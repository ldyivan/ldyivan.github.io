<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>å–è¿œzzyã®åšå®¢</title>
    <link>https://www.hzv5.cn/</link>
    
    <image>
      <url>https://www.hzv5.cn/icon.png</url>
      <title>å–è¿œzzyã®åšå®¢</title>
      <link>https://www.hzv5.cn/</link>
    </image>
    
    <atom:link href="https://www.hzv5.cn/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description>å–è¿œzzyçš„ä¸ªäººåšå®¢ï¼Œä¸“æ³¨äºWebå‰ç«¯å¼€å‘ã€Node.jsã€Vue.jsã€Reactç­‰å…¨æ ˆå†…å®¹åˆ†äº«ã€‚è¿™é‡Œæœ‰æ·±å…¥çš„æŠ€æœ¯æ•™ç¨‹ã€å®ç”¨çš„å¼€å‘ç»éªŒã€æœ€æ–°çš„æŠ€æœ¯åŠ¨æ€ï¼ŒåŠ©ä½ åœ¨ç¼–ç¨‹ä¹‹è·¯ä¸Šä¸æ–­è¿›æ­¥ã€‚</description>
    <pubDate>Wed, 01 Jan 2025 14:55:12 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>Hexoåšå®¢å®ç°éšæœºæ–‡ç« åŠŸèƒ½çš„å®Œæ•´æ•™ç¨‹</title>
      <link>https://www.hzv5.cn/2025/01/01/hexo-random-post/</link>
      <guid>https://www.hzv5.cn/2025/01/01/hexo-random-post/</guid>
      <pubDate>Wed, 01 Jan 2025 14:55:12 GMT</pubDate>
      
      <description>è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨Hexoåšå®¢ä¸­å®ç°éšæœºæ–‡ç« åŠŸèƒ½,åŒ…æ‹¬åˆ›å»ºæ¨¡æ¿æ–‡ä»¶ã€é…ç½®è·¯ç”±ã€æ·»åŠ èœå•é¡¹ç­‰å®Œæ•´æ­¥éª¤,å¸®åŠ©ä½ çš„åšå®¢å¢æ·»è¶£å‘³æ€§ã€‚</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>æƒ³è¦ç»™åšå®¢å¢åŠ ä¸€äº›è¶£å‘³æ€§ï¼Ÿè®©è¯»è€…å¯ä»¥éšæœºæµè§ˆä½ çš„æ–‡ç« æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨Hexoåšå®¢ä¸­å®ç°éšæœºæ–‡ç« åŠŸèƒ½ï¼Œå°±è·Ÿæœ¬åšå®¢çš„ä¾§æ å¯¼èˆªä¸­çš„ã€<a href="/random" title="éšæœºè·å–ä¸€ç¯‡åšæ–‡ - å–è¿œzzy">æ‰‹æ°”</a>ã€‘èœå•ä¸€æ ·çš„æ•ˆæœã€‚</p></blockquote><span id="more"></span><h2 id="1-åŠŸèƒ½ä»‹ç»"><a href="#1-åŠŸèƒ½ä»‹ç»" class="headerlink" title="1. åŠŸèƒ½ä»‹ç»"></a>1. åŠŸèƒ½ä»‹ç»</h2><p>éšæœºæ–‡ç« åŠŸèƒ½å¯ä»¥è®©è®¿é—®è€…éšæœºæµè§ˆåšå®¢ä¸­çš„ä»»æ„ä¸€ç¯‡æ–‡ç« ,è¿™ä¸ä»…èƒ½å¢åŠ åšå®¢çš„è¶£å‘³æ€§,è¿˜èƒ½æé«˜æ–‡ç« çš„æ›å…‰ç‡,è®©ä¸€äº›æ—©æœŸçš„ä¼˜è´¨æ–‡ç« ä¹Ÿæœ‰æœºä¼šè¢«è¯»è€…å‘ç°ã€‚</p><h2 id="2-å®ç°æ­¥éª¤"><a href="#2-å®ç°æ­¥éª¤" class="headerlink" title="2. å®ç°æ­¥éª¤"></a>2. å®ç°æ­¥éª¤</h2><h3 id="2-1-åˆ›å»ºæ¨¡æ¿æ–‡ä»¶"><a href="#2-1-åˆ›å»ºæ¨¡æ¿æ–‡ä»¶" class="headerlink" title="2.1 åˆ›å»ºæ¨¡æ¿æ–‡ä»¶"></a>2.1 åˆ›å»ºæ¨¡æ¿æ–‡ä»¶</h3><p>é¦–å…ˆåœ¨ä¸»é¢˜çš„<code>layout</code>ç›®å½•ä¸‹åˆ›å»º<code>random.ejs</code>æ–‡ä»¶:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">// è·å–æ‰€æœ‰æ–‡ç« </span><br><span class="line">const posts = site.posts.data;</span><br><span class="line">// éšæœºé€‰æ‹©ä¸€ç¯‡æ–‡ç« </span><br><span class="line">const randomPost = posts[Math.floor(Math.random() * posts.length)];</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// ç«‹å³é‡å®šå‘åˆ°éšæœºæ–‡ç« </span><br><span class="line">window.location.href = &#x27;&lt;%- url_for(randomPost.path) %&gt;&#x27;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;noscript&gt;</span><br><span class="line">  &lt;div style=&quot;text-align: center; padding: 20px;&quot;&gt;</span><br><span class="line">    &lt;p&gt;è¯·ç‚¹å‡»ä¸‹æ–¹é“¾æ¥è®¿é—®éšæœºæ–‡ç« ï¼š&lt;/p&gt;</span><br><span class="line">    &lt;a href=&quot;&lt;%- url_for(randomPost.path) %&gt;&quot;&gt;&lt;%- randomPost.title %&gt;&lt;/a&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/noscript&gt;</span><br></pre></td></tr></table></figure><h3 id="2-2-åˆ›å»ºé¡µé¢æ–‡ä»¶"><a href="#2-2-åˆ›å»ºé¡µé¢æ–‡ä»¶" class="headerlink" title="2.2 åˆ›å»ºé¡µé¢æ–‡ä»¶"></a>2.2 åˆ›å»ºé¡µé¢æ–‡ä»¶</h3><p>åœ¨<code>source</code>ç›®å½•ä¸‹åˆ›å»º<code>random</code>æ–‡ä»¶å¤¹,å¹¶åœ¨å…¶ä¸­åˆ›å»º<code>index.md</code>:</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: éšæœºæ–‡ç« </span><br><span class="line">date: 2023-12-31 12:00:00</span><br><span class="line">type: random</span><br><span class="line">layout: random</span><br><span class="line"><span class="section">comments: false</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure><h3 id="2-3-æ·»åŠ èœå•é¡¹"><a href="#2-3-æ·»åŠ èœå•é¡¹" class="headerlink" title="2.3 æ·»åŠ èœå•é¡¹"></a>2.3 æ·»åŠ èœå•é¡¹</h3><p>åœ¨ä¸»é¢˜çš„<code>_config.yml</code>ä¸­æ·»åŠ èœå•é¡¹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">random:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/random</span></span><br><span class="line">    <span class="attr">text:</span> <span class="string">æ‰‹æ°”</span></span><br><span class="line">    <span class="attr">icon:</span> <span class="string">fas</span> <span class="string">fa-random</span></span><br></pre></td></tr></table></figure><h2 id="3-åŠŸèƒ½è¯´æ˜"><a href="#3-åŠŸèƒ½è¯´æ˜" class="headerlink" title="3. åŠŸèƒ½è¯´æ˜"></a>3. åŠŸèƒ½è¯´æ˜</h2><h3 id="3-1-å·¥ä½œåŸç†"><a href="#3-1-å·¥ä½œåŸç†" class="headerlink" title="3.1 å·¥ä½œåŸç†"></a>3.1 å·¥ä½œåŸç†</h3><ol><li>å½“è®¿é—®è€…ç‚¹å‡»â€éšæœºæ–‡ç« â€èœå•æ—¶,ä¼šè®¿é—®<code>/random</code>é¡µé¢</li><li>æ¨¡æ¿ä¼šä»æ‰€æœ‰æ–‡ç« ä¸­éšæœºé€‰æ‹©ä¸€ç¯‡</li><li>é€šè¿‡JavaScriptè‡ªåŠ¨è·³è½¬åˆ°é€‰ä¸­çš„æ–‡ç« </li><li>å¦‚æœæµè§ˆå™¨ç¦ç”¨äº†JavaScript,åˆ™æ˜¾ç¤ºä¸€ä¸ªå¯ç‚¹å‡»çš„é“¾æ¥</li></ol><h3 id="3-2-ä¼˜åŒ–å»ºè®®"><a href="#3-2-ä¼˜åŒ–å»ºè®®" class="headerlink" title="3.2 ä¼˜åŒ–å»ºè®®"></a>3.2 ä¼˜åŒ–å»ºè®®</h3><ol><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>: å¦‚æœåšå®¢æ–‡ç« å¾ˆå¤š,å¯ä»¥è€ƒè™‘ç¼“å­˜æ–‡ç« åˆ—è¡¨</li><li><strong>ç”¨æˆ·ä½“éªŒ</strong>: å¯ä»¥æ·»åŠ åŠ è½½åŠ¨ç”»</li><li><strong>åŠŸèƒ½æ‰©å±•</strong>: å¯ä»¥æŒ‰åˆ†ç±»æˆ–æ ‡ç­¾éšæœº</li></ol><h2 id="4-å¸¸è§é—®é¢˜"><a href="#4-å¸¸è§é—®é¢˜" class="headerlink" title="4. å¸¸è§é—®é¢˜"></a>4. å¸¸è§é—®é¢˜</h2><h3 id="4-1-é¡µé¢é—ªçƒ"><a href="#4-1-é¡µé¢é—ªçƒ" class="headerlink" title="4.1 é¡µé¢é—ªçƒ"></a>4.1 é¡µé¢é—ªçƒ</h3><p>å¦‚æœå‡ºç°é¡µé¢é—ªçƒ,å¯ä»¥æ·»åŠ loadingæ•ˆæœ:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">.loading &#123;</span><br><span class="line">  text-align: center;</span><br><span class="line">  padding: 20px;</span><br><span class="line">&#125;</span><br><span class="line">.loading:after &#123;</span><br><span class="line">  content: &#x27;æ­£åœ¨éšæœºé€‰æ‹©æ–‡ç« ...&#x27;;</span><br><span class="line">  color: #666;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;div class=&quot;loading&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure><h3 id="4-2-é‡å¤è®¿é—®"><a href="#4-2-é‡å¤è®¿é—®" class="headerlink" title="4.2 é‡å¤è®¿é—®"></a>4.2 é‡å¤è®¿é—®</h3><p>å¦‚æœæƒ³é¿å…è¿ç»­è®¿é—®åŒä¸€ç¯‡æ–‡ç« ,å¯ä»¥ä½¿ç”¨sessionStorageè®°å½•å†å²:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å†å²è®°å½•</span></span><br><span class="line"><span class="keyword">const</span> history = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">sessionStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;randomHistory&#x27;</span>) || <span class="string">&#x27;[]&#x27;</span>);</span><br><span class="line"><span class="comment">// è¿‡æ»¤å·²è®¿é—®çš„æ–‡ç« </span></span><br><span class="line"><span class="keyword">const</span> availablePosts = posts.<span class="title function_">filter</span>(<span class="function"><span class="params">post</span> =&gt;</span> !history.<span class="title function_">includes</span>(post.<span class="property">path</span>));</span><br><span class="line"><span class="comment">// å¦‚æœæ‰€æœ‰æ–‡ç« éƒ½è®¿é—®è¿‡,æ¸…ç©ºå†å²</span></span><br><span class="line"><span class="keyword">if</span> (availablePosts.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="variable language_">sessionStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&#x27;randomHistory&#x27;</span>);</span><br><span class="line">  availablePosts = posts;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// éšæœºé€‰æ‹©æ–‡ç« </span></span><br><span class="line"><span class="keyword">const</span> randomPost = availablePosts[<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * availablePosts.<span class="property">length</span>)];</span><br><span class="line"><span class="comment">// è®°å½•åˆ°å†å²</span></span><br><span class="line">history.<span class="title function_">push</span>(randomPost.<span class="property">path</span>);</span><br><span class="line"><span class="variable language_">sessionStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;randomHistory&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(history));</span><br></pre></td></tr></table></figure><h2 id="5-æ€»ç»“"><a href="#5-æ€»ç»“" class="headerlink" title="5. æ€»ç»“"></a>5. æ€»ç»“</h2><p>éšæœºæ–‡ç« åŠŸèƒ½è™½ç„¶å®ç°ç®€å•,ä½†èƒ½å¤§å¤§æå‡åšå®¢çš„è¶£å‘³æ€§å’Œç”¨æˆ·ä½“éªŒã€‚ä½ è¿˜å¯ä»¥åŸºäºè¿™ä¸ªåŸºç¡€åŠŸèƒ½,æ·»åŠ æ›´å¤šä¸ªæ€§åŒ–çš„æ‰©å±•,æ¯”å¦‚æŒ‰ç…§æ–‡ç« çƒ­åº¦éšæœºã€æŒ‰ç…§é˜…è¯»æ—¶é—´éšæœºç­‰ã€‚</p><hr><blockquote><p>å¦‚æœè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©,æ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«,ä½ çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼ </p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.hzv5.cn/categories/Web%E5%BC%80%E5%8F%91/">Webå¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/categories/Web%E5%BC%80%E5%8F%91/Hexo/">Hexo</category>
      
      
      <category domain="https://www.hzv5.cn/tags/%E5%8D%9A%E5%AE%A2%E4%BC%98%E5%8C%96/">åšå®¢ä¼˜åŒ–</category>
      
      <category domain="https://www.hzv5.cn/tags/Hexo/">Hexo</category>
      
      <category domain="https://www.hzv5.cn/tags/JavaScript/">JavaScript</category>
      
      <category domain="https://www.hzv5.cn/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      
      <comments>https://www.hzv5.cn/2025/01/01/hexo-random-post/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>QQé¢‘é“æœºå™¨äººAndroidå®¢æˆ·ç«¯ä½¿ç”¨æŒ‡å—</title>
      <link>https://www.hzv5.cn/2024/12/19/qqch-bot-readme/</link>
      <guid>https://www.hzv5.cn/2024/12/19/qqch-bot-readme/</guid>
      <pubDate>Wed, 18 Dec 2024 18:58:36 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;QQé¢‘é“æœºå™¨äºº-Androidå®¢æˆ·ç«¯&quot;&gt;&lt;a href=&quot;#QQé¢‘é“æœºå™¨äºº-Androidå®¢æˆ·ç«¯&quot; class=&quot;headerlink&quot; title=&quot;QQé¢‘é“æœºå™¨äºº Androidå®¢æˆ·ç«¯&quot;&gt;&lt;/a&gt;QQé¢‘é“æœºå™¨äºº Androidå®¢æˆ·ç«¯&lt;/h1&gt;&lt;p&gt;ä¸€ä¸ªç”¨äºç®¡ç†å’Œæ“ä½œQQé¢‘é“æœºå™¨äººçš„Androidå®¢æˆ·ç«¯åº”ç”¨ï¼ŒåŸºäºuniappå¼€å‘ï¼Œæä¾›äº†ç›´è§‚çš„ç”¨æˆ·ç•Œé¢å’Œä¸°å¯Œçš„åŠŸèƒ½ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å®¢æˆ·ç«¯ç•Œé¢é¢„è§ˆ&quot;&gt;&lt;a href=&quot;#å®¢æˆ·ç«¯ç•Œé¢é¢„è§ˆ&quot; class=&quot;headerlink&quot; title=&quot;å®¢æˆ·ç«¯ç•Œé¢é¢„è§ˆ&quot;&gt;&lt;/a&gt;å®¢æˆ·ç«¯ç•Œé¢é¢„è§ˆ&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/img/qqBot/login_chat.png&quot; alt=&quot;ç™»å½•é¢‘é“èŠå¤©æŸ¥çœ‹å’Œå‘é€æ¶ˆæ¯&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/img/qqBot/plugin_setting_log.png&quot; alt=&quot;æ’ä»¶åŠŸèƒ½è¿è¡Œæ—¥å¿—å’Œè®¾ç½®&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;åŠŸèƒ½ç‰¹æ€§&quot;&gt;&lt;a href=&quot;#åŠŸèƒ½ç‰¹æ€§&quot; class=&quot;headerlink&quot; title=&quot;åŠŸèƒ½ç‰¹æ€§&quot;&gt;&lt;/a&gt;åŠŸèƒ½ç‰¹æ€§&lt;/h2&gt;&lt;h3 id=&quot;1-è´¦å·ç®¡ç†&quot;&gt;&lt;a href=&quot;#1-è´¦å·ç®¡ç†&quot; class=&quot;headerlink&quot; title=&quot;1. è´¦å·ç®¡ç†&quot;&gt;&lt;/a&gt;1. è´¦å·ç®¡ç†&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;App IDå’ŒTokenç™»å½•&lt;/li&gt;
&lt;li&gt;è®°ä½ç™»å½•çŠ¶æ€&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨ç™»å½•é€‰é¡¹&lt;/li&gt;
&lt;li&gt;æ²™ç›’/æ­£å¼ç¯å¢ƒåˆ‡æ¢&lt;/li&gt;
&lt;li&gt;å¤šè´¦å·ç®¡ç†&lt;/li&gt;
&lt;li&gt;è´¦å·å®‰å…¨ä¿æŠ¤&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;2-é¢‘é“ç®¡ç†&quot;&gt;&lt;a href=&quot;#2-é¢‘é“ç®¡ç†&quot; class=&quot;headerlink&quot; title=&quot;2. é¢‘é“ç®¡ç†&quot;&gt;&lt;/a&gt;2. é¢‘é“ç®¡ç†&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;é¢‘é“åˆ—è¡¨æ˜¾ç¤º&lt;ul&gt;
&lt;li&gt;åˆ†ç»„å±•ç¤º&lt;/li&gt;
&lt;li&gt;åœ¨çº¿äººæ•°æ˜¾ç¤º&lt;/li&gt;
&lt;li&gt;é¢‘é“ç±»å‹å›¾æ ‡&lt;/li&gt;
&lt;li&gt;é¢‘é“çŠ¶æ€æ ‡è¯†&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æœªè¯»æ¶ˆæ¯ç»Ÿè®¡&lt;ul&gt;
&lt;li&gt;æ™®é€šæ¶ˆæ¯è®¡æ•°&lt;/li&gt;
&lt;li&gt;@æ¶ˆæ¯ç‰¹åˆ«æ ‡è®°&lt;/li&gt;
&lt;li&gt;æŒ‰é¢‘é“åˆ†ç±»ç»Ÿè®¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é¢‘é“æƒé™ç®¡ç†&lt;ul&gt;
&lt;li&gt;è‡ªåŠ¨è¯†åˆ«ç®¡ç†å‘˜æƒé™&lt;/li&gt;
&lt;li&gt;æƒé™å€¼å®æ—¶è®¡ç®—&lt;/li&gt;
&lt;li&gt;æƒé™æ£€æŸ¥åŠŸèƒ½&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;3-æ¶ˆæ¯åŠŸèƒ½&quot;&gt;&lt;a href=&quot;#3-æ¶ˆæ¯åŠŸèƒ½&quot; class=&quot;headerlink&quot; title=&quot;3. æ¶ˆæ¯åŠŸèƒ½&quot;&gt;&lt;/a&gt;3. æ¶ˆæ¯åŠŸèƒ½&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;å®æ—¶æ¶ˆæ¯æ¥æ”¶&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="QQé¢‘é“æœºå™¨äºº-Androidå®¢æˆ·ç«¯"><a href="#QQé¢‘é“æœºå™¨äºº-Androidå®¢æˆ·ç«¯" class="headerlink" title="QQé¢‘é“æœºå™¨äºº Androidå®¢æˆ·ç«¯"></a>QQé¢‘é“æœºå™¨äºº Androidå®¢æˆ·ç«¯</h1><p>ä¸€ä¸ªç”¨äºç®¡ç†å’Œæ“ä½œQQé¢‘é“æœºå™¨äººçš„Androidå®¢æˆ·ç«¯åº”ç”¨ï¼ŒåŸºäºuniappå¼€å‘ï¼Œæä¾›äº†ç›´è§‚çš„ç”¨æˆ·ç•Œé¢å’Œä¸°å¯Œçš„åŠŸèƒ½ç‰¹æ€§ã€‚</p><h2 id="å®¢æˆ·ç«¯ç•Œé¢é¢„è§ˆ"><a href="#å®¢æˆ·ç«¯ç•Œé¢é¢„è§ˆ" class="headerlink" title="å®¢æˆ·ç«¯ç•Œé¢é¢„è§ˆ"></a>å®¢æˆ·ç«¯ç•Œé¢é¢„è§ˆ</h2><p><img src="/img/qqBot/login_chat.png" alt="ç™»å½•é¢‘é“èŠå¤©æŸ¥çœ‹å’Œå‘é€æ¶ˆæ¯"></p><p><img src="/img/qqBot/plugin_setting_log.png" alt="æ’ä»¶åŠŸèƒ½è¿è¡Œæ—¥å¿—å’Œè®¾ç½®"></p><h2 id="åŠŸèƒ½ç‰¹æ€§"><a href="#åŠŸèƒ½ç‰¹æ€§" class="headerlink" title="åŠŸèƒ½ç‰¹æ€§"></a>åŠŸèƒ½ç‰¹æ€§</h2><h3 id="1-è´¦å·ç®¡ç†"><a href="#1-è´¦å·ç®¡ç†" class="headerlink" title="1. è´¦å·ç®¡ç†"></a>1. è´¦å·ç®¡ç†</h3><ul><li>App IDå’ŒTokenç™»å½•</li><li>è®°ä½ç™»å½•çŠ¶æ€</li><li>è‡ªåŠ¨ç™»å½•é€‰é¡¹</li><li>æ²™ç›’/æ­£å¼ç¯å¢ƒåˆ‡æ¢</li><li>å¤šè´¦å·ç®¡ç†</li><li>è´¦å·å®‰å…¨ä¿æŠ¤</li></ul><h3 id="2-é¢‘é“ç®¡ç†"><a href="#2-é¢‘é“ç®¡ç†" class="headerlink" title="2. é¢‘é“ç®¡ç†"></a>2. é¢‘é“ç®¡ç†</h3><ul><li>é¢‘é“åˆ—è¡¨æ˜¾ç¤º<ul><li>åˆ†ç»„å±•ç¤º</li><li>åœ¨çº¿äººæ•°æ˜¾ç¤º</li><li>é¢‘é“ç±»å‹å›¾æ ‡</li><li>é¢‘é“çŠ¶æ€æ ‡è¯†</li></ul></li><li>æœªè¯»æ¶ˆæ¯ç»Ÿè®¡<ul><li>æ™®é€šæ¶ˆæ¯è®¡æ•°</li><li>@æ¶ˆæ¯ç‰¹åˆ«æ ‡è®°</li><li>æŒ‰é¢‘é“åˆ†ç±»ç»Ÿè®¡</li></ul></li><li>é¢‘é“æƒé™ç®¡ç†<ul><li>è‡ªåŠ¨è¯†åˆ«ç®¡ç†å‘˜æƒé™</li><li>æƒé™å€¼å®æ—¶è®¡ç®—</li><li>æƒé™æ£€æŸ¥åŠŸèƒ½</li></ul></li></ul><h3 id="3-æ¶ˆæ¯åŠŸèƒ½"><a href="#3-æ¶ˆæ¯åŠŸèƒ½" class="headerlink" title="3. æ¶ˆæ¯åŠŸèƒ½"></a>3. æ¶ˆæ¯åŠŸèƒ½</h3><ul><li><p>å®æ—¶æ¶ˆæ¯æ¥æ”¶</p><span id="more"></span><ul><li>WebSocketé•¿è¿æ¥</li><li>æ–­çº¿è‡ªåŠ¨é‡è¿</li><li>å¿ƒè·³ä¿æ´»æœºåˆ¶</li></ul></li><li><p>æ¶ˆæ¯å‘é€åŠŸèƒ½</p><ul><li>æ–‡æœ¬æ¶ˆæ¯æ”¯æŒ</li><li>æ¶ˆæ¯å®¡æ ¸å¤„ç†</li><li>å®¡æ ¸çŠ¶æ€æ˜¾ç¤º</li></ul></li><li><p>æ¶ˆæ¯ç®¡ç†</p><ul><li>æ¶ˆæ¯æ’¤å›</li><li>å†å²è®°å½•æŸ¥çœ‹</li><li>ç³»ç»Ÿæ¶ˆæ¯æ˜¾ç¤º</li><li>åœ¨çº¿çŠ¶æ€æ›´æ–°</li></ul></li><li><p>æ¶ˆæ¯å±•ç¤º</p><ul><li>æ—¶é—´æˆ³æ˜¾ç¤º</li><li>ç”¨æˆ·èº«ä»½æ ‡è¯†</li><li>æ¶ˆæ¯çŠ¶æ€å›¾æ ‡</li><li>é•¿æŒ‰èœå•æ“ä½œ</li></ul></li></ul><h3 id="4-æ’ä»¶ç³»ç»Ÿ"><a href="#4-æ’ä»¶ç³»ç»Ÿ" class="headerlink" title="4. æ’ä»¶ç³»ç»Ÿ"></a>4. æ’ä»¶ç³»ç»Ÿ</h3><ul><li>æ’ä»¶ç®¡ç†<ul><li>å¯ç”¨/ç¦ç”¨æ§åˆ¶</li><li>æœ¬åœ°å­˜å‚¨æ”¯æŒ</li><li>é…ç½®é¡¹ç®¡ç†</li></ul></li><li>æ’ä»¶åŠŸèƒ½<ul><li>å‘½ä»¤å¤„ç†</li><li>æ•°æ®æŒä¹…åŒ–</li><li>æ—¥å¿—è®°å½•</li><li>APIè°ƒç”¨</li></ul></li><li>å†…ç½®æ’ä»¶<ul><li>æ¯æ—¥ç­¾åˆ°</li><li>ç™¾åº¦ç™¾ç§‘</li></ul></li><li>å¼€å‘æ”¯æŒ<ul><li>å®Œæ•´APIæ–‡æ¡£</li><li>ç¤ºä¾‹ä»£ç </li><li>å¼€å‘æŒ‡å—</li></ul></li></ul><h3 id="5-é€šçŸ¥ç³»ç»Ÿ"><a href="#5-é€šçŸ¥ç³»ç»Ÿ" class="headerlink" title="5. é€šçŸ¥ç³»ç»Ÿ"></a>5. é€šçŸ¥ç³»ç»Ÿ</h3><ul><li>æ¶ˆæ¯é€šçŸ¥<ul><li>æ–°æ¶ˆæ¯æé†’</li><li>@æ¶ˆæ¯ç‰¹æ®Šæç¤º</li><li>æ¶ˆæ¯åˆå¹¶æ˜¾ç¤º</li><li>é€šçŸ¥å»¶è¿Ÿå¤„ç†</li></ul></li><li>é€šçŸ¥ç®¡ç†<ul><li>æ˜¯å¦å¼€å¯é€šçŸ¥</li><li>æ˜¯å¦éœ‡åŠ¨æé†’</li><li>æ˜¯å¦ç³»ç»Ÿé€šçŸ¥</li><li>å…æ‰“æ‰°è®¾ç½®</li></ul></li><li>é€šçŸ¥ä¼˜åŒ–<ul><li>æ¶ˆæ¯å»é‡</li><li>æ‰¹é‡å¤„ç†</li><li>æ™ºèƒ½å»¶è¿Ÿ</li><li>æ€§èƒ½ä¼˜åŒ–</li></ul></li></ul><h2 id="ç³»ç»Ÿè¦æ±‚"><a href="#ç³»ç»Ÿè¦æ±‚" class="headerlink" title="ç³»ç»Ÿè¦æ±‚"></a>ç³»ç»Ÿè¦æ±‚</h2><h3 id="åŸºæœ¬è¦æ±‚"><a href="#åŸºæœ¬è¦æ±‚" class="headerlink" title="åŸºæœ¬è¦æ±‚"></a>åŸºæœ¬è¦æ±‚</h3><ul><li>Android 5.0+</li><li>ç½‘ç»œè¿æ¥</li><li>å­˜å‚¨ç©ºé—´ &gt;= 50MB</li><li>é€šçŸ¥æƒé™(å¯é€‰)</li><li>åå°è¿è¡Œæƒé™(æ¨è)</li></ul><h3 id="æƒé™è¯´æ˜"><a href="#æƒé™è¯´æ˜" class="headerlink" title="æƒé™è¯´æ˜"></a>æƒé™è¯´æ˜</h3><ol><li><p>å¿…éœ€æƒé™</p><ul><li>ç½‘ç»œè®¿é—®</li><li>å­˜å‚¨è¯»å†™</li><li>åå°è¿è¡Œ</li></ul></li><li><p>å¯é€‰æƒé™</p><ul><li>é€šçŸ¥æ˜¾ç¤º</li><li>å¼€æœºè‡ªå¯</li><li>éœ‡åŠ¨æ§åˆ¶</li></ul></li></ol><h2 id="å®‰è£…è¯´æ˜"><a href="#å®‰è£…è¯´æ˜" class="headerlink" title="å®‰è£…è¯´æ˜"></a>å®‰è£…è¯´æ˜</h2><ol><li><p>ä¸‹è½½å®‰è£…</p><ul><li>ä»Releaseé¡µé¢ä¸‹è½½æœ€æ–°APK</li><li>å…è®¸å®‰è£…æœªçŸ¥æ¥æºåº”ç”¨</li><li>æŒ‰æç¤ºå®Œæˆå®‰è£…</li></ul></li><li><p>é¦–æ¬¡é…ç½®</p><ul><li>æˆäºˆå¿…è¦æƒé™</li><li>ç™»å½•æœºå™¨äººè´¦å·</li><li>é…ç½®åŸºæœ¬è®¾ç½®</li></ul></li></ol><h2 id="ä½¿ç”¨æŒ‡å—"><a href="#ä½¿ç”¨æŒ‡å—" class="headerlink" title="ä½¿ç”¨æŒ‡å—"></a>ä½¿ç”¨æŒ‡å—</h2><h3 id="1-ç™»å½•é…ç½®"><a href="#1-ç™»å½•é…ç½®" class="headerlink" title="1. ç™»å½•é…ç½®"></a>1. ç™»å½•é…ç½®</h3><h4 id="1-1-è·å–å‡­æ®"><a href="#1-1-è·å–å‡­æ®" class="headerlink" title="1.1 è·å–å‡­æ®"></a>1.1 è·å–å‡­æ®</h4><ol><li>è®¿é—®<a href="https://q.qq.com">QQæœºå™¨äººç®¡ç†å¹³å°</a></li><li>åˆ›å»º/é€‰æ‹©æœºå™¨äºº</li><li>è·å–App IDå’ŒToken</li><li>ç¡®è®¤æœºå™¨äººçŠ¶æ€æ­£å¸¸</li></ol><h4 id="1-2-ç™»å½•è®¾ç½®"><a href="#1-2-ç™»å½•è®¾ç½®" class="headerlink" title="1.2 ç™»å½•è®¾ç½®"></a>1.2 ç™»å½•è®¾ç½®</h4><ol><li>è¾“å…¥App IDå’ŒToken</li><li>é€‰æ‹©ç¯å¢ƒ(æ²™ç›’/æ­£å¼)</li><li>è®¾ç½®è‡ªåŠ¨ç™»å½•(å¯é€‰)</li><li>é…ç½®å®‰å…¨é€‰é¡¹</li></ol><h3 id="2-é¢‘é“æ“ä½œ"><a href="#2-é¢‘é“æ“ä½œ" class="headerlink" title="2. é¢‘é“æ“ä½œ"></a>2. é¢‘é“æ“ä½œ</h3><h4 id="2-1-æŸ¥çœ‹é¢‘é“"><a href="#2-1-æŸ¥çœ‹é¢‘é“" class="headerlink" title="2.1 æŸ¥çœ‹é¢‘é“"></a>2.1 æŸ¥çœ‹é¢‘é“</h4><ol><li><p>æ‰“å¼€é¢‘é“åˆ—è¡¨</p><ul><li>ç‚¹å‡»é¡¶éƒ¨é¢‘é“ä¿¡æ¯å±•å¼€åˆ—è¡¨</li><li>æŸ¥çœ‹åˆ†ç»„å’Œå­é¢‘é“</li><li>è§‚å¯Ÿåœ¨çº¿äººæ•°å’ŒçŠ¶æ€</li></ul></li><li><p>é¢‘é“åˆ†ç±»</p><ul><li>æ–‡å­—é¢‘é“(#)</li><li>è¯­éŸ³é¢‘é“(ğŸ”Š)</li><li>ç›´æ’­é¢‘é“(ğŸ“º)</li><li>å…¬å‘Šé¢‘é“(ğŸ“¢)</li><li>åº”ç”¨é¢‘é“(ğŸ’¬)</li><li>è®ºå›é¢‘é“(ğŸ®)</li></ul></li><li><p>æœªè¯»æ¶ˆæ¯</p><ul><li>çº¢ç‚¹æ˜¾ç¤ºæœªè¯»æ•°</li><li>æ©™è‰²æ ‡è®°@æ¶ˆæ¯</li><li>ç‚¹å‡»æ¸…é™¤æœªè¯»</li></ul></li></ol><h4 id="2-2-æ¶ˆæ¯ç®¡ç†"><a href="#2-2-æ¶ˆæ¯ç®¡ç†" class="headerlink" title="2.2 æ¶ˆæ¯ç®¡ç†"></a>2.2 æ¶ˆæ¯ç®¡ç†</h4><ol><li><p>å‘é€æ¶ˆæ¯</p><ul><li>åœ¨è¾“å…¥æ¡†è¾“å…¥å†…å®¹</li><li>ç‚¹å‡»å‘é€æŒ‰é’®</li><li>ç­‰å¾…å‘é€çŠ¶æ€</li><li>æŸ¥çœ‹å®¡æ ¸ç»“æœ</li></ul></li><li><p>æ¶ˆæ¯æ“ä½œ</p><ul><li>é•¿æŒ‰æ¶ˆæ¯æ˜¾ç¤ºèœå•</li><li>é€‰æ‹©æ’¤å›ç­‰æ“ä½œ</li><li>æŸ¥çœ‹æ¶ˆæ¯è¯¦æƒ…</li></ul></li><li><p>æ¶ˆæ¯çŠ¶æ€</p><ul><li>æ­£å¸¸æ¶ˆæ¯</li><li>å®¡æ ¸ä¸­(ç°è‰²)</li><li>å®¡æ ¸æ‹’ç»(çº¢è‰²)</li><li>å·²æ’¤å›(ç°è‰²æ–œä½“)</li></ul></li></ol><h3 id="3-æ’ä»¶ä½¿ç”¨"><a href="#3-æ’ä»¶ä½¿ç”¨" class="headerlink" title="3. æ’ä»¶ä½¿ç”¨"></a>3. æ’ä»¶ä½¿ç”¨</h3><h4 id="3-1-æ’ä»¶ç®¡ç†"><a href="#3-1-æ’ä»¶ç®¡ç†" class="headerlink" title="3.1 æ’ä»¶ç®¡ç†"></a>3.1 æ’ä»¶ç®¡ç†</h4><ol><li><p>å†…ç½®æ’ä»¶</p><ul><li>æ¯æ—¥ç­¾åˆ°(/ç­¾åˆ°)</li><li>ç™¾åº¦ç™¾ç§‘(/ç™¾ç§‘)</li></ul></li><li><p>æ’ä»¶æ§åˆ¶</p><ul><li>å¯ç”¨/ç¦ç”¨æ’ä»¶</li><li>æŸ¥çœ‹æ’ä»¶ä¿¡æ¯</li><li>ç®¡ç†æ’ä»¶æ•°æ®</li></ul></li></ol><h4 id="3-2-æ’ä»¶å‘½ä»¤"><a href="#3-2-æ’ä»¶å‘½ä»¤" class="headerlink" title="3.2 æ’ä»¶å‘½ä»¤"></a>3.2 æ’ä»¶å‘½ä»¤</h4><ol><li><p>å‘½ä»¤æ ¼å¼</p><ul><li>ä»¥/å¼€å¤´</li><li>ä¸¥æ ¼åŒ¹é…å‘½ä»¤å</li><li>ç©ºæ ¼åˆ†éš”å‚æ•°</li></ul></li><li><p>ä½¿ç”¨ç¤ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/ç­¾åˆ°              # æ‰§è¡Œç­¾åˆ°</span><br><span class="line">/ç™¾ç§‘ å¤ªé˜³         # æŸ¥è¯¢ç™¾ç§‘</span><br></pre></td></tr></table></figure></li></ol><h3 id="4-é€šçŸ¥è®¾ç½®"><a href="#4-é€šçŸ¥è®¾ç½®" class="headerlink" title="4. é€šçŸ¥è®¾ç½®"></a>4. é€šçŸ¥è®¾ç½®</h3><h4 id="4-1-é€šçŸ¥é€‰é¡¹"><a href="#4-1-é€šçŸ¥é€‰é¡¹" class="headerlink" title="4.1 é€šçŸ¥é€‰é¡¹"></a>4.1 é€šçŸ¥é€‰é¡¹</h4><ol><li><p>åŸºæœ¬è®¾ç½®</p><ul><li>å¯ç”¨é€šçŸ¥</li><li>éœ‡åŠ¨æé†’</li><li>ç³»ç»Ÿé€šçŸ¥</li></ul></li><li><p>é€šçŸ¥è§„åˆ™</p><ul><li>æ–°æ¶ˆæ¯å»¶è¿Ÿ2ç§’</li><li>å¤šæ¡æ¶ˆæ¯åˆå¹¶</li><li>@æ¶ˆæ¯ç«‹å³æé†’</li><li>éå½“å‰é¢‘é“é€šçŸ¥</li></ul></li></ol><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><h3 id="1-è¿æ¥é—®é¢˜"><a href="#1-è¿æ¥é—®é¢˜" class="headerlink" title="1. è¿æ¥é—®é¢˜"></a>1. è¿æ¥é—®é¢˜</h3><ul><li>é—®é¢˜: æ— æ³•è¿æ¥æˆ–é¢‘ç¹æ–­å¼€</li><li>è§£å†³: <ol><li>æ£€æŸ¥ç½‘ç»œè¿æ¥</li><li>ç¡®è®¤Tokenæ­£ç¡®</li><li>æŸ¥çœ‹æœºå™¨äººçŠ¶æ€</li><li>ç­‰å¾…è‡ªåŠ¨é‡è¿</li></ol></li></ul><h3 id="2-æ¶ˆæ¯é—®é¢˜"><a href="#2-æ¶ˆæ¯é—®é¢˜" class="headerlink" title="2. æ¶ˆæ¯é—®é¢˜"></a>2. æ¶ˆæ¯é—®é¢˜</h3><ul><li>é—®é¢˜: æ¶ˆæ¯å‘é€å¤±è´¥</li><li>è§£å†³:<ol><li>æ£€æŸ¥é¢‘é“æƒé™</li><li>ç¡®è®¤æ¶ˆæ¯æ ¼å¼</li><li>ç­‰å¾…å®¡æ ¸é€šè¿‡</li><li>æŸ¥çœ‹é”™è¯¯æç¤º</li></ol></li></ul><h3 id="3-æ’ä»¶é—®é¢˜"><a href="#3-æ’ä»¶é—®é¢˜" class="headerlink" title="3. æ’ä»¶é—®é¢˜"></a>3. æ’ä»¶é—®é¢˜</h3><ul><li>é—®é¢˜: æ’ä»¶æ— å“åº”</li><li>è§£å†³:<ol><li>æ£€æŸ¥æ’ä»¶çŠ¶æ€</li><li>ç¡®è®¤å‘½ä»¤æ ¼å¼</li><li>æŸ¥çœ‹é”™è¯¯æ—¥å¿—</li><li>é‡å¯åº”ç”¨</li></ol></li></ul><h3 id="4-é€šçŸ¥é—®é¢˜"><a href="#4-é€šçŸ¥é—®é¢˜" class="headerlink" title="4. é€šçŸ¥é—®é¢˜"></a>4. é€šçŸ¥é—®é¢˜</h3><ul><li>é—®é¢˜: æ”¶ä¸åˆ°é€šçŸ¥</li><li>è§£å†³:<ol><li>æ£€æŸ¥é€šçŸ¥æƒé™</li><li>ç¡®è®¤é€šçŸ¥è®¾ç½®</li><li>å…³é—­çœç”µæ¨¡å¼</li><li>å…è®¸åå°è¿è¡Œ</li></ol></li></ul><h2 id="æ›´æ–°æ—¥å¿—"><a href="#æ›´æ–°æ—¥å¿—" class="headerlink" title="æ›´æ–°æ—¥å¿—"></a>æ›´æ–°æ—¥å¿—</h2><h3 id="v1-1-0-2024-01-20"><a href="#v1-1-0-2024-01-20" class="headerlink" title="v1.1.0 (2024-01-20)"></a>v1.1.0 (2024-01-20)</h3><ul><li>ä¼˜åŒ–WebSocketè¿æ¥</li><li>æ”¹è¿›æ¶ˆæ¯å¤„ç†é€»è¾‘</li><li>å®Œå–„æ’ä»¶ç³»ç»Ÿ</li><li>ä¼˜åŒ–é€šçŸ¥æœºåˆ¶</li><li>ä¿®å¤å·²çŸ¥é—®é¢˜</li></ul><h3 id="v1-0-0-2023-12-25"><a href="#v1-0-0-2023-12-25" class="headerlink" title="v1.0.0 (2023-12-25)"></a>v1.0.0 (2023-12-25)</h3><ul><li>é¦–æ¬¡å‘å¸ƒ</li><li>åŸºç¡€åŠŸèƒ½å®ç°</li><li>æ’ä»¶ç³»ç»Ÿæ”¯æŒ</li><li>é€šçŸ¥ç³»ç»Ÿé›†æˆ</li></ul><h2 id="æ›´å¤šå¾…è¡¥å……"><a href="#æ›´å¤šå¾…è¡¥å……" class="headerlink" title="æ›´å¤šå¾…è¡¥å……"></a>æ›´å¤šå¾…è¡¥å……</h2><p>ä¹ˆä¹ˆå“’~~</p>]]></content:encoded>
      
      
      <category domain="https://www.hzv5.cn/categories/%E7%9F%A5%E8%AF%86%E7%82%B9/">çŸ¥è¯†ç‚¹</category>
      
      
      <category domain="https://www.hzv5.cn/tags/%E7%AC%94%E8%AE%B0/">ç¬”è®°</category>
      
      <category domain="https://www.hzv5.cn/tags/QQ/">QQ</category>
      
      <category domain="https://www.hzv5.cn/tags/QQ%E9%A2%91%E9%81%93/">QQé¢‘é“</category>
      
      <category domain="https://www.hzv5.cn/tags/QQ%E6%9C%BA%E5%99%A8%E4%BA%BA/">QQæœºå™¨äºº</category>
      
      <category domain="https://www.hzv5.cn/tags/%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/">ä½¿ç”¨æ–‡æ¡£</category>
      
      
      <comments>https://www.hzv5.cn/2024/12/19/qqch-bot-readme/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>å®‰å“ç‰ˆQQé¢‘é“æœºå™¨äººAPPå®¢æˆ·ç«¯æ’ä»¶å¼€å‘æŒ‡å—</title>
      <link>https://www.hzv5.cn/2024/12/19/qqch-bot-plugin/</link>
      <guid>https://www.hzv5.cn/2024/12/19/qqch-bot-plugin/</guid>
      <pubDate>Wed, 18 Dec 2024 17:50:56 GMT</pubDate>
      
      <description>&lt;p&gt;æœ¬æ–‡æ¡£å°†æŒ‡å¯¼æ‚¨å¦‚ä½•ä¸ºQQé¢‘é“æœºå™¨äººå®¢æˆ·ç«¯å¼€å‘æ’ä»¶ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ’ä»¶ç»“æ„&quot;&gt;&lt;a href=&quot;#æ’ä»¶ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;æ’ä»¶ç»“æ„&quot;&gt;&lt;/a&gt;æ’ä»¶ç»“æ„&lt;/h2&gt;&lt;p&gt;æ¯ä¸ªæ’ä»¶éƒ½æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ JavaScript æ–‡ä»¶ï¼Œéœ€è¦å¯¼å‡ºä¸€ä¸ªåŒ…å«ä»¥ä¸‹å­—æ®µçš„å¯¹è±¡:&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// æ’ä»¶å¯¹è±¡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; plugin = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// åŸºæœ¬ä¿¡æ¯(å¿…éœ€)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;plugin-id&amp;#x27;&lt;/span&gt;,          &lt;span class=&quot;comment&quot;&gt;// æ’ä»¶ID,åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œæ¨ªçº¿&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;æ’ä»¶åç§°&amp;#x27;&lt;/span&gt;,         &lt;span class=&quot;comment&quot;&gt;// æ’ä»¶æ˜¾ç¤ºåç§°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;description&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;æ’ä»¶æè¿°&amp;#x27;&lt;/span&gt;,  &lt;span class=&quot;comment&quot;&gt;// æ’ä»¶åŠŸèƒ½æè¿°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;command&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;/å‘½ä»¤&amp;#x27;&lt;/span&gt;,         &lt;span class=&quot;comment&quot;&gt;// è§¦å‘å‘½ä»¤,å¿…é¡»ä»¥/å¼€å¤´&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// åŸºæœ¬ä¿¡æ¯(å¯é€‰)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;version&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;1.0.0&amp;#x27;&lt;/span&gt;,        &lt;span class=&quot;comment&quot;&gt;// æ’ä»¶ç‰ˆæœ¬å·&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;author&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;ä½œè€…åç§°&amp;#x27;&lt;/span&gt;,      &lt;span class=&quot;comment&quot;&gt;// æ’ä»¶ä½œè€…&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;enabled&lt;/span&gt;: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,           &lt;span class=&quot;comment&quot;&gt;// æ’ä»¶æ˜¯å¦å¯ç”¨&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// é…ç½®é¡¹(å¯é€‰)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;config&lt;/span&gt;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æ’ä»¶çš„é…ç½®é¡¹&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;minPoints&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;,         &lt;span class=&quot;comment&quot;&gt;// ç¤ºä¾‹:æœ€å°ç§¯åˆ†&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;maxPoints&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;,        &lt;span class=&quot;comment&quot;&gt;// ç¤ºä¾‹:æœ€å¤§ç§¯åˆ†&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// æ•°æ®å­˜å‚¨(å¯é€‰)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;storage&lt;/span&gt;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æ’ä»¶çš„æ•°æ®å­˜å‚¨&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;records&lt;/span&gt;: &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Map&lt;/span&gt;()     &lt;span class=&quot;comment&quot;&gt;// ç¤ºä¾‹:è®°å½•å­˜å‚¨&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// æ¶ˆæ¯å¤„ç†å‡½æ•°(å¿…éœ€)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;handler&lt;/span&gt;: &lt;span class=&quot;title function_&quot;&gt;async&lt;/span&gt; (message, channel, context) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// è¿”å›å€¼:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// - å­—ç¬¦ä¸²: è¦å‘é€çš„å›å¤æ¶ˆæ¯&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// - null/undefined: ä¸å‘é€å›å¤&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// - Promise&amp;lt;string&amp;gt;: å¼‚æ­¥è¿”å›å›å¤æ¶ˆæ¯&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;å›å¤æ¶ˆæ¯&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å¯¼å‡ºæ’ä»¶&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable language_&quot;&gt;module&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;exports&lt;/span&gt; = plugin&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;API-è¯´æ˜&quot;&gt;&lt;a href=&quot;#API-è¯´æ˜&quot; class=&quot;headerlink&quot; title=&quot;API è¯´æ˜&quot;&gt;&lt;/a&gt;API è¯´æ˜&lt;/h2&gt;&lt;h3 id=&quot;1-æ¶ˆæ¯å¯¹è±¡-message&quot;&gt;&lt;a href=&quot;#1-æ¶ˆæ¯å¯¹è±¡-message&quot; class=&quot;headerlink&quot; title=&quot;1. æ¶ˆæ¯å¯¹è±¡(message)&quot;&gt;&lt;/a&gt;1. æ¶ˆæ¯å¯¹è±¡(message)&lt;/h3&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>æœ¬æ–‡æ¡£å°†æŒ‡å¯¼æ‚¨å¦‚ä½•ä¸ºQQé¢‘é“æœºå™¨äººå®¢æˆ·ç«¯å¼€å‘æ’ä»¶ã€‚</p><h2 id="æ’ä»¶ç»“æ„"><a href="#æ’ä»¶ç»“æ„" class="headerlink" title="æ’ä»¶ç»“æ„"></a>æ’ä»¶ç»“æ„</h2><p>æ¯ä¸ªæ’ä»¶éƒ½æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ JavaScript æ–‡ä»¶ï¼Œéœ€è¦å¯¼å‡ºä¸€ä¸ªåŒ…å«ä»¥ä¸‹å­—æ®µçš„å¯¹è±¡:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ’ä»¶å¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> plugin = &#123;</span><br><span class="line">  <span class="comment">// åŸºæœ¬ä¿¡æ¯(å¿…éœ€)</span></span><br><span class="line">  <span class="attr">id</span>: <span class="string">&#x27;plugin-id&#x27;</span>,          <span class="comment">// æ’ä»¶ID,åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œæ¨ªçº¿</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;æ’ä»¶åç§°&#x27;</span>,         <span class="comment">// æ’ä»¶æ˜¾ç¤ºåç§°</span></span><br><span class="line">  <span class="attr">description</span>: <span class="string">&#x27;æ’ä»¶æè¿°&#x27;</span>,  <span class="comment">// æ’ä»¶åŠŸèƒ½æè¿°</span></span><br><span class="line">  <span class="attr">command</span>: <span class="string">&#x27;/å‘½ä»¤&#x27;</span>,         <span class="comment">// è§¦å‘å‘½ä»¤,å¿…é¡»ä»¥/å¼€å¤´</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åŸºæœ¬ä¿¡æ¯(å¯é€‰)</span></span><br><span class="line">  <span class="attr">version</span>: <span class="string">&#x27;1.0.0&#x27;</span>,        <span class="comment">// æ’ä»¶ç‰ˆæœ¬å·</span></span><br><span class="line">  <span class="attr">author</span>: <span class="string">&#x27;ä½œè€…åç§°&#x27;</span>,      <span class="comment">// æ’ä»¶ä½œè€…</span></span><br><span class="line">  <span class="attr">enabled</span>: <span class="literal">true</span>,           <span class="comment">// æ’ä»¶æ˜¯å¦å¯ç”¨</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// é…ç½®é¡¹(å¯é€‰)</span></span><br><span class="line">  <span class="attr">config</span>: &#123;</span><br><span class="line">    <span class="comment">// æ’ä»¶çš„é…ç½®é¡¹</span></span><br><span class="line">    <span class="attr">minPoints</span>: <span class="number">10</span>,         <span class="comment">// ç¤ºä¾‹:æœ€å°ç§¯åˆ†</span></span><br><span class="line">    <span class="attr">maxPoints</span>: <span class="number">100</span>,        <span class="comment">// ç¤ºä¾‹:æœ€å¤§ç§¯åˆ†</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ•°æ®å­˜å‚¨(å¯é€‰)</span></span><br><span class="line">  <span class="attr">storage</span>: &#123;</span><br><span class="line">    <span class="comment">// æ’ä»¶çš„æ•°æ®å­˜å‚¨</span></span><br><span class="line">    <span class="attr">records</span>: <span class="keyword">new</span> <span class="title class_">Map</span>()     <span class="comment">// ç¤ºä¾‹:è®°å½•å­˜å‚¨</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ¶ˆæ¯å¤„ç†å‡½æ•°(å¿…éœ€)</span></span><br><span class="line">  <span class="attr">handler</span>: <span class="title function_">async</span> (message, channel, context) =&gt; &#123;</span><br><span class="line">    <span class="comment">// è¿”å›å€¼:</span></span><br><span class="line">    <span class="comment">// - å­—ç¬¦ä¸²: è¦å‘é€çš„å›å¤æ¶ˆæ¯</span></span><br><span class="line">    <span class="comment">// - null/undefined: ä¸å‘é€å›å¤</span></span><br><span class="line">    <span class="comment">// - Promise&lt;string&gt;: å¼‚æ­¥è¿”å›å›å¤æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;å›å¤æ¶ˆæ¯&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å‡ºæ’ä»¶</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = plugin</span><br></pre></td></tr></table></figure><h2 id="API-è¯´æ˜"><a href="#API-è¯´æ˜" class="headerlink" title="API è¯´æ˜"></a>API è¯´æ˜</h2><h3 id="1-æ¶ˆæ¯å¯¹è±¡-message"><a href="#1-æ¶ˆæ¯å¯¹è±¡-message" class="headerlink" title="1. æ¶ˆæ¯å¯¹è±¡(message)"></a>1. æ¶ˆæ¯å¯¹è±¡(message)</h3>  <span id="more"></span><p>æ¶ˆæ¯å¯¹è±¡åŒ…å«äº†æ¶ˆæ¯çš„å®Œæ•´ä¿¡æ¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&quot;æ¶ˆæ¯ID&quot;</span>,</span><br><span class="line">  <span class="attr">channel_id</span>: <span class="string">&quot;é¢‘é“ID&quot;</span>, </span><br><span class="line">  <span class="attr">guild_id</span>: <span class="string">&quot;æœåŠ¡å™¨ID&quot;</span>,</span><br><span class="line">  <span class="attr">content</span>: <span class="string">&quot;æ¶ˆæ¯å†…å®¹&quot;</span>,</span><br><span class="line">  <span class="attr">cleanContent</span>: <span class="string">&quot;å»é™¤å‘½ä»¤å‰ç¼€çš„æ¶ˆæ¯å†…å®¹&quot;</span>, <span class="comment">// æ–°å¢:æ¸…ç†åçš„å†…å®¹</span></span><br><span class="line">  <span class="attr">timestamp</span>: <span class="string">&quot;2023-01-01T00:00:00.000Z&quot;</span>,</span><br><span class="line">  <span class="attr">status</span>: <span class="string">&quot;normal&quot;</span>, <span class="comment">// æ¶ˆæ¯çŠ¶æ€: normal-æ­£å¸¸, auditing-å®¡æ ¸ä¸­, rejected-å®¡æ ¸æ‹’ç»</span></span><br><span class="line">  <span class="attr">author</span>: &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&quot;ç”¨æˆ·ID&quot;</span>,</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&quot;ç”¨æˆ·å&quot;</span>,</span><br><span class="line">    <span class="attr">bot</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">avatar</span>: <span class="string">&quot;å¤´åƒURL&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">member</span>: &#123;</span><br><span class="line">    <span class="attr">roles</span>: [<span class="string">&quot;è§’è‰²ID1&quot;</span>, <span class="string">&quot;è§’è‰²ID2&quot;</span>],</span><br><span class="line">    <span class="attr">joined_at</span>: <span class="string">&quot;åŠ å…¥æ—¶é—´&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mentions</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="string">&quot;è¢«@ç”¨æˆ·ID&quot;</span>,</span><br><span class="line">      <span class="attr">username</span>: <span class="string">&quot;è¢«@ç”¨æˆ·å&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">mention_everyone</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-é¢‘é“å¯¹è±¡-channel"><a href="#2-é¢‘é“å¯¹è±¡-channel" class="headerlink" title="2. é¢‘é“å¯¹è±¡(channel)"></a>2. é¢‘é“å¯¹è±¡(channel)</h3><p>é¢‘é“å¯¹è±¡åŒ…å«äº†é¢‘é“çš„åŸºæœ¬ä¿¡æ¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&quot;é¢‘é“ID&quot;</span>,</span><br><span class="line">  <span class="attr">guild_id</span>: <span class="string">&quot;æœåŠ¡å™¨ID&quot;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;é¢‘é“åç§°&quot;</span>,</span><br><span class="line">  <span class="attr">type</span>: <span class="number">0</span>, <span class="comment">// é¢‘é“ç±»å‹</span></span><br><span class="line">  <span class="attr">position</span>: <span class="number">1</span>, <span class="comment">// æ˜¾ç¤ºä½ç½®</span></span><br><span class="line">  <span class="attr">parent_id</span>: <span class="string">&quot;çˆ¶é¢‘é“ID&quot;</span>,</span><br><span class="line">  <span class="attr">owner_id</span>: <span class="string">&quot;åˆ›å»ºè€…ID&quot;</span>,</span><br><span class="line">  <span class="attr">permissions</span>: <span class="string">&quot;æƒé™å€¼&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-ä¸Šä¸‹æ–‡å¯¹è±¡-context"><a href="#3-ä¸Šä¸‹æ–‡å¯¹è±¡-context" class="headerlink" title="3. ä¸Šä¸‹æ–‡å¯¹è±¡(context)"></a>3. ä¸Šä¸‹æ–‡å¯¹è±¡(context)</h3><p>ä¸Šä¸‹æ–‡å¯¹è±¡æä¾›äº†æ’ä»¶è¿è¡Œæ—¶çš„ç¯å¢ƒå’Œå·¥å…·ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// å­˜å‚¨API - æŒä¹…åŒ–å­˜å‚¨æ’ä»¶æ•°æ®</span></span><br><span class="line">  <span class="attr">storage</span>: &#123;</span><br><span class="line">    <span class="attr">get</span>: <span class="function">(<span class="params">key</span>) =&gt;</span> value, <span class="comment">// è·å–å­˜å‚¨çš„å€¼</span></span><br><span class="line">    <span class="attr">set</span>: <span class="function">(<span class="params">key, value</span>) =&gt;</span> <span class="keyword">void</span>, <span class="comment">// è®¾ç½®å­˜å‚¨çš„å€¼</span></span><br><span class="line">    <span class="attr">delete</span>: <span class="function">(<span class="params">key</span>) =&gt;</span> <span class="keyword">void</span>, <span class="comment">// åˆ é™¤å­˜å‚¨çš„å€¼</span></span><br><span class="line">    <span class="attr">clear</span>: <span class="function">() =&gt;</span> <span class="keyword">void</span>, <span class="comment">// æ¸…ç©ºå­˜å‚¨</span></span><br><span class="line">    <span class="attr">has</span>: <span class="function">(<span class="params">key</span>) =&gt;</span> boolean <span class="comment">// æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// é…ç½®API - ç®¡ç†æ’ä»¶é…ç½®</span></span><br><span class="line">  <span class="attr">config</span>: &#123;</span><br><span class="line">    <span class="attr">get</span>: <span class="function">(<span class="params">key</span>) =&gt;</span> value, <span class="comment">// è·å–é…ç½®é¡¹</span></span><br><span class="line">    <span class="attr">set</span>: <span class="function">(<span class="params">key, value</span>) =&gt;</span> <span class="keyword">void</span>, <span class="comment">// è®¾ç½®é…ç½®é¡¹</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ—¥å¿—API - è®°å½•æ’ä»¶è¿è¡Œæ—¥å¿—</span></span><br><span class="line">  <span class="attr">log</span>: &#123;</span><br><span class="line">    <span class="attr">info</span>: <span class="function">(<span class="params">message, details</span>) =&gt;</span> <span class="keyword">void</span>, <span class="comment">// è®°å½•ä¿¡æ¯æ—¥å¿—</span></span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">message, details</span>) =&gt;</span> <span class="keyword">void</span>, <span class="comment">// è®°å½•æˆåŠŸæ—¥å¿—</span></span><br><span class="line">    <span class="attr">warning</span>: <span class="function">(<span class="params">message, details</span>) =&gt;</span> <span class="keyword">void</span>, <span class="comment">// è®°å½•è­¦å‘Šæ—¥å¿—</span></span><br><span class="line">    <span class="attr">error</span>: <span class="function">(<span class="params">message, details</span>) =&gt;</span> <span class="keyword">void</span> <span class="comment">// è®°å½•é”™è¯¯æ—¥å¿—</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å·¥å…·API</span></span><br><span class="line">  <span class="attr">api</span>: &#123;</span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">    <span class="attr">sendMessage</span>: <span class="title function_">async</span> (channelId, content, options) =&gt; &#123;</span><br><span class="line">      <span class="comment">// channelId: é¢‘é“ID</span></span><br><span class="line">      <span class="comment">// content: æ¶ˆæ¯å†…å®¹</span></span><br><span class="line">      <span class="comment">// options: å¯é€‰å‚æ•°</span></span><br><span class="line">      <span class="comment">//   - msg_id: å›å¤çš„æ¶ˆæ¯ID</span></span><br><span class="line">      <span class="comment">//   - event_id: äº‹ä»¶ID</span></span><br><span class="line">      <span class="comment">// è¿”å›:</span></span><br><span class="line">      <span class="comment">// - æˆåŠŸ: messageObject</span></span><br><span class="line">      <span class="comment">// - å®¡æ ¸: &#123; code: 304023, data: &#123; message_audit: &#123; audit_id: &quot;xxx&quot; &#125; &#125; &#125;</span></span><br><span class="line">      <span class="keyword">return</span> response</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ é™¤æ¶ˆæ¯</span></span><br><span class="line">    <span class="attr">deleteMessage</span>: <span class="title function_">async</span> (channelId, messageId) =&gt; &#123;</span><br><span class="line">      <span class="comment">// channelId: é¢‘é“ID</span></span><br><span class="line">      <span class="comment">// messageId: æ¶ˆæ¯ID</span></span><br><span class="line">      <span class="keyword">return</span> boolean</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–æˆå‘˜ä¿¡æ¯</span></span><br><span class="line">    <span class="attr">getMember</span>: <span class="title function_">async</span> (guildId, userId) =&gt; &#123;</span><br><span class="line">      <span class="comment">// guildId: æœåŠ¡å™¨ID</span></span><br><span class="line">      <span class="comment">// userId: ç”¨æˆ·ID</span></span><br><span class="line">      <span class="keyword">return</span> memberObject</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–æœåŠ¡å™¨è§’è‰²åˆ—è¡¨</span></span><br><span class="line">    <span class="attr">getGuildRoles</span>: <span class="title function_">async</span> (guildId) =&gt; &#123;</span><br><span class="line">      <span class="comment">// guildId: æœåŠ¡å™¨ID</span></span><br><span class="line">      <span class="keyword">return</span> rolesArray</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ£€æŸ¥æƒé™</span></span><br><span class="line">    <span class="attr">hasPermission</span>: <span class="function">(<span class="params">permissions, permission</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// permissions: æƒé™å€¼</span></span><br><span class="line">      <span class="comment">// permission: è¦æ£€æŸ¥çš„æƒé™</span></span><br><span class="line">      <span class="keyword">return</span> boolean</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ’ä»¶åŠŸèƒ½ç•Œé¢é¢„è§ˆ"><a href="#æ’ä»¶åŠŸèƒ½ç•Œé¢é¢„è§ˆ" class="headerlink" title="æ’ä»¶åŠŸèƒ½ç•Œé¢é¢„è§ˆ"></a>æ’ä»¶åŠŸèƒ½ç•Œé¢é¢„è§ˆ</h2><p><img src="/img/qqBot/log.jpg" alt="æ’ä»¶åŠŸèƒ½ç•Œé¢"></p><h2 id="æ¶ˆæ¯å¤„ç†æµç¨‹"><a href="#æ¶ˆæ¯å¤„ç†æµç¨‹" class="headerlink" title="æ¶ˆæ¯å¤„ç†æµç¨‹"></a>æ¶ˆæ¯å¤„ç†æµç¨‹</h2><ol><li><p>æ¶ˆæ¯æ¥æ”¶</p><ul><li>ç³»ç»Ÿæ¥æ”¶åˆ°æ–°æ¶ˆæ¯æ—¶ï¼Œä¼šæ£€æŸ¥æ¶ˆæ¯å†…å®¹æ˜¯å¦ä»¥é…ç½®çš„å‘½ä»¤å‰ç¼€å¼€å§‹</li><li>è§£æå‡ºå‘½ä»¤å’Œå‚æ•°</li><li>æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…çš„å·²å¯ç”¨æ’ä»¶</li></ul></li><li><p>æ’ä»¶æ‰§è¡Œ</p><ul><li>å¯¹æ¯ä¸ªåŒ¹é…çš„æ’ä»¶ï¼š<ul><li>åˆ›å»ºç‹¬ç«‹çš„æ’ä»¶ä¸Šä¸‹æ–‡å¯¹è±¡</li><li>è°ƒç”¨æ’ä»¶çš„handlerå‡½æ•°</li><li>ç­‰å¾…å¤„ç†ç»“æœ</li></ul></li><li>å¤šä¸ªæ’ä»¶å¯ä»¥ä½¿ç”¨ç›¸åŒçš„å‘½ä»¤</li><li>æ’ä»¶æŒ‰ç…§åŠ è½½é¡ºåºä¾æ¬¡æ‰§è¡Œ</li><li>æŸä¸ªæ’ä»¶æ‰§è¡Œå¤±è´¥ä¸ä¼šå½±å“å…¶ä»–æ’ä»¶</li></ul></li><li><p>å“åº”å¤„ç†</p><ul><li>æ¯ä¸ªæ’ä»¶çš„handlerå¦‚æœè¿”å›å­—ç¬¦ä¸²ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å‘é€å“åº”æ¶ˆæ¯</li><li>æ¯ä¸ªå“åº”éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¼šåˆ†åˆ«å‘é€åˆ°é¢‘é“</li><li>å‘é€çš„æ¶ˆæ¯å¯èƒ½è¿›å…¥å®¡æ ¸çŠ¶æ€(code: 304023)</li><li>å®¡æ ¸é€šè¿‡æˆ–æ‹’ç»ä¼šè§¦å‘ç›¸åº”çš„äº‹ä»¶</li></ul></li></ol><h2 id="æƒé™å¤„ç†"><a href="#æƒé™å¤„ç†" class="headerlink" title="æƒé™å¤„ç†"></a>æƒé™å¤„ç†</h2><p>ç³»ç»Ÿä¼šè‡ªåŠ¨è®¡ç®—æœºå™¨äººçš„æƒé™ï¼š</p><ol><li><p>ç®¡ç†å‘˜æƒé™</p><ul><li>é¢‘é“ä¸»</li><li>ç®¡ç†å‘˜</li><li>è¶…çº§ç®¡ç†å‘˜</li><li>å­é¢‘é“ç®¡ç†å‘˜<br>æ‹¥æœ‰ä»¥ä¸Šè§’è‰²æ—¶è‡ªåŠ¨è·å¾—æ‰€æœ‰æƒé™(1099511627775)</li></ul></li><li><p>æ™®é€šæƒé™</p><ul><li>æ ¹æ®è§’è‰²çš„permissionså€¼æŒ‰ä½è®¡ç®—</li><li>å¤šä¸ªè§’è‰²çš„æƒé™å€¼è¿›è¡ŒæŒ‰ä½æˆ–è¿ç®—</li><li>å¯ä»¥ä½¿ç”¨api.hasPermissionæ£€æŸ¥ç‰¹å®šæƒé™</li></ul></li></ol><h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><ol><li><p>é”™è¯¯å¤„ç†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">handler</span>: <span class="title function_">async</span> (message, channel, context) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†é€»è¾‘</span></span><br><span class="line">    context.<span class="property">log</span>.<span class="title function_">info</span>(<span class="string">&#x27;å¤„ç†æˆåŠŸ&#x27;</span>, &#123; <span class="attr">messageId</span>: message.<span class="property">id</span> &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;æˆåŠŸæ¶ˆæ¯&#x27;</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    context.<span class="property">log</span>.<span class="title function_">error</span>(<span class="string">&#x27;å¤„ç†å¤±è´¥&#x27;</span>, &#123; error, <span class="attr">messageId</span>: message.<span class="property">id</span> &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;å¤„ç†å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®æŒä¹…åŒ–</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨storage APIä¿å­˜æ•°æ®</span></span><br><span class="line"><span class="keyword">const</span> records = context.<span class="property">storage</span>.<span class="title function_">get</span>(<span class="string">&#x27;records&#x27;</span>) || &#123;&#125;</span><br><span class="line">records[userId] = &#123; <span class="comment">/* æ•°æ® */</span> &#125;</span><br><span class="line">context.<span class="property">storage</span>.<span class="title function_">set</span>(<span class="string">&#x27;records&#x27;</span>, records)</span><br></pre></td></tr></table></figure></li><li><p>æ¶ˆæ¯å®¡æ ¸å¤„ç†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> response = <span class="keyword">await</span> context.<span class="property">api</span>.<span class="title function_">sendMessage</span>(channelId, content)</span><br><span class="line"><span class="keyword">if</span> (response.<span class="property">code</span> === <span class="number">304023</span>) &#123;</span><br><span class="line">  context.<span class="property">log</span>.<span class="title function_">info</span>(<span class="string">&#x27;æ¶ˆæ¯è¿›å…¥å®¡æ ¸&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">auditId</span>: response.<span class="property">data</span>.<span class="property">message_audit</span>.<span class="property">audit_id</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æƒé™æ£€æŸ¥</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!context.<span class="property">api</span>.<span class="title function_">hasPermission</span>(channel.<span class="property">permissions</span>, <span class="string">&#x27;MANAGE_MESSAGES&#x27;</span>)) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;æƒé™ä¸è¶³ï¼Œéœ€è¦ç®¡ç†æ¶ˆæ¯çš„æƒé™&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>ä¹ˆä¹ˆæ‰~~</p>]]></content:encoded>
      
      
      <category domain="https://www.hzv5.cn/categories/%E7%9F%A5%E8%AF%86%E7%82%B9/">çŸ¥è¯†ç‚¹</category>
      
      
      <category domain="https://www.hzv5.cn/tags/%E7%AC%94%E8%AE%B0/">ç¬”è®°</category>
      
      <category domain="https://www.hzv5.cn/tags/QQ/">QQ</category>
      
      <category domain="https://www.hzv5.cn/tags/QQ%E9%A2%91%E9%81%93/">QQé¢‘é“</category>
      
      <category domain="https://www.hzv5.cn/tags/QQ%E6%9C%BA%E5%99%A8%E4%BA%BA/">QQæœºå™¨äºº</category>
      
      <category domain="https://www.hzv5.cn/tags/%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3/">å¼€å‘æ–‡æ¡£</category>
      
      
      <comments>https://www.hzv5.cn/2024/12/19/qqch-bot-plugin/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>2024å¹´AIç¼–ç¨‹åŠ©æ‰‹æ·±åº¦è¯„æµ‹ï¼šå“ªæ¬¾æœ€é€‚åˆä½ ï¼Ÿ</title>
      <link>https://www.hzv5.cn/2024/10/15/ai-coding-assistants/</link>
      <guid>https://www.hzv5.cn/2024/10/15/ai-coding-assistants/</guid>
      <pubDate>Tue, 15 Oct 2024 06:30:00 GMT</pubDate>
      
      <description>æ·±åº¦è¯„æµ‹2024å¹´ä¸»æµAIç¼–ç¨‹åŠ©æ‰‹ï¼ŒåŒ…æ‹¬Cursorã€CodeGeeXç­‰å›½å†…å¤–çŸ¥åå·¥å…·ï¼Œä»å¤šä¸ªç»´åº¦å¯¹æ¯”åˆ†æå„è‡ªä¼˜ç¼ºç‚¹ï¼Œå¸®åŠ©å¼€å‘è€…é€‰æ‹©æœ€é€‚åˆçš„AIç¼–ç¨‹åŠ©æ‰‹ã€‚</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>éšç€AIæŠ€æœ¯çš„å¿«é€Ÿå‘å±•ï¼Œå„ç§AIç¼–ç¨‹åŠ©æ‰‹å±‚å‡ºä¸ç©·ã€‚æœ¬æ–‡å°†æ·±å…¥å¯¹æ¯”ä¸»æµAIç¼–ç¨‹åŠ©æ‰‹çš„ä¼˜ç¼ºç‚¹ï¼Œå¸®åŠ©ä½ æ‰¾åˆ°æœ€é€‚åˆè‡ªå·±çš„AIç¼–ç¨‹ä¼™ä¼´ã€‚</p></blockquote><span id="more"></span><h2 id="1-Cursor-ä¸“æ³¨é«˜æ•ˆçš„AIç¼–ç¨‹åŠ©æ‰‹"><a href="#1-Cursor-ä¸“æ³¨é«˜æ•ˆçš„AIç¼–ç¨‹åŠ©æ‰‹" class="headerlink" title="1. Cursor - ä¸“æ³¨é«˜æ•ˆçš„AIç¼–ç¨‹åŠ©æ‰‹"></a>1. Cursor - ä¸“æ³¨é«˜æ•ˆçš„AIç¼–ç¨‹åŠ©æ‰‹</h2><h3 id="1-1-ä¸»è¦ç‰¹ç‚¹"><a href="#1-1-ä¸»è¦ç‰¹ç‚¹" class="headerlink" title="1.1 ä¸»è¦ç‰¹ç‚¹"></a>1.1 ä¸»è¦ç‰¹ç‚¹</h3><ul><li>åŸºäºå…ˆè¿›çš„AIæ¨¡å‹</li><li>å®Œæ•´çš„IDEåŠŸèƒ½</li><li>å¼ºå¤§çš„ä»£ç è¡¥å…¨å’Œç”Ÿæˆèƒ½åŠ›</li><li>æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€</li><li>å®æ—¶ä»£ç åˆ†æå’Œå»ºè®®</li></ul><h3 id="1-2-ä¼˜ç‚¹"><a href="#1-2-ä¼˜ç‚¹" class="headerlink" title="1.2 ä¼˜ç‚¹"></a>1.2 ä¼˜ç‚¹</h3><ol><li><p><strong>ä»£ç ç†è§£èƒ½åŠ›å¼º</strong></p><ul><li>èƒ½å‡†ç¡®ç†è§£é¡¹ç›®ä¸Šä¸‹æ–‡</li><li>æä¾›ç²¾å‡†çš„ä»£ç å»ºè®®</li><li>æ”¯æŒå¤æ‚ä»£ç é‡æ„</li></ul></li><li><p><strong>äº¤äº’ä½“éªŒä¼˜ç§€</strong></p><ul><li>ç•Œé¢ç®€æ´ç›´è§‚</li><li>å“åº”é€Ÿåº¦å¿«</li><li>æ”¯æŒè‡ªç„¶è¯­è¨€äº¤äº’</li></ul></li><li><p><strong>åŠŸèƒ½å®Œæ•´æ€§</strong></p><ul><li>é›†æˆGitç‰ˆæœ¬æ§åˆ¶</li><li>æ”¯æŒä»£ç è°ƒè¯•</li><li>å†…ç½®ç»ˆç«¯åŠŸèƒ½</li></ul></li></ol><h3 id="1-3-ç¼ºç‚¹"><a href="#1-3-ç¼ºç‚¹" class="headerlink" title="1.3 ç¼ºç‚¹"></a>1.3 ç¼ºç‚¹</h3><ol><li><p><strong>èµ„æºå ç”¨è¾ƒé«˜</strong></p><ul><li>è¿è¡Œéœ€è¦è¾ƒå¥½çš„ç¡¬ä»¶é…ç½®</li><li>å¯åŠ¨é€Ÿåº¦è¾ƒæ…¢</li></ul></li><li><p><strong>æ”¶è´¹è¾ƒé«˜</strong></p><ul><li>å®Œæ•´åŠŸèƒ½éœ€è¦ä»˜è´¹è®¢é˜…</li><li>ä»·æ ¼å¯¹ä¸ªäººå¼€å‘è€…ç•¥é«˜</li></ul></li></ol><h2 id="2-CodeGeeX-å›½äº§ä¼˜ç§€AIç¼–ç¨‹åŠ©æ‰‹"><a href="#2-CodeGeeX-å›½äº§ä¼˜ç§€AIç¼–ç¨‹åŠ©æ‰‹" class="headerlink" title="2. CodeGeeX - å›½äº§ä¼˜ç§€AIç¼–ç¨‹åŠ©æ‰‹"></a>2. CodeGeeX - å›½äº§ä¼˜ç§€AIç¼–ç¨‹åŠ©æ‰‹</h2><h3 id="2-1-ä¸»è¦ç‰¹ç‚¹"><a href="#2-1-ä¸»è¦ç‰¹ç‚¹" class="headerlink" title="2.1 ä¸»è¦ç‰¹ç‚¹"></a>2.1 ä¸»è¦ç‰¹ç‚¹</h3><ul><li>æ”¯æŒä¸­æ–‡äº¤äº’</li><li>ç¦»çº¿è¿è¡Œèƒ½åŠ›</li><li>è·¨å¹³å°æ”¯æŒ</li><li>å¤šç§ç¼–è¾‘å™¨æ’ä»¶</li></ul><h3 id="2-2-ä¼˜ç‚¹"><a href="#2-2-ä¼˜ç‚¹" class="headerlink" title="2.2 ä¼˜ç‚¹"></a>2.2 ä¼˜ç‚¹</h3><ol><li><p><strong>æœ¬åœ°åŒ–ä¼˜åŠ¿</strong></p><ul><li>å®Œå–„çš„ä¸­æ–‡æ”¯æŒ</li><li>ç¬¦åˆå›½å†…å¼€å‘ä¹ æƒ¯</li><li>å“åº”é€Ÿåº¦å¿«</li></ul></li><li><p><strong>æ€§ä»·æ¯”é«˜</strong></p><ul><li>åŸºç¡€åŠŸèƒ½å…è´¹</li><li>ä¼ä¸šç‰ˆä»·æ ¼åˆç†</li><li>æ•™è‚²ä¼˜æƒ æ”¿ç­–</li></ul></li><li><p><strong>å®‰å…¨æ€§å¥½</strong></p><ul><li>æ”¯æŒç§æœ‰éƒ¨ç½²</li><li>ä»£ç ä¸å‡ºå¢ƒ</li><li>æ•°æ®å®‰å…¨æœ‰ä¿éšœ</li></ul></li></ol><h3 id="2-3-ç¼ºç‚¹"><a href="#2-3-ç¼ºç‚¹" class="headerlink" title="2.3 ç¼ºç‚¹"></a>2.3 ç¼ºç‚¹</h3><ol><li><p><strong>åŠŸèƒ½å®Œæ•´åº¦</strong></p><ul><li>éƒ¨åˆ†é«˜çº§åŠŸèƒ½ä¸å¦‚å›½å¤–äº§å“</li><li>IDEé›†æˆåº¦æœ‰å¾…æé«˜</li></ul></li><li><p><strong>æ¨¡å‹èƒ½åŠ›</strong></p><ul><li>åœ¨æŸäº›ä¸“ä¸šé¢†åŸŸç†è§£ä¸å¤Ÿæ·±å…¥</li><li>ä»£ç ç”Ÿæˆè´¨é‡ç•¥ä½äºé¡¶çº§äº§å“</li></ul></li></ol><h2 id="3-GitHub-Copilot-æœ€å—æ¬¢è¿çš„AIåŠ©æ‰‹"><a href="#3-GitHub-Copilot-æœ€å—æ¬¢è¿çš„AIåŠ©æ‰‹" class="headerlink" title="3. GitHub Copilot - æœ€å—æ¬¢è¿çš„AIåŠ©æ‰‹"></a>3. GitHub Copilot - æœ€å—æ¬¢è¿çš„AIåŠ©æ‰‹</h2><h3 id="3-1-ä¸»è¦ç‰¹ç‚¹"><a href="#3-1-ä¸»è¦ç‰¹ç‚¹" class="headerlink" title="3.1 ä¸»è¦ç‰¹ç‚¹"></a>3.1 ä¸»è¦ç‰¹ç‚¹</h3><ul><li>å¾®è½¯å’ŒGitHubè”åˆå¼€å‘</li><li>åŸºäºOpenAIæŠ€æœ¯</li><li>æ”¯æŒä¸»æµç¼–è¾‘å™¨</li><li>å¼ºå¤§çš„ä»£ç ç”Ÿæˆèƒ½åŠ›</li></ul><h3 id="3-2-ä¼˜ç‚¹"><a href="#3-2-ä¼˜ç‚¹" class="headerlink" title="3.2 ä¼˜ç‚¹"></a>3.2 ä¼˜ç‚¹</h3><ol><li><p><strong>ä»£ç è´¨é‡é«˜</strong></p><ul><li>åŸºäºæµ·é‡GitHubä»£ç è®­ç»ƒ</li><li>ç”Ÿæˆä»£ç å¯è¯»æ€§å¥½</li><li>æ³¨é‡Šè¯¦ç»†å‡†ç¡®</li></ul></li><li><p><strong>é›†æˆåº¦é«˜</strong></p><ul><li>æ”¯æŒVS Codeç­‰ä¸»æµIDE</li><li>æ“ä½œä¾¿æ·</li><li>å­¦ä¹ æˆæœ¬ä½</li></ul></li><li><p><strong>æ›´æ–°é¢‘ç¹</strong></p><ul><li>æŒç»­æ”¹è¿›å’Œä¼˜åŒ–</li><li>Bugä¿®å¤åŠæ—¶</li><li>æ–°åŠŸèƒ½ä¸æ–­</li></ul></li></ol><h3 id="3-3-ç¼ºç‚¹"><a href="#3-3-ç¼ºç‚¹" class="headerlink" title="3.3 ç¼ºç‚¹"></a>3.3 ç¼ºç‚¹</h3><ol><li><p><strong>ä»·æ ¼è¾ƒè´µ</strong></p><ul><li>æœˆä»˜è´¹ç”¨è¾ƒé«˜</li><li>æ²¡æœ‰æ°¸ä¹…æˆæƒé€‰é¡¹</li></ul></li><li><p><strong>ç½‘ç»œä¾èµ–</strong></p><ul><li>éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥</li><li>æ— æ³•ç¦»çº¿ä½¿ç”¨</li></ul></li></ol><h2 id="4-å›½å†…å…¶ä»–AIç¼–ç¨‹åŠ©æ‰‹"><a href="#4-å›½å†…å…¶ä»–AIç¼–ç¨‹åŠ©æ‰‹" class="headerlink" title="4. å›½å†…å…¶ä»–AIç¼–ç¨‹åŠ©æ‰‹"></a>4. å›½å†…å…¶ä»–AIç¼–ç¨‹åŠ©æ‰‹</h2><h3 id="4-1-MarsCode-æŠ–éŸ³å®˜æ–¹AIç¼–ç¨‹åŠ©æ‰‹"><a href="#4-1-MarsCode-æŠ–éŸ³å®˜æ–¹AIç¼–ç¨‹åŠ©æ‰‹" class="headerlink" title="4.1 MarsCode - æŠ–éŸ³å®˜æ–¹AIç¼–ç¨‹åŠ©æ‰‹"></a>4.1 MarsCode - æŠ–éŸ³å®˜æ–¹AIç¼–ç¨‹åŠ©æ‰‹</h3><p><strong>ä¸»è¦ç‰¹ç‚¹ï¼š</strong></p><ul><li>å­—èŠ‚è·³åŠ¨å®˜æ–¹å‡ºå“</li><li>åŸºäºå…ˆè¿›çš„CodeFuseå¤§æ¨¡å‹</li><li>æ”¯æŒVSCodeã€JetBrainsç­‰ä¸»æµIDE</li><li>æä¾›Webç‰ˆåœ¨çº¿ä½¿ç”¨</li><li>å®Œå…¨å…è´¹ä½¿ç”¨</li></ul><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ol><li><p><strong>å¼ºå¤§çš„ä»£ç ç”Ÿæˆèƒ½åŠ›</strong></p><ul><li>åŸºäºæµ·é‡å­—èŠ‚è·³åŠ¨å†…éƒ¨ä»£ç è®­ç»ƒ</li><li>æ”¯æŒ40+ç§ä¸»æµç¼–ç¨‹è¯­è¨€</li><li>ä»£ç è´¨é‡å’Œå¯ç”¨æ€§è¾ƒé«˜</li><li>æ”¯æŒå®Œæ•´å‡½æ•°å’Œç±»çš„ç”Ÿæˆ</li></ul></li><li><p><strong>æ™ºèƒ½äº¤äº’ä½“éªŒ</strong></p><ul><li>æ”¯æŒè‡ªç„¶è¯­è¨€å¯¹è¯</li><li>æä¾›ä»£ç è§£é‡Šå’Œä¼˜åŒ–å»ºè®®</li><li>å®æ—¶ä»£ç è¡¥å…¨</li><li>å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡ç†è§£</li></ul></li><li><p><strong>ä¾¿æ·çš„ä½¿ç”¨æ–¹å¼</strong></p><ul><li>å®Œå…¨å…è´¹ï¼Œæ— éœ€ä»˜è´¹</li><li>æ”¯æŒWebç«¯ç›´æ¥ä½¿ç”¨</li><li>IDEæ’ä»¶é›†æˆä¾¿æ·</li><li>å¿«é€Ÿçš„å“åº”é€Ÿåº¦</li></ul></li><li><p><strong>ä¸­æ–‡æ”¯æŒä¼˜ç§€</strong></p><ul><li>å®Œå–„çš„ä¸­æ–‡äº¤äº’</li><li>å‡†ç¡®çš„ä¸­æ–‡éœ€æ±‚ç†è§£</li><li>è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šç”Ÿæˆ</li><li>ç¬¦åˆå›½å†…å¼€å‘ä¹ æƒ¯</li></ul></li></ol><p><strong>ç¼ºç‚¹ï¼š</strong></p><ol><li><p><strong>åŠŸèƒ½é™åˆ¶</strong></p><ul><li>éƒ¨åˆ†é«˜çº§åŠŸèƒ½å°šæœªå¼€æ”¾</li><li>ä»£ç åˆ†ææ·±åº¦æœ‰é™</li><li>é‡æ„åŠŸèƒ½ç›¸å¯¹åŸºç¡€</li></ul></li><li><p><strong>ç”Ÿæ€ä½“ç³»</strong></p><ul><li>æ’ä»¶æ•°é‡è¾ƒå°‘</li><li>ç¤¾åŒºèµ„æºä¸å¤Ÿä¸°å¯Œ</li><li>æ–‡æ¡£å’Œæ•™ç¨‹è¾ƒå°‘</li></ul></li><li><p><strong>ä½¿ç”¨é™åˆ¶</strong></p><ul><li>éœ€è¦æŠ–éŸ³è´¦å·ç™»å½•</li><li>å¯èƒ½æœ‰APIè°ƒç”¨é™åˆ¶</li><li>æš‚ä¸æ”¯æŒç§æœ‰éƒ¨ç½²</li></ul></li><li><p><strong>ç¨³å®šæ€§å¾…æå‡</strong></p><ul><li>æœåŠ¡å¶æœ‰æ³¢åŠ¨</li><li>ä»£ç ç”Ÿæˆè´¨é‡ä¸å¤Ÿç¨³å®š</li><li>å¤æ‚åœºæ™¯æ”¯æŒæœ‰é™</li></ul></li></ol><h3 id="4-2-ç™¾åº¦æ™ºèƒ½ç¼–ç¨‹åŠ©æ‰‹"><a href="#4-2-ç™¾åº¦æ™ºèƒ½ç¼–ç¨‹åŠ©æ‰‹" class="headerlink" title="4.2 ç™¾åº¦æ™ºèƒ½ç¼–ç¨‹åŠ©æ‰‹"></a>4.2 ç™¾åº¦æ™ºèƒ½ç¼–ç¨‹åŠ©æ‰‹</h3><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>ä¸­æ–‡æ”¯æŒå¥½</li><li>ä¸ç™¾åº¦ç”Ÿæ€é›†æˆ</li><li>å…è´¹é¢åº¦å¤§</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>åŠŸèƒ½ç›¸å¯¹ç®€å•</li><li>ä»…æ”¯æŒéƒ¨åˆ†è¯­è¨€</li><li>ç¤¾åŒºæ´»è·ƒåº¦ä½</li></ul><h3 id="4-3-é˜¿é‡Œäº‘ä»£ç æ™ºèƒ½åŠ©æ‰‹"><a href="#4-3-é˜¿é‡Œäº‘ä»£ç æ™ºèƒ½åŠ©æ‰‹" class="headerlink" title="4.3 é˜¿é‡Œäº‘ä»£ç æ™ºèƒ½åŠ©æ‰‹"></a>4.3 é˜¿é‡Œäº‘ä»£ç æ™ºèƒ½åŠ©æ‰‹</h3><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>é˜¿é‡Œäº‘ç”Ÿæ€é›†æˆ</li><li>ä¼ä¸šçº§æ”¯æŒ</li><li>å®‰å…¨æ€§é«˜</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>éœ€è¦é˜¿é‡Œäº‘è´¦å·</li><li>æ”¶è´¹è¾ƒé«˜</li><li>é€šç”¨æ€§ä¸è¶³</li></ul><h2 id="5-é€‰æ‹©å»ºè®®"><a href="#5-é€‰æ‹©å»ºè®®" class="headerlink" title="5. é€‰æ‹©å»ºè®®"></a>5. é€‰æ‹©å»ºè®®</h2><h3 id="5-1-ä¸åŒåœºæ™¯çš„é€‰æ‹©å»ºè®®"><a href="#5-1-ä¸åŒåœºæ™¯çš„é€‰æ‹©å»ºè®®" class="headerlink" title="5.1 ä¸åŒåœºæ™¯çš„é€‰æ‹©å»ºè®®"></a>5.1 ä¸åŒåœºæ™¯çš„é€‰æ‹©å»ºè®®</h3><ol><li><p><strong>ä¸ªäººå¼€å‘è€…</strong></p><ul><li>é¢„ç®—å……è¶³ï¼šCursoræˆ–GitHub Copilot</li><li>é¢„ç®—æœ‰é™ï¼šCodeGeeX</li><li>ä¸­æ–‡ç¯å¢ƒï¼šCodeGeeXæˆ–ç™¾åº¦æ™ºèƒ½ç¼–ç¨‹åŠ©æ‰‹</li></ul></li><li><p><strong>ä¼ä¸šç”¨æˆ·</strong></p><ul><li>æ³¨é‡å®‰å…¨ï¼šCodeGeeXä¼ä¸šç‰ˆ</li><li>å›¢é˜Ÿåä½œï¼šGitHub Copilotå•†ä¸šç‰ˆ</li><li>äº‘ç”Ÿæ€ï¼šé˜¿é‡Œäº‘ä»£ç æ™ºèƒ½åŠ©æ‰‹</li></ul></li><li><p><strong>å­¦ç”Ÿç”¨æˆ·</strong></p><ul><li>GitHub Copilotï¼ˆæœ‰æ•™è‚²ä¼˜æƒ ï¼‰</li><li>CodeGeeXï¼ˆå…è´¹ç‰ˆå¤Ÿç”¨ï¼‰</li></ul></li></ol><h3 id="5-2-é€‰æ‹©è€ƒè™‘å› ç´ "><a href="#5-2-é€‰æ‹©è€ƒè™‘å› ç´ " class="headerlink" title="5.2 é€‰æ‹©è€ƒè™‘å› ç´ "></a>5.2 é€‰æ‹©è€ƒè™‘å› ç´ </h3><ol><li><p><strong>é¢„ç®—</strong></p><ul><li>å…è´¹ä½¿ç”¨éœ€æ±‚</li><li>æ€§ä»·æ¯”è€ƒè™‘</li><li>é•¿æœŸè®¢é˜…æˆæœ¬</li></ul></li><li><p><strong>ä½¿ç”¨åœºæ™¯</strong></p><ul><li>ä¸ªäºº/å›¢é˜Ÿä½¿ç”¨</li><li>é¡¹ç›®è§„æ¨¡</li><li>ç¼–ç¨‹è¯­è¨€æ”¯æŒ</li></ul></li><li><p><strong>ç‰¹æ®Šéœ€æ±‚</strong></p><ul><li>ä¸­æ–‡æ”¯æŒ</li><li>ç¦»çº¿ä½¿ç”¨</li><li>å®‰å…¨åˆè§„</li></ul></li></ol><h2 id="6-ä½¿ç”¨æŠ€å·§åˆ†äº«"><a href="#6-ä½¿ç”¨æŠ€å·§åˆ†äº«" class="headerlink" title="6. ä½¿ç”¨æŠ€å·§åˆ†äº«"></a>6. ä½¿ç”¨æŠ€å·§åˆ†äº«</h2><h3 id="6-1-æé«˜AIåŠ©æ‰‹æ•ˆç‡çš„æŠ€å·§"><a href="#6-1-æé«˜AIåŠ©æ‰‹æ•ˆç‡çš„æŠ€å·§" class="headerlink" title="6.1 æé«˜AIåŠ©æ‰‹æ•ˆç‡çš„æŠ€å·§"></a>6.1 æé«˜AIåŠ©æ‰‹æ•ˆç‡çš„æŠ€å·§</h3><ol><li><p><strong>ç¼–å†™æ¸…æ™°çš„æç¤º</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¥½çš„æç¤ºç¤ºä¾‹</span></span><br><span class="line"><span class="comment">// å®ç°ä¸€ä¸ªåŸºäºPromiseçš„å»¶è¿Ÿå‡½æ•°ï¼Œæ”¯æŒå–æ¶ˆæ“ä½œ</span></span><br></pre></td></tr></table></figure></li><li><p><strong>å–„ç”¨ä¸Šä¸‹æ–‡</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…ˆè¯´æ˜éœ€æ±‚èƒŒæ™¯</span></span><br><span class="line"><span class="comment">// å†æè¿°å…·ä½“åŠŸèƒ½</span></span><br><span class="line"><span class="comment">// æœ€åæŒ‡å‡ºå…³é”®ç‚¹</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ç»“åˆæ–‡æ¡£ä½¿ç”¨</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£</span></span><br><span class="line"><span class="comment">// å‚è€ƒç¤ºä¾‹ä»£ç </span></span><br><span class="line"><span class="comment">// ç†è§£å®ç°åŸç†</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="6-2-é¿å…å¸¸è§è¯¯åŒº"><a href="#6-2-é¿å…å¸¸è§è¯¯åŒº" class="headerlink" title="6.2 é¿å…å¸¸è§è¯¯åŒº"></a>6.2 é¿å…å¸¸è§è¯¯åŒº</h3><ol><li><p><strong>è¿‡åº¦ä¾èµ–</strong></p><ul><li>ä¸è¦å®Œå…¨ä¾èµ–AIç”Ÿæˆä»£ç </li><li>ä¿æŒä»£ç å®¡æŸ¥ä¹ æƒ¯</li><li>ç†è§£ä»£ç é€»è¾‘</li></ul></li><li><p><strong>å¿½è§†æ€§èƒ½</strong></p><ul><li>æ³¨æ„ä»£ç è´¨é‡</li><li>è€ƒè™‘æ€§èƒ½å½±å“</li><li>æµ‹è¯•ç”Ÿæˆä»£ç </li></ul></li></ol><h2 id="7-æœªæ¥å±•æœ›"><a href="#7-æœªæ¥å±•æœ›" class="headerlink" title="7. æœªæ¥å±•æœ›"></a>7. æœªæ¥å±•æœ›</h2><ol><li><p><strong>æŠ€æœ¯è¶‹åŠ¿</strong></p><ul><li>æ¨¡å‹èƒ½åŠ›æŒç»­æå‡</li><li>å¤šæ¨¡æ€äº¤äº’å¢å¼º</li><li>ä¸ªæ€§åŒ–æ¨èåŠ å¼º</li></ul></li><li><p><strong>è¡Œä¸šå½±å“</strong></p><ul><li>æé«˜å¼€å‘æ•ˆç‡</li><li>é™ä½å…¥é—¨é—¨æ§›</li><li>æ”¹å˜å¼€å‘æ¨¡å¼</li></ul></li><li><p><strong>æ³¨æ„äº‹é¡¹</strong></p><ul><li>ä¿æŒå­¦ä¹ èƒ½åŠ›</li><li>æé«˜ä»£ç ç´ å…»</li><li>å…³æ³¨å®‰å…¨åˆè§„</li></ul></li></ol><h2 id="8-æ€»ç»“"><a href="#8-æ€»ç»“" class="headerlink" title="8. æ€»ç»“"></a>8. æ€»ç»“</h2><ol><li>é€‰æ‹©åˆé€‚çš„AIç¼–ç¨‹åŠ©æ‰‹å¾ˆé‡è¦</li><li>æ ¹æ®å®é™…éœ€æ±‚å’Œåœºæ™¯é€‰æ‹©</li><li>åˆç†ä½¿ç”¨æé«˜å¼€å‘æ•ˆç‡</li><li>é¿å…è¿‡åº¦ä¾èµ–</li><li>æŒç»­å…³æ³¨æ–°æŠ€æœ¯å‘å±•</li></ol><h2 id="5-äº§å“å¯¹æ¯”åˆ†æ"><a href="#5-äº§å“å¯¹æ¯”åˆ†æ" class="headerlink" title="5. äº§å“å¯¹æ¯”åˆ†æ"></a>5. äº§å“å¯¹æ¯”åˆ†æ</h2><h3 id="5-1-åŠŸèƒ½å¯¹æ¯”"><a href="#5-1-åŠŸèƒ½å¯¹æ¯”" class="headerlink" title="5.1 åŠŸèƒ½å¯¹æ¯”"></a>5.1 åŠŸèƒ½å¯¹æ¯”</h3><table><thead><tr><th>åŠŸèƒ½ç‰¹æ€§</th><th>Cursor</th><th>GitHub Copilot</th><th>CodeGeeX</th><th>MarsCode</th></tr></thead><tbody><tr><td>ä»£ç è¡¥å…¨</td><td>â­â­â­â­â­</td><td>â­â­â­â­â­</td><td>â­â­â­â­</td><td>â­â­â­â­</td></tr><tr><td>ä»£ç ç”Ÿæˆ</td><td>â­â­â­â­â­</td><td>â­â­â­â­â­</td><td>â­â­â­â­</td><td>â­â­â­â­</td></tr><tr><td>ä¸­æ–‡æ”¯æŒ</td><td>â­â­â­</td><td>â­â­</td><td>â­â­â­â­â­</td><td>â­â­â­â­â­</td></tr><tr><td>IDEé›†æˆ</td><td>â­â­â­â­â­</td><td>â­â­â­â­â­</td><td>â­â­â­â­</td><td>â­â­â­</td></tr><tr><td>å“åº”é€Ÿåº¦</td><td>â­â­â­â­</td><td>â­â­â­â­â­</td><td>â­â­â­â­</td><td>â­â­â­â­</td></tr><tr><td>ä»£ç è´¨é‡</td><td>â­â­â­â­â­</td><td>â­â­â­â­â­</td><td>â­â­â­â­</td><td>â­â­â­â­</td></tr></tbody></table><h3 id="5-2-ä»·æ ¼å¯¹æ¯”"><a href="#5-2-ä»·æ ¼å¯¹æ¯”" class="headerlink" title="5.2 ä»·æ ¼å¯¹æ¯”"></a>5.2 ä»·æ ¼å¯¹æ¯”</h3><table><thead><tr><th>äº§å“</th><th>å…è´¹ç‰ˆ</th><th>ä¸ªäººç‰ˆ</th><th>å›¢é˜Ÿç‰ˆ</th><th>ä¼ä¸šç‰ˆ</th></tr></thead><tbody><tr><td>Cursor</td><td>åŸºç¡€åŠŸèƒ½</td><td>$20/æœˆ</td><td>$40/äºº/æœˆ</td><td>è”ç³»å•†åŠ¡</td></tr><tr><td>GitHub Copilot</td><td>æ— </td><td>$10/æœˆ</td><td>$19/äºº/æœˆ</td><td>è”ç³»å•†åŠ¡</td></tr><tr><td>CodeGeeX</td><td>å®Œæ•´åŠŸèƒ½</td><td>å…è´¹</td><td>Â¥299/äºº/å¹´</td><td>è”ç³»å•†åŠ¡</td></tr><tr><td>MarsCode</td><td>å®Œæ•´åŠŸèƒ½</td><td>å…è´¹</td><td>å…è´¹</td><td>å…è´¹</td></tr></tbody></table><h3 id="5-3-é€‚ç”¨åœºæ™¯å¯¹æ¯”"><a href="#5-3-é€‚ç”¨åœºæ™¯å¯¹æ¯”" class="headerlink" title="5.3 é€‚ç”¨åœºæ™¯å¯¹æ¯”"></a>5.3 é€‚ç”¨åœºæ™¯å¯¹æ¯”</h3><ol><li><p><strong>ä¸ªäººå¼€å‘è€…</strong></p><ul><li>é¢„ç®—å……è¶³ï¼šGitHub Copilot &gt; Cursor</li><li>é¢„ç®—æœ‰é™ï¼šMarsCode &gt; CodeGeeX</li><li>ä¸­æ–‡ç¯å¢ƒï¼šMarsCode = CodeGeeX &gt; å…¶ä»–</li></ul></li><li><p><strong>å›¢é˜Ÿä½¿ç”¨</strong></p><ul><li>å¤§å‹ä¼ä¸šï¼šGitHub Copilot &gt; Cursor &gt; CodeGeeX</li><li>ä¸­å°ä¼ä¸šï¼šCodeGeeX &gt; MarsCode &gt; å…¶ä»–</li><li>åˆ›ä¸šå›¢é˜Ÿï¼šMarsCode &gt; CodeGeeX &gt; å…¶ä»–</li></ul></li><li><p><strong>ç‰¹å®šéœ€æ±‚</strong></p><ul><li>ç¦»çº¿ä½¿ç”¨ï¼šCodeGeeX &gt; å…¶ä»–</li><li>ç§æœ‰éƒ¨ç½²ï¼šCodeGeeX &gt; GitHub Copilot</li><li>ä¸­æ–‡æ”¯æŒï¼šMarsCode = CodeGeeX &gt; å…¶ä»–</li></ul></li></ol><hr><blockquote><p>å¦‚æœè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©,æ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«,ä½ çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼ </p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.hzv5.cn/categories/%E6%8A%80%E6%9C%AF%E8%AF%84%E6%B5%8B/">æŠ€æœ¯è¯„æµ‹</category>
      
      <category domain="https://www.hzv5.cn/categories/%E6%8A%80%E6%9C%AF%E8%AF%84%E6%B5%8B/AI%E5%B7%A5%E5%85%B7/">AIå·¥å…·</category>
      
      
      <category domain="https://www.hzv5.cn/tags/AI%E7%BC%96%E7%A8%8B/">AIç¼–ç¨‹</category>
      
      <category domain="https://www.hzv5.cn/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/">å¼€å‘å·¥å…·</category>
      
      <category domain="https://www.hzv5.cn/tags/Cursor/">Cursor</category>
      
      <category domain="https://www.hzv5.cn/tags/CodeGeeX/">CodeGeeX</category>
      
      <category domain="https://www.hzv5.cn/tags/%E7%BC%96%E7%A8%8B%E5%8A%A9%E6%89%8B/">ç¼–ç¨‹åŠ©æ‰‹</category>
      
      
      <comments>https://www.hzv5.cn/2024/10/15/ai-coding-assistants/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>uni-appåœ°å›¾å®šä½è¸©å‘è®°ï¼šåœ°å›¾åŠŸèƒ½å’Œå®šä½çš„é‚£äº›å‘</title>
      <link>https://www.hzv5.cn/2024/06/25/uniapp-map-location/</link>
      <guid>https://www.hzv5.cn/2024/06/25/uniapp-map-location/</guid>
      <pubDate>Tue, 25 Jun 2024 03:40:00 GMT</pubDate>
      
      <description>è¯¦ç»†ä»‹ç»uni-appä¸­åœ°å›¾åŠŸèƒ½å’Œå®šä½æœåŠ¡çš„å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬æƒé™å¤„ç†ã€åœ°å›¾æ ‡è®°ã€è·¯çº¿è§„åˆ’ç­‰å®ç”¨åŠŸèƒ½ï¼Œé€‚åˆæ–°æ‰‹é˜…è¯»ã€‚</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>åœ¨uni-appå¼€å‘ä¸­ï¼Œåœ°å›¾å’Œå®šä½åŠŸèƒ½ç»å¸¸ä¼šé‡åˆ°å„ç§é—®é¢˜ã€‚æœ¬æ–‡æ€»ç»“äº†ä¸€äº›å¸¸è§çš„å‘å’Œè§£å†³æ–¹æ¡ˆï¼Œå¸®åŠ©å¤§å®¶æ›´å¥½åœ°å®ç°åœ°å›¾ç›¸å…³åŠŸèƒ½ã€‚</p></blockquote><span id="more"></span><h2 id="1-å®šä½æƒé™é—®é¢˜"><a href="#1-å®šä½æƒé™é—®é¢˜" class="headerlink" title="1. å®šä½æƒé™é—®é¢˜"></a>1. å®šä½æƒé™é—®é¢˜</h2><h3 id="1-1-è·å–å®šä½æƒé™"><a href="#1-1-è·å–å®šä½æƒé™" class="headerlink" title="1.1 è·å–å®šä½æƒé™"></a>1.1 è·å–å®šä½æƒé™</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>ç”¨æˆ·æ‹’ç»å®šä½æƒé™åï¼Œæ— æ³•æ­£å¸¸ä½¿ç”¨å®šä½åŠŸèƒ½ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ£€æŸ¥å®šä½æƒé™</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">checkLocationAuth</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> uni.<span class="title function_">getSetting</span>()</span><br><span class="line">    <span class="keyword">if</span> (!res.<span class="property">authSetting</span>[<span class="string">&#x27;scope.userLocation&#x27;</span>]) &#123;</span><br><span class="line">      <span class="comment">// æœªæˆæƒï¼Œå¼•å¯¼ç”¨æˆ·å¼€å¯</span></span><br><span class="line">      <span class="keyword">await</span> uni.<span class="title function_">showModal</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;æç¤º&#x27;</span>,</span><br><span class="line">        <span class="attr">content</span>: <span class="string">&#x27;éœ€è¦è·å–æ‚¨çš„ä½ç½®ä¿¡æ¯ï¼Œæ˜¯å¦æˆæƒï¼Ÿ&#x27;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="title function_">async</span> (res) =&gt; &#123;</span><br><span class="line">          <span class="keyword">if</span> (res.<span class="property">confirm</span>) &#123;</span><br><span class="line">            <span class="keyword">await</span> uni.<span class="title function_">openSetting</span>()</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="property">authSetting</span>[<span class="string">&#x27;scope.userLocation&#x27;</span>]</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;è·å–æƒé™å¤±è´¥ï¼š&#x27;</span>, e)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-å®šä½å¤±è´¥å¤„ç†"><a href="#1-2-å®šä½å¤±è´¥å¤„ç†" class="headerlink" title="1.2 å®šä½å¤±è´¥å¤„ç†"></a>1.2 å®šä½å¤±è´¥å¤„ç†</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>å®šä½å¤±è´¥æ—¶æ²¡æœ‰åˆé€‚çš„æç¤ºå’Œå¤„ç†ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–ä½ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">getLocation</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> auth = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">checkLocationAuth</span>()</span><br><span class="line">    <span class="keyword">if</span> (!auth) &#123;</span><br><span class="line">      uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;è¯·å…ˆå¼€å¯å®šä½æƒé™&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> location = <span class="keyword">await</span> uni.<span class="title function_">getLocation</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;gcj02&#x27;</span>, <span class="comment">// gcj02ç«æ˜Ÿåæ ‡ç³»</span></span><br><span class="line">      <span class="attr">isHighAccuracy</span>: <span class="literal">true</span>, <span class="comment">// å¼€å¯é«˜ç²¾åº¦å®šä½</span></span><br><span class="line">      <span class="attr">highAccuracyExpireTime</span>: <span class="number">3000</span> <span class="comment">// è¶…æ—¶æ—¶é—´</span></span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> location</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">let</span> message = <span class="string">&#x27;å®šä½å¤±è´¥&#x27;</span></span><br><span class="line">    <span class="keyword">switch</span> (e.<span class="property">errMsg</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;getLocation:fail system permission denied&#x27;</span>:</span><br><span class="line">        message = <span class="string">&#x27;ç³»ç»Ÿå®šä½æƒé™å·²å…³é—­&#x27;</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;getLocation:fail timeout&#x27;</span>:</span><br><span class="line">        message = <span class="string">&#x27;å®šä½è¶…æ—¶ï¼Œè¯·é‡è¯•&#x27;</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">        message = <span class="string">&#x27;å®šä½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: message,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-åœ°å›¾æ˜¾ç¤ºé—®é¢˜"><a href="#2-åœ°å›¾æ˜¾ç¤ºé—®é¢˜" class="headerlink" title="2. åœ°å›¾æ˜¾ç¤ºé—®é¢˜"></a>2. åœ°å›¾æ˜¾ç¤ºé—®é¢˜</h2><h3 id="2-1-åœ°å›¾åŠ è½½å¤±è´¥"><a href="#2-1-åœ°å›¾åŠ è½½å¤±è´¥" class="headerlink" title="2.1 åœ°å›¾åŠ è½½å¤±è´¥"></a>2.1 åœ°å›¾åŠ è½½å¤±è´¥</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>åœ°å›¾ç»„ä»¶åŠ è½½å¤±è´¥æˆ–æ˜¾ç¤ºç©ºç™½ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- åœ°å›¾ç»„ä»¶ä½¿ç”¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;map-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">map</span></span></span><br><span class="line"><span class="tag">      <span class="attr">id</span>=<span class="string">&quot;map&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:style</span>=<span class="string">&quot;mapStyle&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:latitude</span>=<span class="string">&quot;latitude&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:longitude</span>=<span class="string">&quot;longitude&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:markers</span>=<span class="string">&quot;markers&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:scale</span>=<span class="string">&quot;scale&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">regionchange</span>=<span class="string">&quot;onRegionChange&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">markertap</span>=<span class="string">&quot;onMarkerTap&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:show-location</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">mapStyle</span>: <span class="string">&#x27;width: 100%; height: 300px;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">latitude</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">longitude</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">markers</span>: [],</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">scale</span>: <span class="number">16</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">async</span> <span class="title function_">onReady</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// ç­‰å¾…åœ°å›¾ç»„ä»¶åˆ›å»ºå®Œæˆ</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="property">mapContext</span> = uni.<span class="title function_">createMapContext</span>(<span class="string">&#x27;map&#x27;</span>, <span class="variable language_">this</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">initMap</span>()</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">async</span> <span class="title function_">initMap</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> location = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">getLocation</span>()</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (location) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">latitude</span> = location.<span class="property">latitude</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">longitude</span> = location.<span class="property">longitude</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// æ·»åŠ å½“å‰ä½ç½®æ ‡è®°</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="title function_">addMarker</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">id</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">latitude</span>: location.<span class="property">latitude</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">longitude</span>: location.<span class="property">longitude</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">title</span>: <span class="string">&#x27;å½“å‰ä½ç½®&#x27;</span></span></span><br><span class="line"><span class="language-javascript">          &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">catch</span> (e) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;åˆå§‹åŒ–åœ°å›¾å¤±è´¥ï¼š&#x27;</span>, e)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-2-æ ‡è®°ç‚¹æ˜¾ç¤ºé—®é¢˜"><a href="#2-2-æ ‡è®°ç‚¹æ˜¾ç¤ºé—®é¢˜" class="headerlink" title="2.2 æ ‡è®°ç‚¹æ˜¾ç¤ºé—®é¢˜"></a>2.2 æ ‡è®°ç‚¹æ˜¾ç¤ºé—®é¢˜</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>è‡ªå®šä¹‰æ ‡è®°ç‚¹æ ·å¼ä¸ç”Ÿæ•ˆæˆ–æ˜¾ç¤ºå¼‚å¸¸ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ è‡ªå®šä¹‰æ ‡è®°</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addMarker</span>(<span class="params">point</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> marker = &#123;</span><br><span class="line">    <span class="attr">id</span>: point.<span class="property">id</span>,</span><br><span class="line">    <span class="attr">latitude</span>: point.<span class="property">latitude</span>,</span><br><span class="line">    <span class="attr">longitude</span>: point.<span class="property">longitude</span>,</span><br><span class="line">    <span class="attr">title</span>: point.<span class="property">title</span>,</span><br><span class="line">    <span class="attr">width</span>: <span class="number">32</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">32</span>,</span><br><span class="line">    <span class="attr">callout</span>: &#123;</span><br><span class="line">      <span class="attr">content</span>: point.<span class="property">title</span>,</span><br><span class="line">      <span class="attr">color</span>: <span class="string">&#x27;#ffffff&#x27;</span>,</span><br><span class="line">      <span class="attr">fontSize</span>: <span class="number">14</span>,</span><br><span class="line">      <span class="attr">borderRadius</span>: <span class="number">4</span>,</span><br><span class="line">      <span class="attr">bgColor</span>: <span class="string">&#x27;#1989fa&#x27;</span>,</span><br><span class="line">      <span class="attr">padding</span>: <span class="number">8</span>,</span><br><span class="line">      <span class="attr">display</span>: <span class="string">&#x27;ALWAYS&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰å›¾æ ‡</span></span><br><span class="line">    <span class="attr">iconPath</span>: point.<span class="property">iconPath</span> || <span class="string">&#x27;/static/images/marker.png&#x27;</span>,</span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰æ°”æ³¡</span></span><br><span class="line">    <span class="attr">customCallout</span>: &#123;</span><br><span class="line">      <span class="attr">display</span>: <span class="string">&#x27;ALWAYS&#x27;</span>,</span><br><span class="line">      <span class="attr">anchorY</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">anchorX</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">markers</span>.<span class="title function_">push</span>(marker)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-è·¯çº¿è§„åˆ’é—®é¢˜"><a href="#3-è·¯çº¿è§„åˆ’é—®é¢˜" class="headerlink" title="3. è·¯çº¿è§„åˆ’é—®é¢˜"></a>3. è·¯çº¿è§„åˆ’é—®é¢˜</h2><h3 id="3-1-è·¯çº¿ç»˜åˆ¶é”™è¯¯"><a href="#3-1-è·¯çº¿ç»˜åˆ¶é”™è¯¯" class="headerlink" title="3.1 è·¯çº¿ç»˜åˆ¶é”™è¯¯"></a>3.1 è·¯çº¿ç»˜åˆ¶é”™è¯¯</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>è·¯çº¿è§„åˆ’æ—¶ç»˜åˆ¶çš„è·¯çº¿ä¸å‡†ç¡®æˆ–æ— æ³•æ˜¾ç¤ºã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è§„åˆ’è·¯çº¿</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">planRoute</span>(<span class="params">start, end</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// æ¸…é™¤æ—§è·¯çº¿</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">polyline</span> = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–è·¯çº¿è§„åˆ’</span></span><br><span class="line">    <span class="keyword">const</span> route = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">getRoutePoints</span>(start, end)</span><br><span class="line">    <span class="keyword">if</span> (!route) <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç»˜åˆ¶è·¯çº¿</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">polyline</span> = [&#123;</span><br><span class="line">      <span class="attr">points</span>: route,</span><br><span class="line">      <span class="attr">color</span>: <span class="string">&#x27;#1989fa&#x27;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">4</span>,</span><br><span class="line">      <span class="attr">arrowLine</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">borderColor</span>: <span class="string">&#x27;#ffffff&#x27;</span>,</span><br><span class="line">      <span class="attr">borderWidth</span>: <span class="number">2</span></span><br><span class="line">    &#125;]</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è°ƒæ•´è§†é‡ä»¥æ˜¾ç¤ºæ•´æ¡è·¯çº¿</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">mapContext</span>.<span class="title function_">includePoints</span>(&#123;</span><br><span class="line">      <span class="attr">points</span>: [start, end],</span><br><span class="line">      <span class="attr">padding</span>: [<span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;è§„åˆ’è·¯çº¿å¤±è´¥ï¼š&#x27;</span>, e)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-å¯¼èˆªé—®é¢˜"><a href="#3-2-å¯¼èˆªé—®é¢˜" class="headerlink" title="3.2 å¯¼èˆªé—®é¢˜"></a>3.2 å¯¼èˆªé—®é¢˜</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>è°ƒç”¨å¯¼èˆªåŠŸèƒ½æ—¶å‡ºç°å…¼å®¹æ€§é—®é¢˜ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰“å¼€å¯¼èˆª</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">openNavigation</span>(<span class="params">destination</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// æ£€æŸ¥å¹³å°</span></span><br><span class="line">    <span class="comment">// #ifdef APP-PLUS</span></span><br><span class="line">    <span class="comment">// APPç«¯ä½¿ç”¨ç³»ç»Ÿå¯¼èˆª</span></span><br><span class="line">    plus.<span class="property">runtime</span>.<span class="title function_">openURL</span>(</span><br><span class="line">      <span class="string">`androidamap://navi?sourceApplication=appname&amp;lat=<span class="subst">$&#123;destination.latitude&#125;</span>&amp;lon=<span class="subst">$&#123;destination.longitude&#125;</span>&amp;dev=0&amp;style=2`</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// #ifdef H5</span></span><br><span class="line">    <span class="comment">// H5ç«¯ä½¿ç”¨Webå¯¼èˆª</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">`https://uri.amap.com/navigation?to=<span class="subst">$&#123;destination.longitude&#125;</span>,<span class="subst">$&#123;destination.latitude&#125;</span>&amp;mode=car&amp;policy=1`</span></span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// #ifdef MP-WEIXIN</span></span><br><span class="line">    <span class="comment">// å°ç¨‹åºç«¯ä½¿ç”¨å¾®ä¿¡å¯¼èˆª</span></span><br><span class="line">    uni.<span class="title function_">openLocation</span>(&#123;</span><br><span class="line">      <span class="attr">latitude</span>: destination.<span class="property">latitude</span>,</span><br><span class="line">      <span class="attr">longitude</span>: destination.<span class="property">longitude</span>,</span><br><span class="line">      <span class="attr">name</span>: destination.<span class="property">name</span>,</span><br><span class="line">      <span class="attr">address</span>: destination.<span class="property">address</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;æ‰“å¼€å¯¼èˆªå¤±è´¥&#x27;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-æ€§èƒ½ä¼˜åŒ–é—®é¢˜"><a href="#4-æ€§èƒ½ä¼˜åŒ–é—®é¢˜" class="headerlink" title="4. æ€§èƒ½ä¼˜åŒ–é—®é¢˜"></a>4. æ€§èƒ½ä¼˜åŒ–é—®é¢˜</h2><h3 id="4-1-æ ‡è®°ç‚¹è¿‡å¤š"><a href="#4-1-æ ‡è®°ç‚¹è¿‡å¤š" class="headerlink" title="4.1 æ ‡è®°ç‚¹è¿‡å¤š"></a>4.1 æ ‡è®°ç‚¹è¿‡å¤š</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>åœ°å›¾ä¸Šæ ‡è®°ç‚¹å¤ªå¤šå¯¼è‡´å¡é¡¿ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// èšåˆæ ‡è®°ç‚¹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clusterMarkers</span>(<span class="params">markers, distance = <span class="number">20</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> clusters = []</span><br><span class="line">  <span class="keyword">const</span> used = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">  </span><br><span class="line">  markers.<span class="title function_">forEach</span>(<span class="function">(<span class="params">marker, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (used.<span class="title function_">has</span>(index)) <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> cluster = &#123;</span><br><span class="line">      <span class="attr">center</span>: &#123;</span><br><span class="line">        <span class="attr">latitude</span>: marker.<span class="property">latitude</span>,</span><br><span class="line">        <span class="attr">longitude</span>: marker.<span class="property">longitude</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">points</span>: [marker]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æŸ¥æ‰¾é™„è¿‘çš„ç‚¹</span></span><br><span class="line">    markers.<span class="title function_">forEach</span>(<span class="function">(<span class="params">m, i</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (i === index || used.<span class="title function_">has</span>(i)) <span class="keyword">return</span></span><br><span class="line">      </span><br><span class="line">      <span class="keyword">const</span> d = <span class="variable language_">this</span>.<span class="title function_">calculateDistance</span>(</span><br><span class="line">        marker.<span class="property">latitude</span>,</span><br><span class="line">        marker.<span class="property">longitude</span>,</span><br><span class="line">        m.<span class="property">latitude</span>,</span><br><span class="line">        m.<span class="property">longitude</span></span><br><span class="line">      )</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (d &lt;= distance) &#123;</span><br><span class="line">        cluster.<span class="property">points</span>.<span class="title function_">push</span>(m)</span><br><span class="line">        used.<span class="title function_">add</span>(i)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    clusters.<span class="title function_">push</span>(cluster)</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> clusters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-é¢‘ç¹æ›´æ–°"><a href="#4-2-é¢‘ç¹æ›´æ–°" class="headerlink" title="4.2 é¢‘ç¹æ›´æ–°"></a>4.2 é¢‘ç¹æ›´æ–°</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>é¢‘ç¹æ›´æ–°æ ‡è®°ç‚¹ä½ç½®å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨èŠ‚æµæ›´æ–°ä½ç½®</span></span><br><span class="line"><span class="keyword">const</span> throttleUpdate = <span class="title function_">throttle</span>(<span class="keyword">function</span>(<span class="params">markers</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">markers</span> = markers</span><br><span class="line">&#125;, <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ›´æ–°æ ‡è®°ä½ç½®</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateMarkers</span>(<span class="params">newMarkers</span>) &#123;</span><br><span class="line">  <span class="title function_">throttleUpdate</span>(newMarkers)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// èŠ‚æµå‡½æ•°</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">fn, delay</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (timer) <span class="keyword">return</span></span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)</span><br><span class="line">      timer = <span class="literal">null</span></span><br><span class="line">    &#125;, delay)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-å®ç”¨åŠŸèƒ½åˆ†äº«"><a href="#5-å®ç”¨åŠŸèƒ½åˆ†äº«" class="headerlink" title="5. å®ç”¨åŠŸèƒ½åˆ†äº«"></a>5. å®ç”¨åŠŸèƒ½åˆ†äº«</h2><h3 id="5-1-è®¡ç®—è·ç¦»"><a href="#5-1-è®¡ç®—è·ç¦»" class="headerlink" title="5.1 è®¡ç®—è·ç¦»"></a>5.1 è®¡ç®—è·ç¦»</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®—ä¸¤ç‚¹è·ç¦»</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">calculateDistance</span>(<span class="params">lat1, lng1, lat2, lng2</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> R = <span class="number">6371</span> <span class="comment">// åœ°çƒåŠå¾„ï¼Œå•ä½km</span></span><br><span class="line">  <span class="keyword">const</span> dLat = (lat2 - lat1) * <span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">180</span></span><br><span class="line">  <span class="keyword">const</span> dLng = (lng2 - lng1) * <span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">180</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> a = <span class="title class_">Math</span>.<span class="title function_">sin</span>(dLat/<span class="number">2</span>) * <span class="title class_">Math</span>.<span class="title function_">sin</span>(dLat/<span class="number">2</span>) +</span><br><span class="line">    <span class="title class_">Math</span>.<span class="title function_">cos</span>(lat1 * <span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">180</span>) * <span class="title class_">Math</span>.<span class="title function_">cos</span>(lat2 * <span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">180</span>) *</span><br><span class="line">    <span class="title class_">Math</span>.<span class="title function_">sin</span>(dLng/<span class="number">2</span>) * <span class="title class_">Math</span>.<span class="title function_">sin</span>(dLng/<span class="number">2</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> c = <span class="number">2</span> * <span class="title class_">Math</span>.<span class="title function_">atan2</span>(<span class="title class_">Math</span>.<span class="title function_">sqrt</span>(a), <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="number">1</span>-a))</span><br><span class="line">  <span class="keyword">return</span> R * c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2-åœ°å€è§£æ"><a href="#5-2-åœ°å€è§£æ" class="headerlink" title="5.2 åœ°å€è§£æ"></a>5.2 åœ°å€è§£æ</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ°å€è½¬åæ ‡</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">geocode</span>(<span class="params">address</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;geocode-api-url&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">address</span>: address,</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&#x27;your-api-key&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">data</span>.<span class="property">status</span> === <span class="string">&#x27;1&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">latitude</span>: res.<span class="property">data</span>.<span class="property">result</span>.<span class="property">location</span>.<span class="property">lat</span>,</span><br><span class="line">        <span class="attr">longitude</span>: res.<span class="property">data</span>.<span class="property">result</span>.<span class="property">location</span>.<span class="property">lng</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;åœ°å€è§£æå¤±è´¥ï¼š&#x27;</span>, e)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-æœ€ä½³å®è·µå»ºè®®"><a href="#6-æœ€ä½³å®è·µå»ºè®®" class="headerlink" title="6. æœ€ä½³å®è·µå»ºè®®"></a>6. æœ€ä½³å®è·µå»ºè®®</h2><ol><li>æ³¨æ„æƒé™å¤„ç†</li><li>åšå¥½é”™è¯¯æç¤º</li><li>ä¼˜åŒ–æ€§èƒ½è¡¨ç°</li><li>å¤„ç†å…¼å®¹é—®é¢˜</li><li>æ³¨æ„ç”¨æˆ·ä½“éªŒ</li></ol><h2 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7. æ€»ç»“"></a>7. æ€»ç»“</h2><ol><li>æƒé™é—®é¢˜è¦æå‰å¤„ç†</li><li>åœ°å›¾æ˜¾ç¤ºè¦åšå¥½å…¼å®¹</li><li>è·¯çº¿è§„åˆ’è¦è€ƒè™‘æ€§èƒ½</li><li>å¯¼èˆªåŠŸèƒ½è¦é€‚é…å¹³å°</li><li>æ³¨æ„ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ</li></ol><hr><blockquote><p>å¦‚æœè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©,æ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«,ä½ çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼ </p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/uni-app/">uni-app</category>
      
      
      <category domain="https://www.hzv5.cn/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/tags/uni-app/">uni-app</category>
      
      <category domain="https://www.hzv5.cn/tags/%E5%9C%B0%E5%9B%BE%E5%8A%9F%E8%83%BD/">åœ°å›¾åŠŸèƒ½</category>
      
      <category domain="https://www.hzv5.cn/tags/%E5%AE%9A%E4%BD%8D%E6%9C%8D%E5%8A%A1/">å®šä½æœåŠ¡</category>
      
      
      <comments>https://www.hzv5.cn/2024/06/25/uniapp-map-location/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>uni-appæ–‡ä»¶ä¸Šä¼ è¸©å‘è®°ï¼šå›¾ç‰‡å¤„ç†å’Œä¸Šä¼ å…¨æ”»ç•¥</title>
      <link>https://www.hzv5.cn/2024/06/01/uniapp-file-upload/</link>
      <guid>https://www.hzv5.cn/2024/06/01/uniapp-file-upload/</guid>
      <pubDate>Sat, 01 Jun 2024 07:20:00 GMT</pubDate>
      
      <description>è¯¦ç»†ä»‹ç»uni-appä¸­æ–‡ä»¶ä¸Šä¼ å’Œå›¾ç‰‡å¤„ç†çš„å„ç§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬å›¾ç‰‡å‹ç¼©ã€æ‰¹é‡ä¸Šä¼ ã€ä¸Šä¼ è¿›åº¦ç­‰å®ç”¨æŠ€å·§ï¼Œé€‚åˆæ–°æ‰‹é˜…è¯»ã€‚</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>åœ¨uni-appå¼€å‘ä¸­ï¼Œæ–‡ä»¶ä¸Šä¼ å’Œå›¾ç‰‡å¤„ç†æ˜¯å¾ˆå¸¸è§çš„éœ€æ±‚ï¼Œä½†ä¹Ÿç»å¸¸ä¼šé‡åˆ°å„ç§é—®é¢˜ã€‚æœ¬æ–‡æ€»ç»“äº†ä¸€äº›å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Œå¸Œæœ›èƒ½å¸®åŠ©å¤§å®¶æ›´å¥½åœ°å¤„ç†æ–‡ä»¶ä¸Šä¼ ç›¸å…³çš„éœ€æ±‚ã€‚</p></blockquote><span id="more"></span><h2 id="1-å›¾ç‰‡é€‰æ‹©é—®é¢˜"><a href="#1-å›¾ç‰‡é€‰æ‹©é—®é¢˜" class="headerlink" title="1. å›¾ç‰‡é€‰æ‹©é—®é¢˜"></a>1. å›¾ç‰‡é€‰æ‹©é—®é¢˜</h2><h3 id="1-1-å›¾ç‰‡é€‰æ‹©æ•°é‡é™åˆ¶"><a href="#1-1-å›¾ç‰‡é€‰æ‹©æ•°é‡é™åˆ¶" class="headerlink" title="1.1 å›¾ç‰‡é€‰æ‹©æ•°é‡é™åˆ¶"></a>1.1 å›¾ç‰‡é€‰æ‹©æ•°é‡é™åˆ¶</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>é€‰æ‹©å›¾ç‰‡æ—¶æ²¡æœ‰é™åˆ¶æ•°é‡ï¼Œå¯¼è‡´ç”¨æˆ·å¯èƒ½é€‰æ‹©å¤ªå¤šå›¾ç‰‡ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é™åˆ¶é€‰æ‹©æ•°é‡å’Œå¤§å°</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">chooseImages</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> uni.<span class="title function_">chooseImage</span>(&#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">9</span>, <span class="comment">// æœ€å¤šé€‰æ‹©9å¼ </span></span><br><span class="line">      <span class="attr">sizeType</span>: [<span class="string">&#x27;original&#x27;</span>, <span class="string">&#x27;compressed&#x27;</span>], <span class="comment">// åŸå›¾å’Œå‹ç¼©å›¾éƒ½å¯ä»¥</span></span><br><span class="line">      <span class="attr">sourceType</span>: [<span class="string">&#x27;album&#x27;</span>, <span class="string">&#x27;camera&#x27;</span>] <span class="comment">// ç›¸å†Œå’Œç›¸æœºéƒ½å¯ä»¥</span></span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ£€æŸ¥æ–‡ä»¶å¤§å°</span></span><br><span class="line">    <span class="keyword">const</span> maxSize = <span class="number">5</span> * <span class="number">1024</span> * <span class="number">1024</span> <span class="comment">// 5MB</span></span><br><span class="line">    <span class="keyword">const</span> overSizeFiles = res.<span class="property">tempFiles</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">file</span> =&gt;</span> file.<span class="property">size</span> &gt; maxSize)</span><br><span class="line">    <span class="keyword">if</span> (overSizeFiles.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">handleUpload</span>(res.<span class="property">tempFilePaths</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;é€‰æ‹©å›¾ç‰‡å¤±è´¥ï¼š&#x27;</span>, e)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-å›¾ç‰‡æ ¼å¼é™åˆ¶"><a href="#1-2-å›¾ç‰‡æ ¼å¼é™åˆ¶" class="headerlink" title="1.2 å›¾ç‰‡æ ¼å¼é™åˆ¶"></a>1.2 å›¾ç‰‡æ ¼å¼é™åˆ¶</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>ç”¨æˆ·ä¸Šä¼ äº†ä¸æ”¯æŒçš„å›¾ç‰‡æ ¼å¼ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ£€æŸ¥å›¾ç‰‡æ ¼å¼</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkImageType</span>(<span class="params">filePath</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> allowTypes = [<span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>, <span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>]</span><br><span class="line">  <span class="keyword">const</span> extension = filePath.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="title function_">pop</span>().<span class="title function_">toLowerCase</span>()</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (!allowTypes.<span class="title function_">includes</span>(extension)) &#123;</span><br><span class="line">    uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;åªæ”¯æŒjpgã€pngã€gifæ ¼å¼&#x27;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-å›¾ç‰‡å‹ç¼©é—®é¢˜"><a href="#2-å›¾ç‰‡å‹ç¼©é—®é¢˜" class="headerlink" title="2. å›¾ç‰‡å‹ç¼©é—®é¢˜"></a>2. å›¾ç‰‡å‹ç¼©é—®é¢˜</h2><h3 id="2-1-ä¸Šä¼ å‰å‹ç¼©"><a href="#2-1-ä¸Šä¼ å‰å‹ç¼©" class="headerlink" title="2.1 ä¸Šä¼ å‰å‹ç¼©"></a>2.1 ä¸Šä¼ å‰å‹ç¼©</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>å›¾ç‰‡å¤ªå¤§å¯¼è‡´ä¸Šä¼ æ…¢ï¼Œæµªè´¹æµé‡ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‹ç¼©å›¾ç‰‡</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">compressImage</span>(<span class="params">tempFilePath</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> uni.<span class="title function_">compressImage</span>(&#123;</span><br><span class="line">      <span class="attr">src</span>: tempFilePath,</span><br><span class="line">      <span class="attr">quality</span>: <span class="number">80</span> <span class="comment">// å‹ç¼©è´¨é‡0-100</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> res.<span class="property">tempFilePath</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;å‹ç¼©å¤±è´¥ï¼š&#x27;</span>, e)</span><br><span class="line">    <span class="keyword">return</span> tempFilePath <span class="comment">// å‹ç¼©å¤±è´¥è¿”å›åŸå›¾</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">handleUpload</span>(<span class="params">tempFilePaths</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> compressedPaths = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> path <span class="keyword">of</span> tempFilePaths) &#123;</span><br><span class="line">    <span class="keyword">const</span> compressed = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">compressImage</span>(path)</span><br><span class="line">    compressedPaths.<span class="title function_">push</span>(compressed)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">uploadFiles</span>(compressedPaths)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-å¤§å›¾é¢„è§ˆä¼˜åŒ–"><a href="#2-2-å¤§å›¾é¢„è§ˆä¼˜åŒ–" class="headerlink" title="2.2 å¤§å›¾é¢„è§ˆä¼˜åŒ–"></a>2.2 å¤§å›¾é¢„è§ˆä¼˜åŒ–</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>ç›´æ¥é¢„è§ˆåŸå›¾å ç”¨å†…å­˜å¤§ï¼Œå¯èƒ½å¯¼è‡´å¡é¡¿ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¢„è§ˆæ—¶ä½¿ç”¨ç¼©ç•¥å›¾ï¼Œç‚¹å‡»æŸ¥çœ‹åŸå›¾</span></span><br><span class="line"><span class="keyword">const</span> imageList = &#123;</span><br><span class="line">  <span class="attr">original</span>: [], <span class="comment">// åŸå›¾</span></span><br><span class="line">  <span class="attr">thumbnail</span>: [] <span class="comment">// ç¼©ç•¥å›¾</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¢„è§ˆå›¾ç‰‡</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">previewImage</span>(<span class="params">index</span>) &#123;</span><br><span class="line">  uni.<span class="title function_">previewImage</span>(&#123;</span><br><span class="line">    <span class="attr">urls</span>: imageList.<span class="property">original</span>,</span><br><span class="line">    <span class="attr">current</span>: index,</span><br><span class="line">    <span class="comment">// æ˜¾ç¤ºåŠ è½½æç¤º</span></span><br><span class="line">    <span class="attr">showmenu</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;é¢„è§ˆæˆåŠŸ&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">fail</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;é¢„è§ˆå¤±è´¥&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-ä¸Šä¼ è¿›åº¦é—®é¢˜"><a href="#3-ä¸Šä¼ è¿›åº¦é—®é¢˜" class="headerlink" title="3. ä¸Šä¼ è¿›åº¦é—®é¢˜"></a>3. ä¸Šä¼ è¿›åº¦é—®é¢˜</h2><h3 id="3-1-è¿›åº¦æ˜¾ç¤ºä¸å‡†"><a href="#3-1-è¿›åº¦æ˜¾ç¤ºä¸å‡†" class="headerlink" title="3.1 è¿›åº¦æ˜¾ç¤ºä¸å‡†"></a>3.1 è¿›åº¦æ˜¾ç¤ºä¸å‡†</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>ä¸Šä¼ è¿›åº¦æ˜¾ç¤ºä¸å‡†ç¡®ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ›´ç²¾ç¡®çš„è¿›åº¦æ˜¾ç¤º</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">uploadFile</span>(<span class="params">filePath</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> uploadTask = uni.<span class="title function_">uploadFile</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;your-upload-url&#x27;</span>,</span><br><span class="line">      <span class="attr">filePath</span>: filePath,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">      <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> <span class="title function_">resolve</span>(res),</span><br><span class="line">      <span class="attr">fail</span>: <span class="function"><span class="params">err</span> =&gt;</span> <span class="title function_">reject</span>(err)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç›‘å¬ä¸Šä¼ è¿›åº¦</span></span><br><span class="line">    uploadTask.<span class="title function_">onProgressUpdate</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> progress = res.<span class="property">progress</span></span><br><span class="line">      <span class="keyword">const</span> speed = (res.<span class="property">totalBytesSent</span> / <span class="number">1024</span> / <span class="number">1024</span>).<span class="title function_">toFixed</span>(<span class="number">2</span>)</span><br><span class="line">      </span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">uploadInfo</span> = &#123;</span><br><span class="line">        <span class="attr">progress</span>: progress,</span><br><span class="line">        <span class="attr">speed</span>: speed + <span class="string">&#x27;MB/s&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// æ›´æ–°UIæ˜¾ç¤º</span></span><br><span class="line">      <span class="variable language_">this</span>.$set(<span class="variable language_">this</span>.<span class="property">uploadProgress</span>, filePath, progress)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-æ‰¹é‡ä¸Šä¼ è¿›åº¦"><a href="#3-2-æ‰¹é‡ä¸Šä¼ è¿›åº¦" class="headerlink" title="3.2 æ‰¹é‡ä¸Šä¼ è¿›åº¦"></a>3.2 æ‰¹é‡ä¸Šä¼ è¿›åº¦</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>å¤šæ–‡ä»¶ä¸Šä¼ æ—¶æ— æ³•æ˜¾ç¤ºæ€»ä½“è¿›åº¦ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰¹é‡ä¸Šä¼ è¿›åº¦ç®¡ç†</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">uploadFiles</span>(<span class="params">files</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> total = files.<span class="property">length</span></span><br><span class="line">  <span class="keyword">let</span> completed = <span class="number">0</span></span><br><span class="line">  </span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">totalProgress</span> = <span class="number">0</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> uploads = files.<span class="title function_">map</span>(<span class="title function_">async</span> (file, index) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">uploadFile</span>(file)</span><br><span class="line">      completed++</span><br><span class="line">      <span class="comment">// æ›´æ–°æ€»è¿›åº¦</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">totalProgress</span> = <span class="title class_">Math</span>.<span class="title function_">floor</span>((completed / total) * <span class="number">100</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`æ–‡ä»¶<span class="subst">$&#123;index + <span class="number">1</span>&#125;</span>ä¸Šä¼ å¤±è´¥ï¼š`</span>, e)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(uploads)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-ä¸Šä¼ é”™è¯¯å¤„ç†"><a href="#4-ä¸Šä¼ é”™è¯¯å¤„ç†" class="headerlink" title="4. ä¸Šä¼ é”™è¯¯å¤„ç†"></a>4. ä¸Šä¼ é”™è¯¯å¤„ç†</h2><h3 id="4-1-æ–­ç½‘é‡ä¼ "><a href="#4-1-æ–­ç½‘é‡ä¼ " class="headerlink" title="4.1 æ–­ç½‘é‡ä¼ "></a>4.1 æ–­ç½‘é‡ä¼ </h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>ä¸Šä¼ è¿‡ç¨‹ä¸­æ–­ç½‘å¯¼è‡´ä¸Šä¼ å¤±è´¥ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ é‡è¯•æœºåˆ¶</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">uploadWithRetry</span>(<span class="params">file, maxRetries = <span class="number">3</span></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> retries = <span class="number">0</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">while</span> (retries &lt; maxRetries) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">uploadFile</span>(file)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      retries++</span><br><span class="line">      <span class="keyword">if</span> (retries === maxRetries) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;ä¸Šä¼ å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// ç­‰å¾…åé‡è¯•</span></span><br><span class="line">      <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">1000</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-é”™è¯¯æç¤ºä¼˜åŒ–"><a href="#4-2-é”™è¯¯æç¤ºä¼˜åŒ–" class="headerlink" title="4.2 é”™è¯¯æç¤ºä¼˜åŒ–"></a>4.2 é”™è¯¯æç¤ºä¼˜åŒ–</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>ä¸Šä¼ å¤±è´¥æ—¶æç¤ºä¸å¤Ÿå‹å¥½ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼˜åŒ–é”™è¯¯æç¤º</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleUploadError</span>(<span class="params">error</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> message = <span class="string">&#x27;ä¸Šä¼ å¤±è´¥&#x27;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ ¹æ®é”™è¯¯ç±»å‹æ˜¾ç¤ºä¸åŒæç¤º</span></span><br><span class="line">  <span class="keyword">switch</span> (error.<span class="property">code</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;NETWORK_ERROR&#x27;</span>:</span><br><span class="line">      message = <span class="string">&#x27;ç½‘ç»œå¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®&#x27;</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;SIZE_EXCEED&#x27;</span>:</span><br><span class="line">      message = <span class="string">&#x27;æ–‡ä»¶å¤§å°è¶…å‡ºé™åˆ¶&#x27;</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;TYPE_ERROR&#x27;</span>:</span><br><span class="line">      message = <span class="string">&#x27;ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹&#x27;</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      message = error.<span class="property">message</span> || <span class="string">&#x27;ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">    <span class="attr">title</span>: message,</span><br><span class="line">    <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">    <span class="attr">duration</span>: <span class="number">2000</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-å®ç”¨æŠ€å·§åˆ†äº«"><a href="#5-å®ç”¨æŠ€å·§åˆ†äº«" class="headerlink" title="5. å®ç”¨æŠ€å·§åˆ†äº«"></a>5. å®ç”¨æŠ€å·§åˆ†äº«</h2><h3 id="5-1-è‡ªåŠ¨é‡å‘½å"><a href="#5-1-è‡ªåŠ¨é‡å‘½å" class="headerlink" title="5.1 è‡ªåŠ¨é‡å‘½å"></a>5.1 è‡ªåŠ¨é‡å‘½å</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿæˆæ–‡ä»¶å</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateFileName</span>(<span class="params">file</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line">  <span class="keyword">const</span> random = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10000</span>)</span><br><span class="line">  <span class="keyword">const</span> extension = file.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="title function_">pop</span>()</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;date.getTime()&#125;</span>_<span class="subst">$&#123;random&#125;</span>.<span class="subst">$&#123;extension&#125;</span>`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2-ç§’ä¼ ä¼˜åŒ–"><a href="#5-2-ç§’ä¼ ä¼˜åŒ–" class="headerlink" title="5.2 ç§’ä¼ ä¼˜åŒ–"></a>5.2 ç§’ä¼ ä¼˜åŒ–</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²ä¸Šä¼ </span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">checkFileExists</span>(<span class="params">file</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> md5 = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">calculateMD5</span>(file)</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">checkMD5</span>(md5)</span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">exists</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="property">url</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-æœ€ä½³å®è·µå»ºè®®"><a href="#6-æœ€ä½³å®è·µå»ºè®®" class="headerlink" title="6. æœ€ä½³å®è·µå»ºè®®"></a>6. æœ€ä½³å®è·µå»ºè®®</h2><ol><li>ä¸Šä¼ å‰åšå¥½æ ¡éªŒ</li><li>åˆç†ä½¿ç”¨å‹ç¼©</li><li>æ·»åŠ é‡è¯•æœºåˆ¶</li><li>ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ</li><li>åšå¥½é”™è¯¯å¤„ç†</li></ol><h2 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7. æ€»ç»“"></a>7. æ€»ç»“</h2><ol><li>æ³¨æ„æ–‡ä»¶å¤§å°é™åˆ¶</li><li>å¤„ç†å¥½è¿›åº¦æ˜¾ç¤º</li><li>ä¼˜åŒ–ä¸Šä¼ ä½“éªŒ</li><li>åšå¥½å®¹é”™å¤„ç†</li><li>ä¿æŒä»£ç å¯ç»´æŠ¤</li></ol><hr><blockquote><p>å¦‚æœè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©,æ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«,ä½ çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼ </p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/uni-app/">uni-app</category>
      
      
      <category domain="https://www.hzv5.cn/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/tags/uni-app/">uni-app</category>
      
      <category domain="https://www.hzv5.cn/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/">æ–‡ä»¶ä¸Šä¼ </category>
      
      <category domain="https://www.hzv5.cn/tags/%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86/">å›¾ç‰‡å¤„ç†</category>
      
      
      <comments>https://www.hzv5.cn/2024/06/01/uniapp-file-upload/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>uni-appè¡¨å•éªŒè¯è¸©å‘è®°ï¼šè¿™äº›å‘æˆ‘æ›¿ä½ è¸©è¿‡äº†</title>
      <link>https://www.hzv5.cn/2024/05/10/uniapp-form-validation/</link>
      <guid>https://www.hzv5.cn/2024/05/10/uniapp-form-validation/</guid>
      <pubDate>Fri, 10 May 2024 02:30:00 GMT</pubDate>
      
      <description>æ€»ç»“uni-appè¡¨å•éªŒè¯ä¸­çš„å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬æ‰‹æœºå·éªŒè¯ã€å¯†ç éªŒè¯ã€è‡ªå®šä¹‰éªŒè¯ç­‰å®ç”¨æŠ€å·§ï¼Œé€šä¿—æ˜“æ‡‚çš„è¯­è¨€è®²è§£å¼€å‘ç»éªŒã€‚</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>åšè¿‡è¡¨å•çš„åŒå­¦éƒ½çŸ¥é“ï¼Œè¡¨å•éªŒè¯çœ‹ä¼¼ç®€å•ï¼Œä½†æ€»æœ‰ä¸€äº›æ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚æœ¬æ–‡æ•´ç†äº†ä¸€äº›å®ç”¨çš„è¡¨å•éªŒè¯ç»éªŒï¼Œå¸Œæœ›èƒ½å¸®ä½ å°‘èµ°å¼¯è·¯ã€‚</p></blockquote><span id="more"></span><h2 id="1-å¸¸è§éªŒè¯è¸©å‘"><a href="#1-å¸¸è§éªŒè¯è¸©å‘" class="headerlink" title="1. å¸¸è§éªŒè¯è¸©å‘"></a>1. å¸¸è§éªŒè¯è¸©å‘</h2><h3 id="1-1-æ‰‹æœºå·éªŒè¯ä¸å…¨é¢"><a href="#1-1-æ‰‹æœºå·éªŒè¯ä¸å…¨é¢" class="headerlink" title="1.1 æ‰‹æœºå·éªŒè¯ä¸å…¨é¢"></a>1.1 æ‰‹æœºå·éªŒè¯ä¸å…¨é¢</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>å¾ˆå¤šäººåªç”¨ä¸€ä¸ªç®€å•çš„11ä½æ•°å­—æ­£åˆ™æ¥éªŒè¯æ‰‹æœºå·ï¼Œä½†å®é™…ä¸Šè¿™æ ·å¹¶ä¸ä¸¥è°¨ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li>æ›´ä¸¥è°¨çš„æ‰‹æœºå·éªŒè¯ï¼š<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ›´å®Œæ•´çš„æ‰‹æœºå·éªŒè¯è§„åˆ™</span></span><br><span class="line"><span class="keyword">const</span> phoneReg = <span class="regexp">/^1[3-9]\d&#123;9&#125;$/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨æ–¹æ³•</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">validatePhone</span>(<span class="params">phone</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!phoneReg.<span class="title function_">test</span>(phone)) &#123;</span><br><span class="line">    uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·&#x27;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="1-2-å¯†ç å¼ºåº¦éªŒè¯ä¸å¤Ÿ"><a href="#1-2-å¯†ç å¼ºåº¦éªŒè¯ä¸å¤Ÿ" class="headerlink" title="1.2 å¯†ç å¼ºåº¦éªŒè¯ä¸å¤Ÿ"></a>1.2 å¯†ç å¼ºåº¦éªŒè¯ä¸å¤Ÿ</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>ç®€å•çš„å¯†ç éªŒè¯å®¹æ˜“å¯¼è‡´ç”¨æˆ·è®¾ç½®è¿‡äºç®€å•çš„å¯†ç ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li>æ·»åŠ å¯†ç å¼ºåº¦æ£€æŸ¥ï¼š<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯†ç å¿…é¡»åŒ…å«æ•°å­—ã€å­—æ¯ã€ç‰¹æ®Šå­—ç¬¦</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkPasswordStrength</span>(<span class="params">password</span>) &#123;</span><br><span class="line">  <span class="comment">// è‡³å°‘8ä½ï¼ŒåŒ…å«æ•°å­—å’Œå­—æ¯</span></span><br><span class="line">  <span class="keyword">const</span> baseReg = <span class="regexp">/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]&#123;8,&#125;$/</span></span><br><span class="line">  <span class="comment">// å¢åŠ ç‰¹æ®Šå­—ç¬¦è¦æ±‚</span></span><br><span class="line">  <span class="keyword">const</span> strongReg = <span class="regexp">/^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&amp;])[A-Za-z\d@$!%*#?&amp;]&#123;8,&#125;$/</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (!baseReg.<span class="title function_">test</span>(password)) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">valid</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;å¯†ç è‡³å°‘8ä½ï¼Œå¿…é¡»åŒ…å«æ•°å­—å’Œå­—æ¯&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (!strongReg.<span class="title function_">test</span>(password)) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">valid</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">level</span>: <span class="string">&#x27;normal&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;å»ºè®®å¢åŠ ç‰¹æ®Šå­—ç¬¦æé«˜å®‰å…¨æ€§&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">valid</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">level</span>: <span class="string">&#x27;strong&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;å¯†ç å¼ºåº¦å¾ˆå¥½&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="2-å®æ—¶éªŒè¯é—®é¢˜"><a href="#2-å®æ—¶éªŒè¯é—®é¢˜" class="headerlink" title="2. å®æ—¶éªŒè¯é—®é¢˜"></a>2. å®æ—¶éªŒè¯é—®é¢˜</h2><h3 id="2-1-éªŒè¯é¢‘ç‡è¿‡é«˜"><a href="#2-1-éªŒè¯é¢‘ç‡è¿‡é«˜" class="headerlink" title="2.1 éªŒè¯é¢‘ç‡è¿‡é«˜"></a>2.1 éªŒè¯é¢‘ç‡è¿‡é«˜</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>è¾“å…¥æ—¶å®æ—¶éªŒè¯ï¼Œå¯¼è‡´é¢‘ç¹æç¤ºï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li>ä½¿ç”¨é˜²æŠ–å¤„ç†ï¼š<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounceValidate</span>(<span class="params">value, rule</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">  timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æ‰§è¡ŒéªŒè¯</span></span><br><span class="line">    <span class="keyword">const</span> result = rule.<span class="title function_">test</span>(value)</span><br><span class="line">    <span class="keyword">if</span> (!result) &#123;</span><br><span class="line">      uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;æ ¼å¼ä¸æ­£ç¡®&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">500</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="2-2-å¤±ç„¦éªŒè¯æ—¶æœº"><a href="#2-2-å¤±ç„¦éªŒè¯æ—¶æœº" class="headerlink" title="2.2 å¤±ç„¦éªŒè¯æ—¶æœº"></a>2.2 å¤±ç„¦éªŒè¯æ—¶æœº</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>åœ¨è¾“å…¥æ¡†å¤±ç„¦æ—¶æ‰éªŒè¯ï¼Œä½†æœ‰æ—¶ç”¨æˆ·ç›´æ¥æäº¤è¡¨å•ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li>ç»“åˆå¤šä¸ªéªŒè¯æ—¶æœºï¼š<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">&quot;form.phone&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">input</span>=<span class="string">&quot;onPhoneInput&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">blur</span>=<span class="string">&quot;validatePhone&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥æ‰‹æœºå·&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// è¾“å…¥æ—¶ç®€å•éªŒè¯</span></span><br><span class="line">    <span class="title function_">onPhoneInput</span>(<span class="params">e</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> value = e.<span class="property">target</span>.<span class="property">value</span></span><br><span class="line">      <span class="comment">// åªå…è®¸è¾“å…¥æ•°å­—</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">phone</span> = value.<span class="title function_">replace</span>(<span class="regexp">/\D/g</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤±ç„¦æ—¶å®Œæ•´éªŒè¯</span></span><br><span class="line">    <span class="title function_">validatePhone</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">phone</span>) <span class="keyword">return</span></span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">checkPhone</span>(<span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">phone</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æäº¤æ—¶å†æ¬¡éªŒè¯</span></span><br><span class="line">    <span class="title function_">submitForm</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">validatePhone</span>()) <span class="keyword">return</span></span><br><span class="line">      <span class="comment">// ç»§ç»­æäº¤æµç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-ç‰¹æ®Šåœºæ™¯éªŒè¯"><a href="#3-ç‰¹æ®Šåœºæ™¯éªŒè¯" class="headerlink" title="3. ç‰¹æ®Šåœºæ™¯éªŒè¯"></a>3. ç‰¹æ®Šåœºæ™¯éªŒè¯</h2><h3 id="3-1-èº«ä»½è¯å·éªŒè¯"><a href="#3-1-èº«ä»½è¯å·éªŒè¯" class="headerlink" title="3.1 èº«ä»½è¯å·éªŒè¯"></a>3.1 èº«ä»½è¯å·éªŒè¯</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>ç®€å•çš„18ä½éªŒè¯æ— æ³•è¯†åˆ«å‡èº«ä»½è¯å·ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li>å®Œæ•´çš„èº«ä»½è¯éªŒè¯ï¼š<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">validateIdCard</span>(<span class="params">idCard</span>) &#123;</span><br><span class="line">  <span class="comment">// åŸºæœ¬æ ¼å¼éªŒè¯</span></span><br><span class="line">  <span class="keyword">const</span> reg = <span class="regexp">/(^\d&#123;15&#125;$)|(^\d&#123;18&#125;$)|(^\d&#123;17&#125;(\d|X|x)$)/</span></span><br><span class="line">  <span class="keyword">if</span> (!reg.<span class="title function_">test</span>(idCard)) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// éªŒè¯å‡ºç”Ÿæ—¥æœŸ</span></span><br><span class="line">  <span class="keyword">const</span> year = idCard.<span class="title function_">substr</span>(<span class="number">6</span>, <span class="number">4</span>)</span><br><span class="line">  <span class="keyword">const</span> month = idCard.<span class="title function_">substr</span>(<span class="number">10</span>, <span class="number">2</span>)</span><br><span class="line">  <span class="keyword">const</span> day = idCard.<span class="title function_">substr</span>(<span class="number">12</span>, <span class="number">2</span>)</span><br><span class="line">  <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>(year + <span class="string">&#x27;-&#x27;</span> + month + <span class="string">&#x27;-&#x27;</span> + day)</span><br><span class="line">  <span class="keyword">if</span> (date &gt; <span class="keyword">new</span> <span class="title class_">Date</span>()) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// éªŒè¯æ ¡éªŒç ï¼ˆç•¥ï¼‰</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="3-2-é‡‘é¢è¾“å…¥éªŒè¯"><a href="#3-2-é‡‘é¢è¾“å…¥éªŒè¯" class="headerlink" title="3.2 é‡‘é¢è¾“å…¥éªŒè¯"></a>3.2 é‡‘é¢è¾“å…¥éªŒè¯</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>é‡‘é¢è¾“å…¥éœ€è¦é™åˆ¶å°æ•°ä½æ•°å’Œè¾“å…¥æ ¼å¼ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li>é‡‘é¢è¾“å…¥å¤„ç†ï¼š<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é™åˆ¶åªèƒ½è¾“å…¥æ•°å­—å’Œå°æ•°ç‚¹ï¼Œæœ€å¤šä¸¤ä½å°æ•°</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">validateAmount</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="comment">// å…ˆå»é™¤éæ•°å­—å’Œå°æ•°ç‚¹</span></span><br><span class="line">  value = value.<span class="title function_">replace</span>(<span class="regexp">/[^\d.]/g</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  <span class="comment">// åªä¿ç•™ç¬¬ä¸€ä¸ªå°æ•°ç‚¹</span></span><br><span class="line">  value = value.<span class="title function_">replace</span>(<span class="regexp">/\.&#123;2,&#125;/g</span>, <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">  <span class="comment">// ä¿ç•™ä¸¤ä½å°æ•°</span></span><br><span class="line">  value = value.<span class="title function_">replace</span>(<span class="regexp">/^(\d+)\.(\d\d).*$/</span>, <span class="string">&#x27;$1.$2&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="title function_">onAmountInput</span>(<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">amount</span> = <span class="title function_">validateAmount</span>(e.<span class="property">target</span>.<span class="property">value</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="4-è¡¨å•æäº¤éªŒè¯"><a href="#4-è¡¨å•æäº¤éªŒè¯" class="headerlink" title="4. è¡¨å•æäº¤éªŒè¯"></a>4. è¡¨å•æäº¤éªŒè¯</h2><h3 id="4-1-é‡å¤æäº¤é—®é¢˜"><a href="#4-1-é‡å¤æäº¤é—®é¢˜" class="headerlink" title="4.1 é‡å¤æäº¤é—®é¢˜"></a>4.1 é‡å¤æäº¤é—®é¢˜</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>ç”¨æˆ·å¿«é€Ÿç‚¹å‡»æäº¤æŒ‰é’®ï¼Œå¯¼è‡´è¡¨å•é‡å¤æäº¤ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li>æ·»åŠ æäº¤é”ï¼š<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">submitting</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">submitForm</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">submitting</span>) <span class="keyword">return</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">submitting</span> = <span class="literal">true</span></span><br><span class="line">      </span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">submit</span>()</span><br><span class="line">        uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&#x27;æäº¤æˆåŠŸ&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&#x27;æäº¤å¤±è´¥&#x27;</span>,</span><br><span class="line">          <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">submitting</span> = <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="4-2-å¿…å¡«é¡¹æ£€æŸ¥"><a href="#4-2-å¿…å¡«é¡¹æ£€æŸ¥" class="headerlink" title="4.2 å¿…å¡«é¡¹æ£€æŸ¥"></a>4.2 å¿…å¡«é¡¹æ£€æŸ¥</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>æäº¤æ—¶æ‰å‘ç°æœ‰å¿…å¡«é¡¹æœªå¡«å†™ï¼Œä½“éªŒä¸å¥½ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li>å®æ—¶æ˜¾ç¤ºå¿…å¡«çŠ¶æ€ï¼š<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;form-item&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;label&quot;</span>&gt;</span></span><br><span class="line">    æ‰‹æœºå·</span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;required&quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">v-model</span>=<span class="string">&quot;form.phone&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:class</span>=<span class="string">&quot;&#123;&#x27;is-error&#x27;: showError &amp;&amp; !form.phone&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥æ‰‹æœºå·&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">v-if</span>=<span class="string">&quot;showError &amp;&amp; !form.phone&quot;</span> <span class="attr">class</span>=<span class="string">&quot;error-tip&quot;</span>&gt;</span></span><br><span class="line">    æ‰‹æœºå·ä¸èƒ½ä¸ºç©º</span><br><span class="line">  <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="5-å¸¸ç”¨éªŒè¯è§„åˆ™"><a href="#5-å¸¸ç”¨éªŒè¯è§„åˆ™" class="headerlink" title="5. å¸¸ç”¨éªŒè¯è§„åˆ™"></a>5. å¸¸ç”¨éªŒè¯è§„åˆ™</h2><h3 id="5-1-å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼"><a href="#5-1-å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="5.1 å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼"></a>5.1 å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> rules = &#123;</span><br><span class="line">  <span class="comment">// æ‰‹æœºå·</span></span><br><span class="line">  <span class="attr">phone</span>: <span class="regexp">/^1[3-9]\d&#123;9&#125;$/</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// é‚®ç®±</span></span><br><span class="line">  <span class="attr">email</span>: <span class="regexp">/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]&#123;2,&#125;$/</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è½¦ç‰Œå·</span></span><br><span class="line">  <span class="attr">carNo</span>: <span class="regexp">/^[äº¬æ´¥æ²ªæ¸å†€è±«äº‘è¾½é»‘æ¹˜çš–é²æ–°è‹æµ™èµ£é„‚æ¡‚ç”˜æ™‹è’™é™•å‰é—½è´µç²¤é’è—å·å®ç¼ä½¿é¢†A-Z]&#123;1&#125;[A-Z]&#123;1&#125;[A-Z0-9]&#123;4&#125;[A-Z0-9æŒ‚å­¦è­¦æ¸¯æ¾³]&#123;1&#125;$/</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// é“¶è¡Œå¡å·</span></span><br><span class="line">  <span class="attr">bankCard</span>: <span class="regexp">/^([1-9]&#123;1&#125;)(\d&#123;15&#125;|\d&#123;18&#125;)$/</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å¯†ç å¼ºåº¦</span></span><br><span class="line">  <span class="attr">password</span>: <span class="regexp">/^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&amp;])[A-Za-z\d@$!%*#?&amp;]&#123;8,&#125;$/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2-è‡ªå®šä¹‰éªŒè¯å‡½æ•°"><a href="#5-2-è‡ªå®šä¹‰éªŒè¯å‡½æ•°" class="headerlink" title="5.2 è‡ªå®šä¹‰éªŒè¯å‡½æ•°"></a>5.2 è‡ªå®šä¹‰éªŒè¯å‡½æ•°</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> validators = &#123;</span><br><span class="line">  <span class="comment">// å¹´é¾„éªŒè¯</span></span><br><span class="line">  <span class="title function_">age</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> age = <span class="built_in">parseInt</span>(value)</span><br><span class="line">    <span class="keyword">return</span> age &gt;= <span class="number">0</span> &amp;&amp; age &lt;= <span class="number">120</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ—¥æœŸéªŒè¯</span></span><br><span class="line">  <span class="title function_">date</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="built_in">isNaN</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(value).<span class="title function_">getTime</span>())</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// é‡‘é¢éªŒè¯</span></span><br><span class="line">  <span class="title function_">amount</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="regexp">/^\d+(\.\d&#123;1,2&#125;)?$/</span>.<span class="title function_">test</span>(value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-æœ€ä½³å®è·µå»ºè®®"><a href="#6-æœ€ä½³å®è·µå»ºè®®" class="headerlink" title="6. æœ€ä½³å®è·µå»ºè®®"></a>6. æœ€ä½³å®è·µå»ºè®®</h2><ol><li>åˆç†ä½¿ç”¨éªŒè¯æ—¶æœº</li><li>æ³¨æ„éªŒè¯æç¤ºçš„å‹å¥½æ€§</li><li>è€ƒè™‘ç‰¹æ®Šæƒ…å†µå¤„ç†</li><li>åšå¥½é˜²é‡å¤æäº¤</li><li>ä¿æŒä»£ç å¯ç»´æŠ¤æ€§</li></ol><h2 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7. æ€»ç»“"></a>7. æ€»ç»“</h2><ol><li>éªŒè¯è§„åˆ™è¦ä¸¥è°¨ä½†ä¸è¿‡åº¦</li><li>æ³¨æ„ç”¨æˆ·ä½“éªŒ</li><li>è€ƒè™‘å„ç§å¼‚å¸¸æƒ…å†µ</li><li>åšå¥½æ€§èƒ½ä¼˜åŒ–</li><li>ä¿æŒä»£ç æ•´æ´</li></ol><hr><blockquote><p>å¦‚æœè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©,æ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«,ä½ çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼ </p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/uni-app/">uni-app</category>
      
      
      <category domain="https://www.hzv5.cn/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/tags/uni-app/">uni-app</category>
      
      <category domain="https://www.hzv5.cn/tags/%E8%A1%A8%E5%8D%95%E9%AA%8C%E8%AF%81/">è¡¨å•éªŒè¯</category>
      
      <category domain="https://www.hzv5.cn/tags/%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C/">å®æˆ˜ç»éªŒ</category>
      
      
      <comments>https://www.hzv5.cn/2024/05/10/uniapp-form-validation/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>uni-appå¼€å‘è¸©å‘è®°å½•ï¼šæ–°æ‰‹å¿…çœ‹çš„å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</title>
      <link>https://www.hzv5.cn/2024/04/20/uniapp-common-issues/</link>
      <guid>https://www.hzv5.cn/2024/04/20/uniapp-common-issues/</guid>
      <pubDate>Sat, 20 Apr 2024 08:45:00 GMT</pubDate>
      
      <description>æ€»ç»“uni-appå¼€å‘ä¸­çš„å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Œå¸®åŠ©å¼€å‘è€…é¿å…è¸©å‘ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚é€šä¿—æ˜“æ‡‚çš„è¯­è¨€ï¼Œé€‚åˆæ–°æ‰‹é˜…è¯»ã€‚</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>åœ¨uni-appå¼€å‘ä¸­ï¼Œæ€»ä¼šé‡åˆ°ä¸€äº›è®©äººå¤´ç–¼çš„é—®é¢˜ã€‚æœ¬æ–‡æ•´ç†äº†ä¸€äº›å¸¸è§çš„å‘å’Œè§£å†³æ–¹æ¡ˆï¼Œå¸Œæœ›èƒ½å¸®åŠ©å¤§å®¶å°‘èµ°å¼¯è·¯ã€‚</p></blockquote><span id="more"></span><h2 id="1-é¡µé¢ç›¸å…³é—®é¢˜"><a href="#1-é¡µé¢ç›¸å…³é—®é¢˜" class="headerlink" title="1. é¡µé¢ç›¸å…³é—®é¢˜"></a>1. é¡µé¢ç›¸å…³é—®é¢˜</h2><h3 id="1-1-é¡µé¢è¿”å›æ•°æ®åˆ·æ–°é—®é¢˜"><a href="#1-1-é¡µé¢è¿”å›æ•°æ®åˆ·æ–°é—®é¢˜" class="headerlink" title="1.1 é¡µé¢è¿”å›æ•°æ®åˆ·æ–°é—®é¢˜"></a>1.1 é¡µé¢è¿”å›æ•°æ®åˆ·æ–°é—®é¢˜</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>ä»Aé¡µé¢è·³è½¬åˆ°Bé¡µé¢ï¼Œåœ¨Bé¡µé¢ä¿®æ”¹äº†æ•°æ®åè¿”å›Aé¡µé¢ï¼Œå‘ç°Aé¡µé¢çš„æ•°æ®æ²¡æœ‰æ›´æ–°ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li><p>ä½¿ç”¨äº‹ä»¶æ€»çº¿ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨Bé¡µé¢ä¿®æ”¹æ•°æ®åå‘é€äº‹ä»¶</span></span><br><span class="line">uni.$emit(<span class="string">&#x27;updateData&#x27;</span>, &#123; <span class="attr">data</span>: <span class="string">&#x27;æ–°æ•°æ®&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨Aé¡µé¢ç›‘å¬äº‹ä»¶</span></span><br><span class="line"><span class="title function_">onShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">  uni.$on(<span class="string">&#x27;updateData&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleUpdate</span>)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">onHide</span>(<span class="params"></span>) &#123;</span><br><span class="line">  uni.$off(<span class="string">&#x27;updateData&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleUpdate</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨é¡µé¢ç”Ÿå‘½å‘¨æœŸï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨Aé¡µé¢çš„onShowä¸­åˆ·æ–°æ•°æ®</span></span><br><span class="line"><span class="title function_">onShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">loadData</span>() <span class="comment">// é‡æ–°åŠ è½½æ•°æ®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="1-2-é¡µé¢è¿”å›å¡é¡¿é—®é¢˜"><a href="#1-2-é¡µé¢è¿”å›å¡é¡¿é—®é¢˜" class="headerlink" title="1.2 é¡µé¢è¿”å›å¡é¡¿é—®é¢˜"></a>1.2 é¡µé¢è¿”å›å¡é¡¿é—®é¢˜</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>ä½¿ç”¨uni.navigateBackè¿”å›ä¸Šä¸€é¡µæ—¶å‡ºç°æ˜æ˜¾å¡é¡¿ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li>æ£€æŸ¥é¡µé¢æ˜¯å¦æœ‰å¤§é‡æ•°æ®æˆ–å¤æ‚è®¡ç®—</li><li>ä½¿ç”¨åˆ†é¡µåŠ è½½ä»£æ›¿ä¸€æ¬¡æ€§åŠ è½½</li><li>åœ¨è¿”å›å‰æ¸…ç†ä¸å¿…è¦çš„å®šæ—¶å™¨å’Œç›‘å¬å™¨</li><li>é¿å…åœ¨onShowä¸­è¿›è¡Œè€—æ—¶æ“ä½œ</li></ol><h2 id="2-æ ·å¼å…¼å®¹é—®é¢˜"><a href="#2-æ ·å¼å…¼å®¹é—®é¢˜" class="headerlink" title="2. æ ·å¼å…¼å®¹é—®é¢˜"></a>2. æ ·å¼å…¼å®¹é—®é¢˜</h2><h3 id="2-1-ä¸åŒå¹³å°æ ·å¼å·®å¼‚"><a href="#2-1-ä¸åŒå¹³å°æ ·å¼å·®å¼‚" class="headerlink" title="2.1 ä¸åŒå¹³å°æ ·å¼å·®å¼‚"></a>2.1 ä¸åŒå¹³å°æ ·å¼å·®å¼‚</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>åŒæ ·çš„æ ·å¼åœ¨ä¸åŒå¹³å°ï¼ˆiOSã€Androidã€H5ï¼‰æ˜¾ç¤ºæ•ˆæœä¸ä¸€è‡´ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li>ä½¿ç”¨flexå¸ƒå±€ä»£æ›¿å›ºå®šå®½é«˜</li><li>é¿å…ä½¿ç”¨å¤æ‚çš„CSS3ç‰¹æ€§</li><li>ä½¿ç”¨æ¡ä»¶ç¼–è¯‘å¤„ç†å¹³å°å·®å¼‚ï¼š<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* #ifdef H5 */</span></span><br><span class="line"><span class="selector-class">.box</span> &#123; <span class="attribute">height</span>: <span class="number">100vh</span>; &#125;</span><br><span class="line"><span class="comment">/* #endif */</span></span><br><span class="line"><span class="comment">/* #ifdef MP */</span></span><br><span class="line"><span class="selector-class">.box</span> &#123; <span class="attribute">height</span>: <span class="number">100%</span>; &#125;</span><br><span class="line"><span class="comment">/* #endif */</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="2-2-æ»šåŠ¨ç©¿é€é—®é¢˜"><a href="#2-2-æ»šåŠ¨ç©¿é€é—®é¢˜" class="headerlink" title="2.2 æ»šåŠ¨ç©¿é€é—®é¢˜"></a>2.2 æ»šåŠ¨ç©¿é€é—®é¢˜</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>å¼¹çª—æ‰“å¼€æ—¶ï¼ŒèƒŒæ™¯é¡µé¢ä»å¯æ»šåŠ¨ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li><p>å¼¹çª—æ‰“å¼€æ—¶ç»™bodyæ·»åŠ ç±»ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰“å¼€å¼¹çª—æ—¶</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">overflow</span> = <span class="string">&#x27;hidden&#x27;</span></span><br><span class="line"><span class="comment">// å…³é—­å¼¹çª—æ—¶</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">overflow</span> = <span class="string">&#x27;auto&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨@touchmove.preventé˜»æ­¢æ»šåŠ¨ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;mask&quot;</span> @<span class="attr">touchmove.prevent</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="3-ç½‘ç»œè¯·æ±‚é—®é¢˜"><a href="#3-ç½‘ç»œè¯·æ±‚é—®é¢˜" class="headerlink" title="3. ç½‘ç»œè¯·æ±‚é—®é¢˜"></a>3. ç½‘ç»œè¯·æ±‚é—®é¢˜</h2><h3 id="3-1-è¯·æ±‚è¶…æ—¶å¤„ç†"><a href="#3-1-è¯·æ±‚è¶…æ—¶å¤„ç†" class="headerlink" title="3.1 è¯·æ±‚è¶…æ—¶å¤„ç†"></a>3.1 è¯·æ±‚è¶…æ—¶å¤„ç†</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>ç½‘ç»œè¯·æ±‚å¶å°”è¶…æ—¶ï¼Œå¯¼è‡´é¡µé¢å¡æ­»ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li>è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´</li><li>æ·»åŠ é‡è¯•æœºåˆ¶</li><li>æ˜¾ç¤ºåŠ è½½æç¤ºå’Œé”™è¯¯æç¤ºï¼š<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">showLoading</span>(&#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;åŠ è½½ä¸­...&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">loadData</span>()</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•&#x27;</span>,</span><br><span class="line">    <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  uni.<span class="title function_">hideLoading</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="3-2-ç™»å½•å¤±æ•ˆå¤„ç†"><a href="#3-2-ç™»å½•å¤±æ•ˆå¤„ç†" class="headerlink" title="3.2 ç™»å½•å¤±æ•ˆå¤„ç†"></a>3.2 ç™»å½•å¤±æ•ˆå¤„ç†</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>tokenè¿‡æœŸåç»§ç»­è¯·æ±‚æ¥å£å¯¼è‡´æŠ¥é”™ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li>ç»Ÿä¸€å¤„ç†tokenè¿‡æœŸï¼š<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯·æ±‚æ‹¦æˆªå™¨ä¸­å¤„ç†</span></span><br><span class="line"><span class="keyword">if</span> (response.<span class="property">code</span> === <span class="number">401</span>) &#123;</span><br><span class="line">  <span class="comment">// æ¸…é™¤ç™»å½•ä¿¡æ¯</span></span><br><span class="line">  uni.<span class="title function_">clearStorageSync</span>()</span><br><span class="line">  <span class="comment">// è·³è½¬ç™»å½•é¡µ</span></span><br><span class="line">  uni.<span class="title function_">reLaunch</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/pages/login/index&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="4-æ€§èƒ½ä¼˜åŒ–é—®é¢˜"><a href="#4-æ€§èƒ½ä¼˜åŒ–é—®é¢˜" class="headerlink" title="4. æ€§èƒ½ä¼˜åŒ–é—®é¢˜"></a>4. æ€§èƒ½ä¼˜åŒ–é—®é¢˜</h2><h3 id="4-1-å›¾ç‰‡åŠ è½½ä¼˜åŒ–"><a href="#4-1-å›¾ç‰‡åŠ è½½ä¼˜åŒ–" class="headerlink" title="4.1 å›¾ç‰‡åŠ è½½ä¼˜åŒ–"></a>4.1 å›¾ç‰‡åŠ è½½ä¼˜åŒ–</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>é¡µé¢ä¸­å›¾ç‰‡è¾ƒå¤šï¼ŒåŠ è½½æ…¢ä¸”å ç”¨å†…å­˜ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li><p>ä½¿ç”¨æ‡’åŠ è½½ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;url&quot;</span> <span class="attr">lazy-load</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>å‹ç¼©å›¾ç‰‡</p></li><li><p>ä½¿ç”¨CDNåŠ é€Ÿ</p></li><li><p>é¢„åŠ è½½é‡è¦å›¾ç‰‡</p></li></ol><h3 id="4-2-åˆ—è¡¨å¡é¡¿é—®é¢˜"><a href="#4-2-åˆ—è¡¨å¡é¡¿é—®é¢˜" class="headerlink" title="4.2 åˆ—è¡¨å¡é¡¿é—®é¢˜"></a>4.2 åˆ—è¡¨å¡é¡¿é—®é¢˜</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>é•¿åˆ—è¡¨æ»šåŠ¨æ—¶å‡ºç°å¡é¡¿ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li>ä½¿ç”¨åˆ†é¡µåŠ è½½</li><li>é¿å…åœ¨æ»šåŠ¨æ—¶è¿›è¡Œå¤æ‚è®¡ç®—</li><li>ä½¿ç”¨éª¨æ¶å±ä¼˜åŒ–ä½“éªŒ</li><li>å‡å°‘ä¸å¿…è¦çš„æ•°æ®ç»‘å®š</li></ol><h2 id="5-å°ç¨‹åºç›¸å…³é—®é¢˜"><a href="#5-å°ç¨‹åºç›¸å…³é—®é¢˜" class="headerlink" title="5. å°ç¨‹åºç›¸å…³é—®é¢˜"></a>5. å°ç¨‹åºç›¸å…³é—®é¢˜</h2><h3 id="5-1-åŒ…ä½“ç§¯è¶…é™"><a href="#5-1-åŒ…ä½“ç§¯è¶…é™" class="headerlink" title="5.1 åŒ…ä½“ç§¯è¶…é™"></a>5.1 åŒ…ä½“ç§¯è¶…é™</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>å°ç¨‹åºæ‰“åŒ…åæç¤ºè¶…å‡ºå¤§å°é™åˆ¶ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li>ä½¿ç”¨åˆ†åŒ…åŠ è½½</li><li>å‹ç¼©å›¾ç‰‡å’Œèµ„æºæ–‡ä»¶</li><li>åˆ é™¤æœªä½¿ç”¨çš„ç»„ä»¶å’Œæ–‡ä»¶</li><li>ä½¿ç”¨CDNåŠ è½½å¤§æ–‡ä»¶</li></ol><h3 id="5-2-å¾®ä¿¡æˆæƒé—®é¢˜"><a href="#5-2-å¾®ä¿¡æˆæƒé—®é¢˜" class="headerlink" title="5.2 å¾®ä¿¡æˆæƒé—®é¢˜"></a>5.2 å¾®ä¿¡æˆæƒé—®é¢˜</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>è·å–ç”¨æˆ·ä¿¡æ¯æ—¶æˆæƒå¼¹çª—æ˜¾ç¤ºä¸å‡ºæ¥ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li><p>ä½¿ç”¨buttonè§¦å‘æˆæƒï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">open-type</span>=<span class="string">&quot;getUserInfo&quot;</span> @<span class="attr">getuserinfo</span>=<span class="string">&quot;handleGetUserInfo&quot;</span>&gt;</span></span><br><span class="line">  è·å–ç”¨æˆ·ä¿¡æ¯</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>æ£€æŸ¥æ˜¯å¦å·²æˆæƒï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">getSetting</span>(&#123;</span><br><span class="line">  <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!res.<span class="property">authSetting</span>[<span class="string">&#x27;scope.userInfo&#x27;</span>]) &#123;</span><br><span class="line">      <span class="comment">// æœªæˆæƒï¼Œæ˜¾ç¤ºæˆæƒæŒ‰é’®</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ol><h2 id="6-å¼€å‘å·¥å…·é—®é¢˜"><a href="#6-å¼€å‘å·¥å…·é—®é¢˜" class="headerlink" title="6. å¼€å‘å·¥å…·é—®é¢˜"></a>6. å¼€å‘å·¥å…·é—®é¢˜</h2><h3 id="6-1-HBuilderXå¡é¡¿"><a href="#6-1-HBuilderXå¡é¡¿" class="headerlink" title="6.1 HBuilderXå¡é¡¿"></a>6.1 HBuilderXå¡é¡¿</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>HBuilderXè¿è¡Œç¼“æ…¢ï¼Œç»å¸¸å¡æ­»ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li>å…³é—­ä¸éœ€è¦çš„é¡¹ç›®</li><li>å®šæœŸæ¸…ç†ç¼“å­˜</li><li>æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬</li><li>å¢åŠ å†…å­˜åˆ†é…</li></ol><h3 id="6-2-çœŸæœºè°ƒè¯•é—®é¢˜"><a href="#6-2-çœŸæœºè°ƒè¯•é—®é¢˜" class="headerlink" title="6.2 çœŸæœºè°ƒè¯•é—®é¢˜"></a>6.2 çœŸæœºè°ƒè¯•é—®é¢˜</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>çœŸæœºè°ƒè¯•æ—¶è¿æ¥ä¸ä¸Šè®¾å¤‡ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li>æ£€æŸ¥USBè°ƒè¯•æ˜¯å¦å¼€å¯</li><li>æ›´æ–°æ‰‹æœºé©±åŠ¨</li><li>æ›´æ¢æ•°æ®çº¿</li><li>é‡å¯å¼€å‘å·¥å…·å’Œæ‰‹æœº</li></ol><h2 id="7-æ€»ç»“å»ºè®®"><a href="#7-æ€»ç»“å»ºè®®" class="headerlink" title="7. æ€»ç»“å»ºè®®"></a>7. æ€»ç»“å»ºè®®</h2><ol><li>å¤šçœ‹å®˜æ–¹æ–‡æ¡£å’Œæ›´æ–°æ—¥å¿—</li><li>ä¿æŒè‰¯å¥½çš„ä»£ç ä¹ æƒ¯</li><li>åšå¥½ç‰ˆæœ¬ç®¡ç†</li><li>å¸¸è§é—®é¢˜è®°å½•æ€»ç»“</li><li>å®šæœŸæ›´æ–°å¼€å‘å·¥å…·</li></ol><hr><blockquote><p>å¦‚æœè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©,æ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«,ä½ çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼ </p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/uni-app/">uni-app</category>
      
      
      <category domain="https://www.hzv5.cn/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/tags/uni-app/">uni-app</category>
      
      <category domain="https://www.hzv5.cn/tags/%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/">è¸©å‘è®°å½•</category>
      
      <category domain="https://www.hzv5.cn/tags/%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/">é—®é¢˜è§£å†³</category>
      
      
      <comments>https://www.hzv5.cn/2024/04/20/uniapp-common-issues/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>uni-appå®‰å…¨é˜²æŠ¤æŒ‡å—ï¼šæ„å»ºå¯é çš„è·¨ç«¯åº”ç”¨</title>
      <link>https://www.hzv5.cn/2024/04/15/uniapp-security/</link>
      <guid>https://www.hzv5.cn/2024/04/15/uniapp-security/</guid>
      <pubDate>Mon, 15 Apr 2024 03:35:00 GMT</pubDate>
      
      <description>æ·±å…¥æ¢è®¨uni-appåº”ç”¨çš„å®‰å…¨é˜²æŠ¤ç­–ç•¥,åŒ…æ‹¬æ•°æ®åŠ å¯†ã€é˜²æŠ¤ç­–ç•¥ã€å®‰å…¨é˜²èŒƒç­‰å†…å®¹,å¸®åŠ©å¼€å‘è€…æ„å»ºå®‰å…¨å¯é çš„è·¨ç«¯åº”ç”¨ã€‚</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>å®‰å…¨é˜²æŠ¤æ˜¯åº”ç”¨å¼€å‘ä¸­ä¸å¯å¿½è§†çš„ç¯èŠ‚,æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨uni-appä¸­å®ç°å…¨æ–¹ä½çš„å®‰å…¨é˜²æŠ¤,åŠ©ä½ æ‰“é€ å®‰å…¨å¯é çš„åº”ç”¨ã€‚</p></blockquote><span id="more"></span><h2 id="1-æ•°æ®åŠ å¯†"><a href="#1-æ•°æ®åŠ å¯†" class="headerlink" title="1. æ•°æ®åŠ å¯†"></a>1. æ•°æ®åŠ å¯†</h2><h3 id="1-1-åŠ å¯†å·¥å…·ç±»"><a href="#1-1-åŠ å¯†å·¥å…·ç±»" class="headerlink" title="1.1 åŠ å¯†å·¥å…·ç±»"></a>1.1 åŠ å¯†å·¥å…·ç±»</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/crypto.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">CryptoJS</span> <span class="keyword">from</span> <span class="string">&#x27;crypto-js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Crypto</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">key</span> = options.<span class="property">key</span> || <span class="string">&#x27;default_key&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">iv</span> = options.<span class="property">iv</span> || <span class="string">&#x27;default_iv&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// AESåŠ å¯†</span></span><br><span class="line">  <span class="title function_">encrypt</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> key = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">key</span>)</span><br><span class="line">    <span class="keyword">const</span> iv = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">iv</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> encrypted = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">encrypt</span>(</span><br><span class="line">      <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data),</span><br><span class="line">      key,</span><br><span class="line">      &#123;</span><br><span class="line">        iv,</span><br><span class="line">        <span class="attr">mode</span>: <span class="title class_">CryptoJS</span>.<span class="property">mode</span>.<span class="property">CBC</span>,</span><br><span class="line">        <span class="attr">padding</span>: <span class="title class_">CryptoJS</span>.<span class="property">pad</span>.<span class="property">Pkcs7</span></span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> encrypted.<span class="title function_">toString</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// AESè§£å¯†</span></span><br><span class="line">  <span class="title function_">decrypt</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> key = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">key</span>)</span><br><span class="line">    <span class="keyword">const</span> iv = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">iv</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> decrypted = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">decrypt</span>(</span><br><span class="line">      data,</span><br><span class="line">      key,</span><br><span class="line">      &#123;</span><br><span class="line">        iv,</span><br><span class="line">        <span class="attr">mode</span>: <span class="title class_">CryptoJS</span>.<span class="property">mode</span>.<span class="property">CBC</span>,</span><br><span class="line">        <span class="attr">padding</span>: <span class="title class_">CryptoJS</span>.<span class="property">pad</span>.<span class="property">Pkcs7</span></span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(decrypted.<span class="title function_">toString</span>(<span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// RSAåŠ å¯†</span></span><br><span class="line">  <span class="title function_">rsaEncrypt</span>(<span class="params">data, publicKey</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> jsencrypt = <span class="keyword">new</span> <span class="title class_">JSEncrypt</span>()</span><br><span class="line">    jsencrypt.<span class="title function_">setPublicKey</span>(publicKey)</span><br><span class="line">    <span class="keyword">return</span> jsencrypt.<span class="title function_">encrypt</span>(data)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// RSAè§£å¯†</span></span><br><span class="line">  <span class="title function_">rsaDecrypt</span>(<span class="params">data, privateKey</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> jsencrypt = <span class="keyword">new</span> <span class="title class_">JSEncrypt</span>()</span><br><span class="line">    jsencrypt.<span class="title function_">setPrivateKey</span>(privateKey)</span><br><span class="line">    <span class="keyword">return</span> jsencrypt.<span class="title function_">decrypt</span>(data)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// MD5åŠ å¯†</span></span><br><span class="line">  <span class="title function_">md5</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">CryptoJS</span>.<span class="title class_">MD5</span>(data).<span class="title function_">toString</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Base64ç¼–ç </span></span><br><span class="line">  <span class="title function_">base64Encode</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Base64</span>.<span class="title function_">stringify</span>(</span><br><span class="line">      <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(data)</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Base64è§£ç </span></span><br><span class="line">  <span class="title function_">base64Decode</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Base64</span>.<span class="title function_">parse</span>(data).<span class="title function_">toString</span>(</span><br><span class="line">      <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Crypto</span>(&#123;</span><br><span class="line">  <span class="attr">key</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_CRYPTO_KEY</span>,</span><br><span class="line">  <span class="attr">iv</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_CRYPTO_IV</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="1-2-æ•æ„Ÿæ•°æ®å­˜å‚¨"><a href="#1-2-æ•æ„Ÿæ•°æ®å­˜å‚¨" class="headerlink" title="1.2 æ•æ„Ÿæ•°æ®å­˜å‚¨"></a>1.2 æ•æ„Ÿæ•°æ®å­˜å‚¨</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/secure-storage.js</span></span><br><span class="line"><span class="keyword">import</span> crypto <span class="keyword">from</span> <span class="string">&#x27;./crypto&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SecureStorage</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">prefix</span> = options.<span class="property">prefix</span> || <span class="string">&#x27;secure_&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">expire</span> = options.<span class="property">expire</span> || <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åŠ å¯†å­˜å‚¨</span></span><br><span class="line">  <span class="title function_">set</span>(<span class="params">key, value, expire = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">      value,</span><br><span class="line">      <span class="attr">time</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">      <span class="attr">expire</span>: expire || <span class="variable language_">this</span>.<span class="property">expire</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> encrypted = crypto.<span class="title function_">encrypt</span>(data)</span><br><span class="line">    uni.<span class="title function_">setStorageSync</span>(</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">prefix</span> + key,</span><br><span class="line">      encrypted</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è§£å¯†è¯»å–</span></span><br><span class="line">  <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> encrypted = uni.<span class="title function_">getStorageSync</span>(<span class="variable language_">this</span>.<span class="property">prefix</span> + key)</span><br><span class="line">    <span class="keyword">if</span> (!encrypted) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; value, time, expire &#125; = crypto.<span class="title function_">decrypt</span>(encrypted)</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">      <span class="keyword">if</span> (expire &amp;&amp; <span class="title class_">Date</span>.<span class="title function_">now</span>() - time &gt; expire * <span class="number">1000</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">remove</span>(key)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç§»é™¤æ•°æ®</span></span><br><span class="line">  <span class="title function_">remove</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    uni.<span class="title function_">removeStorageSync</span>(<span class="variable language_">this</span>.<span class="property">prefix</span> + key)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ¸…ç©ºæ•°æ®</span></span><br><span class="line">  <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> keys = uni.<span class="title function_">getStorageInfoSync</span>().<span class="property">keys</span></span><br><span class="line">    keys.<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (key.<span class="title function_">startsWith</span>(<span class="variable language_">this</span>.<span class="property">prefix</span>)) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">remove</span>(key.<span class="title function_">slice</span>(<span class="variable language_">this</span>.<span class="property">prefix</span>.<span class="property">length</span>))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">SecureStorage</span>()</span><br></pre></td></tr></table></figure><h2 id="2-ç½‘ç»œå®‰å…¨"><a href="#2-ç½‘ç»œå®‰å…¨" class="headerlink" title="2. ç½‘ç»œå®‰å…¨"></a>2. ç½‘ç»œå®‰å…¨</h2><h3 id="2-1-è¯·æ±‚åŠ å¯†"><a href="#2-1-è¯·æ±‚åŠ å¯†" class="headerlink" title="2.1 è¯·æ±‚åŠ å¯†"></a>2.1 è¯·æ±‚åŠ å¯†</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/secure-request.js</span></span><br><span class="line"><span class="keyword">import</span> crypto <span class="keyword">from</span> <span class="string">&#x27;./crypto&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SecureRequest</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">publicKey</span> = <span class="string">&#x27;&#x27;</span> <span class="comment">// RSAå…¬é’¥</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// è·å–æœåŠ¡å™¨å…¬é’¥</span></span><br><span class="line">    <span class="keyword">const</span> &#123; publicKey &#125; = <span class="keyword">await</span> uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/api/public-key&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">publicKey</span> = publicKey</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åŠ å¯†è¯·æ±‚</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">request</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="comment">// ç”Ÿæˆéšæœºå¯†é’¥</span></span><br><span class="line">    <span class="keyword">const</span> randomKey = <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">slice</span>(-<span class="number">8</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨RSAåŠ å¯†éšæœºå¯†é’¥</span></span><br><span class="line">    <span class="keyword">const</span> encryptedKey = crypto.<span class="title function_">rsaEncrypt</span>(</span><br><span class="line">      randomKey,</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">publicKey</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨éšæœºå¯†é’¥åŠ å¯†æ•°æ®</span></span><br><span class="line">    <span class="keyword">const</span> encryptedData = crypto.<span class="title function_">encrypt</span>(</span><br><span class="line">      options.<span class="property">data</span>,</span><br><span class="line">      randomKey</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">return</span> uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">      ...options,</span><br><span class="line">      <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">key</span>: encryptedKey,</span><br><span class="line">        <span class="attr">data</span>: encryptedData</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">SecureRequest</span>()</span><br></pre></td></tr></table></figure><h3 id="2-2-é˜²é‡æ”¾æ”»å‡»"><a href="#2-2-é˜²é‡æ”¾æ”»å‡»" class="headerlink" title="2.2 é˜²é‡æ”¾æ”»å‡»"></a>2.2 é˜²é‡æ”¾æ”»å‡»</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/anti-replay.js</span></span><br><span class="line"><span class="keyword">import</span> crypto <span class="keyword">from</span> <span class="string">&#x27;./crypto&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AntiReplay</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cache</span> = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç”Ÿæˆè¯·æ±‚ç­¾å</span></span><br><span class="line">  <span class="title function_">sign</span>(<span class="params">params</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> timestamp = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    <span class="keyword">const</span> nonce = <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">slice</span>(-<span class="number">8</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">      ...params,</span><br><span class="line">      timestamp,</span><br><span class="line">      nonce</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æŒ‰é”®åæ’åº</span></span><br><span class="line">    <span class="keyword">const</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(data).<span class="title function_">sort</span>()</span><br><span class="line">    <span class="keyword">const</span> signStr = keys.<span class="title function_">map</span>(<span class="function"><span class="params">key</span> =&gt;</span> <span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;data[key]&#125;</span>`</span>).<span class="title function_">join</span>(<span class="string">&#x27;&amp;&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      ...data,</span><br><span class="line">      <span class="attr">sign</span>: crypto.<span class="title function_">md5</span>(signStr)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// éªŒè¯ç­¾å</span></span><br><span class="line">  <span class="title function_">verify</span>(<span class="params">params</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; timestamp, nonce, sign, ...rest &#125; = params</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ£€æŸ¥æ—¶é—´æˆ³æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Date</span>.<span class="title function_">now</span>() - timestamp &gt; <span class="number">5</span> * <span class="number">60</span> * <span class="number">1000</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ£€æŸ¥æ˜¯å¦é‡æ”¾</span></span><br><span class="line">    <span class="keyword">const</span> cacheKey = <span class="string">`<span class="subst">$&#123;timestamp&#125;</span>:<span class="subst">$&#123;nonce&#125;</span>`</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">has</span>(cacheKey)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éªŒè¯ç­¾å</span></span><br><span class="line">    <span class="keyword">const</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(rest).<span class="title function_">sort</span>()</span><br><span class="line">    <span class="keyword">const</span> signStr = keys.<span class="title function_">map</span>(<span class="function"><span class="params">key</span> =&gt;</span> <span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;rest[key]&#125;</span>`</span>).<span class="title function_">join</span>(<span class="string">&#x27;&amp;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (crypto.<span class="title function_">md5</span>(signStr) !== sign) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¼“å­˜è¯·æ±‚æ ‡è¯†</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">set</span>(cacheKey, <span class="literal">true</span>)</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">delete</span>(cacheKey)</span><br><span class="line">    &#125;, <span class="number">5</span> * <span class="number">60</span> * <span class="number">1000</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">AntiReplay</span>()</span><br></pre></td></tr></table></figure><h2 id="3-ä»£ç ä¿æŠ¤"><a href="#3-ä»£ç ä¿æŠ¤" class="headerlink" title="3. ä»£ç ä¿æŠ¤"></a>3. ä»£ç ä¿æŠ¤</h2><h3 id="3-1-ä»£ç æ··æ·†"><a href="#3-1-ä»£ç æ··æ·†" class="headerlink" title="3.1 ä»£ç æ··æ·†"></a>3.1 ä»£ç æ··æ·†</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue.config.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;terser-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">configureWebpack</span>: &#123;</span><br><span class="line">    <span class="attr">optimization</span>: &#123;</span><br><span class="line">      <span class="attr">minimizer</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">          <span class="attr">terserOptions</span>: &#123;</span><br><span class="line">            <span class="attr">compress</span>: &#123;</span><br><span class="line">              <span class="attr">drop_console</span>: <span class="literal">true</span>, <span class="comment">// ç§»é™¤console</span></span><br><span class="line">              <span class="attr">pure_funcs</span>: [<span class="string">&#x27;console.log&#x27;</span>] <span class="comment">// ç§»é™¤æŒ‡å®šå‡½æ•°</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">mangle</span>: &#123;</span><br><span class="line">              <span class="attr">safari10</span>: <span class="literal">true</span> <span class="comment">// å…¼å®¹safari10</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">output</span>: &#123;</span><br><span class="line">              <span class="attr">ascii_only</span>: <span class="literal">true</span>, <span class="comment">// è¾“å‡ºASCIIå­—ç¬¦</span></span><br><span class="line">              <span class="attr">comments</span>: <span class="literal">false</span> <span class="comment">// ç§»é™¤æ³¨é‡Š</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-æºç åŠ å¯†"><a href="#3-2-æºç åŠ å¯†" class="headerlink" title="3.2 æºç åŠ å¯†"></a>3.2 æºç åŠ å¯†</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/code-protection.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CodeProtection</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isDebug</span> = <span class="literal">false</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">init</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">  <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// æ£€æµ‹è°ƒè¯•æ¨¡å¼</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">checkDebugger</span>()</span><br><span class="line">    <span class="comment">// ç¦ç”¨æ§åˆ¶å°</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">disableConsole</span>()</span><br><span class="line">    <span class="comment">// ç¦ç”¨å³é”®èœå•</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">disableContextMenu</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ£€æµ‹è°ƒè¯•æ¨¡å¼</span></span><br><span class="line">  <span class="title function_">checkDebugger</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> startTime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">      <span class="keyword">debugger</span></span><br><span class="line">      <span class="keyword">const</span> endTime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (endTime - startTime &gt; <span class="number">100</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isDebug</span> = <span class="literal">true</span></span><br><span class="line">        <span class="comment">// æ£€æµ‹åˆ°è°ƒè¯•è¡Œä¸º</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">handleDebug</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç¦ç”¨æ§åˆ¶å°</span></span><br><span class="line">  <span class="title function_">disableConsole</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// #ifdef H5</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">noop</span> = (<span class="params"></span>) =&gt; &#123;&#125;</span><br><span class="line">      <span class="keyword">const</span> methods = [</span><br><span class="line">        <span class="string">&#x27;log&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;debug&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;warn&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;assert&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;dir&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;dirxml&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;trace&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;group&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;groupEnd&#x27;</span></span><br><span class="line">      ]</span><br><span class="line">      </span><br><span class="line">      methods.<span class="title function_">forEach</span>(<span class="function"><span class="params">method</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>[method] = noop</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç¦ç”¨å³é”®èœå•</span></span><br><span class="line">  <span class="title function_">disableContextMenu</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// #ifdef H5</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">oncontextmenu</span> = <span class="function">() =&gt;</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å¤„ç†è°ƒè¯•è¡Œä¸º</span></span><br><span class="line">  <span class="title function_">handleDebug</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isDebug</span>) &#123;</span><br><span class="line">      <span class="comment">// é€€å‡ºåº”ç”¨</span></span><br><span class="line">      <span class="comment">// #ifdef APP-PLUS</span></span><br><span class="line">      plus.<span class="property">runtime</span>.<span class="title function_">quit</span>()</span><br><span class="line">      <span class="comment">// #endif</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// è¿”å›é¦–é¡µ</span></span><br><span class="line">      <span class="comment">// #ifdef H5 || MP</span></span><br><span class="line">      uni.<span class="title function_">reLaunch</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/pages/index/index&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// #endif</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">CodeProtection</span>()</span><br></pre></td></tr></table></figure><h2 id="4-æ•°æ®é˜²æŠ¤"><a href="#4-æ•°æ®é˜²æŠ¤" class="headerlink" title="4. æ•°æ®é˜²æŠ¤"></a>4. æ•°æ®é˜²æŠ¤</h2><h3 id="4-1-é˜²æ­¢SQLæ³¨å…¥"><a href="#4-1-é˜²æ­¢SQLæ³¨å…¥" class="headerlink" title="4.1 é˜²æ­¢SQLæ³¨å…¥"></a>4.1 é˜²æ­¢SQLæ³¨å…¥</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/sql-escape.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SqlEscape</span> &#123;</span><br><span class="line">  <span class="comment">// è½¬ä¹‰SQLç‰¹æ®Šå­—ç¬¦</span></span><br><span class="line">  <span class="title function_">escape</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> str !== <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> str</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">replace</span>(<span class="regexp">/[\0\n\r\b\t\\&#x27;&quot;\x1a]/g</span>, <span class="function"><span class="params">s</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">switch</span> (s) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;\0&#x27;</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&#x27;\\0&#x27;</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;\n&#x27;</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&#x27;\\n&#x27;</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;\r&#x27;</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&#x27;\\r&#x27;</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;\b&#x27;</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&#x27;\\b&#x27;</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;\t&#x27;</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&#x27;\\t&#x27;</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;\x1a&#x27;</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&#x27;\\Z&#x27;</span></span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&#x27;\\&#x27;</span> + s</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// éªŒè¯SQLæ³¨å…¥</span></span><br><span class="line">  <span class="title function_">validate</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> pattern = <span class="regexp">/select|update|delete|exec|count|&#x27;|&quot;|=|;|&gt;|&lt;|%/i</span></span><br><span class="line">    <span class="keyword">return</span> !pattern.<span class="title function_">test</span>(str)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">SqlEscape</span>()</span><br></pre></td></tr></table></figure><h3 id="4-2-é˜²æ­¢XSSæ”»å‡»"><a href="#4-2-é˜²æ­¢XSSæ”»å‡»" class="headerlink" title="4.2 é˜²æ­¢XSSæ”»å‡»"></a>4.2 é˜²æ­¢XSSæ”»å‡»</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/xss-filter.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">XssFilter</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rules</span> = &#123;</span><br><span class="line">      <span class="attr">whiteList</span>: &#123;</span><br><span class="line">        <span class="attr">a</span>: [<span class="string">&#x27;href&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;target&#x27;</span>],</span><br><span class="line">        <span class="attr">img</span>: [<span class="string">&#x27;src&#x27;</span>, <span class="string">&#x27;alt&#x27;</span>],</span><br><span class="line">        <span class="attr">p</span>: [],</span><br><span class="line">        <span class="attr">div</span>: [],</span><br><span class="line">        <span class="attr">span</span>: [],</span><br><span class="line">        <span class="attr">br</span>: [],</span><br><span class="line">        <span class="attr">strong</span>: [],</span><br><span class="line">        <span class="attr">em</span>: []</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">stripIgnoreTag</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">stripIgnoreTagBody</span>: [<span class="string">&#x27;script&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è¿‡æ»¤HTML</span></span><br><span class="line">  <span class="title function_">filter</span>(<span class="params">html</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> html !== <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> html</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> html.<span class="title function_">replace</span>(<span class="regexp">/&lt;\/?[^&gt;]*&gt;/g</span>, <span class="string">&#x27;&#x27;</span>).<span class="title function_">replace</span>(<span class="regexp">/&amp;[^;]+;/g</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è½¬ä¹‰HTML</span></span><br><span class="line">  <span class="title function_">escape</span>(<span class="params">html</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> html.<span class="title function_">replace</span>(<span class="regexp">/[&amp;&lt;&gt;&quot;&#x27;]/g</span>, <span class="function"><span class="params">match</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="built_in">escape</span> = &#123;</span><br><span class="line">        <span class="string">&#x27;&amp;&#x27;</span>: <span class="string">&#x27;&amp;amp;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;&lt;&#x27;</span>: <span class="string">&#x27;&amp;lt;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;&gt;&#x27;</span>: <span class="string">&#x27;&amp;gt;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;&quot;&#x27;</span>: <span class="string">&#x27;&amp;quot;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;&#x27;&quot;</span>: <span class="string">&#x27;&amp;#39;&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">escape</span>[match]</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// éªŒè¯XSS</span></span><br><span class="line">  <span class="title function_">validate</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> pattern = <span class="regexp">/&lt;script|javascript:|on\w+\s*=|style\s*=|href\s*=|alert\s*\(|confirm\s*\(|prompt\s*\(/i</span></span><br><span class="line">    <span class="keyword">return</span> !pattern.<span class="title function_">test</span>(str)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">XssFilter</span>()</span><br></pre></td></tr></table></figure><h2 id="5-æœ€ä½³å®è·µå»ºè®®"><a href="#5-æœ€ä½³å®è·µå»ºè®®" class="headerlink" title="5. æœ€ä½³å®è·µå»ºè®®"></a>5. æœ€ä½³å®è·µå»ºè®®</h2><ol><li>ä½¿ç”¨HTTPSé€šä¿¡</li><li>å®ç°è¯·æ±‚ç­¾å</li><li>åŠ å¯†æ•æ„Ÿæ•°æ®</li><li>é˜²æ­¢ä»£ç æ³„éœ²</li><li>åšå¥½æ•°æ®æ ¡éªŒ</li><li>å®šæœŸå®‰å…¨å®¡è®¡</li><li>åŠæ—¶æ›´æ–°ä¾èµ–</li><li>è®°å½•å®‰å…¨æ—¥å¿—</li></ol><h2 id="6-å®‰å…¨ç›‘æ§"><a href="#6-å®‰å…¨ç›‘æ§" class="headerlink" title="6. å®‰å…¨ç›‘æ§"></a>6. å®‰å…¨ç›‘æ§</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/security-monitor.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SecurityMonitor</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">logs</span> = []</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">maxLogs</span> = <span class="number">1000</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è®°å½•å®‰å…¨æ—¥å¿—</span></span><br><span class="line">  <span class="title function_">log</span>(<span class="params">type, data</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> log = &#123;</span><br><span class="line">      type,</span><br><span class="line">      data,</span><br><span class="line">      <span class="attr">time</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">      <span class="attr">page</span>: <span class="variable language_">this</span>.<span class="title function_">getCurrentPage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">logs</span>.<span class="title function_">push</span>(log)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¶…å‡ºé™åˆ¶æ¸…ç†æ—§æ—¥å¿—</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">logs</span>.<span class="property">length</span> &gt; <span class="variable language_">this</span>.<span class="property">maxLogs</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">logs</span> = <span class="variable language_">this</span>.<span class="property">logs</span>.<span class="title function_">slice</span>(-<span class="variable language_">this</span>.<span class="property">maxLogs</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¸ŠæŠ¥æ—¥å¿—</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">report</span>(log)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è·å–å½“å‰é¡µé¢</span></span><br><span class="line">  <span class="title function_">getCurrentPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> pages = <span class="title function_">getCurrentPages</span>()</span><br><span class="line">    <span class="keyword">const</span> page = pages[pages.<span class="property">length</span> - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> page ? page.<span class="property">route</span> : <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ä¸ŠæŠ¥æ—¥å¿—</span></span><br><span class="line">  <span class="title function_">report</span>(<span class="params">log</span>) &#123;</span><br><span class="line">    uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/api/security/log&#x27;</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: log</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è·å–æ—¥å¿—</span></span><br><span class="line">  <span class="title function_">getLogs</span>(<span class="params">type</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (type) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">logs</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">log</span> =&gt;</span> log.<span class="property">type</span> === type)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">logs</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ¸…ç†æ—¥å¿—</span></span><br><span class="line">  <span class="title function_">clearLogs</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">logs</span> = []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">SecurityMonitor</span>()</span><br></pre></td></tr></table></figure><h2 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7. æ€»ç»“"></a>7. æ€»ç»“</h2><ol><li>å®ç°æ•°æ®åŠ å¯†</li><li>ä¿æŠ¤ç½‘ç»œå®‰å…¨</li><li>é˜²æŠ¤ä»£ç æ³„éœ²</li><li>è¿‡æ»¤å±é™©æ•°æ®</li><li>ç›‘æ§å®‰å…¨é£é™©</li></ol><hr><blockquote><p>å¦‚æœè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©,æ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«,ä½ çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼ </p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/uni-app/">uni-app</category>
      
      
      <category domain="https://www.hzv5.cn/tags/uni-app/">uni-app</category>
      
      <category domain="https://www.hzv5.cn/tags/%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4/">å®‰å…¨é˜²æŠ¤</category>
      
      <category domain="https://www.hzv5.cn/tags/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8/">å‰ç«¯å®‰å…¨</category>
      
      <category domain="https://www.hzv5.cn/tags/%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86/">æ•°æ®åŠ å¯†</category>
      
      
      <comments>https://www.hzv5.cn/2024/04/15/uniapp-security/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>uni-appæ€§èƒ½ä¼˜åŒ–æŒ‡å—ï¼šä»åŠ è½½åˆ°æ¸²æŸ“çš„å…¨æ–¹ä½æå‡</title>
      <link>https://www.hzv5.cn/2024/04/10/uniapp-optimization/</link>
      <guid>https://www.hzv5.cn/2024/04/10/uniapp-optimization/</guid>
      <pubDate>Wed, 10 Apr 2024 06:25:00 GMT</pubDate>
      
      <description>æ·±å…¥æ¢è®¨uni-appåº”ç”¨çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥,åŒ…æ‹¬é¦–å±åŠ è½½ä¼˜åŒ–ã€æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–ã€å†…å­˜ç®¡ç†ã€ç½‘ç»œä¼˜åŒ–ç­‰å¤šä¸ªç»´åº¦,åŠ©ä½ æ‰“é€ é«˜æ€§èƒ½çš„è·¨ç«¯åº”ç”¨ã€‚</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>æ€§èƒ½ä¼˜åŒ–æ˜¯æå‡ç”¨æˆ·ä½“éªŒçš„å…³é”®å› ç´ ,æœ¬æ–‡å°†ä»å¤šä¸ªç»´åº¦è¯¦ç»†ä»‹ç»uni-appåº”ç”¨çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥,å¸®åŠ©ä½ æ„å»ºæµç•…çš„è·¨ç«¯åº”ç”¨ã€‚</p></blockquote><span id="more"></span><h2 id="1-é¦–å±åŠ è½½ä¼˜åŒ–"><a href="#1-é¦–å±åŠ è½½ä¼˜åŒ–" class="headerlink" title="1. é¦–å±åŠ è½½ä¼˜åŒ–"></a>1. é¦–å±åŠ è½½ä¼˜åŒ–</h2><h3 id="1-1-åˆ†åŒ…åŠ è½½"><a href="#1-1-åˆ†åŒ…åŠ è½½" class="headerlink" title="1.1 åˆ†åŒ…åŠ è½½"></a>1.1 åˆ†åŒ…åŠ è½½</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;pages&quot;</span>: [&#123;</span><br><span class="line">    <span class="string">&quot;path&quot;</span>: <span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line">    <span class="string">&quot;style&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;é¦–é¡µ&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;],</span><br><span class="line">  <span class="string">&quot;subPackages&quot;</span>: [&#123;</span><br><span class="line">    <span class="string">&quot;root&quot;</span>: <span class="string">&quot;pagesA&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pages&quot;</span>: [&#123;</span><br><span class="line">      <span class="string">&quot;path&quot;</span>: <span class="string">&quot;list/index&quot;</span>,</span><br><span class="line">      <span class="string">&quot;style&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;åˆ—è¡¨é¡µ&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¢„åŠ è½½åˆ†åŒ…</span></span><br><span class="line"><span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// è¿›å…¥é¦–é¡µæ—¶é¢„åŠ è½½åˆ†åŒ…</span></span><br><span class="line">  uni.<span class="title function_">preloadSubPackage</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;pagesA&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;åˆ†åŒ…é¢„åŠ è½½æˆåŠŸ&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">fail</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;åˆ†åŒ…é¢„åŠ è½½å¤±è´¥&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-å›¾ç‰‡ä¼˜åŒ–"><a href="#1-2-å›¾ç‰‡ä¼˜åŒ–" class="headerlink" title="1.2 å›¾ç‰‡ä¼˜åŒ–"></a>1.2 å›¾ç‰‡ä¼˜åŒ–</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;!-- ä½¿ç”¨æ‡’åŠ è½½ --&gt;</span><br><span class="line">    &lt;image </span><br><span class="line">      v-for=&quot;(item, index) in images&quot; </span><br><span class="line">      :key=&quot;index&quot;</span><br><span class="line">      :src=&quot;item.url&quot;</span><br><span class="line">      :lazy-load=&quot;true&quot;</span><br><span class="line">      mode=&quot;aspectFill&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- ä½¿ç”¨webpæ ¼å¼ --&gt;</span><br><span class="line">    &lt;image </span><br><span class="line">      :src=&quot;getWebpUrl(image.url)&quot;</span><br><span class="line">      mode=&quot;aspectFill&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // åˆ¤æ–­æ˜¯å¦æ”¯æŒwebp</span><br><span class="line">    checkWebp() &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        return document.createElement(&#x27;canvas&#x27;)</span><br><span class="line">          .toDataURL(&#x27;image/webp&#x27;)</span><br><span class="line">          .indexOf(&#x27;data:image/webp&#x27;) === 0</span><br><span class="line">      &#125; catch (e) &#123;</span><br><span class="line">        return false</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    // è·å–webpå›¾ç‰‡åœ°å€</span><br><span class="line">    getWebpUrl(url) &#123;</span><br><span class="line">      if (this.checkWebp()) &#123;</span><br><span class="line">        return url.replace(/\.(jpg|png)$/, &#x27;.webp&#x27;)</span><br><span class="line">      &#125;</span><br><span class="line">      return url</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="1-3-éª¨æ¶å±"><a href="#1-3-éª¨æ¶å±" class="headerlink" title="1.3 éª¨æ¶å±"></a>1.3 éª¨æ¶å±</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- components/skeleton.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;skeleton&quot; v-if=&quot;loading&quot;&gt;</span><br><span class="line">    &lt;view class=&quot;skeleton-header&quot;&gt;</span><br><span class="line">      &lt;view class=&quot;skeleton-avatar&quot;&gt;&lt;/view&gt;</span><br><span class="line">      &lt;view class=&quot;skeleton-content&quot;&gt;</span><br><span class="line">        &lt;view class=&quot;skeleton-title&quot;&gt;&lt;/view&gt;</span><br><span class="line">        &lt;view class=&quot;skeleton-desc&quot;&gt;&lt;/view&gt;</span><br><span class="line">      &lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">    &lt;view class=&quot;skeleton-list&quot;&gt;</span><br><span class="line">      &lt;view </span><br><span class="line">        class=&quot;skeleton-item&quot;</span><br><span class="line">        v-for=&quot;i in 5&quot;</span><br><span class="line">        :key=&quot;i&quot;</span><br><span class="line">      &gt;&lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">.skeleton &#123;</span><br><span class="line">  padding: 20rpx;</span><br><span class="line">  </span><br><span class="line">  &amp;-header &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    margin-bottom: 30rpx;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;-avatar &#123;</span><br><span class="line">    width: 100rpx;</span><br><span class="line">    height: 100rpx;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    background: #f0f0f0;</span><br><span class="line">    margin-right: 20rpx;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;-content &#123;</span><br><span class="line">    flex: 1;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;-title &#123;</span><br><span class="line">    width: 60%;</span><br><span class="line">    height: 40rpx;</span><br><span class="line">    background: #f0f0f0;</span><br><span class="line">    margin-bottom: 20rpx;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;-desc &#123;</span><br><span class="line">    width: 80%;</span><br><span class="line">    height: 32rpx;</span><br><span class="line">    background: #f0f0f0;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;-item &#123;</span><br><span class="line">    height: 160rpx;</span><br><span class="line">    background: #f0f0f0;</span><br><span class="line">    margin-bottom: 20rpx;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;-avatar,</span><br><span class="line">  &amp;-title,</span><br><span class="line">  &amp;-desc,</span><br><span class="line">  &amp;-item &#123;</span><br><span class="line">    animation: skeleton-loading 1.4s ease infinite;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@keyframes skeleton-loading &#123;</span><br><span class="line">  0% &#123;</span><br><span class="line">    opacity: 1;</span><br><span class="line">  &#125;</span><br><span class="line">  50% &#123;</span><br><span class="line">    opacity: 0.5;</span><br><span class="line">  &#125;</span><br><span class="line">  100% &#123;</span><br><span class="line">    opacity: 1;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="2-æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–"><a href="#2-æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="2. æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–"></a>2. æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–</h2><h3 id="2-1-é•¿åˆ—è¡¨ä¼˜åŒ–"><a href="#2-1-é•¿åˆ—è¡¨ä¼˜åŒ–" class="headerlink" title="2.1 é•¿åˆ—è¡¨ä¼˜åŒ–"></a>2.1 é•¿åˆ—è¡¨ä¼˜åŒ–</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;list-container&quot;&gt;</span><br><span class="line">    &lt;!-- è™šæ‹Ÿåˆ—è¡¨ --&gt;</span><br><span class="line">    &lt;recycle-list</span><br><span class="line">      :list=&quot;list&quot;</span><br><span class="line">      :height=&quot;listHeight&quot;</span><br><span class="line">      :item-height=&quot;itemHeight&quot;</span><br><span class="line">      :buffer-scale=&quot;1&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;template v-slot=&quot;&#123; item &#125;&quot;&gt;</span><br><span class="line">        &lt;view class=&quot;list-item&quot;&gt;</span><br><span class="line">          &#123;&#123; item.title &#125;&#125;</span><br><span class="line">        &lt;/view&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/recycle-list&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import RecycleList from &#x27;@/components/recycle-list&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    RecycleList</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      list: [],</span><br><span class="line">      listHeight: 600,</span><br><span class="line">      itemHeight: 100</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // åˆ†é¡µåŠ è½½æ•°æ®</span><br><span class="line">    async loadData(page = 1) &#123;</span><br><span class="line">      const &#123; list &#125; = await this.$api.getList(&#123; page &#125;)</span><br><span class="line">      this.list = [...this.list, ...list]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="2-2-é¿å…é¢‘ç¹æ›´æ–°"><a href="#2-2-é¿å…é¢‘ç¹æ›´æ–°" class="headerlink" title="2.2 é¿å…é¢‘ç¹æ›´æ–°"></a>2.2 é¿å…é¢‘ç¹æ›´æ–°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      timer: null,</span><br><span class="line">      count: 0</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // ä½¿ç”¨èŠ‚æµ</span><br><span class="line">    throttleUpdate() &#123;</span><br><span class="line">      if (this.timer) return</span><br><span class="line">      this.timer = setTimeout(() =&gt; &#123;</span><br><span class="line">        this.count++</span><br><span class="line">        this.timer = null</span><br><span class="line">      &#125;, 16)</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    // ä½¿ç”¨requestAnimationFrame</span><br><span class="line">    rafUpdate() &#123;</span><br><span class="line">      requestAnimationFrame(() =&gt; &#123;</span><br><span class="line">        this.count++</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  beforeDestroy() &#123;</span><br><span class="line">    // æ¸…ç†å®šæ—¶å™¨</span><br><span class="line">    if (this.timer) &#123;</span><br><span class="line">      clearTimeout(this.timer)</span><br><span class="line">      this.timer = null</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="3-å†…å­˜ä¼˜åŒ–"><a href="#3-å†…å­˜ä¼˜åŒ–" class="headerlink" title="3. å†…å­˜ä¼˜åŒ–"></a>3. å†…å­˜ä¼˜åŒ–</h2><h3 id="3-1-åŠæ—¶æ¸…ç†èµ„æº"><a href="#3-1-åŠæ—¶æ¸…ç†èµ„æº" class="headerlink" title="3.1 åŠæ—¶æ¸…ç†èµ„æº"></a>3.1 åŠæ—¶æ¸…ç†èµ„æº</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">observer</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">listeners</span>: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">initObserver</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">observer</span> = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(<span class="function"><span class="params">entries</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†é€»è¾‘</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">addListener</span>(<span class="params">element, event, handler</span>) &#123;</span><br><span class="line">      element.<span class="title function_">addEventListener</span>(event, handler)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">push</span>(&#123; element, event, handler &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeDestroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// æ¸…ç†è§‚å¯Ÿè€…</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">observer</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">observer</span>.<span class="title function_">disconnect</span>()</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">observer</span> = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç§»é™¤äº‹ä»¶ç›‘å¬</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">&#123; element, event, handler &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      element.<span class="title function_">removeEventListener</span>(event, handler)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">listeners</span> = []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-ç¼“å­˜ç®¡ç†"><a href="#3-2-ç¼“å­˜ç®¡ç†" class="headerlink" title="3.2 ç¼“å­˜ç®¡ç†"></a>3.2 ç¼“å­˜ç®¡ç†</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/cache.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cache</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">storage</span> = options.<span class="property">storage</span> || uni.<span class="property">getStorageSync</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">prefix</span> = options.<span class="property">prefix</span> || <span class="string">&#x27;cache_&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">expire</span> = options.<span class="property">expire</span> || <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è®¾ç½®ç¼“å­˜</span></span><br><span class="line">  <span class="title function_">set</span>(<span class="params">key, value, expire = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">      value,</span><br><span class="line">      <span class="attr">expire</span>: expire ? <span class="title class_">Date</span>.<span class="title function_">now</span>() + expire * <span class="number">1000</span> : <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">storage</span>(<span class="variable language_">this</span>.<span class="property">prefix</span> + key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è·å–ç¼“å­˜</span></span><br><span class="line">  <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="variable language_">this</span>.<span class="title function_">storage</span>(<span class="variable language_">this</span>.<span class="property">prefix</span> + key)</span><br><span class="line">    <span class="keyword">if</span> (!data) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; value, expire &#125; = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data)</span><br><span class="line">      <span class="comment">// åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">      <span class="keyword">if</span> (expire &amp;&amp; expire &lt; <span class="title class_">Date</span>.<span class="title function_">now</span>()) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">remove</span>(key)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç§»é™¤ç¼“å­˜</span></span><br><span class="line">  <span class="title function_">remove</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">storage</span>(<span class="variable language_">this</span>.<span class="property">prefix</span> + key, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ¸…ç©ºç¼“å­˜</span></span><br><span class="line">  <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> keys = uni.<span class="title function_">getStorageInfoSync</span>().<span class="property">keys</span></span><br><span class="line">    keys.<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (key.<span class="title function_">startsWith</span>(<span class="variable language_">this</span>.<span class="property">prefix</span>)) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">remove</span>(key.<span class="title function_">slice</span>(<span class="variable language_">this</span>.<span class="property">prefix</span>.<span class="property">length</span>))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Cache</span>()</span><br></pre></td></tr></table></figure><h2 id="4-ç½‘ç»œä¼˜åŒ–"><a href="#4-ç½‘ç»œä¼˜åŒ–" class="headerlink" title="4. ç½‘ç»œä¼˜åŒ–"></a>4. ç½‘ç»œä¼˜åŒ–</h2><h3 id="4-1-è¯·æ±‚ä¼˜åŒ–"><a href="#4-1-è¯·æ±‚ä¼˜åŒ–" class="headerlink" title="4.1 è¯·æ±‚ä¼˜åŒ–"></a>4.1 è¯·æ±‚ä¼˜åŒ–</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/request.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Request</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">queue</span> = <span class="keyword">new</span> <span class="title class_">Map</span>() <span class="comment">// è¯·æ±‚é˜Ÿåˆ—</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cache</span> = <span class="keyword">new</span> <span class="title class_">Map</span>() <span class="comment">// è¯·æ±‚ç¼“å­˜</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å‘é€è¯·æ±‚</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">request</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> key = <span class="variable language_">this</span>.<span class="title function_">getRequestKey</span>(options)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦æœ‰ç›¸åŒè¯·æ±‚åœ¨é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">has</span>(key)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">get</span>(key)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦æœ‰ç¼“å­˜</span></span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">useCache</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> cached = <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">get</span>(key)</span><br><span class="line">      <span class="keyword">if</span> (cached &amp;&amp; cached.<span class="property">expire</span> &gt; <span class="title class_">Date</span>.<span class="title function_">now</span>()) &#123;</span><br><span class="line">        <span class="keyword">return</span> cached.<span class="property">data</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">        ...options,</span><br><span class="line">        <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// ç¼“å­˜å“åº”</span></span><br><span class="line">          <span class="keyword">if</span> (options.<span class="property">useCache</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">set</span>(key, &#123;</span><br><span class="line">              <span class="attr">data</span>: res.<span class="property">data</span>,</span><br><span class="line">              <span class="attr">expire</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>() + (options.<span class="property">cacheTime</span> || <span class="number">60000</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="title function_">resolve</span>(res.<span class="property">data</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">fail</span>: reject,</span><br><span class="line">        <span class="attr">complete</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// è¯·æ±‚å®Œæˆåä»é˜Ÿåˆ—ç§»é™¤</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">delete</span>(key)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ·»åŠ åˆ°é˜Ÿåˆ—</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">set</span>(key, promise)</span><br><span class="line">    <span class="keyword">return</span> promise</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç”Ÿæˆè¯·æ±‚çš„å”¯ä¸€æ ‡è¯†</span></span><br><span class="line">  <span class="title function_">getRequestKey</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;options.url&#125;</span>:<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(options.data)&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Request</span>()</span><br></pre></td></tr></table></figure><h3 id="4-2-ç¦»çº¿ç¼“å­˜"><a href="#4-2-ç¦»çº¿ç¼“å­˜" class="headerlink" title="4.2 ç¦»çº¿ç¼“å­˜"></a>4.2 ç¦»çº¿ç¼“å­˜</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/offline.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OfflineStorage</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">version</span> = <span class="string">&#x27;1.0.0&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">table</span> = <span class="string">&#x27;offline_data&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–æ•°æ®åº“</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      plus.<span class="property">sqlite</span>.<span class="title function_">openDatabase</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;app.db&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;_doc/app.db&#x27;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">createTable</span>()</span><br><span class="line">          <span class="title function_">resolve</span>()</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">fail</span>: reject</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆ›å»ºè¡¨</span></span><br><span class="line">  <span class="title function_">createTable</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> sql = <span class="string">`</span></span><br><span class="line"><span class="string">      CREATE TABLE IF NOT EXISTS <span class="subst">$&#123;<span class="variable language_">this</span>.table&#125;</span> (</span></span><br><span class="line"><span class="string">        id TEXT PRIMARY KEY,</span></span><br><span class="line"><span class="string">        data TEXT,</span></span><br><span class="line"><span class="string">        expire INTEGER,</span></span><br><span class="line"><span class="string">        version TEXT</span></span><br><span class="line"><span class="string">      )</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">    plus.<span class="property">sqlite</span>.<span class="title function_">executeSql</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;app.db&#x27;</span>,</span><br><span class="line">      sql</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ä¿å­˜æ•°æ®</span></span><br><span class="line">  <span class="title function_">save</span>(<span class="params">key, data, expire = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> sql = <span class="string">`</span></span><br><span class="line"><span class="string">      REPLACE INTO <span class="subst">$&#123;<span class="variable language_">this</span>.table&#125;</span> (id, data, expire, version)</span></span><br><span class="line"><span class="string">      VALUES (?, ?, ?, ?)</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">    <span class="keyword">const</span> values = [</span><br><span class="line">      key,</span><br><span class="line">      <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data),</span><br><span class="line">      expire ? <span class="title class_">Date</span>.<span class="title function_">now</span>() + expire * <span class="number">1000</span> : <span class="number">0</span>,</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">version</span></span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    plus.<span class="property">sqlite</span>.<span class="title function_">executeSql</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;app.db&#x27;</span>,</span><br><span class="line">      sql,</span><br><span class="line">      values</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è·å–æ•°æ®</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> sql = <span class="string">`</span></span><br><span class="line"><span class="string">        SELECT * FROM <span class="subst">$&#123;<span class="variable language_">this</span>.table&#125;</span></span></span><br><span class="line"><span class="string">        WHERE id = ? AND version = ?</span></span><br><span class="line"><span class="string">      `</span></span><br><span class="line">      plus.<span class="property">sqlite</span>.<span class="title function_">selectSql</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;app.db&#x27;</span>,</span><br><span class="line">        sql,</span><br><span class="line">        <span class="attr">values</span>: [key, <span class="variable language_">this</span>.<span class="property">version</span>],</span><br><span class="line">        <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (!res.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">          &#125;</span><br><span class="line">          </span><br><span class="line">          <span class="keyword">const</span> &#123; data, expire &#125; = res[<span class="number">0</span>]</span><br><span class="line">          <span class="comment">// åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">          <span class="keyword">if</span> (expire &amp;&amp; expire &lt; <span class="title class_">Date</span>.<span class="title function_">now</span>()) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">remove</span>(key)</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">          &#125;</span><br><span class="line">          </span><br><span class="line">          <span class="title function_">resolve</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(data))</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">fail</span>: reject</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç§»é™¤æ•°æ®</span></span><br><span class="line">  <span class="title function_">remove</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> sql = <span class="string">`</span></span><br><span class="line"><span class="string">      DELETE FROM <span class="subst">$&#123;<span class="variable language_">this</span>.table&#125;</span></span></span><br><span class="line"><span class="string">      WHERE id = ?</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">    plus.<span class="property">sqlite</span>.<span class="title function_">executeSql</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;app.db&#x27;</span>,</span><br><span class="line">      sql,</span><br><span class="line">      <span class="attr">values</span>: [key]</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ¸…ç©ºæ•°æ®</span></span><br><span class="line">  <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> sql = <span class="string">`</span></span><br><span class="line"><span class="string">      DELETE FROM <span class="subst">$&#123;<span class="variable language_">this</span>.table&#125;</span></span></span><br><span class="line"><span class="string">      WHERE version = ?</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">    plus.<span class="property">sqlite</span>.<span class="title function_">executeSql</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;app.db&#x27;</span>,</span><br><span class="line">      sql,</span><br><span class="line">      <span class="attr">values</span>: [<span class="variable language_">this</span>.<span class="property">version</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">OfflineStorage</span>()</span><br></pre></td></tr></table></figure><h2 id="5-æœ€ä½³å®è·µå»ºè®®"><a href="#5-æœ€ä½³å®è·µå»ºè®®" class="headerlink" title="5. æœ€ä½³å®è·µå»ºè®®"></a>5. æœ€ä½³å®è·µå»ºè®®</h2><ol><li>åˆç†ä½¿ç”¨åˆ†åŒ…åŠ è½½</li><li>ä¼˜åŒ–å›¾ç‰‡åŠ è½½ç­–ç•¥</li><li>å®ç°è™šæ‹Ÿåˆ—è¡¨</li><li>é¿å…é¢‘ç¹æ›´æ–°</li><li>åŠæ—¶æ¸…ç†èµ„æº</li><li>åšå¥½ç¼“å­˜ç®¡ç†</li><li>ä¼˜åŒ–ç½‘ç»œè¯·æ±‚</li><li>å®ç°ç¦»çº¿ç¼“å­˜</li></ol><h2 id="6-æ€§èƒ½ç›‘æ§"><a href="#6-æ€§èƒ½ç›‘æ§" class="headerlink" title="6. æ€§èƒ½ç›‘æ§"></a>6. æ€§èƒ½ç›‘æ§</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/performance.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Performance</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span> = &#123;</span><br><span class="line">      <span class="comment">// é¡µé¢æ€§èƒ½</span></span><br><span class="line">      <span class="attr">page</span>: &#123;</span><br><span class="line">        <span class="attr">ready</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">load</span>: <span class="number">0</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// æ¥å£æ€§èƒ½</span></span><br><span class="line">      <span class="attr">api</span>: <span class="keyword">new</span> <span class="title class_">Map</span>(),</span><br><span class="line">      <span class="comment">// èµ„æºæ€§èƒ½</span></span><br><span class="line">      <span class="attr">resource</span>: <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è®°å½•é¡µé¢æ€§èƒ½</span></span><br><span class="line">  <span class="title function_">recordPage</span>(<span class="params">type, time</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">page</span>[type] = time</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è®°å½•æ¥å£æ€§èƒ½</span></span><br><span class="line">  <span class="title function_">recordApi</span>(<span class="params">url, time</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> api = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">api</span>.<span class="title function_">get</span>(url) || &#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">total</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">max</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">min</span>: <span class="title class_">Infinity</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    api.<span class="property">count</span>++</span><br><span class="line">    api.<span class="property">total</span> += time</span><br><span class="line">    api.<span class="property">max</span> = <span class="title class_">Math</span>.<span class="title function_">max</span>(api.<span class="property">max</span>, time)</span><br><span class="line">    api.<span class="property">min</span> = <span class="title class_">Math</span>.<span class="title function_">min</span>(api.<span class="property">min</span>, time)</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">api</span>.<span class="title function_">set</span>(url, api)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è®°å½•èµ„æºæ€§èƒ½</span></span><br><span class="line">  <span class="title function_">recordResource</span>(<span class="params">url, time</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">resource</span>.<span class="title function_">set</span>(url, time)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è·å–æ€§èƒ½æ•°æ®</span></span><br><span class="line">  <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; page, api, resource &#125; = <span class="variable language_">this</span>.<span class="property">data</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      page,</span><br><span class="line">      <span class="attr">api</span>: <span class="title class_">Array</span>.<span class="title function_">from</span>(api.<span class="title function_">entries</span>()).<span class="title function_">map</span>(<span class="function">(<span class="params">[url, data]</span>) =&gt;</span> (&#123;</span><br><span class="line">        url,</span><br><span class="line">        ...data,</span><br><span class="line">        <span class="attr">avg</span>: data.<span class="property">total</span> / data.<span class="property">count</span></span><br><span class="line">      &#125;)),</span><br><span class="line">      <span class="attr">resource</span>: <span class="title class_">Array</span>.<span class="title function_">from</span>(resource.<span class="title function_">entries</span>()).<span class="title function_">map</span>(<span class="function">(<span class="params">[url, time]</span>) =&gt;</span> (&#123;</span><br><span class="line">        url,</span><br><span class="line">        time</span><br><span class="line">      &#125;))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ä¸ŠæŠ¥æ€§èƒ½æ•°æ®</span></span><br><span class="line">  <span class="title function_">report</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="variable language_">this</span>.<span class="title function_">getData</span>()</span><br><span class="line">    <span class="comment">// ä¸ŠæŠ¥é€»è¾‘</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æ€§èƒ½æ•°æ®:&#x27;</span>, data)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Performance</span>()</span><br></pre></td></tr></table></figure><h2 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7. æ€»ç»“"></a>7. æ€»ç»“</h2><ol><li>ä¼˜åŒ–é¦–å±åŠ è½½</li><li>æå‡æ¸²æŸ“æ€§èƒ½</li><li>ç®¡ç†å†…å­˜èµ„æº</li><li>ä¼˜åŒ–ç½‘ç»œè¯·æ±‚</li><li>å®ç°æ€§èƒ½ç›‘æ§</li></ol><hr><blockquote><p>å¦‚æœè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©,æ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«,ä½ çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼ </p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/uni-app/">uni-app</category>
      
      
      <category domain="https://www.hzv5.cn/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/tags/uni-app/">uni-app</category>
      
      <category domain="https://www.hzv5.cn/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">æ€§èƒ½ä¼˜åŒ–</category>
      
      <category domain="https://www.hzv5.cn/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/">å°ç¨‹åº</category>
      
      
      <comments>https://www.hzv5.cn/2024/04/10/uniapp-optimization/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>uni-appåŠ¨ç”»æ•ˆæœå®æˆ˜ï¼šä»åŸºç¡€åˆ°é«˜çº§çš„åŠ¨ç”»å®ç°æŒ‡å—</title>
      <link>https://www.hzv5.cn/2024/04/05/uniapp-animation/</link>
      <guid>https://www.hzv5.cn/2024/04/05/uniapp-animation/</guid>
      <pubDate>Fri, 05 Apr 2024 01:15:00 GMT</pubDate>
      
      <description>æ·±å…¥æ¢è®¨uni-appä¸­çš„åŠ¨ç”»æ•ˆæœå®ç°æ–¹æ¡ˆ,åŒ…æ‹¬CSSåŠ¨ç”»ã€JSåŠ¨ç”»ã€æ‰‹åŠ¿åŠ¨ç”»ç­‰å†…å®¹,å¸®åŠ©å¼€å‘è€…æ‰“é€ æµç•…çš„åŠ¨ç”»äº¤äº’ä½“éªŒã€‚</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>ä¼˜ç§€çš„åŠ¨ç”»æ•ˆæœå¯ä»¥å¤§å¤§æå‡åº”ç”¨çš„ç”¨æˆ·ä½“éªŒ,æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨uni-appä¸­å®ç°å„ç§åŠ¨ç”»æ•ˆæœ,åŠ©ä½ æ‰“é€ å‡ºè‰²çš„äº¤äº’ä½“éªŒã€‚</p></blockquote><span id="more"></span><h2 id="1-CSSåŠ¨ç”»åŸºç¡€"><a href="#1-CSSåŠ¨ç”»åŸºç¡€" class="headerlink" title="1. CSSåŠ¨ç”»åŸºç¡€"></a>1. CSSåŠ¨ç”»åŸºç¡€</h2><h3 id="1-1-è¿‡æ¸¡åŠ¨ç”»"><a href="#1-1-è¿‡æ¸¡åŠ¨ç”»" class="headerlink" title="1.1 è¿‡æ¸¡åŠ¨ç”»"></a>1.1 è¿‡æ¸¡åŠ¨ç”»</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;view </span><br><span class="line">      class=&quot;box&quot;</span><br><span class="line">      :class=&quot;&#123; active: isActive &#125;&quot;</span><br><span class="line">      @click=&quot;toggleActive&quot;</span><br><span class="line">    &gt;&lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      isActive: false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    toggleActive() &#123;</span><br><span class="line">      this.isActive = !this.isActive</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">.box &#123;</span><br><span class="line">  width: 100rpx;</span><br><span class="line">  height: 100rpx;</span><br><span class="line">  background: #409eff;</span><br><span class="line">  transition: all 0.3s ease;</span><br><span class="line">  </span><br><span class="line">  &amp;.active &#123;</span><br><span class="line">    transform: scale(1.5) rotate(45deg);</span><br><span class="line">    background: #67c23a;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h3 id="1-2-å…³é”®å¸§åŠ¨ç”»"><a href="#1-2-å…³é”®å¸§åŠ¨ç”»" class="headerlink" title="1.2 å…³é”®å¸§åŠ¨ç”»"></a>1.2 å…³é”®å¸§åŠ¨ç”»</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.loading</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">60</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">60</span>rpx;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">4</span>rpx solid <span class="number">#f3f3f3</span>;</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">4</span>rpx solid <span class="number">#3498db</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">animation</span>: spin <span class="number">1s</span> linear infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> spin &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">360deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.pulse</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100</span>rpx;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#409eff</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">animation</span>: pulse <span class="number">2s</span> ease-in-out infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> pulse &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">50%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1.5</span>);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-JSåŠ¨ç”»å®ç°"><a href="#2-JSåŠ¨ç”»å®ç°" class="headerlink" title="2. JSåŠ¨ç”»å®ç°"></a>2. JSåŠ¨ç”»å®ç°</h2><h3 id="2-1-ä½¿ç”¨animationå¯¹è±¡"><a href="#2-1-ä½¿ç”¨animationå¯¹è±¡" class="headerlink" title="2.1 ä½¿ç”¨animationå¯¹è±¡"></a>2.1 ä½¿ç”¨animationå¯¹è±¡</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/animation.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createAnimation</span>(<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> uni.<span class="title function_">createAnimation</span>(&#123;</span><br><span class="line">    <span class="attr">duration</span>: options.<span class="property">duration</span> || <span class="number">300</span>,</span><br><span class="line">    <span class="attr">timingFunction</span>: options.<span class="property">timingFunction</span> || <span class="string">&#x27;ease&#x27;</span>,</span><br><span class="line">    <span class="attr">delay</span>: options.<span class="property">delay</span> || <span class="number">0</span>,</span><br><span class="line">    <span class="attr">transformOrigin</span>: options.<span class="property">transformOrigin</span> || <span class="string">&#x27;50% 50% 0&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">:animation</span>=<span class="string">&quot;animationData&quot;</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;startAnimation&quot;</span>&gt;</span>å¼€å§‹åŠ¨ç”»<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; createAnimation &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/animation&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">animation</span>: <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">animationData</span>: &#123;&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">startAnimation</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// åˆ›å»ºåŠ¨ç”»å®ä¾‹</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">const</span> animation = <span class="title function_">createAnimation</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// å®šä¹‰åŠ¨ç”»</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      animation</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        .<span class="title function_">scale</span>(<span class="number">1.5</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        .<span class="title function_">rotate</span>(<span class="number">45</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        .<span class="title function_">step</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        .<span class="title function_">scale</span>(<span class="number">1</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        .<span class="title function_">rotate</span>(<span class="number">0</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        .<span class="title function_">step</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// å¯¼å‡ºåŠ¨ç”»æ•°æ®</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="property">animationData</span> = animation.<span class="title function_">export</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="2-2-requestAnimationFrameå®ç°"><a href="#2-2-requestAnimationFrameå®ç°" class="headerlink" title="2.2 requestAnimationFrameå®ç°"></a>2.2 requestAnimationFrameå®ç°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/raf.js</span></span><br><span class="line"><span class="keyword">let</span> lastTime = <span class="number">0</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">raf</span> = callback =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> currTime = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>()</span><br><span class="line">  <span class="keyword">const</span> timeToCall = <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="number">0</span>, <span class="number">16</span> - (currTime - lastTime))</span><br><span class="line">  <span class="keyword">const</span> id = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">callback</span>(currTime + timeToCall)</span><br><span class="line">  &#125;, timeToCall)</span><br><span class="line">  lastTime = currTime + timeToCall</span><br><span class="line">  <span class="keyword">return</span> id</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">caf</span> = id =&gt; &#123;</span><br><span class="line">  <span class="built_in">clearTimeout</span>(id)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> requestAnimationFrame = <span class="keyword">typeof</span> <span class="variable language_">window</span> !== <span class="string">&#x27;undefined&#x27;</span> </span><br><span class="line">  ? <span class="variable language_">window</span>.<span class="property">requestAnimationFrame</span> || raf</span><br><span class="line">  : raf</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> cancelAnimationFrame = <span class="keyword">typeof</span> <span class="variable language_">window</span> !== <span class="string">&#x27;undefined&#x27;</span></span><br><span class="line">  ? <span class="variable language_">window</span>.<span class="property">cancelAnimationFrame</span> || caf</span><br><span class="line">  : caf</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Animator</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">duration</span> = options.<span class="property">duration</span> || <span class="number">300</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">easing</span> = options.<span class="property">easing</span> || (<span class="function"><span class="params">t</span> =&gt;</span> t)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">running</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">animate</span>(<span class="params"><span class="keyword">from</span>, to, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> startTime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    <span class="keyword">const</span> change = to - <span class="keyword">from</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">update</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> currentTime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">      <span class="keyword">const</span> elapsed = currentTime - startTime</span><br><span class="line">      <span class="keyword">const</span> progress = <span class="title class_">Math</span>.<span class="title function_">min</span>(elapsed / <span class="variable language_">this</span>.<span class="property">duration</span>, <span class="number">1</span>)</span><br><span class="line">      <span class="keyword">const</span> value = <span class="keyword">from</span> + change * <span class="variable language_">this</span>.<span class="title function_">easing</span>(progress)</span><br><span class="line">      </span><br><span class="line">      <span class="title function_">callback</span>(value)</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (progress &lt; <span class="number">1</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">running</span>) &#123;</span><br><span class="line">        <span class="title function_">requestAnimationFrame</span>(update)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">running</span> = <span class="literal">true</span></span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(update)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">stop</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">running</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">const</span> animator = <span class="keyword">new</span> <span class="title class_">Animator</span>(&#123;</span><br><span class="line">  <span class="attr">duration</span>: <span class="number">1000</span>,</span><br><span class="line">  <span class="attr">easing</span>: <span class="function"><span class="params">t</span> =&gt;</span> t * t <span class="comment">// ç¼“åŠ¨å‡½æ•°</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">animator.<span class="title function_">animate</span>(<span class="number">0</span>, <span class="number">100</span>, <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æ›´æ–°å…ƒç´ ä½ç½®</span></span><br><span class="line">  element.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`translateX(<span class="subst">$&#123;value&#125;</span>px)`</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="3-æ‰‹åŠ¿åŠ¨ç”»"><a href="#3-æ‰‹åŠ¿åŠ¨ç”»" class="headerlink" title="3. æ‰‹åŠ¿åŠ¨ç”»"></a>3. æ‰‹åŠ¿åŠ¨ç”»</h2><h3 id="3-1-æ‹–æ‹½åŠ¨ç”»"><a href="#3-1-æ‹–æ‹½åŠ¨ç”»" class="headerlink" title="3.1 æ‹–æ‹½åŠ¨ç”»"></a>3.1 æ‹–æ‹½åŠ¨ç”»</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;drag-container&quot;&gt;</span><br><span class="line">    &lt;view</span><br><span class="line">      class=&quot;drag-item&quot;</span><br><span class="line">      :style=&quot;itemStyle&quot;</span><br><span class="line">      @touchstart=&quot;handleTouchStart&quot;</span><br><span class="line">      @touchmove=&quot;handleTouchMove&quot;</span><br><span class="line">      @touchend=&quot;handleTouchEnd&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      æ‹–æ‹½æˆ‘</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      startX: 0,</span><br><span class="line">      startY: 0,</span><br><span class="line">      moveX: 0,</span><br><span class="line">      moveY: 0,</span><br><span class="line">      isDragging: false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    itemStyle() &#123;</span><br><span class="line">      if (!this.isDragging) &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          transform: `translate3d($&#123;this.moveX&#125;px, $&#123;this.moveY&#125;px, 0)`,</span><br><span class="line">          transition: &#x27;transform 0.3s&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      return &#123;</span><br><span class="line">        transform: `translate3d($&#123;this.moveX&#125;px, $&#123;this.moveY&#125;px, 0)`</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleTouchStart(e) &#123;</span><br><span class="line">      const touch = e.touches[0]</span><br><span class="line">      this.startX = touch.clientX - this.moveX</span><br><span class="line">      this.startY = touch.clientY - this.moveY</span><br><span class="line">      this.isDragging = true</span><br><span class="line">    &#125;,</span><br><span class="line">    handleTouchMove(e) &#123;</span><br><span class="line">      const touch = e.touches[0]</span><br><span class="line">      this.moveX = touch.clientX - this.startX</span><br><span class="line">      this.moveY = touch.clientY - this.startY</span><br><span class="line">      </span><br><span class="line">      // é˜²æ­¢é¡µé¢æ»šåŠ¨</span><br><span class="line">      e.preventDefault()</span><br><span class="line">    &#125;,</span><br><span class="line">    handleTouchEnd() &#123;</span><br><span class="line">      this.isDragging = false</span><br><span class="line">      </span><br><span class="line">      // åˆ¤æ–­æ˜¯å¦è¶…å‡ºè¾¹ç•Œ,å¦‚æœæ˜¯åˆ™å›å¼¹</span><br><span class="line">      const maxX = this.containerWidth - this.itemWidth</span><br><span class="line">      const maxY = this.containerHeight - this.itemHeight</span><br><span class="line">      </span><br><span class="line">      if (this.moveX &lt; 0) this.moveX = 0</span><br><span class="line">      if (this.moveY &lt; 0) this.moveY = 0</span><br><span class="line">      if (this.moveX &gt; maxX) this.moveX = maxX</span><br><span class="line">      if (this.moveY &gt; maxY) this.moveY = maxY</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">.drag-container &#123;</span><br><span class="line">  position: relative;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 500rpx;</span><br><span class="line">  background: #f5f5f5;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.drag-item &#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  width: 200rpx;</span><br><span class="line">  height: 200rpx;</span><br><span class="line">  background: #409eff;</span><br><span class="line">  color: #fff;</span><br><span class="line">  display: flex;</span><br><span class="line">  align-items: center;</span><br><span class="line">  justify-content: center;</span><br><span class="line">  user-select: none;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h3 id="3-2-æ»‘åŠ¨åˆ é™¤"><a href="#3-2-æ»‘åŠ¨åˆ é™¤" class="headerlink" title="3.2 æ»‘åŠ¨åˆ é™¤"></a>3.2 æ»‘åŠ¨åˆ é™¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;swipe-container&quot;&gt;</span><br><span class="line">    &lt;view</span><br><span class="line">      class=&quot;swipe-item&quot;</span><br><span class="line">      :style=&quot;itemStyle&quot;</span><br><span class="line">      @touchstart=&quot;handleTouchStart&quot;</span><br><span class="line">      @touchmove=&quot;handleTouchMove&quot;</span><br><span class="line">      @touchend=&quot;handleTouchEnd&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;view class=&quot;swipe-content&quot;&gt;</span><br><span class="line">        åˆ—è¡¨é¡¹å†…å®¹</span><br><span class="line">      &lt;/view&gt;</span><br><span class="line">      &lt;view class=&quot;swipe-actions&quot;&gt;</span><br><span class="line">        &lt;view class=&quot;swipe-btn delete&quot; @click=&quot;handleDelete&quot;&gt;åˆ é™¤&lt;/view&gt;</span><br><span class="line">      &lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">const THRESHOLD = 80 // æ»‘åŠ¨é˜ˆå€¼</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      startX: 0,</span><br><span class="line">      moveX: 0,</span><br><span class="line">      isMoving: false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    itemStyle() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        transform: `translate3d($&#123;this.moveX&#125;px, 0, 0)`,</span><br><span class="line">        transition: this.isMoving ? &#x27;&#x27; : &#x27;transform 0.3s&#x27;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleTouchStart(e) &#123;</span><br><span class="line">      this.startX = e.touches[0].clientX - this.moveX</span><br><span class="line">      this.isMoving = true</span><br><span class="line">    &#125;,</span><br><span class="line">    handleTouchMove(e) &#123;</span><br><span class="line">      const moveX = e.touches[0].clientX - this.startX</span><br><span class="line">      // é™åˆ¶åªèƒ½å‘å·¦æ»‘åŠ¨</span><br><span class="line">      this.moveX = Math.min(0, moveX)</span><br><span class="line">    &#125;,</span><br><span class="line">    handleTouchEnd() &#123;</span><br><span class="line">      this.isMoving = false</span><br><span class="line">      // åˆ¤æ–­æ˜¯å¦è¶…è¿‡é˜ˆå€¼</span><br><span class="line">      if (Math.abs(this.moveX) &gt; THRESHOLD) &#123;</span><br><span class="line">        this.moveX = -100 // å±•å¼€åˆ é™¤æŒ‰é’®</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        this.moveX = 0 // å›å¼¹</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    handleDelete() &#123;</span><br><span class="line">      // åˆ é™¤é€»è¾‘</span><br><span class="line">      this.$emit(&#x27;delete&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">.swipe-item &#123;</span><br><span class="line">  position: relative;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100rpx;</span><br><span class="line">  background: #fff;</span><br><span class="line">  </span><br><span class="line">  .swipe-content &#123;</span><br><span class="line">    height: 100%;</span><br><span class="line">    padding: 0 30rpx;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  .swipe-actions &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    top: 0;</span><br><span class="line">    right: 0;</span><br><span class="line">    height: 100%;</span><br><span class="line">    display: flex;</span><br><span class="line">    transform: translateX(100%);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  .swipe-btn &#123;</span><br><span class="line">    width: 100rpx;</span><br><span class="line">    height: 100%;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    color: #fff;</span><br><span class="line">    </span><br><span class="line">    &amp;.delete &#123;</span><br><span class="line">      background: #f56c6c;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="4-é«˜çº§åŠ¨ç”»æŠ€å·§"><a href="#4-é«˜çº§åŠ¨ç”»æŠ€å·§" class="headerlink" title="4. é«˜çº§åŠ¨ç”»æŠ€å·§"></a>4. é«˜çº§åŠ¨ç”»æŠ€å·§</h2><h3 id="4-1-è·¯ç”±è½¬åœºåŠ¨ç”»"><a href="#4-1-è·¯ç”±è½¬åœºåŠ¨ç”»" class="headerlink" title="4.1 è·¯ç”±è½¬åœºåŠ¨ç”»"></a>4.1 è·¯ç”±è½¬åœºåŠ¨ç”»</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;page-container&quot;&gt;</span><br><span class="line">    &lt;view </span><br><span class="line">      class=&quot;page-wrapper&quot;</span><br><span class="line">      :class=&quot;transitionClass&quot;</span><br><span class="line">      :style=&quot;&#123; &#x27;z-index&#x27;: zIndex &#125;&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    name: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: &#x27;fade&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      transitionClass: &#x27;&#x27;,</span><br><span class="line">      zIndex: 1</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    enter() &#123;</span><br><span class="line">      this.zIndex = 2</span><br><span class="line">      this.transitionClass = `$&#123;this.name&#125;-enter`</span><br><span class="line">      requestAnimationFrame(() =&gt; &#123;</span><br><span class="line">        this.transitionClass = `$&#123;this.name&#125;-enter $&#123;this.name&#125;-enter-active`</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    leave() &#123;</span><br><span class="line">      this.zIndex = 1</span><br><span class="line">      this.transitionClass = `$&#123;this.name&#125;-leave`</span><br><span class="line">      requestAnimationFrame(() =&gt; &#123;</span><br><span class="line">        this.transitionClass = `$&#123;this.name&#125;-leave $&#123;this.name&#125;-leave-active`</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">.page-container &#123;</span><br><span class="line">  position: relative;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.page-wrapper &#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100%;</span><br><span class="line">  transition: all 0.3s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ·¡å…¥æ·¡å‡º</span><br><span class="line">.fade-enter &#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">&#125;</span><br><span class="line">.fade-enter-active &#123;</span><br><span class="line">  opacity: 1;</span><br><span class="line">&#125;</span><br><span class="line">.fade-leave &#123;</span><br><span class="line">  opacity: 1;</span><br><span class="line">&#125;</span><br><span class="line">.fade-leave-active &#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ»‘åŠ¨</span><br><span class="line">.slide-enter &#123;</span><br><span class="line">  transform: translateX(100%);</span><br><span class="line">&#125;</span><br><span class="line">.slide-enter-active &#123;</span><br><span class="line">  transform: translateX(0);</span><br><span class="line">&#125;</span><br><span class="line">.slide-leave &#123;</span><br><span class="line">  transform: translateX(0);</span><br><span class="line">&#125;</span><br><span class="line">.slide-leave-active &#123;</span><br><span class="line">  transform: translateX(-100%);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h3 id="4-2-åˆ—è¡¨åŠ¨ç”»"><a href="#4-2-åˆ—è¡¨åŠ¨ç”»" class="headerlink" title="4.2 åˆ—è¡¨åŠ¨ç”»"></a>4.2 åˆ—è¡¨åŠ¨ç”»</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;list-container&quot;&gt;</span><br><span class="line">    &lt;view</span><br><span class="line">      v-for=&quot;(item, index) in list&quot;</span><br><span class="line">      :key=&quot;item.id&quot;</span><br><span class="line">      class=&quot;list-item&quot;</span><br><span class="line">      :style=&quot;getItemStyle(index)&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;&#123; item.text &#125;&#125;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      list: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    getItemStyle(index) &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        animation: `slideIn 0.3s ease-out $&#123;index * 0.1&#125;s both`</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    addItem() &#123;</span><br><span class="line">      this.list.push(&#123;</span><br><span class="line">        id: Date.now(),</span><br><span class="line">        text: &#x27;æ–°é¡¹ç›®&#x27;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    removeItem(index) &#123;</span><br><span class="line">      this.list.splice(index, 1)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">.list-item &#123;</span><br><span class="line">  height: 100rpx;</span><br><span class="line">  margin: 20rpx;</span><br><span class="line">  background: #fff;</span><br><span class="line">  border-radius: 8rpx;</span><br><span class="line">  box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@keyframes slideIn &#123;</span><br><span class="line">  from &#123;</span><br><span class="line">    opacity: 0;</span><br><span class="line">    transform: translateY(60rpx);</span><br><span class="line">  &#125;</span><br><span class="line">  to &#123;</span><br><span class="line">    opacity: 1;</span><br><span class="line">    transform: translateY(0);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="5-æ€§èƒ½ä¼˜åŒ–"><a href="#5-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="5. æ€§èƒ½ä¼˜åŒ–"></a>5. æ€§èƒ½ä¼˜åŒ–</h2><ol><li>ä½¿ç”¨transformä»£æ›¿ä½ç½®å±æ€§</li><li>ä½¿ç”¨will-changeæç¤ºæµè§ˆå™¨</li><li>é¿å…åŒæ—¶åŠ¨ç”»è¿‡å¤šå…ƒç´ </li><li>é€‚å½“ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿ</li><li>åˆç†è®¾ç½®åŠ¨ç”»å¸§ç‡</li></ol><h2 id="6-æœ€ä½³å®è·µå»ºè®®"><a href="#6-æœ€ä½³å®è·µå»ºè®®" class="headerlink" title="6. æœ€ä½³å®è·µå»ºè®®"></a>6. æœ€ä½³å®è·µå»ºè®®</h2><ol><li>åŠ¨ç”»è¦æœ‰ç›®çš„æ€§</li><li>éµå¾ªç‰©ç†è¿åŠ¨è§„å¾‹</li><li>æ³¨æ„åŠ¨ç”»æ—¶é•¿æ§åˆ¶</li><li>æä¾›åŠ¨ç”»å¼€å…³é€‰é¡¹</li><li>åšå¥½æ€§èƒ½ä¼˜åŒ–</li></ol><h2 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7. æ€»ç»“"></a>7. æ€»ç»“</h2><ol><li>æŒæ¡åŠ¨ç”»åŸºç¡€çŸ¥è¯†</li><li>çµæ´»è¿ç”¨å¤šç§å®ç°æ–¹å¼</li><li>æ³¨æ„æ€§èƒ½ä¼˜åŒ–</li><li>æå‡ç”¨æˆ·ä½“éªŒ</li><li>ä¿æŒä»£ç å¯ç»´æŠ¤æ€§</li></ol><hr><blockquote><p>å¦‚æœè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©,æ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«,ä½ çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼ </p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/uni-app/">uni-app</category>
      
      
      <category domain="https://www.hzv5.cn/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/tags/uni-app/">uni-app</category>
      
      <category domain="https://www.hzv5.cn/tags/%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C/">åŠ¨ç”»æ•ˆæœ</category>
      
      <category domain="https://www.hzv5.cn/tags/CSS%E5%8A%A8%E7%94%BB/">CSSåŠ¨ç”»</category>
      
      <category domain="https://www.hzv5.cn/tags/JS%E5%8A%A8%E7%94%BB/">JSåŠ¨ç”»</category>
      
      
      <comments>https://www.hzv5.cn/2024/04/05/uniapp-animation/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>uni-appç»„ä»¶å¼€å‘å®æˆ˜ï¼šä»åŸºç¡€åˆ°è¿›é˜¶çš„æœ€ä½³å®è·µ</title>
      <link>https://www.hzv5.cn/2024/03/30/uniapp-component/</link>
      <guid>https://www.hzv5.cn/2024/03/30/uniapp-component/</guid>
      <pubDate>Sat, 30 Mar 2024 02:40:00 GMT</pubDate>
      
      <description>æ·±å…¥æ¢è®¨uni-appç»„ä»¶å¼€å‘çš„æœ€ä½³å®è·µ,åŒ…æ‹¬åŸºç¡€ç»„ä»¶å°è£…ã€ç»„ä»¶é€šä¿¡ã€è·¨ç«¯é€‚é…ç­‰å†…å®¹,å¸®åŠ©å¼€å‘è€…æ„å»ºé«˜è´¨é‡çš„UIç»„ä»¶åº“ã€‚</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>ç»„ä»¶åŒ–å¼€å‘æ˜¯ç°ä»£å‰ç«¯çš„é‡è¦ç‰¹å¾,æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨uni-appä¸­å¼€å‘é«˜è´¨é‡çš„UIç»„ä»¶,åŠ©ä½ æ‰“é€ è‡ªå·±çš„ç»„ä»¶åº“ã€‚</p></blockquote><span id="more"></span><h2 id="1-ç»„ä»¶åŸºç¡€å¼€å‘"><a href="#1-ç»„ä»¶åŸºç¡€å¼€å‘" class="headerlink" title="1. ç»„ä»¶åŸºç¡€å¼€å‘"></a>1. ç»„ä»¶åŸºç¡€å¼€å‘</h2><h3 id="1-1-ç»„ä»¶ç›®å½•ç»“æ„"><a href="#1-1-ç»„ä»¶ç›®å½•ç»“æ„" class="headerlink" title="1.1 ç»„ä»¶ç›®å½•ç»“æ„"></a>1.1 ç»„ä»¶ç›®å½•ç»“æ„</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">components</span><br><span class="line">â”œâ”€â”€ base              <span class="comment"># åŸºç¡€ç»„ä»¶</span></span><br><span class="line">â”‚   â”œâ”€â”€ button</span><br><span class="line">â”‚   â”œâ”€â”€ input</span><br><span class="line">â”‚   â””â”€â”€ icon</span><br><span class="line">â”œâ”€â”€ business          <span class="comment"># ä¸šåŠ¡ç»„ä»¶</span></span><br><span class="line">â”‚   â”œâ”€â”€ product-card</span><br><span class="line">â”‚   â”œâ”€â”€ order-item</span><br><span class="line">â”‚   â””â”€â”€ user-info</span><br><span class="line">â””â”€â”€ common           <span class="comment"># å…¬å…±ç»„ä»¶</span></span><br><span class="line">    â”œâ”€â”€ loading</span><br><span class="line">    â”œâ”€â”€ empty</span><br><span class="line">    â””â”€â”€ error</span><br></pre></td></tr></table></figure><h3 id="1-2-åŸºç¡€ç»„ä»¶ç¤ºä¾‹"><a href="#1-2-åŸºç¡€ç»„ä»¶ç¤ºä¾‹" class="headerlink" title="1.2 åŸºç¡€ç»„ä»¶ç¤ºä¾‹"></a>1.2 åŸºç¡€ç»„ä»¶ç¤ºä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- components/base/button/index.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view </span><br><span class="line">    class=&quot;custom-button&quot;</span><br><span class="line">    :class=&quot;[</span><br><span class="line">      `custom-button--$&#123;type&#125;`,</span><br><span class="line">      `custom-button--$&#123;size&#125;`,</span><br><span class="line">      &#123;</span><br><span class="line">        &#x27;custom-button--plain&#x27;: plain,</span><br><span class="line">        &#x27;custom-button--disabled&#x27;: disabled,</span><br><span class="line">        &#x27;custom-button--loading&#x27;: loading</span><br><span class="line">      &#125;</span><br><span class="line">    ]&quot;</span><br><span class="line">    :hover-class=&quot;disabled ? &#x27;&#x27; : &#x27;custom-button--hover&#x27;&quot;</span><br><span class="line">    @click=&quot;handleClick&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;view class=&quot;custom-button__content&quot;&gt;</span><br><span class="line">      &lt;text v-if=&quot;loading&quot; class=&quot;custom-button__loading&quot;&gt;&lt;/text&gt;</span><br><span class="line">      &lt;text v-if=&quot;icon&quot; class=&quot;custom-button__icon&quot; :class=&quot;icon&quot;&gt;&lt;/text&gt;</span><br><span class="line">      &lt;text class=&quot;custom-button__text&quot;&gt;&lt;slot&gt;&lt;/slot&gt;&lt;/text&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;CustomButton&#x27;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    // æŒ‰é’®ç±»å‹</span><br><span class="line">    type: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: &#x27;default&#x27;,</span><br><span class="line">      validator: value =&gt; &#123;</span><br><span class="line">        return [&#x27;default&#x27;, &#x27;primary&#x27;, &#x27;success&#x27;, &#x27;warning&#x27;, &#x27;danger&#x27;].includes(value)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // æŒ‰é’®å°ºå¯¸</span><br><span class="line">    size: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: &#x27;normal&#x27;,</span><br><span class="line">      validator: value =&gt; &#123;</span><br><span class="line">        return [&#x27;small&#x27;, &#x27;normal&#x27;, &#x27;large&#x27;].includes(value)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // æ˜¯å¦æœ´ç´ æŒ‰é’®</span><br><span class="line">    plain: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">      default: false</span><br><span class="line">    &#125;,</span><br><span class="line">    // æ˜¯å¦ç¦ç”¨</span><br><span class="line">    disabled: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">      default: false</span><br><span class="line">    &#125;,</span><br><span class="line">    // æ˜¯å¦åŠ è½½ä¸­</span><br><span class="line">    loading: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">      default: false</span><br><span class="line">    &#125;,</span><br><span class="line">    // å›¾æ ‡ç±»å</span><br><span class="line">    icon: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: &#x27;&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleClick(event) &#123;</span><br><span class="line">      if (this.disabled || this.loading) return</span><br><span class="line">      this.$emit(&#x27;click&#x27;, event)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">.custom-button &#123;</span><br><span class="line">  position: relative;</span><br><span class="line">  display: inline-flex;</span><br><span class="line">  align-items: center;</span><br><span class="line">  justify-content: center;</span><br><span class="line">  padding: 0 30rpx;</span><br><span class="line">  font-size: 28rpx;</span><br><span class="line">  height: 80rpx;</span><br><span class="line">  line-height: 1;</span><br><span class="line">  text-align: center;</span><br><span class="line">  border-radius: 8rpx;</span><br><span class="line">  background: #fff;</span><br><span class="line">  border: 2rpx solid #dcdfe6;</span><br><span class="line">  box-sizing: border-box;</span><br><span class="line">  transition: all 0.3s;</span><br><span class="line">  </span><br><span class="line">  &amp;--hover &#123;</span><br><span class="line">    opacity: 0.8;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;--primary &#123;</span><br><span class="line">    color: #fff;</span><br><span class="line">    background: #409eff;</span><br><span class="line">    border-color: #409eff;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;--success &#123;</span><br><span class="line">    color: #fff;</span><br><span class="line">    background: #67c23a;</span><br><span class="line">    border-color: #67c23a;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;--warning &#123;</span><br><span class="line">    color: #fff;</span><br><span class="line">    background: #e6a23c;</span><br><span class="line">    border-color: #e6a23c;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;--danger &#123;</span><br><span class="line">    color: #fff;</span><br><span class="line">    background: #f56c6c;</span><br><span class="line">    border-color: #f56c6c;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;--plain &#123;</span><br><span class="line">    background: transparent;</span><br><span class="line">    </span><br><span class="line">    &amp;.custom-button--primary &#123;</span><br><span class="line">      color: #409eff;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &amp;.custom-button--success &#123;</span><br><span class="line">      color: #67c23a;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &amp;.custom-button--warning &#123;</span><br><span class="line">      color: #e6a23c;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &amp;.custom-button--danger &#123;</span><br><span class="line">      color: #f56c6c;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;--disabled &#123;</span><br><span class="line">    opacity: 0.5;</span><br><span class="line">    cursor: not-allowed;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;--small &#123;</span><br><span class="line">    height: 60rpx;</span><br><span class="line">    padding: 0 20rpx;</span><br><span class="line">    font-size: 24rpx;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;--large &#123;</span><br><span class="line">    height: 100rpx;</span><br><span class="line">    padding: 0 40rpx;</span><br><span class="line">    font-size: 32rpx;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;__content &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: center;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;__loading &#123;</span><br><span class="line">    width: 28rpx;</span><br><span class="line">    height: 28rpx;</span><br><span class="line">    margin-right: 10rpx;</span><br><span class="line">    border: 2rpx solid currentColor;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    border-right-color: transparent;</span><br><span class="line">    animation: button-loading 0.8s linear infinite;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;__icon &#123;</span><br><span class="line">    margin-right: 10rpx;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@keyframes button-loading &#123;</span><br><span class="line">  from &#123;</span><br><span class="line">    transform: rotate(0);</span><br><span class="line">  &#125;</span><br><span class="line">  to &#123;</span><br><span class="line">    transform: rotate(360deg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="2-ç»„ä»¶é€šä¿¡æ–¹å¼"><a href="#2-ç»„ä»¶é€šä¿¡æ–¹å¼" class="headerlink" title="2. ç»„ä»¶é€šä¿¡æ–¹å¼"></a>2. ç»„ä»¶é€šä¿¡æ–¹å¼</h2><h3 id="2-1-Props-Events"><a href="#2-1-Props-Events" class="headerlink" title="2.1 Props/Events"></a>2.1 Props/Events</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- çˆ¶ç»„ä»¶ --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;custom-form</span><br><span class="line">    :model=&quot;formData&quot;</span><br><span class="line">    :rules=&quot;formRules&quot;</span><br><span class="line">    @submit=&quot;handleSubmit&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;custom-form-item label=&quot;ç”¨æˆ·å&quot; prop=&quot;username&quot;&gt;</span><br><span class="line">      &lt;custom-input v-model=&quot;formData.username&quot; /&gt;</span><br><span class="line">    &lt;/custom-form-item&gt;</span><br><span class="line">  &lt;/custom-form&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      formData: &#123;</span><br><span class="line">        username: &#x27;&#x27;</span><br><span class="line">      &#125;,</span><br><span class="line">      formRules: &#123;</span><br><span class="line">        username: [</span><br><span class="line">          &#123; required: true, message: &#x27;è¯·è¾“å…¥ç”¨æˆ·å&#x27; &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleSubmit(values) &#123;</span><br><span class="line">      console.log(&#x27;è¡¨å•æäº¤:&#x27;, values)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="2-2-Provide-Inject"><a href="#2-2-Provide-Inject" class="headerlink" title="2.2 Provide/Inject"></a>2.2 Provide/Inject</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- components/form/index.vue --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;CustomForm&#x27;,</span><br><span class="line">  provide() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      form: this</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    model: &#123;</span><br><span class="line">      type: Object,</span><br><span class="line">      required: true</span><br><span class="line">    &#125;,</span><br><span class="line">    rules: &#123;</span><br><span class="line">      type: Object,</span><br><span class="line">      default: () =&gt; (&#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    validate(callback) &#123;</span><br><span class="line">      // è¡¨å•éªŒè¯é€»è¾‘</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- components/form-item/index.vue --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;CustomFormItem&#x27;,</span><br><span class="line">  inject: [&#x27;form&#x27;],</span><br><span class="line">  props: &#123;</span><br><span class="line">    label: String,</span><br><span class="line">    prop: String</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    if (this.prop) &#123;</span><br><span class="line">      this.form.fields.push(this)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="3-è·¨ç«¯é€‚é…"><a href="#3-è·¨ç«¯é€‚é…" class="headerlink" title="3. è·¨ç«¯é€‚é…"></a>3. è·¨ç«¯é€‚é…</h2><h3 id="3-1-æ¡ä»¶ç¼–è¯‘"><a href="#3-1-æ¡ä»¶ç¼–è¯‘" class="headerlink" title="3.1 æ¡ä»¶ç¼–è¯‘"></a>3.1 æ¡ä»¶ç¼–è¯‘</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;custom-input&quot;&gt;</span><br><span class="line">    &lt;!-- #ifdef MP --&gt;</span><br><span class="line">    &lt;input </span><br><span class="line">      :value=&quot;value&quot;</span><br><span class="line">      :type=&quot;type&quot;</span><br><span class="line">      :password=&quot;password&quot;</span><br><span class="line">      :placeholder=&quot;placeholder&quot;</span><br><span class="line">      :disabled=&quot;disabled&quot;</span><br><span class="line">      :maxlength=&quot;maxlength&quot;</span><br><span class="line">      @input=&quot;handleInput&quot;</span><br><span class="line">      @focus=&quot;handleFocus&quot;</span><br><span class="line">      @blur=&quot;handleBlur&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;!-- #endif --&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- #ifdef H5 --&gt;</span><br><span class="line">    &lt;input </span><br><span class="line">      v-model=&quot;inputValue&quot;</span><br><span class="line">      :type=&quot;type&quot;</span><br><span class="line">      :placeholder=&quot;placeholder&quot;</span><br><span class="line">      :disabled=&quot;disabled&quot;</span><br><span class="line">      :maxlength=&quot;maxlength&quot;</span><br><span class="line">      @focus=&quot;handleFocus&quot;</span><br><span class="line">      @blur=&quot;handleBlur&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;!-- #endif --&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;CustomInput&#x27;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    value: String,</span><br><span class="line">    type: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: &#x27;text&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    password: Boolean,</span><br><span class="line">    placeholder: String,</span><br><span class="line">    disabled: Boolean,</span><br><span class="line">    maxlength: &#123;</span><br><span class="line">      type: Number,</span><br><span class="line">      default: -1</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      inputValue: this.value</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    value(val) &#123;</span><br><span class="line">      this.inputValue = val</span><br><span class="line">    &#125;,</span><br><span class="line">    inputValue(val) &#123;</span><br><span class="line">      this.$emit(&#x27;input&#x27;, val)</span><br><span class="line">      this.$emit(&#x27;change&#x27;, val)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleInput(e) &#123;</span><br><span class="line">      // #ifdef MP</span><br><span class="line">      const value = e.detail.value</span><br><span class="line">      // #endif</span><br><span class="line">      </span><br><span class="line">      // #ifdef H5</span><br><span class="line">      const value = e.target.value</span><br><span class="line">      // #endif</span><br><span class="line">      </span><br><span class="line">      this.inputValue = value</span><br><span class="line">    &#125;,</span><br><span class="line">    handleFocus(e) &#123;</span><br><span class="line">      this.$emit(&#x27;focus&#x27;, e)</span><br><span class="line">    &#125;,</span><br><span class="line">    handleBlur(e) &#123;</span><br><span class="line">      this.$emit(&#x27;blur&#x27;, e)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="3-2-æ ·å¼é€‚é…"><a href="#3-2-æ ·å¼é€‚é…" class="headerlink" title="3.2 æ ·å¼é€‚é…"></a>3.2 æ ·å¼é€‚é…</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* styles/mixins.scss */</span></span><br><span class="line"><span class="comment">// 1pxè¾¹æ¡†</span></span><br><span class="line"><span class="keyword">@mixin</span> hairline(<span class="variable">$position</span>: bottom, <span class="variable">$color</span>: <span class="number">#dcdfe6</span>) &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  </span><br><span class="line">  &amp;<span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    #&#123;<span class="variable">$position</span>&#125;: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="variable">$color</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scaleY</span>(<span class="number">0.5</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// #ifdef H5</span></span><br><span class="line">    <span class="keyword">@media</span> (<span class="attribute">-webkit-min-device-pixel-ratio</span>: <span class="number">2</span>) &#123;</span><br><span class="line">      <span class="attribute">transform</span>: <span class="built_in">scaleY</span>(<span class="number">0.5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®‰å…¨åŒºåŸŸ</span></span><br><span class="line"><span class="keyword">@mixin</span> safe-area(<span class="variable">$position</span>: bottom) &#123;</span><br><span class="line">  <span class="comment">// #ifdef H5</span></span><br><span class="line">  <span class="attribute">padding</span>-#&#123;<span class="variable">$position</span>&#125;: <span class="built_in">constant</span>(safe-area-inset-#&#123;<span class="variable">$position</span>&#125;);</span><br><span class="line">  <span class="attribute">padding</span>-#&#123;<span class="variable">$position</span>&#125;: <span class="built_in">env</span>(safe-area-inset-#&#123;<span class="variable">$position</span>&#125;);</span><br><span class="line">  <span class="comment">// #endif</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// #ifdef MP</span></span><br><span class="line">  <span class="attribute">padding</span>-#&#123;<span class="variable">$position</span>&#125;: <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// #endif</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-ç»„ä»¶ä¼˜åŒ–"><a href="#4-ç»„ä»¶ä¼˜åŒ–" class="headerlink" title="4. ç»„ä»¶ä¼˜åŒ–"></a>4. ç»„ä»¶ä¼˜åŒ–</h2><h3 id="4-1-æ€§èƒ½ä¼˜åŒ–"><a href="#4-1-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="4.1 æ€§èƒ½ä¼˜åŒ–"></a>4.1 æ€§èƒ½ä¼˜åŒ–</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;CustomList&#x27;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    list: Array</span><br><span class="line">  &#125;,</span><br><span class="line">  // é¿å…ä¸å¿…è¦çš„æ›´æ–°</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      renderList: this.list.map(item =&gt; (&#123;</span><br><span class="line">        ...item,</span><br><span class="line">        _id: item.id</span><br><span class="line">      &#125;))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    list: &#123;</span><br><span class="line">      handler(val) &#123;</span><br><span class="line">        this.renderList = val.map(item =&gt; (&#123;</span><br><span class="line">          ...item,</span><br><span class="line">          _id: item.id</span><br><span class="line">        &#125;))</span><br><span class="line">      &#125;,</span><br><span class="line">      deep: true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="4-2-ä½“éªŒä¼˜åŒ–"><a href="#4-2-ä½“éªŒä¼˜åŒ–" class="headerlink" title="4.2 ä½“éªŒä¼˜åŒ–"></a>4.2 ä½“éªŒä¼˜åŒ–</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;custom-image&quot; :style=&quot;imageStyle&quot;&gt;</span><br><span class="line">    &lt;image</span><br><span class="line">      :src=&quot;src&quot;</span><br><span class="line">      :mode=&quot;mode&quot;</span><br><span class="line">      :lazy-load=&quot;lazyLoad&quot;</span><br><span class="line">      @load=&quot;handleLoad&quot;</span><br><span class="line">      @error=&quot;handleError&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;view v-if=&quot;loading&quot; class=&quot;custom-image__loading&quot;&gt;</span><br><span class="line">      &lt;text class=&quot;custom-image__loading-text&quot;&gt;åŠ è½½ä¸­...&lt;/text&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">    &lt;view v-if=&quot;error&quot; class=&quot;custom-image__error&quot;&gt;</span><br><span class="line">      &lt;text class=&quot;custom-image__error-text&quot;&gt;åŠ è½½å¤±è´¥&lt;/text&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;CustomImage&#x27;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    src: String,</span><br><span class="line">    mode: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: &#x27;aspectFill&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    width: &#123;</span><br><span class="line">      type: [String, Number],</span><br><span class="line">      default: &#x27;100%&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    height: &#123;</span><br><span class="line">      type: [String, Number],</span><br><span class="line">      default: &#x27;100%&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    lazyLoad: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">      default: true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      loading: true,</span><br><span class="line">      error: false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    imageStyle() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        width: typeof this.width === &#x27;number&#x27; ? `$&#123;this.width&#125;rpx` : this.width,</span><br><span class="line">        height: typeof this.height === &#x27;number&#x27; ? `$&#123;this.height&#125;rpx` : this.height</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleLoad(e) &#123;</span><br><span class="line">      this.loading = false</span><br><span class="line">      this.$emit(&#x27;load&#x27;, e)</span><br><span class="line">    &#125;,</span><br><span class="line">    handleError(e) &#123;</span><br><span class="line">      this.loading = false</span><br><span class="line">      this.error = true</span><br><span class="line">      this.$emit(&#x27;error&#x27;, e)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="5-æœ€ä½³å®è·µå»ºè®®"><a href="#5-æœ€ä½³å®è·µå»ºè®®" class="headerlink" title="5. æœ€ä½³å®è·µå»ºè®®"></a>5. æœ€ä½³å®è·µå»ºè®®</h2><ol><li>ç»„ä»¶å‘½åè§„èŒƒ</li><li>åˆç†çš„ç›®å½•ç»“æ„</li><li>å®Œå–„çš„æ–‡æ¡£è¯´æ˜</li><li>ç»Ÿä¸€çš„æ ·å¼è§„èŒƒ</li><li>åšå¥½è·¨ç«¯é€‚é…</li></ol><h2 id="6-æ€»ç»“"><a href="#6-æ€»ç»“" class="headerlink" title="6. æ€»ç»“"></a>6. æ€»ç»“</h2><ol><li>æŒæ¡ç»„ä»¶å¼€å‘åŸºç¡€</li><li>å®ç°ç»„ä»¶é€šä¿¡</li><li>å¤„ç†è·¨ç«¯é€‚é…</li><li>ä¼˜åŒ–ç»„ä»¶æ€§èƒ½</li><li>æå‡ç”¨æˆ·ä½“éªŒ</li></ol><hr><blockquote><p>å¦‚æœè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©,æ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«,ä½ çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼ </p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/uni-app/">uni-app</category>
      
      
      <category domain="https://www.hzv5.cn/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/tags/uni-app/">uni-app</category>
      
      <category domain="https://www.hzv5.cn/tags/%E7%BB%84%E4%BB%B6%E5%BC%80%E5%8F%91/">ç»„ä»¶å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/tags/UI%E7%BB%84%E4%BB%B6/">UIç»„ä»¶</category>
      
      
      <comments>https://www.hzv5.cn/2024/03/30/uniapp-component/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>uni-appç½‘ç»œè¯·æ±‚ä¸ç¼“å­˜ç­–ç•¥ï¼šæ„å»ºé«˜æ•ˆçš„æ•°æ®å±‚</title>
      <link>https://www.hzv5.cn/2024/03/25/uniapp-network/</link>
      <guid>https://www.hzv5.cn/2024/03/25/uniapp-network/</guid>
      <pubDate>Mon, 25 Mar 2024 07:20:00 GMT</pubDate>
      
      <description>æ·±å…¥æ¢è®¨uni-appä¸­çš„ç½‘ç»œè¯·æ±‚ä¸æ•°æ®ç¼“å­˜æ–¹æ¡ˆ,åŒ…æ‹¬è¯·æ±‚å°è£…ã€æ‹¦æˆªå™¨é…ç½®ã€æ•°æ®ç¼“å­˜ç­–ç•¥ç­‰å†…å®¹,å¸®åŠ©å¼€å‘è€…æ„å»ºå¯é çš„æ•°æ®å±‚ã€‚</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>ç½‘ç»œè¯·æ±‚å’Œæ•°æ®ç¼“å­˜æ˜¯åº”ç”¨å¼€å‘ä¸­çš„å…³é”®ç¯èŠ‚,æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨uni-appä¸­æ„å»ºé«˜æ•ˆå¯é çš„æ•°æ®å±‚ã€‚</p></blockquote><span id="more"></span><h2 id="1-ç½‘ç»œè¯·æ±‚å°è£…"><a href="#1-ç½‘ç»œè¯·æ±‚å°è£…" class="headerlink" title="1. ç½‘ç»œè¯·æ±‚å°è£…"></a>1. ç½‘ç»œè¯·æ±‚å°è£…</h2><h3 id="1-1-åŸºç¡€è¯·æ±‚ç±»"><a href="#1-1-åŸºç¡€è¯·æ±‚ç±»" class="headerlink" title="1.1 åŸºç¡€è¯·æ±‚ç±»"></a>1.1 åŸºç¡€è¯·æ±‚ç±»</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/request.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Request</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">baseURL</span> = options.<span class="property">baseURL</span> || <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">timeout</span> = options.<span class="property">timeout</span> || <span class="number">60000</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">header</span> = options.<span class="property">header</span> || &#123;&#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">beforeRequest</span> = options.<span class="property">beforeRequest</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">afterRequest</span> = options.<span class="property">afterRequest</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¯·æ±‚æ‹¦æˆª</span></span><br><span class="line">  <span class="title function_">beforeRequest</span>(<span class="params">config</span>) &#123;</span><br><span class="line">    <span class="comment">// æ·»åŠ token</span></span><br><span class="line">    <span class="keyword">const</span> token = uni.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">      config.<span class="property">header</span>.<span class="property">Authorization</span> = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å“åº”æ‹¦æˆª</span></span><br><span class="line">  <span class="title function_">afterRequest</span>(<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; statusCode, data &#125; = response</span><br><span class="line">    <span class="keyword">if</span> (statusCode &gt;= <span class="number">200</span> &amp;&amp; statusCode &lt; <span class="number">300</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> data</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(response)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¯·æ±‚æ–¹æ³•</span></span><br><span class="line">  <span class="title function_">request</span>(<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">    options.<span class="property">baseURL</span> = options.<span class="property">baseURL</span> || <span class="variable language_">this</span>.<span class="property">baseURL</span></span><br><span class="line">    options.<span class="property">timeout</span> = options.<span class="property">timeout</span> || <span class="variable language_">this</span>.<span class="property">timeout</span></span><br><span class="line">    options.<span class="property">header</span> = &#123; ...<span class="variable language_">this</span>.<span class="property">header</span>, ...options.<span class="property">header</span> &#125;</span><br><span class="line">    options.<span class="property">method</span> = options.<span class="property">method</span> || <span class="string">&#x27;GET&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯·æ±‚æ‹¦æˆª</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">beforeRequest</span>) &#123;</span><br><span class="line">      options = <span class="variable language_">this</span>.<span class="title function_">beforeRequest</span>(options)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">        ...options,</span><br><span class="line">        <span class="attr">url</span>: options.<span class="property">baseURL</span> + options.<span class="property">url</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// å“åº”æ‹¦æˆª</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">afterRequest</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="keyword">const</span> data = <span class="variable language_">this</span>.<span class="title function_">afterRequest</span>(res)</span><br><span class="line">              <span class="title function_">resolve</span>(data)</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">              <span class="title function_">reject</span>(error)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(res.<span class="property">data</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">fail</span>: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">reject</span>(err)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°è£…å¸¸ç”¨è¯·æ±‚æ–¹æ³•</span></span><br><span class="line">  <span class="title function_">get</span>(<span class="params">url, data = &#123;&#125;, options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(&#123;</span><br><span class="line">      url,</span><br><span class="line">      data,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">      ...options</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">post</span>(<span class="params">url, data = &#123;&#125;, options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(&#123;</span><br><span class="line">      url,</span><br><span class="line">      data,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">      ...options</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">put</span>(<span class="params">url, data = &#123;&#125;, options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(&#123;</span><br><span class="line">      url,</span><br><span class="line">      data,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;PUT&#x27;</span>,</span><br><span class="line">      ...options</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">delete</span>(<span class="params">url, data = &#123;&#125;, options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(&#123;</span><br><span class="line">      url,</span><br><span class="line">      data,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;DELETE&#x27;</span>,</span><br><span class="line">      ...options</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Request</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_BASE_API</span>,</span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">10000</span>,</span><br><span class="line">  <span class="attr">header</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="1-2-è¯·æ±‚æ‹¦æˆªå™¨"><a href="#1-2-è¯·æ±‚æ‹¦æˆªå™¨" class="headerlink" title="1.2 è¯·æ±‚æ‹¦æˆªå™¨"></a>1.2 è¯·æ±‚æ‹¦æˆªå™¨</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/interceptors.js</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯·æ±‚é˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">let</span> requestQueue = []</span><br><span class="line"><span class="comment">// æ˜¯å¦æ­£åœ¨åˆ·æ–°token</span></span><br><span class="line"><span class="keyword">let</span> isRefreshing = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">requestInterceptor</span> = (<span class="params">config</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// æ·»åŠ token</span></span><br><span class="line">  <span class="keyword">const</span> token = uni.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> (token) &#123;</span><br><span class="line">    config.<span class="property">header</span>.<span class="property">Authorization</span> = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">responseInterceptor</span> = <span class="keyword">async</span> (<span class="params">response</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; statusCode, data &#125; = response</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// tokenè¿‡æœŸå¤„ç†</span></span><br><span class="line">  <span class="keyword">if</span> (statusCode === <span class="number">401</span>) &#123;</span><br><span class="line">    <span class="comment">// å°†è¯·æ±‚æ·»åŠ åˆ°é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">const</span> retryRequest = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">      requestQueue.<span class="title function_">push</span>(<span class="function">(<span class="params">token</span>) =&gt;</span> &#123;</span><br><span class="line">        config.<span class="property">header</span>.<span class="property">Authorization</span> = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span></span><br><span class="line">        <span class="title function_">resolve</span>(request.<span class="title function_">request</span>(config))</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ˜¯å¦æ­£åœ¨åˆ·æ–°token</span></span><br><span class="line">    <span class="keyword">if</span> (!isRefreshing) &#123;</span><br><span class="line">      isRefreshing = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ·æ–°token</span></span><br><span class="line">        <span class="keyword">const</span> &#123; token &#125; = <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/refreshToken&#x27;</span>)</span><br><span class="line">        <span class="comment">// é‡è¯•é˜Ÿåˆ—ä¸­çš„è¯·æ±‚</span></span><br><span class="line">        requestQueue.<span class="title function_">forEach</span>(<span class="function"><span class="params">callback</span> =&gt;</span> <span class="title function_">callback</span>(token))</span><br><span class="line">        requestQueue = []</span><br><span class="line">        <span class="keyword">return</span> request.<span class="title function_">request</span>(config)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="comment">// åˆ·æ–°tokenå¤±è´¥,è·³è½¬ç™»å½•é¡µ</span></span><br><span class="line">        store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/logout&#x27;</span>)</span><br><span class="line">        uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">          <span class="attr">url</span>: <span class="string">&#x27;/pages/login/index&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        isRefreshing = <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> retryRequest</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-æ•°æ®ç¼“å­˜ç­–ç•¥"><a href="#2-æ•°æ®ç¼“å­˜ç­–ç•¥" class="headerlink" title="2. æ•°æ®ç¼“å­˜ç­–ç•¥"></a>2. æ•°æ®ç¼“å­˜ç­–ç•¥</h2><h3 id="2-1-ç¼“å­˜ç®¡ç†ç±»"><a href="#2-1-ç¼“å­˜ç®¡ç†ç±»" class="headerlink" title="2.1 ç¼“å­˜ç®¡ç†ç±»"></a>2.1 ç¼“å­˜ç®¡ç†ç±»</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/cache.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cache</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">prefix</span> = options.<span class="property">prefix</span> || <span class="string">&#x27;app_&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">expire</span> = options.<span class="property">expire</span> || <span class="number">0</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isEncrypt</span> = options.<span class="property">isEncrypt</span> || <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¾ç½®ç¼“å­˜</span></span><br><span class="line">  <span class="title function_">setItem</span>(<span class="params">key, value, expire = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">      value,</span><br><span class="line">      <span class="attr">time</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">      <span class="attr">expire</span>: expire || <span class="variable language_">this</span>.<span class="property">expire</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŠ å¯†å¤„ç†</span></span><br><span class="line">    <span class="keyword">const</span> stringData = <span class="variable language_">this</span>.<span class="property">isEncrypt</span> </span><br><span class="line">      ? <span class="variable language_">this</span>.<span class="title function_">encrypt</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))</span><br><span class="line">      : <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data)</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      uni.<span class="title function_">setStorageSync</span>(<span class="variable language_">this</span>.<span class="property">prefix</span> + key, stringData)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;ç¼“å­˜è®¾ç½®å¤±è´¥:&#x27;</span>, error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è·å–ç¼“å­˜</span></span><br><span class="line">  <span class="title function_">getItem</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> data = uni.<span class="title function_">getStorageSync</span>(<span class="variable language_">this</span>.<span class="property">prefix</span> + key)</span><br><span class="line">      <span class="keyword">if</span> (!data) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// è§£å¯†å¤„ç†</span></span><br><span class="line">      <span class="keyword">const</span> storage = <span class="variable language_">this</span>.<span class="property">isEncrypt</span> </span><br><span class="line">        ? <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="title function_">decrypt</span>(data))</span><br><span class="line">        : <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data)</span><br><span class="line">        </span><br><span class="line">      <span class="comment">// è¿‡æœŸåˆ¤æ–­</span></span><br><span class="line">      <span class="keyword">if</span> (storage.<span class="property">expire</span> &amp;&amp; <span class="title class_">Date</span>.<span class="title function_">now</span>() - storage.<span class="property">time</span> &gt; storage.<span class="property">expire</span> * <span class="number">1000</span>) &#123;</span><br><span class="line">        uni.<span class="title function_">removeStorageSync</span>(<span class="variable language_">this</span>.<span class="property">prefix</span> + key)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> storage.<span class="property">value</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;ç¼“å­˜è·å–å¤±è´¥:&#x27;</span>, error)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç§»é™¤ç¼“å­˜</span></span><br><span class="line">  <span class="title function_">removeItem</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      uni.<span class="title function_">removeStorageSync</span>(<span class="variable language_">this</span>.<span class="property">prefix</span> + key)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;ç¼“å­˜ç§»é™¤å¤±è´¥:&#x27;</span>, error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¸…ç©ºç¼“å­˜</span></span><br><span class="line">  <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      uni.<span class="title function_">clearStorageSync</span>()</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;ç¼“å­˜æ¸…ç©ºå¤±è´¥:&#x27;</span>, error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åŠ å¯†æ–¹æ³•</span></span><br><span class="line">  <span class="title function_">encrypt</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="comment">// å®ç°åŠ å¯†é€»è¾‘</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è§£å¯†æ–¹æ³•</span></span><br><span class="line">  <span class="title function_">decrypt</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="comment">// å®ç°è§£å¯†é€»è¾‘</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Cache</span>(&#123;</span><br><span class="line">  <span class="attr">prefix</span>: <span class="string">&#x27;app_&#x27;</span>,</span><br><span class="line">  <span class="attr">expire</span>: <span class="number">7</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>, <span class="comment">// é»˜è®¤7å¤©è¿‡æœŸ</span></span><br><span class="line">  <span class="attr">isEncrypt</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span> <span class="comment">// ç”Ÿäº§ç¯å¢ƒå¼€å¯åŠ å¯†</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="2-2-æ•°æ®é¢„åŠ è½½"><a href="#2-2-æ•°æ®é¢„åŠ è½½" class="headerlink" title="2.2 æ•°æ®é¢„åŠ è½½"></a>2.2 æ•°æ®é¢„åŠ è½½</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/preload.js</span></span><br><span class="line"><span class="keyword">import</span> cache <span class="keyword">from</span> <span class="string">&#x27;./cache&#x27;</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;./request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Preload</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">tasks</span> = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ·»åŠ é¢„åŠ è½½ä»»åŠ¡</span></span><br><span class="line">  <span class="title function_">add</span>(<span class="params">key, promiseCreator</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">tasks</span>.<span class="title function_">has</span>(key)) &#123;</span><br><span class="line">      <span class="keyword">const</span> task = <span class="title function_">promiseCreator</span>().<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        cache.<span class="title function_">setItem</span>(key, data)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">tasks</span>.<span class="title function_">set</span>(key, task)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">tasks</span>.<span class="title function_">get</span>(key)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è·å–é¢„åŠ è½½æ•°æ®</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">get</span>(<span class="params">key, promiseCreator</span>) &#123;</span><br><span class="line">    <span class="comment">// ä¼˜å…ˆä»ç¼“å­˜è·å–</span></span><br><span class="line">    <span class="keyword">const</span> cached = cache.<span class="title function_">getItem</span>(key)</span><br><span class="line">    <span class="keyword">if</span> (cached) <span class="keyword">return</span> cached</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…¶æ¬¡ä»é¢„åŠ è½½ä»»åŠ¡è·å–</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">tasks</span>.<span class="title function_">has</span>(key)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">tasks</span>.<span class="title function_">get</span>(key)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æœ€åå®æ—¶åŠ è½½</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">add</span>(key, promiseCreator)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¸…é™¤é¢„åŠ è½½ä»»åŠ¡</span></span><br><span class="line">  <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">tasks</span>.<span class="title function_">clear</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Preload</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">const</span> preload = <span class="keyword">new</span> <span class="title class_">Preload</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¢„åŠ è½½æ•°æ®</span></span><br><span class="line">preload.<span class="title function_">add</span>(<span class="string">&#x27;userInfo&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/api/user/info&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ•°æ®</span></span><br><span class="line"><span class="keyword">const</span> userInfo = <span class="keyword">await</span> preload.<span class="title function_">get</span>(<span class="string">&#x27;userInfo&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/api/user/info&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="3-å®é™…åº”ç”¨ç¤ºä¾‹"><a href="#3-å®é™…åº”ç”¨ç¤ºä¾‹" class="headerlink" title="3. å®é™…åº”ç”¨ç¤ºä¾‹"></a>3. å®é™…åº”ç”¨ç¤ºä¾‹</h2><h3 id="3-1-APIå°è£…"><a href="#3-1-APIå°è£…" class="headerlink" title="3.1 APIå°è£…"></a>3.1 APIå°è£…</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// api/user.js</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"><span class="keyword">import</span> cache <span class="keyword">from</span> <span class="string">&#x27;@/utils/cache&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">login</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">post</span>(<span class="string">&#x27;/api/login&#x27;</span>, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getUserInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> cache.<span class="title function_">remember</span>(<span class="string">&#x27;user_info&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/api/user/info&#x27;</span>)</span><br><span class="line">  &#125;, <span class="number">30</span> * <span class="number">60</span>) <span class="comment">// ç¼“å­˜30åˆ†é’Ÿ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">updateUserInfo</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">put</span>(<span class="string">&#x27;/api/user/info&#x27;</span>, data).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æ›´æ–°åæ¸…é™¤ç¼“å­˜</span></span><br><span class="line">    cache.<span class="title function_">removeItem</span>(<span class="string">&#x27;user_info&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-æ•°æ®é¢„åŠ è½½"><a href="#3-2-æ•°æ®é¢„åŠ è½½" class="headerlink" title="3.2 æ•°æ®é¢„åŠ è½½"></a>3.2 æ•°æ®é¢„åŠ è½½</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/index/index.vue</span></span><br><span class="line"><span class="keyword">import</span> preload <span class="keyword">from</span> <span class="string">&#x27;@/utils/preload&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// é¢„åŠ è½½ä¸‹ä¸€é¡µæ•°æ®</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">preloadNextPage</span>()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">preloadNextPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> nextPage = <span class="variable language_">this</span>.<span class="property">currentPage</span> + <span class="number">1</span></span><br><span class="line">      preload.<span class="title function_">add</span>(<span class="string">`list_page_<span class="subst">$&#123;nextPage&#125;</span>`</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/api/list&#x27;</span>, &#123;</span><br><span class="line">          <span class="attr">page</span>: nextPage,</span><br><span class="line">          <span class="attr">size</span>: <span class="number">10</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">loadNextPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> nextPage = <span class="variable language_">this</span>.<span class="property">currentPage</span> + <span class="number">1</span></span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">await</span> preload.<span class="title function_">get</span>(<span class="string">`list_page_<span class="subst">$&#123;nextPage&#125;</span>`</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/api/list&#x27;</span>, &#123;</span><br><span class="line">          <span class="attr">page</span>: nextPage,</span><br><span class="line">          <span class="attr">size</span>: <span class="number">10</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">push</span>(...data.<span class="property">list</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">currentPage</span> = nextPage</span><br><span class="line">      <span class="comment">// ç»§ç»­é¢„åŠ è½½ä¸‹ä¸€é¡µ</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">preloadNextPage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-æœ€ä½³å®è·µå»ºè®®"><a href="#4-æœ€ä½³å®è·µå»ºè®®" class="headerlink" title="4. æœ€ä½³å®è·µå»ºè®®"></a>4. æœ€ä½³å®è·µå»ºè®®</h2><ol><li>ç»Ÿä¸€å°è£…è¯·æ±‚æ–¹æ³•</li><li>å®ç°è¯·æ±‚æ‹¦æˆªå’Œå“åº”æ‹¦æˆª</li><li>åˆç†ä½¿ç”¨æ•°æ®ç¼“å­˜</li><li>å®ç°æ•°æ®é¢„åŠ è½½</li><li>æ³¨æ„å®‰å…¨æ€§å¤„ç†</li></ol><h2 id="5-æ€»ç»“"><a href="#5-æ€»ç»“" class="headerlink" title="5. æ€»ç»“"></a>5. æ€»ç»“</h2><ol><li>æŒæ¡è¯·æ±‚å°è£…æŠ€å·§</li><li>å®ç°æ•°æ®ç¼“å­˜ç­–ç•¥</li><li>ä¼˜åŒ–æ•°æ®åŠ è½½ä½“éªŒ</li><li>å¤„ç†å¼‚å¸¸æƒ…å†µ</li><li>ä¿è¯æ•°æ®å®‰å…¨æ€§</li></ol><hr><blockquote><p>å¦‚æœè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©,æ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«,ä½ çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼ </p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/uni-app/">uni-app</category>
      
      
      <category domain="https://www.hzv5.cn/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/tags/uni-app/">uni-app</category>
      
      <category domain="https://www.hzv5.cn/tags/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/">ç½‘ç»œè¯·æ±‚</category>
      
      <category domain="https://www.hzv5.cn/tags/%E6%95%B0%E6%8D%AE%E7%BC%93%E5%AD%98/">æ•°æ®ç¼“å­˜</category>
      
      
      <comments>https://www.hzv5.cn/2024/03/25/uniapp-network/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>uni-appçŠ¶æ€ç®¡ç†è¿›é˜¶ï¼šVuexæœ€ä½³å®è·µä¸æ€§èƒ½ä¼˜åŒ–</title>
      <link>https://www.hzv5.cn/2024/03/20/uniapp-state-management/</link>
      <guid>https://www.hzv5.cn/2024/03/20/uniapp-state-management/</guid>
      <pubDate>Wed, 20 Mar 2024 08:45:00 GMT</pubDate>
      
      <description>æ·±å…¥æ¢è®¨uni-appä¸­çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ,åŒ…æ‹¬Vuexçš„æœ€ä½³å®è·µã€æ•°æ®æŒä¹…åŒ–ã€æ€§èƒ½ä¼˜åŒ–ç­‰å†…å®¹,å¸®åŠ©å¼€å‘è€…æ„å»ºå¯ç»´æŠ¤çš„æ•°æ®æµæ–¹æ¡ˆã€‚</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>çŠ¶æ€ç®¡ç†æ˜¯uni-appåº”ç”¨å¼€å‘ä¸­çš„é‡è¦ç¯èŠ‚,æœ¬æ–‡å°†æ·±å…¥ä»‹ç»Vuexåœ¨uni-appä¸­çš„åº”ç”¨,ä»¥åŠå¦‚ä½•æ„å»ºé«˜æ•ˆçš„æ•°æ®æµæ–¹æ¡ˆã€‚</p></blockquote><span id="more"></span><h2 id="1-VuexåŸºç¡€é…ç½®"><a href="#1-VuexåŸºç¡€é…ç½®" class="headerlink" title="1. VuexåŸºç¡€é…ç½®"></a>1. VuexåŸºç¡€é…ç½®</h2><h3 id="1-1-ç›®å½•ç»“æ„"><a href="#1-1-ç›®å½•ç»“æ„" class="headerlink" title="1.1 ç›®å½•ç»“æ„"></a>1.1 ç›®å½•ç»“æ„</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">store</span><br><span class="line">â”œâ”€â”€ index.js          <span class="comment"># å…¥å£æ–‡ä»¶</span></span><br><span class="line">â”œâ”€â”€ state.js          <span class="comment"># æ ¹çº§åˆ«çš„state</span></span><br><span class="line">â”œâ”€â”€ mutations.js      <span class="comment"># æ ¹çº§åˆ«çš„mutations</span></span><br><span class="line">â”œâ”€â”€ actions.js        <span class="comment"># æ ¹çº§åˆ«çš„actions</span></span><br><span class="line">â”œâ”€â”€ getters.js        <span class="comment"># æ ¹çº§åˆ«çš„getters</span></span><br><span class="line">â””â”€â”€ modules          <span class="comment"># æ¨¡å—ç›®å½•</span></span><br><span class="line">    â”œâ”€â”€ user.js      <span class="comment"># ç”¨æˆ·æ¨¡å—</span></span><br><span class="line">    â”œâ”€â”€ cart.js      <span class="comment"># è´­ç‰©è½¦æ¨¡å—</span></span><br><span class="line">    â””â”€â”€ order.js     <span class="comment"># è®¢å•æ¨¡å—</span></span><br></pre></td></tr></table></figure><h3 id="1-2-åŸºç¡€é…ç½®"><a href="#1-2-åŸºç¡€é…ç½®" class="headerlink" title="1.2 åŸºç¡€é…ç½®"></a>1.2 åŸºç¡€é…ç½®</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> state <span class="keyword">from</span> <span class="string">&#x27;./state&#x27;</span></span><br><span class="line"><span class="keyword">import</span> mutations <span class="keyword">from</span> <span class="string">&#x27;./mutations&#x27;</span></span><br><span class="line"><span class="keyword">import</span> actions <span class="keyword">from</span> <span class="string">&#x27;./actions&#x27;</span></span><br><span class="line"><span class="keyword">import</span> getters <span class="keyword">from</span> <span class="string">&#x27;./getters&#x27;</span></span><br><span class="line"><span class="keyword">import</span> user <span class="keyword">from</span> <span class="string">&#x27;./modules/user&#x27;</span></span><br><span class="line"><span class="keyword">import</span> cart <span class="keyword">from</span> <span class="string">&#x27;./modules/cart&#x27;</span></span><br><span class="line"><span class="keyword">import</span> order <span class="keyword">from</span> <span class="string">&#x27;./modules/order&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  state,</span><br><span class="line">  mutations,</span><br><span class="line">  actions,</span><br><span class="line">  getters,</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">    user,</span><br><span class="line">    cart,</span><br><span class="line">    order</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">strict</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure><h2 id="2-æ¨¡å—åŒ–è®¾è®¡"><a href="#2-æ¨¡å—åŒ–è®¾è®¡" class="headerlink" title="2. æ¨¡å—åŒ–è®¾è®¡"></a>2. æ¨¡å—åŒ–è®¾è®¡</h2><h3 id="2-1-ç”¨æˆ·æ¨¡å—"><a href="#2-1-ç”¨æˆ·æ¨¡å—" class="headerlink" title="2.1 ç”¨æˆ·æ¨¡å—"></a>2.1 ç”¨æˆ·æ¨¡å—</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/modules/user.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; login, getUserInfo, updateUserInfo &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/user&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">token</span>: uni.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;token&#x27;</span>) || <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">userInfo</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">permissions</span>: []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  <span class="title function_">SET_TOKEN</span>(<span class="params">state, token</span>) &#123;</span><br><span class="line">    state.<span class="property">token</span> = token</span><br><span class="line">    uni.<span class="title function_">setStorageSync</span>(<span class="string">&#x27;token&#x27;</span>, token)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">SET_USER_INFO</span>(<span class="params">state, info</span>) &#123;</span><br><span class="line">    state.<span class="property">userInfo</span> = info</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">SET_PERMISSIONS</span>(<span class="params">state, permissions</span>) &#123;</span><br><span class="line">    state.<span class="property">permissions</span> = permissions</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">CLEAR_USER_DATA</span>(<span class="params">state</span>) &#123;</span><br><span class="line">    state.<span class="property">token</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    state.<span class="property">userInfo</span> = <span class="literal">null</span></span><br><span class="line">    state.<span class="property">permissions</span> = []</span><br><span class="line">    uni.<span class="title function_">removeStorageSync</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="comment">// ç™»å½•</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">login</span>(<span class="params">&#123; commit &#125;, params</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; token &#125; = <span class="keyword">await</span> <span class="title function_">login</span>(params)</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;SET_TOKEN&#x27;</span>, token)</span><br><span class="line">      <span class="keyword">return</span> token</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;ç™»å½•å¤±è´¥&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è·å–ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getUserInfo</span>(<span class="params">&#123; commit &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; userInfo, permissions &#125; = <span class="keyword">await</span> <span class="title function_">getUserInfo</span>()</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;SET_USER_INFO&#x27;</span>, userInfo)</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;SET_PERMISSIONS&#x27;</span>, permissions)</span><br><span class="line">      <span class="keyword">return</span> userInfo</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ›´æ–°ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">updateUserInfo</span>(<span class="params">&#123; commit &#125;, params</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> info = <span class="keyword">await</span> <span class="title function_">updateUserInfo</span>(params)</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;SET_USER_INFO&#x27;</span>, info)</span><br><span class="line">      <span class="keyword">return</span> info</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;æ›´æ–°ç”¨æˆ·ä¿¡æ¯å¤±è´¥&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// é€€å‡ºç™»å½•</span></span><br><span class="line">  <span class="title function_">logout</span>(<span class="params">&#123; commit &#125;</span>) &#123;</span><br><span class="line">    <span class="title function_">commit</span>(<span class="string">&#x27;CLEAR_USER_DATA&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">  <span class="attr">isLogin</span>: <span class="function"><span class="params">state</span> =&gt;</span> !!state.<span class="property">token</span>,</span><br><span class="line">  <span class="attr">userInfo</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">userInfo</span> || &#123;&#125;,</span><br><span class="line">  <span class="attr">permissions</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">permissions</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  state,</span><br><span class="line">  mutations,</span><br><span class="line">  actions,</span><br><span class="line">  getters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-è´­ç‰©è½¦æ¨¡å—"><a href="#2-2-è´­ç‰©è½¦æ¨¡å—" class="headerlink" title="2.2 è´­ç‰©è½¦æ¨¡å—"></a>2.2 è´­ç‰©è½¦æ¨¡å—</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/modules/cart.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; getCartList, updateCart, removeFromCart &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/cart&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">cartList</span>: [],</span><br><span class="line">  <span class="attr">selectedIds</span>: []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  <span class="title function_">SET_CART_LIST</span>(<span class="params">state, list</span>) &#123;</span><br><span class="line">    state.<span class="property">cartList</span> = list</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">UPDATE_CART_ITEM</span>(<span class="params">state, &#123; id, data &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> index = state.<span class="property">cartList</span>.<span class="title function_">findIndex</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">id</span> === id)</span><br><span class="line">    <span class="keyword">if</span> (index &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">      state.<span class="property">cartList</span>[index] = &#123; ...state.<span class="property">cartList</span>[index], ...data &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">REMOVE_CART_ITEM</span>(<span class="params">state, id</span>) &#123;</span><br><span class="line">    state.<span class="property">cartList</span> = state.<span class="property">cartList</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">id</span> !== id)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">SET_SELECTED_IDS</span>(<span class="params">state, ids</span>) &#123;</span><br><span class="line">    state.<span class="property">selectedIds</span> = ids</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="comment">// è·å–è´­ç‰©è½¦åˆ—è¡¨</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getCartList</span>(<span class="params">&#123; commit &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> list = <span class="keyword">await</span> <span class="title function_">getCartList</span>()</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;SET_CART_LIST&#x27;</span>, list)</span><br><span class="line">      <span class="keyword">return</span> list</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;è·å–è´­ç‰©è½¦åˆ—è¡¨å¤±è´¥&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ›´æ–°è´­ç‰©è½¦å•†å“</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">updateCartItem</span>(<span class="params">&#123; commit &#125;, &#123; id, data &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">updateCart</span>(id, data)</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;UPDATE_CART_ITEM&#x27;</span>, &#123; id, data &#125;)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;æ›´æ–°è´­ç‰©è½¦å•†å“å¤±è´¥&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆ é™¤è´­ç‰©è½¦å•†å“</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">removeCartItem</span>(<span class="params">&#123; commit &#125;, id</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">removeFromCart</span>(id)</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;REMOVE_CART_ITEM&#x27;</span>, id)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;åˆ é™¤è´­ç‰©è½¦å•†å“å¤±è´¥&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">  <span class="attr">cartCount</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">cartList</span>.<span class="property">length</span>,</span><br><span class="line">  <span class="attr">selectedCount</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">selectedIds</span>.<span class="property">length</span>,</span><br><span class="line">  <span class="attr">totalPrice</span>: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> state.<span class="property">cartList</span></span><br><span class="line">      .<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> state.<span class="property">selectedIds</span>.<span class="title function_">includes</span>(item.<span class="property">id</span>))</span><br><span class="line">      .<span class="title function_">reduce</span>(<span class="function">(<span class="params">total, item</span>) =&gt;</span> total + item.<span class="property">price</span> * item.<span class="property">quantity</span>, <span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  state,</span><br><span class="line">  mutations,</span><br><span class="line">  actions,</span><br><span class="line">  getters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-æ•°æ®æŒä¹…åŒ–"><a href="#3-æ•°æ®æŒä¹…åŒ–" class="headerlink" title="3. æ•°æ®æŒä¹…åŒ–"></a>3. æ•°æ®æŒä¹…åŒ–</h2><h3 id="3-1-æ’ä»¶å°è£…"><a href="#3-1-æ’ä»¶å°è£…" class="headerlink" title="3.1 æ’ä»¶å°è£…"></a>3.1 æ’ä»¶å°è£…</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/plugins/persist.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">STORAGE_KEY</span> = <span class="string">&#x27;vuex_storage&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">createPersistPlugin</span>(<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    key = <span class="variable constant_">STORAGE_KEY</span>,</span><br><span class="line">    paths = [],</span><br><span class="line">    storage = uni.<span class="property">getStorageSync</span></span><br><span class="line">  &#125; = options</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è·å–æŒä¹…åŒ–æ•°æ®</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">getState</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> data = <span class="title function_">storage</span>(key)</span><br><span class="line">      <span class="keyword">return</span> data ? <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data) : &#123;&#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;è·å–æŒä¹…åŒ–æ•°æ®å¤±è´¥:&#x27;</span>, err)</span><br><span class="line">      <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è®¾ç½®æŒä¹…åŒ–æ•°æ®</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">setState</span> = (<span class="params">state, paths</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> data = paths.<span class="property">length</span></span><br><span class="line">        ? paths.<span class="title function_">reduce</span>(<span class="function">(<span class="params">obj, path</span>) =&gt;</span> &#123;</span><br><span class="line">            obj[path] = state[path]</span><br><span class="line">            <span class="keyword">return</span> obj</span><br><span class="line">          &#125;, &#123;&#125;)</span><br><span class="line">        : state</span><br><span class="line">      <span class="title function_">storage</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;è®¾ç½®æŒä¹…åŒ–æ•°æ®å¤±è´¥:&#x27;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">store</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æ—¶è·å–æŒä¹…åŒ–æ•°æ®</span></span><br><span class="line">    <span class="keyword">const</span> data = <span class="title function_">getState</span>()</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="title function_">keys</span>(data).<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      store.<span class="title function_">replaceState</span>(&#123;</span><br><span class="line">        ...store.<span class="property">state</span>,</span><br><span class="line">        ...data</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç›‘å¬æ•°æ®å˜åŒ–</span></span><br><span class="line">    store.<span class="title function_">subscribe</span>(<span class="function">(<span class="params">mutation, state</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setState</span>(state, paths)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-ä½¿ç”¨æ’ä»¶"><a href="#3-2-ä½¿ç”¨æ’ä»¶" class="headerlink" title="3.2 ä½¿ç”¨æ’ä»¶"></a>3.2 ä½¿ç”¨æ’ä»¶</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/index.js</span></span><br><span class="line"><span class="keyword">import</span> createPersistPlugin <span class="keyword">from</span> <span class="string">&#x27;./plugins/persist&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> persistPlugin = <span class="title function_">createPersistPlugin</span>(&#123;</span><br><span class="line">  <span class="attr">paths</span>: [<span class="string">&#x27;user.token&#x27;</span>, <span class="string">&#x27;user.userInfo&#x27;</span>, <span class="string">&#x27;cart.cartList&#x27;</span>],</span><br><span class="line">  <span class="attr">storage</span>: uni.<span class="property">setStorageSync</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="comment">// ...å…¶ä»–é…ç½®</span></span><br><span class="line">  <span class="attr">plugins</span>: [persistPlugin]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="4-æ€§èƒ½ä¼˜åŒ–"><a href="#4-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="4. æ€§èƒ½ä¼˜åŒ–"></a>4. æ€§èƒ½ä¼˜åŒ–</h2><h3 id="4-1-é¿å…é¢‘ç¹æ›´æ–°"><a href="#4-1-é¿å…é¢‘ç¹æ›´æ–°" class="headerlink" title="4.1 é¿å…é¢‘ç¹æ›´æ–°"></a>4.1 é¿å…é¢‘ç¹æ›´æ–°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/modules/cart.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; debounce &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/tools&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="comment">// ä½¿ç”¨é˜²æŠ–ä¼˜åŒ–æ›´æ–°</span></span><br><span class="line">  <span class="attr">updateCartItem</span>: <span class="title function_">debounce</span>(<span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">&#123; commit &#125;, &#123; id, data &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">updateCart</span>(id, data)</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;UPDATE_CART_ITEM&#x27;</span>, &#123; id, data &#125;)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;æ›´æ–°è´­ç‰©è½¦å•†å“å¤±è´¥&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">300</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-æ‰¹é‡æ›´æ–°"><a href="#4-2-æ‰¹é‡æ›´æ–°" class="headerlink" title="4.2 æ‰¹é‡æ›´æ–°"></a>4.2 æ‰¹é‡æ›´æ–°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/modules/cart.js</span></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="comment">// æ‰¹é‡æ›´æ–°è´­ç‰©è½¦</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">batchUpdateCart</span>(<span class="params">&#123; commit &#125;, items</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(items.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> <span class="title function_">updateCart</span>(item.<span class="property">id</span>, item.<span class="property">data</span>)))</span><br><span class="line">      items.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&#x27;UPDATE_CART_ITEM&#x27;</span>, item)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;æ‰¹é‡æ›´æ–°è´­ç‰©è½¦å¤±è´¥&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-è¾…åŠ©å‡½æ•°ä½¿ç”¨"><a href="#5-è¾…åŠ©å‡½æ•°ä½¿ç”¨" class="headerlink" title="5. è¾…åŠ©å‡½æ•°ä½¿ç”¨"></a>5. è¾…åŠ©å‡½æ•°ä½¿ç”¨</h2><h3 id="5-1-ç»„ä»¶ä¸­ä½¿ç”¨"><a href="#5-1-ç»„ä»¶ä¸­ä½¿ç”¨" class="headerlink" title="5.1 ç»„ä»¶ä¸­ä½¿ç”¨"></a>5.1 ç»„ä»¶ä¸­ä½¿ç”¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;cart&quot;&gt;</span><br><span class="line">    &lt;view class=&quot;total&quot;&gt;æ€»ä»·: ï¿¥&#123;&#123; totalPrice &#125;&#125;&lt;/view&gt;</span><br><span class="line">    &lt;view </span><br><span class="line">      v-for=&quot;item in cartList&quot;</span><br><span class="line">      :key=&quot;item.id&quot;</span><br><span class="line">      class=&quot;cart-item&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;text&gt;&#123;&#123; item.name &#125;&#125;&lt;/text&gt;</span><br><span class="line">      &lt;text&gt;ï¿¥&#123;&#123; item.price &#125;&#125;&lt;/text&gt;</span><br><span class="line">      &lt;button @click=&quot;updateQuantity(item.id, item.quantity + 1)&quot;&gt;+&lt;/button&gt;</span><br><span class="line">      &lt;text&gt;&#123;&#123; item.quantity &#125;&#125;&lt;/text&gt;</span><br><span class="line">      &lt;button @click=&quot;updateQuantity(item.id, item.quantity - 1)&quot;&gt;-&lt;/button&gt;</span><br><span class="line">      &lt;button @click=&quot;removeItem(item.id)&quot;&gt;åˆ é™¤&lt;/button&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; mapState, mapGetters, mapActions &#125; from &#x27;vuex&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  computed: &#123;</span><br><span class="line">    ...mapState(&#x27;cart&#x27;, [&#x27;cartList&#x27;]),</span><br><span class="line">    ...mapGetters(&#x27;cart&#x27;, [&#x27;totalPrice&#x27;])</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    ...mapActions(&#x27;cart&#x27;, [&#x27;updateCartItem&#x27;, &#x27;removeCartItem&#x27;]),</span><br><span class="line">    async updateQuantity(id, quantity) &#123;</span><br><span class="line">      if (quantity &lt; 1) return</span><br><span class="line">      try &#123;</span><br><span class="line">        await this.updateCartItem(&#123; id, data: &#123; quantity &#125; &#125;)</span><br><span class="line">        uni.showToast(&#123; title: &#x27;æ›´æ–°æˆåŠŸ&#x27; &#125;)</span><br><span class="line">      &#125; catch (err) &#123;</span><br><span class="line">        uni.showToast(&#123; title: err.message, icon: &#x27;none&#x27; &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    async removeItem(id) &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        await this.removeCartItem(id)</span><br><span class="line">        uni.showToast(&#123; title: &#x27;åˆ é™¤æˆåŠŸ&#x27; &#125;)</span><br><span class="line">      &#125; catch (err) &#123;</span><br><span class="line">        uni.showToast(&#123; title: err.message, icon: &#x27;none&#x27; &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="5-2-è‡ªå®šä¹‰è¾…åŠ©å‡½æ•°"><a href="#5-2-è‡ªå®šä¹‰è¾…åŠ©å‡½æ•°" class="headerlink" title="5.2 è‡ªå®šä¹‰è¾…åŠ©å‡½æ•°"></a>5.2 è‡ªå®šä¹‰è¾…åŠ©å‡½æ•°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/helpers.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">mapCache</span>(<span class="params">namespace, maps</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> res = &#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">normalizeMap</span>(maps).<span class="title function_">forEach</span>(<span class="function">(<span class="params">&#123; key, val &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    res[key] = <span class="keyword">function</span> <span class="title function_">mappedCache</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> store = <span class="variable language_">this</span>.<span class="property">$store</span></span><br><span class="line">      <span class="keyword">const</span> cache = store.<span class="property">_cache</span> || (store.<span class="property">_cache</span> = &#123;&#125;)</span><br><span class="line">      <span class="keyword">const</span> cacheKey = namespace + <span class="string">&#x27;:&#x27;</span> + key</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (cache[cacheKey]) &#123;</span><br><span class="line">        <span class="keyword">return</span> cache[cacheKey]</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">const</span> value = <span class="keyword">typeof</span> val === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">        ? val.<span class="title function_">call</span>(<span class="variable language_">this</span>, store.<span class="property">state</span>[namespace], store.<span class="property">getters</span>)</span><br><span class="line">        : store.<span class="property">state</span>[namespace][val]</span><br><span class="line">        </span><br><span class="line">      cache[cacheKey] = value</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeMap</span>(<span class="params">map</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">isArray</span>(map)</span><br><span class="line">    ? map.<span class="title function_">map</span>(<span class="function"><span class="params">key</span> =&gt;</span> (&#123; key, <span class="attr">val</span>: key &#125;))</span><br><span class="line">    : <span class="title class_">Object</span>.<span class="title function_">keys</span>(map).<span class="title function_">map</span>(<span class="function"><span class="params">key</span> =&gt;</span> (&#123; key, <span class="attr">val</span>: map[key] &#125;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-æœ€ä½³å®è·µå»ºè®®"><a href="#6-æœ€ä½³å®è·µå»ºè®®" class="headerlink" title="6. æœ€ä½³å®è·µå»ºè®®"></a>6. æœ€ä½³å®è·µå»ºè®®</h2><ol><li>åˆç†åˆ’åˆ†æ¨¡å—</li><li>å®ç°æ•°æ®æŒä¹…åŒ–</li><li>æ³¨æ„æ€§èƒ½ä¼˜åŒ–</li><li>ä½¿ç”¨è¾…åŠ©å‡½æ•°</li><li>åšå¥½é”™è¯¯å¤„ç†</li></ol><h2 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7. æ€»ç»“"></a>7. æ€»ç»“</h2><ol><li>æŒæ¡VuexåŸºç¡€é…ç½®</li><li>å®ç°æ¨¡å—åŒ–è®¾è®¡</li><li>å¤„ç†æ•°æ®æŒä¹…åŒ–</li><li>ä¼˜åŒ–æ›´æ–°æ€§èƒ½</li><li>çµæ´»ä½¿ç”¨è¾…åŠ©å‡½æ•°</li></ol><hr><blockquote><p>å¦‚æœè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©,æ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«,ä½ çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼ </p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/uni-app/">uni-app</category>
      
      
      <category domain="https://www.hzv5.cn/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/tags/uni-app/">uni-app</category>
      
      <category domain="https://www.hzv5.cn/tags/Vuex/">Vuex</category>
      
      <category domain="https://www.hzv5.cn/tags/%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/">çŠ¶æ€ç®¡ç†</category>
      
      
      <comments>https://www.hzv5.cn/2024/03/20/uniapp-state-management/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>uni-appè·¯ç”±ä¸é¡µé¢è·³è½¬ï¼šæœ€ä½³å®è·µä¸è¸©å‘æŒ‡å—</title>
      <link>https://www.hzv5.cn/2024/03/15/uniapp-router/</link>
      <guid>https://www.hzv5.cn/2024/03/15/uniapp-router/</guid>
      <pubDate>Fri, 15 Mar 2024 06:30:00 GMT</pubDate>
      
      <description>è¯¦ç»†ä»‹ç»uni-appä¸­çš„è·¯ç”±ä¸é¡µé¢è·³è½¬æœºåˆ¶,åŒ…æ‹¬å„ç§è·³è½¬æ–¹å¼ã€å‚æ•°ä¼ é€’ã€è·¯ç”±æ‹¦æˆªã€é¡µé¢é€šä¿¡ç­‰å†…å®¹,å¸®åŠ©å¼€å‘è€…æ„å»ºå®Œå–„çš„é¡µé¢å¯¼èˆªä½“ç³»ã€‚</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>è·¯ç”±ä¸é¡µé¢è·³è½¬æ˜¯uni-appåº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€,æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å„ç§è·³è½¬æ–¹å¼åŠå…¶æœ€ä½³å®è·µ,å¸®åŠ©ä½ æ„å»ºæµç•…çš„é¡µé¢å¯¼èˆªä½“éªŒã€‚</p></blockquote><span id="more"></span><h2 id="1-åŸºç¡€è·¯ç”±æ–¹æ³•"><a href="#1-åŸºç¡€è·¯ç”±æ–¹æ³•" class="headerlink" title="1. åŸºç¡€è·¯ç”±æ–¹æ³•"></a>1. åŸºç¡€è·¯ç”±æ–¹æ³•</h2><h3 id="1-1-é¡µé¢è·³è½¬æ–¹å¼"><a href="#1-1-é¡µé¢è·³è½¬æ–¹å¼" class="headerlink" title="1.1 é¡µé¢è·³è½¬æ–¹å¼"></a>1.1 é¡µé¢è·³è½¬æ–¹å¼</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿ç•™å½“å‰é¡µé¢ï¼Œè·³è½¬åˆ°åº”ç”¨å†…çš„æŸä¸ªé¡µé¢</span></span><br><span class="line">uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;/pages/detail/detail?id=1&#x27;</span>,</span><br><span class="line">  <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è·³è½¬æˆåŠŸ&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">fail</span>: <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;è·³è½¬å¤±è´¥:&#x27;</span>, err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³é—­å½“å‰é¡µé¢ï¼Œè·³è½¬åˆ°åº”ç”¨å†…çš„æŸä¸ªé¡µé¢</span></span><br><span class="line">uni.<span class="title function_">redirectTo</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;/pages/index/index&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³é—­æ‰€æœ‰é¡µé¢ï¼Œæ‰“å¼€åˆ°åº”ç”¨å†…çš„æŸä¸ªé¡µé¢</span></span><br><span class="line">uni.<span class="title function_">reLaunch</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;/pages/home/home&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³é—­å½“å‰é¡µé¢ï¼Œè¿”å›ä¸Šä¸€é¡µé¢æˆ–å¤šçº§é¡µé¢</span></span><br><span class="line">uni.<span class="title function_">navigateBack</span>(&#123;</span><br><span class="line">  <span class="attr">delta</span>: <span class="number">1</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·³è½¬åˆ° tabBar é¡µé¢</span></span><br><span class="line">uni.<span class="title function_">switchTab</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;/pages/user/user&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="1-2-å‚æ•°ä¼ é€’"><a href="#1-2-å‚æ•°ä¼ é€’" class="headerlink" title="1.2 å‚æ•°ä¼ é€’"></a>1.2 å‚æ•°ä¼ é€’</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¡µé¢Aï¼šä¼ é€’å‚æ•°</span></span><br><span class="line">uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;/pages/detail/detail?id=1&amp;type=product&amp;data=&#x27;</span> + <span class="built_in">encodeURIComponent</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¡µé¢Bï¼šæ¥æ”¶å‚æ•°</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">onLoad</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> id = options.<span class="property">id</span></span><br><span class="line">    <span class="keyword">const</span> type = options.<span class="property">type</span></span><br><span class="line">    <span class="keyword">const</span> data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="built_in">decodeURIComponent</span>(options.<span class="property">data</span>))</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æ¥æ”¶åˆ°çš„å‚æ•°:&#x27;</span>, id, type, data)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-è·¯ç”±æ‹¦æˆªä¸æƒé™æ§åˆ¶"><a href="#2-è·¯ç”±æ‹¦æˆªä¸æƒé™æ§åˆ¶" class="headerlink" title="2. è·¯ç”±æ‹¦æˆªä¸æƒé™æ§åˆ¶"></a>2. è·¯ç”±æ‹¦æˆªä¸æƒé™æ§åˆ¶</h2><h3 id="2-1-å…¨å±€è·¯ç”±æ‹¦æˆª"><a href="#2-1-å…¨å±€è·¯ç”±æ‹¦æˆª" class="headerlink" title="2.1 å…¨å±€è·¯ç”±æ‹¦æˆª"></a>2.1 å…¨å±€è·¯ç”±æ‹¦æˆª</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œå…¨å±€è·¯ç”±æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="keyword">const</span> whiteList = [<span class="string">&#x27;/pages/login/login&#x27;</span>, <span class="string">&#x27;/pages/register/register&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$beforeRouter</span> = <span class="keyword">function</span>(<span class="params">to</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æ£€æŸ¥æ˜¯å¦éœ€è¦ç™»å½•</span></span><br><span class="line">    <span class="keyword">if</span> (whiteList.<span class="title function_">includes</span>(to)) &#123;</span><br><span class="line">      <span class="title function_">resolve</span>()</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ£€æŸ¥ç™»å½•çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">const</span> token = uni.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (!token) &#123;</span><br><span class="line">      uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;è¯·å…ˆç™»å½•&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/pages/login/login&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;æœªç™»å½•&#x27;</span>))</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ£€æŸ¥æƒé™</span></span><br><span class="line">    <span class="keyword">const</span> userInfo = store.<span class="property">state</span>.<span class="property">user</span>.<span class="property">userInfo</span></span><br><span class="line">    <span class="keyword">if</span> (to.<span class="property">requiresAuth</span> &amp;&amp; !userInfo.<span class="property">permissions</span>.<span class="title function_">includes</span>(to.<span class="property">permission</span>)) &#123;</span><br><span class="line">      uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;æš‚æ— æƒé™è®¿é—®&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;æ— æƒé™&#x27;</span>))</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">resolve</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¡µé¢ä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.$beforeRouter(<span class="string">&#x27;/pages/user/user&#x27;</span>)</span><br><span class="line">      <span class="comment">// ç»§ç»­æ‰§è¡Œé¡µé¢é€»è¾‘</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;è·¯ç”±æ‹¦æˆª:&#x27;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-é¡µé¢çº§æƒé™æ§åˆ¶"><a href="#2-2-é¡µé¢çº§æƒé™æ§åˆ¶" class="headerlink" title="2.2 é¡µé¢çº§æƒé™æ§åˆ¶"></a>2.2 é¡µé¢çº§æƒé™æ§åˆ¶</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mixins/auth.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">hasPermission</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">checkPermission</span>()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">checkPermission</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> userPermissions = <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">user</span>.<span class="property">permissions</span></span><br><span class="line">      <span class="keyword">const</span> pagePermission = <span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">permission</span></span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (!pagePermission) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hasPermission</span> = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">hasPermission</span> = userPermissions.<span class="title function_">includes</span>(pagePermission)</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">hasPermission</span>) &#123;</span><br><span class="line">        uni.<span class="title function_">showModal</span>(&#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&#x27;æç¤º&#x27;</span>,</span><br><span class="line">          <span class="attr">content</span>: <span class="string">&#x27;æš‚æ— è®¿é—®æƒé™&#x27;</span>,</span><br><span class="line">          <span class="attr">showCancel</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">success</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            uni.<span class="title function_">navigateBack</span>()</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¡µé¢ä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">import</span> authMixin <span class="keyword">from</span> <span class="string">&#x27;@/mixins/auth&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">mixins</span>: [authMixin],</span><br><span class="line">  <span class="attr">permission</span>: <span class="string">&#x27;user:edit&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-é¡µé¢é€šä¿¡æ–¹æ¡ˆ"><a href="#3-é¡µé¢é€šä¿¡æ–¹æ¡ˆ" class="headerlink" title="3. é¡µé¢é€šä¿¡æ–¹æ¡ˆ"></a>3. é¡µé¢é€šä¿¡æ–¹æ¡ˆ</h2><h3 id="3-1-é¡µé¢é—´äº‹ä»¶é€šä¿¡"><a href="#3-1-é¡µé¢é—´äº‹ä»¶é€šä¿¡" class="headerlink" title="3.1 é¡µé¢é—´äº‹ä»¶é€šä¿¡"></a>3.1 é¡µé¢é—´äº‹ä»¶é€šä¿¡</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¡µé¢Aï¼šå‘é€äº‹ä»¶</span></span><br><span class="line"><span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// æ³¨å†Œäº‹ä»¶ç›‘å¬</span></span><br><span class="line">  uni.$on(<span class="string">&#x27;updateList&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleUpdateList</span>)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">onUnload</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// æ³¨é”€äº‹ä»¶ç›‘å¬</span></span><br><span class="line">  uni.$off(<span class="string">&#x27;updateList&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleUpdateList</span>)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">handleUpdateList</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æ”¶åˆ°æ›´æ–°æ•°æ®:&#x27;</span>, data)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">refreshList</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¡µé¢Bï¼šè§¦å‘äº‹ä»¶</span></span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">submitSuccess</span>(<span class="params"></span>) &#123;</span><br><span class="line">    uni.$emit(<span class="string">&#x27;updateList&#x27;</span>, &#123; <span class="attr">type</span>: <span class="string">&#x27;add&#x27;</span>, <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">formData</span> &#125;)</span><br><span class="line">    uni.<span class="title function_">navigateBack</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-é¡µé¢æ ˆç®¡ç†"><a href="#3-2-é¡µé¢æ ˆç®¡ç†" class="headerlink" title="3.2 é¡µé¢æ ˆç®¡ç†"></a>3.2 é¡µé¢æ ˆç®¡ç†</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/page.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PageManager</span> &#123;</span><br><span class="line">  <span class="comment">// è·å–å½“å‰é¡µé¢æ ˆ</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">getCurrentPages</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> pages = <span class="title function_">getCurrentPages</span>()</span><br><span class="line">    <span class="keyword">return</span> pages</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è·å–ä¸Šä¸€ä¸ªé¡µé¢å®ä¾‹</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">getPrevPage</span>(<span class="params">delta = <span class="number">1</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> pages = <span class="variable language_">this</span>.<span class="title function_">getCurrentPages</span>()</span><br><span class="line">    <span class="keyword">const</span> prevPage = pages[pages.<span class="property">length</span> - <span class="number">1</span> - delta]</span><br><span class="line">    <span class="keyword">return</span> prevPage</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è°ƒç”¨ä¸Šä¸€ä¸ªé¡µé¢çš„æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">callPrevPageMethod</span>(<span class="params">methodName, args, delta = <span class="number">1</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> prevPage = <span class="variable language_">this</span>.<span class="title function_">getPrevPage</span>(delta)</span><br><span class="line">    <span class="keyword">if</span> (prevPage &amp;&amp; <span class="keyword">typeof</span> prevPage[methodName] === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> prevPage[methodName](args)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ£€æŸ¥æ˜¯å¦å¯ä»¥è¿”å›</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">canBack</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> pages = <span class="variable language_">this</span>.<span class="title function_">getCurrentPages</span>()</span><br><span class="line">    <span class="keyword">return</span> pages.<span class="property">length</span> &gt; <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">PageManager</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PageManager</span> <span class="keyword">from</span> <span class="string">&#x27;@/utils/page&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨ä¸Šä¸€é¡µé¢æ–¹æ³•</span></span><br><span class="line"><span class="title class_">PageManager</span>.<span class="title function_">callPrevPageMethod</span>(<span class="string">&#x27;refreshData&#x27;</span>, &#123; <span class="attr">type</span>: <span class="string">&#x27;update&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥æ˜¯å¦å¯ä»¥è¿”å›</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title class_">PageManager</span>.<span class="title function_">canBack</span>()) &#123;</span><br><span class="line">  uni.<span class="title function_">navigateBack</span>()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  uni.<span class="title function_">reLaunch</span>(&#123; <span class="attr">url</span>: <span class="string">&#x27;/pages/index/index&#x27;</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-è·¯ç”±åŠ¨ç”»ä¸è½¬åœºæ•ˆæœ"><a href="#4-è·¯ç”±åŠ¨ç”»ä¸è½¬åœºæ•ˆæœ" class="headerlink" title="4. è·¯ç”±åŠ¨ç”»ä¸è½¬åœºæ•ˆæœ"></a>4. è·¯ç”±åŠ¨ç”»ä¸è½¬åœºæ•ˆæœ</h2><h3 id="4-1-åŸºç¡€åŠ¨ç”»é…ç½®"><a href="#4-1-åŸºç¡€åŠ¨ç”»é…ç½®" class="headerlink" title="4.1 åŸºç¡€åŠ¨ç”»é…ç½®"></a>4.1 åŸºç¡€åŠ¨ç”»é…ç½®</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;pages&quot;</span>: [&#123;</span><br><span class="line">    <span class="string">&quot;path&quot;</span>: <span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line">    <span class="string">&quot;style&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;é¦–é¡µ&quot;</span>,</span><br><span class="line">      <span class="string">&quot;app-plus&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;animationType&quot;</span>: <span class="string">&quot;slide-in-right&quot;</span>,</span><br><span class="line">        <span class="string">&quot;animationDuration&quot;</span>: <span class="number">300</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¡µé¢è·³è½¬æ—¶æŒ‡å®šåŠ¨ç”»</span></span><br><span class="line">uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;/pages/detail/detail&#x27;</span>,</span><br><span class="line">  <span class="attr">animationType</span>: <span class="string">&#x27;slide-in-bottom&#x27;</span>,</span><br><span class="line">  <span class="attr">animationDuration</span>: <span class="number">300</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="4-2-è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»"><a href="#4-2-è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»" class="headerlink" title="4.2 è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»"></a>4.2 è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- components/page-transition.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;page-transition&quot; :class=&quot;[transitionClass]&quot;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      transitionClass: &#x27;&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    enter() &#123;</span><br><span class="line">      this.transitionClass = &#x27;slide-enter&#x27;</span><br><span class="line">      setTimeout(() =&gt; &#123;</span><br><span class="line">        this.transitionClass = &#x27;slide-enter-active&#x27;</span><br><span class="line">      &#125;, 50)</span><br><span class="line">    &#125;,</span><br><span class="line">    leave() &#123;</span><br><span class="line">      this.transitionClass = &#x27;slide-leave&#x27;</span><br><span class="line">      setTimeout(() =&gt; &#123;</span><br><span class="line">        this.transitionClass = &#x27;slide-leave-active&#x27;</span><br><span class="line">      &#125;, 50)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.page-transition &#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100%;</span><br><span class="line">  transition: all 0.3s ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.slide-enter &#123;</span><br><span class="line">  transform: translateX(100%);</span><br><span class="line">&#125;</span><br><span class="line">.slide-enter-active &#123;</span><br><span class="line">  transform: translateX(0);</span><br><span class="line">&#125;</span><br><span class="line">.slide-leave &#123;</span><br><span class="line">  transform: translateX(0);</span><br><span class="line">&#125;</span><br><span class="line">.slide-leave-active &#123;</span><br><span class="line">  transform: translateX(-100%);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="5-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"><a href="#5-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ" class="headerlink" title="5. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"></a>5. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2><h3 id="5-1-é¡µé¢æ ˆæº¢å‡º"><a href="#5-1-é¡µé¢æ ˆæº¢å‡º" class="headerlink" title="5.1 é¡µé¢æ ˆæº¢å‡º"></a>5.1 é¡µé¢æ ˆæº¢å‡º</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ£€æŸ¥é¡µé¢æ ˆæ·±åº¦</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkPageStack</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> pages = <span class="title function_">getCurrentPages</span>()</span><br><span class="line">  <span class="keyword">const</span> maxStack = <span class="number">10</span> <span class="comment">// æœ€å¤§é¡µé¢æ ˆæ·±åº¦</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (pages.<span class="property">length</span> &gt;= maxStack) &#123;</span><br><span class="line">    uni.<span class="title function_">showModal</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;æç¤º&#x27;</span>,</span><br><span class="line">      <span class="attr">content</span>: <span class="string">&#x27;é¡µé¢å±‚çº§è¿‡æ·±ï¼Œæ˜¯å¦è¿”å›é¦–é¡µï¼Ÿ&#x27;</span>,</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">confirm</span>) &#123;</span><br><span class="line">          uni.<span class="title function_">reLaunch</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/pages/index/index&#x27;</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">navigateToDetail</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">checkPageStack</span>()) <span class="keyword">return</span></span><br><span class="line">    uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/pages/detail/detail&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2-å‚æ•°é•¿åº¦é™åˆ¶"><a href="#5-2-å‚æ•°é•¿åº¦é™åˆ¶" class="headerlink" title="5.2 å‚æ•°é•¿åº¦é™åˆ¶"></a>5.2 å‚æ•°é•¿åº¦é™åˆ¶</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤„ç†é•¿å‚æ•°ä¼ é€’</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleLongParams</span>(<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> params !== <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    params = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(params)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ£€æŸ¥å‚æ•°é•¿åº¦</span></span><br><span class="line">  <span class="keyword">if</span> (params.<span class="property">length</span> &gt; <span class="number">2048</span>) &#123;</span><br><span class="line">    <span class="comment">// å­˜å‚¨åˆ°æœ¬åœ°</span></span><br><span class="line">    <span class="keyword">const</span> key = <span class="string">&#x27;temp_params_&#x27;</span> + <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    uni.<span class="title function_">setStorageSync</span>(key, params)</span><br><span class="line">    <span class="keyword">return</span> key</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> params</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¡µé¢Aï¼šä¼ é€’å‚æ•°</span></span><br><span class="line"><span class="keyword">const</span> params = <span class="title function_">handleLongParams</span>(<span class="variable language_">this</span>.<span class="property">longData</span>)</span><br><span class="line">uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">`/pages/detail/detail?key=<span class="subst">$&#123;params&#125;</span>`</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¡µé¢Bï¼šæ¥æ”¶å‚æ•°</span></span><br><span class="line"><span class="title function_">onLoad</span>(<span class="params">options</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> data = options.<span class="property">key</span></span><br><span class="line">  <span class="keyword">if</span> (data.<span class="title function_">startsWith</span>(<span class="string">&#x27;temp_params_&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">// ä»æœ¬åœ°å­˜å‚¨è·å–</span></span><br><span class="line">    data = uni.<span class="title function_">getStorageSync</span>(data)</span><br><span class="line">    <span class="comment">// æ¸…ç†å­˜å‚¨</span></span><br><span class="line">    uni.<span class="title function_">removeStorageSync</span>(data)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">handleData</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(data))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-æœ€ä½³å®è·µå»ºè®®"><a href="#6-æœ€ä½³å®è·µå»ºè®®" class="headerlink" title="6. æœ€ä½³å®è·µå»ºè®®"></a>6. æœ€ä½³å®è·µå»ºè®®</h2><ol><li>åˆç†ä½¿ç”¨é¡µé¢è·³è½¬æ–¹å¼</li><li>å®ç°ç»Ÿä¸€çš„è·¯ç”±æ‹¦æˆª</li><li>æ³¨æ„é¡µé¢æ ˆç®¡ç†</li><li>ä¼˜åŒ–è½¬åœºåŠ¨ç”»</li><li>å¤„ç†å¼‚å¸¸æƒ…å†µ</li></ol><h2 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7. æ€»ç»“"></a>7. æ€»ç»“</h2><ol><li>æŒæ¡åŸºç¡€è·¯ç”±æ–¹æ³•</li><li>å®ç°æƒé™æ§åˆ¶</li><li>å¤„ç†é¡µé¢é€šä¿¡</li><li>ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ</li><li>è§£å†³å¸¸è§é—®é¢˜</li></ol><hr><blockquote><p>å¦‚æœè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©,æ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«,ä½ çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼ </p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/uni-app/">uni-app</category>
      
      
      <category domain="https://www.hzv5.cn/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/tags/uni-app/">uni-app</category>
      
      <category domain="https://www.hzv5.cn/tags/%E8%B7%AF%E7%94%B1%E8%B7%B3%E8%BD%AC/">è·¯ç”±è·³è½¬</category>
      
      <category domain="https://www.hzv5.cn/tags/%E9%A1%B5%E9%9D%A2%E9%80%9A%E4%BF%A1/">é¡µé¢é€šä¿¡</category>
      
      
      <comments>https://www.hzv5.cn/2024/03/15/uniapp-router/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>uni-appæ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šä»åŠ è½½åˆ°æ¸²æŸ“çš„å…¨æ–¹ä½æå‡</title>
      <link>https://www.hzv5.cn/2024/03/10/uniapp-performance/</link>
      <guid>https://www.hzv5.cn/2024/03/10/uniapp-performance/</guid>
      <pubDate>Sun, 10 Mar 2024 03:30:00 GMT</pubDate>
      
      <description>æ·±å…¥æ¢è®¨uni-appåº”ç”¨çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥,åŒ…æ‹¬é¦–å±åŠ è½½ä¼˜åŒ–ã€æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–ã€å†…å­˜ç®¡ç†ã€ç½‘ç»œä¼˜åŒ–ç­‰å¤šä¸ªç»´åº¦,åŠ©ä½ æ‰“é€ é«˜æ€§èƒ½çš„è·¨ç«¯åº”ç”¨ã€‚</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>æ€§èƒ½ä¼˜åŒ–æ˜¯æå‡ç”¨æˆ·ä½“éªŒçš„å…³é”®å› ç´ ,æœ¬æ–‡å°†ä»å¤šä¸ªç»´åº¦è¯¦ç»†ä»‹ç»uni-appåº”ç”¨çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥,å¸®åŠ©ä½ æ„å»ºæµç•…çš„è·¨ç«¯åº”ç”¨ã€‚</p></blockquote><span id="more"></span><h2 id="1-é¦–å±åŠ è½½ä¼˜åŒ–"><a href="#1-é¦–å±åŠ è½½ä¼˜åŒ–" class="headerlink" title="1. é¦–å±åŠ è½½ä¼˜åŒ–"></a>1. é¦–å±åŠ è½½ä¼˜åŒ–</h2><h3 id="1-1-åˆ†åŒ…åŠ è½½"><a href="#1-1-åˆ†åŒ…åŠ è½½" class="headerlink" title="1.1 åˆ†åŒ…åŠ è½½"></a>1.1 åˆ†åŒ…åŠ è½½</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;pages&quot;</span>: [&#123;</span><br><span class="line">    <span class="string">&quot;path&quot;</span>: <span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line">    <span class="string">&quot;style&quot;</span>: &#123; ... &#125;</span><br><span class="line">  &#125;],</span><br><span class="line">  <span class="string">&quot;subPackages&quot;</span>: [&#123;</span><br><span class="line">    <span class="string">&quot;root&quot;</span>: <span class="string">&quot;pagesA&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pages&quot;</span>: [&#123;</span><br><span class="line">      <span class="string">&quot;path&quot;</span>: <span class="string">&quot;list/index&quot;</span>,</span><br><span class="line">      <span class="string">&quot;style&quot;</span>: &#123; ... &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-é¢„åŠ è½½ç­–ç•¥"><a href="#1-2-é¢„åŠ è½½ç­–ç•¥" class="headerlink" title="1.2 é¢„åŠ è½½ç­–ç•¥"></a>1.2 é¢„åŠ è½½ç­–ç•¥</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¢„åŠ è½½åˆ†åŒ…</span></span><br><span class="line">uni.<span class="title function_">preloadSubPackage</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;pagesA&#x27;</span>,</span><br><span class="line">  <span class="attr">success</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;åˆ†åŒ…é¢„åŠ è½½æˆåŠŸ&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">fail</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;åˆ†åŒ…é¢„åŠ è½½å¤±è´¥&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¢„åŠ è½½é¡µé¢</span></span><br><span class="line"><span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// åœ¨é¦–é¡µé¢„åŠ è½½å…¶ä»–é¡µé¢</span></span><br><span class="line">  uni.<span class="title function_">preloadPage</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/pagesA/list/index&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-3-éª¨æ¶å±å®ç°"><a href="#1-3-éª¨æ¶å±å®ç°" class="headerlink" title="1.3 éª¨æ¶å±å®ç°"></a>1.3 éª¨æ¶å±å®ç°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- components/skeleton.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;skeleton&quot; v-if=&quot;loading&quot;&gt;</span><br><span class="line">    &lt;view class=&quot;skeleton-header&quot;&gt;&lt;/view&gt;</span><br><span class="line">    &lt;view class=&quot;skeleton-content&quot;&gt;</span><br><span class="line">      &lt;view class=&quot;skeleton-item&quot; v-for=&quot;i in 5&quot; :key=&quot;i&quot;&gt;&lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.skeleton &#123;</span><br><span class="line">  padding: 20rpx;</span><br><span class="line">&#125;</span><br><span class="line">.skeleton-header &#123;</span><br><span class="line">  height: 40rpx;</span><br><span class="line">  background: #f0f0f0;</span><br><span class="line">  margin-bottom: 20rpx;</span><br><span class="line">  animation: skeleton-loading 1s infinite;</span><br><span class="line">&#125;</span><br><span class="line">.skeleton-item &#123;</span><br><span class="line">  height: 100rpx;</span><br><span class="line">  background: #f0f0f0;</span><br><span class="line">  margin-bottom: 20rpx;</span><br><span class="line">  animation: skeleton-loading 1s infinite;</span><br><span class="line">&#125;</span><br><span class="line">@keyframes skeleton-loading &#123;</span><br><span class="line">  0% &#123; opacity: 1; &#125;</span><br><span class="line">  50% &#123; opacity: 0.5; &#125;</span><br><span class="line">  100% &#123; opacity: 1; &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="2-æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–"><a href="#2-æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="2. æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–"></a>2. æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–</h2><h3 id="2-1-é•¿åˆ—è¡¨ä¼˜åŒ–"><a href="#2-1-é•¿åˆ—è¡¨ä¼˜åŒ–" class="headerlink" title="2.1 é•¿åˆ—è¡¨ä¼˜åŒ–"></a>2.1 é•¿åˆ—è¡¨ä¼˜åŒ–</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- è™šæ‹Ÿåˆ—è¡¨å®ç° --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;list-container&quot;&gt;</span><br><span class="line">    &lt;view </span><br><span class="line">      class=&quot;list-phantom&quot;</span><br><span class="line">      :style=&quot;&#123; height: listHeight + &#x27;px&#x27; &#125;&quot;</span><br><span class="line">    &gt;&lt;/view&gt;</span><br><span class="line">    &lt;view </span><br><span class="line">      class=&quot;list-content&quot;</span><br><span class="line">      :style=&quot;&#123; transform: getTransform &#125;&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;view </span><br><span class="line">        class=&quot;list-item&quot;</span><br><span class="line">        v-for=&quot;item in visibleData&quot;</span><br><span class="line">        :key=&quot;item.id&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;&#123; item.content &#125;&#125;</span><br><span class="line">      &lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      listData: [], // å®Œæ•´åˆ—è¡¨æ•°æ®</span><br><span class="line">      itemHeight: 50, // æ¯é¡¹é«˜åº¦</span><br><span class="line">      visibleCount: 10, // å¯è§†åŒºåŸŸæ˜¾ç¤ºçš„æ•°é‡</span><br><span class="line">      startIndex: 0, // èµ·å§‹ç´¢å¼•</span><br><span class="line">      endIndex: 0 // ç»“æŸç´¢å¼•</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    listHeight() &#123;</span><br><span class="line">      return this.listData.length * this.itemHeight</span><br><span class="line">    &#125;,</span><br><span class="line">    visibleData() &#123;</span><br><span class="line">      return this.listData.slice(this.startIndex, this.endIndex)</span><br><span class="line">    &#125;,</span><br><span class="line">    getTransform() &#123;</span><br><span class="line">      return `translate3d(0, $&#123;this.startIndex * this.itemHeight&#125;px, 0)`</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleScroll(e) &#123;</span><br><span class="line">      const scrollTop = e.detail.scrollTop</span><br><span class="line">      this.startIndex = Math.floor(scrollTop / this.itemHeight)</span><br><span class="line">      this.endIndex = this.startIndex + this.visibleCount</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="2-2-é¿å…é¢‘ç¹æ›´æ–°"><a href="#2-2-é¿å…é¢‘ç¹æ›´æ–°" class="headerlink" title="2.2 é¿å…é¢‘ç¹æ›´æ–°"></a>2.2 é¿å…é¢‘ç¹æ›´æ–°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨é˜²æŠ–</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">fn, delay</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)</span><br><span class="line">    &#125;, delay)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨èŠ‚æµ</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">fn, delay</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">let</span> start = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> current = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    <span class="keyword">const</span> remaining = delay - (current - start)</span><br><span class="line">    <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">    <span class="keyword">if</span> (remaining &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)</span><br><span class="line">      start = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)</span><br><span class="line">        start = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">      &#125;, remaining)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="attr">updateData</span>: <span class="title function_">debounce</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// æ›´æ–°æ•°æ®çš„æ“ä½œ</span></span><br><span class="line">    &#125;, <span class="number">300</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-å†…å­˜ä¼˜åŒ–"><a href="#3-å†…å­˜ä¼˜åŒ–" class="headerlink" title="3. å†…å­˜ä¼˜åŒ–"></a>3. å†…å­˜ä¼˜åŒ–</h2><h3 id="3-1-åŠæ—¶é”€æ¯"><a href="#3-1-åŠæ—¶é”€æ¯" class="headerlink" title="3.1 åŠæ—¶é”€æ¯"></a>3.1 åŠæ—¶é”€æ¯</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">timer</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">observer</span>: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeDestroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// æ¸…é™¤å®šæ—¶å™¨</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">timer</span>) &#123;</span><br><span class="line">      <span class="built_in">clearTimeout</span>(<span class="variable language_">this</span>.<span class="property">timer</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">timer</span> = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ¸…é™¤ç›‘å¬å™¨</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">observer</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">observer</span>.<span class="title function_">disconnect</span>()</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">observer</span> = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-é¿å…å†…å­˜æ³„æ¼"><a href="#3-2-é¿å…å†…å­˜æ³„æ¼" class="headerlink" title="3.2 é¿å…å†…å­˜æ³„æ¼"></a>3.2 é¿å…å†…å­˜æ³„æ¼</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å›¾ç‰‡é¢„åŠ è½½</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">preloadImages</span> = (<span class="params">urls</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> promises = urls.<span class="title function_">map</span>(<span class="function"><span class="params">url</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> image = <span class="keyword">new</span> <span class="title class_">Image</span>()</span><br><span class="line">      image.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        image.<span class="property">onload</span> = <span class="literal">null</span> <span class="comment">// æ¸…é™¤äº‹ä»¶ç›‘å¬</span></span><br><span class="line">        <span class="title function_">resolve</span>(url)</span><br><span class="line">      &#125;</span><br><span class="line">      image.<span class="property">onerror</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        image.<span class="property">onerror</span> = <span class="literal">null</span> <span class="comment">// æ¸…é™¤äº‹ä»¶ç›‘å¬</span></span><br><span class="line">        <span class="title function_">reject</span>(url)</span><br><span class="line">      &#125;</span><br><span class="line">      image.<span class="property">src</span> = url</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(promises)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-ç½‘ç»œä¼˜åŒ–"><a href="#4-ç½‘ç»œä¼˜åŒ–" class="headerlink" title="4. ç½‘ç»œä¼˜åŒ–"></a>4. ç½‘ç»œä¼˜åŒ–</h2><h3 id="4-1-è¯·æ±‚åˆå¹¶"><a href="#4-1-è¯·æ±‚åˆå¹¶" class="headerlink" title="4.1 è¯·æ±‚åˆå¹¶"></a>4.1 è¯·æ±‚åˆå¹¶</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯·æ±‚é˜Ÿåˆ—ç®¡ç†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RequestQueue</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">queue</span> = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">request</span>(<span class="params">key, promiseCreator</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">has</span>(key)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">get</span>(key)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> promise = <span class="title function_">promiseCreator</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">set</span>(key, promise)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> promise</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">delete</span>(key)</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">delete</span>(key)</span><br><span class="line">      <span class="keyword">throw</span> err</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">const</span> requestQueue = <span class="keyword">new</span> <span class="title class_">RequestQueue</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> requestQueue.<span class="title function_">request</span>(<span class="string">`data_<span class="subst">$&#123;id&#125;</span>`</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(&#123; id, <span class="attr">data</span>: <span class="string">&#x27;some data&#x27;</span> &#125;)</span><br><span class="line">      &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-æ•°æ®ç¼“å­˜"><a href="#4-2-æ•°æ®ç¼“å­˜" class="headerlink" title="4.2 æ•°æ®ç¼“å­˜"></a>4.2 æ•°æ®ç¼“å­˜</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CacheManager</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">expire = <span class="number">5</span> * <span class="number">60</span> * <span class="number">1000</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cache</span> = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">expire</span> = expire</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">set</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">set</span>(key, &#123;</span><br><span class="line">      value,</span><br><span class="line">      <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">get</span>(key)</span><br><span class="line">    <span class="keyword">if</span> (!data) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Date</span>.<span class="title function_">now</span>() - data.<span class="property">timestamp</span> &gt; <span class="variable language_">this</span>.<span class="property">expire</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">delete</span>(key)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> data.<span class="property">value</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">clear</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">const</span> cache = <span class="keyword">new</span> <span class="title class_">CacheManager</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getData</span>(<span class="params">key</span>) &#123;</span><br><span class="line">  <span class="comment">// å…ˆä»ç¼“å­˜è·å–</span></span><br><span class="line">  <span class="keyword">const</span> cached = cache.<span class="title function_">get</span>(key)</span><br><span class="line">  <span class="keyword">if</span> (cached) <span class="keyword">return</span> cached</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç¼“å­˜ä¸å­˜åœ¨åˆ™è¯·æ±‚</span></span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">fetchData</span>(key)</span><br><span class="line">  cache.<span class="title function_">set</span>(key, data)</span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-å…¶ä»–ä¼˜åŒ–æŠ€å·§"><a href="#5-å…¶ä»–ä¼˜åŒ–æŠ€å·§" class="headerlink" title="5. å…¶ä»–ä¼˜åŒ–æŠ€å·§"></a>5. å…¶ä»–ä¼˜åŒ–æŠ€å·§</h2><h3 id="5-1-å›¾ç‰‡ä¼˜åŒ–"><a href="#5-1-å›¾ç‰‡ä¼˜åŒ–" class="headerlink" title="5.1 å›¾ç‰‡ä¼˜åŒ–"></a>5.1 å›¾ç‰‡ä¼˜åŒ–</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å›¾ç‰‡æ‡’åŠ è½½æŒ‡ä»¤</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;lazy&#x27;</span>, &#123;</span><br><span class="line">  <span class="title function_">bind</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(<span class="function"><span class="params">entries</span> =&gt;</span> &#123;</span><br><span class="line">      entries.<span class="title function_">forEach</span>(<span class="function"><span class="params">entry</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (entry.<span class="property">isIntersecting</span>) &#123;</span><br><span class="line">          el.<span class="property">src</span> = binding.<span class="property">value</span></span><br><span class="line">          observer.<span class="title function_">unobserve</span>(el)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    observer.<span class="title function_">observe</span>(el)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line">&lt;image v-lazy=<span class="string">&quot;imageUrl&quot;</span> /&gt;</span><br></pre></td></tr></table></figure><h3 id="5-2-ç»„ä»¶ä¼˜åŒ–"><a href="#5-2-ç»„ä»¶ä¼˜åŒ–" class="headerlink" title="5.2 ç»„ä»¶ä¼˜åŒ–"></a>5.2 ç»„ä»¶ä¼˜åŒ–</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨keep-aliveç¼“å­˜ç»„ä»¶</span></span><br><span class="line">&lt;keep-alive&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;currentComponent&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span></span><br><span class="line">&lt;/keep-alive&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼‚æ­¥ç»„ä»¶</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">AsyncComponent</span> = (<span class="params"></span>) =&gt; (&#123;</span><br><span class="line">  <span class="attr">component</span>: <span class="keyword">import</span>(<span class="string">&#x27;./heavy-component.vue&#x27;</span>),</span><br><span class="line">  <span class="attr">loading</span>: <span class="title class_">LoadingComponent</span>,</span><br><span class="line">  <span class="attr">error</span>: <span class="title class_">ErrorComponent</span>,</span><br><span class="line">  <span class="attr">delay</span>: <span class="number">200</span>,</span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">3000</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="6-æ€§èƒ½ç›‘æ§"><a href="#6-æ€§èƒ½ç›‘æ§" class="headerlink" title="6. æ€§èƒ½ç›‘æ§"></a>6. æ€§èƒ½ç›‘æ§</h2><h3 id="6-1-é¡µé¢æ€§èƒ½ç›‘æ§"><a href="#6-1-é¡µé¢æ€§èƒ½ç›‘æ§" class="headerlink" title="6.1 é¡µé¢æ€§èƒ½ç›‘æ§"></a>6.1 é¡µé¢æ€§èƒ½ç›‘æ§</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> performance = &#123;</span><br><span class="line">  <span class="comment">// è®°å½•æ—¶é—´ç‚¹</span></span><br><span class="line">  <span class="title function_">mark</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> performance !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">      performance.<span class="title function_">mark</span>(name)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æµ‹é‡ä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹é—´çš„æ—¶é—´</span></span><br><span class="line">  <span class="title function_">measure</span>(<span class="params">name, startMark, endMark</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> performance !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">      performance.<span class="title function_">measure</span>(name, startMark, endMark)</span><br><span class="line">      <span class="keyword">const</span> measures = performance.<span class="title function_">getEntriesByName</span>(name)</span><br><span class="line">      <span class="keyword">return</span> measures[<span class="number">0</span>].<span class="property">duration</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ä¸ŠæŠ¥æ€§èƒ½æ•°æ®</span></span><br><span class="line">  <span class="title function_">report</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="comment">// ä¸ŠæŠ¥é€»è¾‘</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æ€§èƒ½æ•°æ®:&#x27;</span>, data)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7. æ€»ç»“"></a>7. æ€»ç»“</h2><ol><li>åˆç†ä½¿ç”¨åˆ†åŒ…åŠ è½½</li><li>å®ç°è™šæ‹Ÿåˆ—è¡¨</li><li>ä¼˜åŒ–æ›´æ–°æœºåˆ¶</li><li>æ³¨æ„å†…å­˜ç®¡ç†</li><li>åšå¥½ç½‘ç»œä¼˜åŒ–</li><li>ç›‘æ§æ€§èƒ½æŒ‡æ ‡</li></ol><hr><blockquote><p>å¦‚æœè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©,æ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«,ä½ çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼ </p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/uni-app/">uni-app</category>
      
      
      <category domain="https://www.hzv5.cn/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/tags/uni-app/">uni-app</category>
      
      <category domain="https://www.hzv5.cn/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">æ€§èƒ½ä¼˜åŒ–</category>
      
      <category domain="https://www.hzv5.cn/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/">å°ç¨‹åº</category>
      
      
      <comments>https://www.hzv5.cn/2024/03/10/uniapp-performance/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>uni-appç»„ä»¶é€šä¿¡å®Œå…¨æŒ‡å—ï¼šä»åŸºç¡€åˆ°è¿›é˜¶</title>
      <link>https://www.hzv5.cn/2024/02/18/uniapp-component-communication/</link>
      <guid>https://www.hzv5.cn/2024/02/18/uniapp-component-communication/</guid>
      <pubDate>Sun, 18 Feb 2024 02:15:00 GMT</pubDate>
      
      <description>å…¨é¢ä»‹ç»uni-appä¸­å„ç§ç»„ä»¶é€šä¿¡æ–¹å¼,åŒ…æ‹¬props/emitã€provide/injectã€eventBusã€Vuexç­‰,å¹¶ç»“åˆå®é™…åœºæ™¯åˆ†ææœ€ä½³å®è·µã€‚</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>ç»„ä»¶é€šä¿¡æ˜¯uni-appå¼€å‘ä¸­çš„é‡è¦ç¯èŠ‚,é€‰æ‹©åˆé€‚çš„é€šä¿¡æ–¹å¼å¯¹æå‡ä»£ç è´¨é‡å’Œå¼€å‘æ•ˆç‡è‡³å…³é‡è¦ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å„ç§ç»„ä»¶é€šä¿¡æ–¹æ¡ˆçš„ä½¿ç”¨åœºæ™¯å’Œæœ€ä½³å®è·µã€‚</p></blockquote><span id="more"></span><h2 id="1-åŸºç¡€é€šä¿¡æ–¹å¼"><a href="#1-åŸºç¡€é€šä¿¡æ–¹å¼" class="headerlink" title="1. åŸºç¡€é€šä¿¡æ–¹å¼"></a>1. åŸºç¡€é€šä¿¡æ–¹å¼</h2><h3 id="1-1-Props-Emit"><a href="#1-1-Props-Emit" class="headerlink" title="1.1 Props/Emit"></a>1.1 Props/Emit</h3><p>çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ å€¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- çˆ¶ç»„ä»¶ --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;child-component </span><br><span class="line">    :title=&quot;title&quot;</span><br><span class="line">    :list=&quot;dataList&quot;</span><br><span class="line">    @on-click=&quot;handleClick&quot;</span><br><span class="line">  /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      title: &#x27;æ ‡é¢˜&#x27;,</span><br><span class="line">      dataList: [&#x27;item1&#x27;, &#x27;item2&#x27;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleClick(data) &#123;</span><br><span class="line">      console.log(&#x27;å­ç»„ä»¶ç‚¹å‡»äº‹ä»¶:&#x27;, data)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- å­ç»„ä»¶ --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view&gt;</span><br><span class="line">    &lt;text&gt;&#123;&#123;title&#125;&#125;&lt;/text&gt;</span><br><span class="line">    &lt;view </span><br><span class="line">      v-for=&quot;(item, index) in list&quot; </span><br><span class="line">      :key=&quot;index&quot;</span><br><span class="line">      @click=&quot;onClick(item)&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;&#123;item&#125;&#125;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    title: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: &#x27;&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    list: &#123;</span><br><span class="line">      type: Array,</span><br><span class="line">      default: () =&gt; []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    onClick(item) &#123;</span><br><span class="line">      this.$emit(&#x27;on-click&#x27;, item)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="1-2-Provide-Inject"><a href="#1-2-Provide-Inject" class="headerlink" title="1.2 Provide/Inject"></a>1.2 Provide/Inject</h3><p>è·¨å±‚çº§ç»„ä»¶é€šä¿¡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- çˆ¶ç»„ä»¶ --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  provide() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      theme: this.theme,</span><br><span class="line">      updateTheme: this.updateTheme</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      theme: &#x27;light&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    updateTheme(newTheme) &#123;</span><br><span class="line">      this.theme = newTheme</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- å­ç»„ä»¶(ä»»æ„å±‚çº§) --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  inject: [&#x27;theme&#x27;, &#x27;updateTheme&#x27;],</span><br><span class="line">  methods: &#123;</span><br><span class="line">    toggleTheme() &#123;</span><br><span class="line">      this.updateTheme(this.theme === &#x27;light&#x27; ? &#x27;dark&#x27; : &#x27;light&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="2-è¿›é˜¶é€šä¿¡æ–¹æ¡ˆ"><a href="#2-è¿›é˜¶é€šä¿¡æ–¹æ¡ˆ" class="headerlink" title="2. è¿›é˜¶é€šä¿¡æ–¹æ¡ˆ"></a>2. è¿›é˜¶é€šä¿¡æ–¹æ¡ˆ</h2><h3 id="2-1-EventBus"><a href="#2-1-EventBus" class="headerlink" title="2.1 EventBus"></a>2.1 EventBus</h3><p>é€‚ç”¨äºä»»æ„ç»„ä»¶é—´é€šä¿¡ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/event-bus.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EventBus</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">events</span> = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">on</span>(<span class="params">eventName, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">events</span>[eventName]) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">events</span>[eventName] = []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">events</span>[eventName].<span class="title function_">push</span>(callback)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">emit</span>(<span class="params">eventName, data</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">events</span>[eventName]) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">events</span>[eventName].<span class="title function_">forEach</span>(<span class="function"><span class="params">callback</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">callback</span>(data)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">off</span>(<span class="params">eventName, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">events</span>[eventName]) &#123;</span><br><span class="line">      <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">events</span>[eventName] = <span class="variable language_">this</span>.<span class="property">events</span>[eventName].<span class="title function_">filter</span>(<span class="function"><span class="params">cb</span> =&gt;</span> cb !== callback)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">delete</span> <span class="variable language_">this</span>.<span class="property">events</span>[eventName]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">EventBus</span>()</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- ç»„ä»¶A --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import eventBus from &#x27;@/utils/event-bus&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    sendMessage() &#123;</span><br><span class="line">      eventBus.emit(&#x27;message&#x27;, &#123; type: &#x27;success&#x27;, content: &#x27;æ“ä½œæˆåŠŸ&#x27; &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- ç»„ä»¶B --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import eventBus from &#x27;@/utils/event-bus&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    eventBus.on(&#x27;message&#x27;, this.handleMessage)</span><br><span class="line">  &#125;,</span><br><span class="line">  beforeDestroy() &#123;</span><br><span class="line">    eventBus.off(&#x27;message&#x27;, this.handleMessage)</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleMessage(data) &#123;</span><br><span class="line">      console.log(&#x27;æ”¶åˆ°æ¶ˆæ¯:&#x27;, data)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="2-2-VuexçŠ¶æ€ç®¡ç†"><a href="#2-2-VuexçŠ¶æ€ç®¡ç†" class="headerlink" title="2.2 VuexçŠ¶æ€ç®¡ç†"></a>2.2 VuexçŠ¶æ€ç®¡ç†</h3><p>å¤æ‚ç»„ä»¶é€šä¿¡æ¨èä½¿ç”¨ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">userInfo</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">cartList</span>: []</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">setUserInfo</span>(<span class="params">state, info</span>) &#123;</span><br><span class="line">      state.<span class="property">userInfo</span> = info</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">addToCart</span>(<span class="params">state, item</span>) &#123;</span><br><span class="line">      state.<span class="property">cartList</span>.<span class="title function_">push</span>(item)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">updateUserInfo</span>(<span class="params">&#123; commit &#125;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> info = <span class="keyword">await</span> <span class="title function_">getUserInfo</span>()</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;setUserInfo&#x27;</span>, info)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="attr">cartCount</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">cartList</span>.<span class="property">length</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- ç»„ä»¶ä¸­ä½¿ç”¨ --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; mapState, mapMutations, mapActions &#125; from &#x27;vuex&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  computed: &#123;</span><br><span class="line">    ...mapState([&#x27;userInfo&#x27;, &#x27;cartList&#x27;]),</span><br><span class="line">    ...mapGetters([&#x27;cartCount&#x27;])</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    ...mapMutations([&#x27;setUserInfo&#x27;, &#x27;addToCart&#x27;]),</span><br><span class="line">    ...mapActions([&#x27;updateUserInfo&#x27;]),</span><br><span class="line">    async init() &#123;</span><br><span class="line">      await this.updateUserInfo()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="3-ç‰¹æ®Šåœºæ™¯å¤„ç†"><a href="#3-ç‰¹æ®Šåœºæ™¯å¤„ç†" class="headerlink" title="3. ç‰¹æ®Šåœºæ™¯å¤„ç†"></a>3. ç‰¹æ®Šåœºæ™¯å¤„ç†</h2><h3 id="3-1-è·¨é¡µé¢é€šä¿¡"><a href="#3-1-è·¨é¡µé¢é€šä¿¡" class="headerlink" title="3.1 è·¨é¡µé¢é€šä¿¡"></a>3.1 è·¨é¡µé¢é€šä¿¡</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¡µé¢A</span></span><br><span class="line">uni.$on(<span class="string">&#x27;pageMessage&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleMessage</span>)</span><br><span class="line">uni.$emit(<span class="string">&#x27;pageMessage&#x27;</span>, &#123; <span class="attr">data</span>: <span class="string">&#x27;hello&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¡µé¢B</span></span><br><span class="line">uni.$once(<span class="string">&#x27;pageMessage&#x27;</span>, <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æ”¶åˆ°ä¸€æ¬¡æ€§æ¶ˆæ¯:&#x27;</span>, data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„åœ¨é¡µé¢é”€æ¯æ—¶è§£é™¤ç›‘å¬</span></span><br><span class="line"><span class="title function_">onUnload</span>(<span class="params"></span>) &#123;</span><br><span class="line">  uni.$off(<span class="string">&#x27;pageMessage&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleMessage</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-ç»„ä»¶refé€šä¿¡"><a href="#3-2-ç»„ä»¶refé€šä¿¡" class="headerlink" title="3.2 ç»„ä»¶refé€šä¿¡"></a>3.2 ç»„ä»¶refé€šä¿¡</h3><p>ç›´æ¥è®¿é—®ç»„ä»¶å®ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- çˆ¶ç»„ä»¶ --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;child-component ref=&quot;child&quot; /&gt;</span><br><span class="line">  &lt;button @click=&quot;callChildMethod&quot;&gt;è°ƒç”¨å­ç»„ä»¶æ–¹æ³•&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    callChildMethod() &#123;</span><br><span class="line">      this.$refs.child.someMethod()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- å­ç»„ä»¶ --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    someMethod() &#123;</span><br><span class="line">      console.log(&#x27;å­ç»„ä»¶æ–¹æ³•è¢«è°ƒç”¨&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="4-æœ€ä½³å®è·µå»ºè®®"><a href="#4-æœ€ä½³å®è·µå»ºè®®" class="headerlink" title="4. æœ€ä½³å®è·µå»ºè®®"></a>4. æœ€ä½³å®è·µå»ºè®®</h2><h3 id="4-1-é€‰æ‹©åˆé€‚çš„é€šä¿¡æ–¹å¼"><a href="#4-1-é€‰æ‹©åˆé€‚çš„é€šä¿¡æ–¹å¼" class="headerlink" title="4.1 é€‰æ‹©åˆé€‚çš„é€šä¿¡æ–¹å¼"></a>4.1 é€‰æ‹©åˆé€‚çš„é€šä¿¡æ–¹å¼</h3><ol><li>çˆ¶å­ç»„ä»¶ï¼šä¼˜å…ˆä½¿ç”¨props/emit</li><li>è·¨å±‚çº§ç»„ä»¶ï¼šè€ƒè™‘provide/inject</li><li>å¤æ‚æ•°æ®ç®¡ç†ï¼šä½¿ç”¨Vuex</li><li>ç®€å•å…¨å±€é€šä¿¡ï¼šä½¿ç”¨EventBus</li><li>ä¸´æ—¶è·¨é¡µé¢ï¼šä½¿ç”¨uni.$emit/$on</li></ol><h3 id="4-2-æ€§èƒ½ä¼˜åŒ–"><a href="#4-2-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="4.2 æ€§èƒ½ä¼˜åŒ–"></a>4.2 æ€§èƒ½ä¼˜åŒ–</h3><ol><li>é¿å…è¿‡åº¦ä½¿ç”¨EventBus</li><li>åŠæ—¶è§£é™¤äº‹ä»¶ç›‘å¬</li><li>Vuexä¸­åˆç†åˆ’åˆ†æ¨¡å—</li><li>å‡å°‘ä¸å¿…è¦çš„æ•°æ®ç›‘å¬</li></ol><h2 id="5-å¸¸è§é—®é¢˜"><a href="#5-å¸¸è§é—®é¢˜" class="headerlink" title="5. å¸¸è§é—®é¢˜"></a>5. å¸¸è§é—®é¢˜</h2><h3 id="5-1-æ•°æ®åŒæ­¥é—®é¢˜"><a href="#5-1-æ•°æ®åŒæ­¥é—®é¢˜" class="headerlink" title="5.1 æ•°æ®åŒæ­¥é—®é¢˜"></a>5.1 æ•°æ®åŒæ­¥é—®é¢˜</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çˆ¶ç»„ä»¶æ•°æ®å˜åŒ–å­ç»„ä»¶ä¸æ›´æ–°</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">list</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Array</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="function">() =&gt;</span> []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">watch</span>: &#123;</span><br><span class="line">    <span class="attr">list</span>: &#123;</span><br><span class="line">      <span class="title function_">handler</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">        <span class="comment">// æ·±åº¦ç›‘å¬æ•°æ®å˜åŒ–</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">handleListChange</span>(newVal)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">deep</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2-äº‹ä»¶è§£ç»‘é—®é¢˜"><a href="#5-2-äº‹ä»¶è§£ç»‘é—®é¢˜" class="headerlink" title="5.2 äº‹ä»¶è§£ç»‘é—®é¢˜"></a>5.2 äº‹ä»¶è§£ç»‘é—®é¢˜</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">handlers</span>: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">addEventHandler</span>(<span class="params">handler</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">handlers</span>.<span class="title function_">push</span>(handler)</span><br><span class="line">      eventBus.<span class="title function_">on</span>(<span class="string">&#x27;someEvent&#x27;</span>, handler)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeDestroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ç»Ÿä¸€è§£ç»‘äº‹ä»¶</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">handlers</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">handler</span> =&gt;</span> &#123;</span><br><span class="line">      eventBus.<span class="title function_">off</span>(<span class="string">&#x27;someEvent&#x27;</span>, handler)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-æ€»ç»“"><a href="#6-æ€»ç»“" class="headerlink" title="6. æ€»ç»“"></a>6. æ€»ç»“</h2><ol><li>äº†è§£å„ç§é€šä¿¡æ–¹å¼çš„ç‰¹ç‚¹</li><li>æ ¹æ®åœºæ™¯é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆ</li><li>æ³¨æ„æ€§èƒ½å’Œå†…å­˜é—®é¢˜</li><li>åšå¥½äº‹ä»¶è§£ç»‘å’Œé”€æ¯</li><li>ä¿æŒä»£ç çš„å¯ç»´æŠ¤æ€§</li></ol><hr><blockquote><p>å¦‚æœè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©,æ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«,ä½ çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼ </p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/uni-app/">uni-app</category>
      
      
      <category domain="https://www.hzv5.cn/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/tags/uni-app/">uni-app</category>
      
      <category domain="https://www.hzv5.cn/tags/Vue/">Vue</category>
      
      <category domain="https://www.hzv5.cn/tags/%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1/">ç»„ä»¶é€šä¿¡</category>
      
      
      <comments>https://www.hzv5.cn/2024/02/18/uniapp-component-communication/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>uni-appæ•°æ®å­˜å‚¨å…¨æ”»ç•¥ï¼šä»æœ¬åœ°å­˜å‚¨åˆ°æŒä¹…åŒ–æ–¹æ¡ˆ</title>
      <link>https://www.hzv5.cn/2024/01/05/uniapp-storage/</link>
      <guid>https://www.hzv5.cn/2024/01/05/uniapp-storage/</guid>
      <pubDate>Fri, 05 Jan 2024 08:20:00 GMT</pubDate>
      
      <description>æ·±å…¥è®²è§£uni-appä¸­çš„æ•°æ®å­˜å‚¨æ–¹æ¡ˆ,åŒ…æ‹¬æœ¬åœ°å­˜å‚¨çš„ä½¿ç”¨æŠ€å·§ã€æŒä¹…åŒ–æ–¹æ¡ˆçš„é€‰æ‹©ã€æ•°æ®åŒæ­¥ç­–ç•¥ç­‰,å¸®åŠ©ä½ æ›´å¥½åœ°ç®¡ç†åº”ç”¨æ•°æ®ã€‚</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>æ•°æ®å­˜å‚¨æ˜¯åº”ç”¨å¼€å‘ä¸­çš„é‡è¦ç¯èŠ‚,é€‰æ‹©åˆé€‚çš„å­˜å‚¨æ–¹æ¡ˆå¯¹æå‡ç”¨æˆ·ä½“éªŒè‡³å…³é‡è¦ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»uni-appä¸­çš„æ•°æ®å­˜å‚¨æœ€ä½³å®è·µã€‚</p></blockquote><span id="more"></span><h2 id="1-æœ¬åœ°å­˜å‚¨åŸºç¡€"><a href="#1-æœ¬åœ°å­˜å‚¨åŸºç¡€" class="headerlink" title="1. æœ¬åœ°å­˜å‚¨åŸºç¡€"></a>1. æœ¬åœ°å­˜å‚¨åŸºç¡€</h2><h3 id="1-1-Storage-APIå°è£…"><a href="#1-1-Storage-APIå°è£…" class="headerlink" title="1.1 Storage APIå°è£…"></a>1.1 Storage APIå°è£…</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/storage.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Storage</span> &#123;</span><br><span class="line">  <span class="comment">// è®¾ç½®å­˜å‚¨</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">set</span>(<span class="params">key, value, expired = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">      value,</span><br><span class="line">      <span class="attr">expired</span>: expired ? <span class="title class_">Date</span>.<span class="title function_">now</span>() + expired * <span class="number">1000</span> : <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    uni.<span class="title function_">setStorageSync</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è·å–å­˜å‚¨</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = uni.<span class="title function_">getStorageSync</span>(key)</span><br><span class="line">    <span class="keyword">if</span> (!data) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> &#123; value, expired &#125; = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data)</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">    <span class="keyword">if</span> (expired &amp;&amp; expired &lt; <span class="title class_">Date</span>.<span class="title function_">now</span>()) &#123;</span><br><span class="line">      uni.<span class="title function_">removeStorageSync</span>(key)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç§»é™¤å­˜å‚¨</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">remove</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    uni.<span class="title function_">removeStorageSync</span>(key)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ¸…ç©ºå­˜å‚¨</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    uni.<span class="title function_">clearStorageSync</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Storage</span></span><br></pre></td></tr></table></figure><h3 id="1-2-ä½¿ç”¨ç¤ºä¾‹"><a href="#1-2-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="1.2 ä½¿ç”¨ç¤ºä¾‹"></a>1.2 ä½¿ç”¨ç¤ºä¾‹</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­˜å‚¨æ•°æ®(7å¤©è¿‡æœŸ)</span></span><br><span class="line"><span class="title class_">Storage</span>.<span class="title function_">set</span>(<span class="string">&#x27;userInfo&#x27;</span>, &#123; <span class="attr">name</span>: <span class="string">&#x27;Tom&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;, <span class="number">7</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ•°æ®</span></span><br><span class="line"><span class="keyword">const</span> userInfo = <span class="title class_">Storage</span>.<span class="title function_">get</span>(<span class="string">&#x27;userInfo&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç§»é™¤æ•°æ®</span></span><br><span class="line"><span class="title class_">Storage</span>.<span class="title function_">remove</span>(<span class="string">&#x27;userInfo&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¸…ç©ºæ‰€æœ‰æ•°æ®</span></span><br><span class="line"><span class="title class_">Storage</span>.<span class="title function_">clear</span>()</span><br></pre></td></tr></table></figure><h2 id="2-é«˜çº§å­˜å‚¨æ–¹æ¡ˆ"><a href="#2-é«˜çº§å­˜å‚¨æ–¹æ¡ˆ" class="headerlink" title="2. é«˜çº§å­˜å‚¨æ–¹æ¡ˆ"></a>2. é«˜çº§å­˜å‚¨æ–¹æ¡ˆ</h2><h3 id="2-1-åŠ å¯†å­˜å‚¨"><a href="#2-1-åŠ å¯†å­˜å‚¨" class="headerlink" title="2.1 åŠ å¯†å­˜å‚¨"></a>2.1 åŠ å¯†å­˜å‚¨</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/crypto.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">CryptoJS</span> <span class="keyword">from</span> <span class="string">&#x27;crypto-js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SECRET_KEY</span> = <span class="string">&#x27;your-secret-key&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">encrypt</span> = (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">encrypt</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data), <span class="variable constant_">SECRET_KEY</span>).<span class="title function_">toString</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">decrypt</span> = (<span class="params">ciphertext</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> bytes = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">decrypt</span>(ciphertext, <span class="variable constant_">SECRET_KEY</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(bytes.<span class="title function_">toString</span>(<span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ å¯†å­˜å‚¨ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SecureStorage</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">set</span>(<span class="params">key, value, expired = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">      <span class="attr">value</span>: <span class="title function_">encrypt</span>(value),</span><br><span class="line">      <span class="attr">expired</span>: expired ? <span class="title class_">Date</span>.<span class="title function_">now</span>() + expired * <span class="number">1000</span> : <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    uni.<span class="title function_">setStorageSync</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = uni.<span class="title function_">getStorageSync</span>(key)</span><br><span class="line">    <span class="keyword">if</span> (!data) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> &#123; value, expired &#125; = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data)</span><br><span class="line">    <span class="keyword">if</span> (expired &amp;&amp; expired &lt; <span class="title class_">Date</span>.<span class="title function_">now</span>()) &#123;</span><br><span class="line">      uni.<span class="title function_">removeStorageSync</span>(key)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">decrypt</span>(value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-æ•°æ®å‹ç¼©å­˜å‚¨"><a href="#2-2-æ•°æ®å‹ç¼©å­˜å‚¨" class="headerlink" title="2.2 æ•°æ®å‹ç¼©å­˜å‚¨"></a>2.2 æ•°æ®å‹ç¼©å­˜å‚¨</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/compress.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; deflate, inflate &#125; <span class="keyword">from</span> <span class="string">&#x27;pako&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CompressStorage</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">set</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">    <span class="comment">// è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²å¹¶å‹ç¼©</span></span><br><span class="line">    <span class="keyword">const</span> compressed = <span class="title function_">deflate</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(value))</span><br><span class="line">    uni.<span class="title function_">setStorageSync</span>(key, compressed)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> compressed = uni.<span class="title function_">getStorageSync</span>(key)</span><br><span class="line">    <span class="keyword">if</span> (!compressed) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è§£å‹å¹¶è§£æJSON</span></span><br><span class="line">    <span class="keyword">const</span> decompressed = <span class="title function_">inflate</span>(compressed, &#123; <span class="attr">to</span>: <span class="string">&#x27;string&#x27;</span> &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(decompressed)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-æŒä¹…åŒ–å­˜å‚¨ç­–ç•¥"><a href="#3-æŒä¹…åŒ–å­˜å‚¨ç­–ç•¥" class="headerlink" title="3. æŒä¹…åŒ–å­˜å‚¨ç­–ç•¥"></a>3. æŒä¹…åŒ–å­˜å‚¨ç­–ç•¥</h2><h3 id="3-1-VuexæŒä¹…åŒ–"><a href="#3-1-VuexæŒä¹…åŒ–" class="headerlink" title="3.1 VuexæŒä¹…åŒ–"></a>3.1 VuexæŒä¹…åŒ–</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Storage</span> <span class="keyword">from</span> <span class="string">&#x27;@/utils/storage&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">STORAGE_KEY</span> = <span class="string">&#x27;vuex_store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">userInfo</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">settings</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">setState</span>(<span class="params">state, payload</span>) &#123;</span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">assign</span>(state, payload)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–çŠ¶æ€</span></span><br><span class="line">    <span class="title function_">initState</span>(<span class="params">&#123; commit &#125;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> data = <span class="title class_">Storage</span>.<span class="title function_">get</span>(<span class="variable constant_">STORAGE_KEY</span>)</span><br><span class="line">      <span class="keyword">if</span> (data) &#123;</span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&#x27;setState&#x27;</span>, data)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ä¿å­˜çŠ¶æ€</span></span><br><span class="line">    <span class="title function_">saveState</span>(<span class="params">&#123; state &#125;</span>) &#123;</span><br><span class="line">      <span class="title class_">Storage</span>.<span class="title function_">set</span>(<span class="variable constant_">STORAGE_KEY</span>, state)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="3-2-è‡ªåŠ¨åŒæ­¥æœºåˆ¶"><a href="#3-2-è‡ªåŠ¨åŒæ­¥æœºåˆ¶" class="headerlink" title="3.2 è‡ªåŠ¨åŒæ­¥æœºåˆ¶"></a>3.2 è‡ªåŠ¨åŒæ­¥æœºåˆ¶</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mixins/storage-sync.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ç›‘å¬åº”ç”¨è¿›å…¥åå°</span></span><br><span class="line">    uni.<span class="title function_">onAppHide</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&#x27;saveState&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç›‘å¬ç½‘ç»œçŠ¶æ€</span></span><br><span class="line">    uni.<span class="title function_">onNetworkStatusChange</span>(<span class="function">(<span class="params">&#123; isConnected &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (isConnected) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">syncDataToServer</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">syncDataToServer</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> localData = <span class="title class_">Storage</span>.<span class="title function_">get</span>(<span class="string">&#x27;offlineData&#x27;</span>) || []</span><br><span class="line">        <span class="keyword">if</span> (localData.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¸Šä¼ æœ¬åœ°æ•°æ®åˆ°æœåŠ¡å™¨</span></span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">$api</span>.<span class="title function_">syncData</span>(localData)</span><br><span class="line">        <span class="comment">// æ¸…ç©ºæœ¬åœ°ç¼“å­˜</span></span><br><span class="line">        <span class="title class_">Storage</span>.<span class="title function_">remove</span>(<span class="string">&#x27;offlineData&#x27;</span>)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;æ•°æ®åŒæ­¥å¤±è´¥&#x27;</span>, err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-å­˜å‚¨ä¼˜åŒ–æŠ€å·§"><a href="#4-å­˜å‚¨ä¼˜åŒ–æŠ€å·§" class="headerlink" title="4. å­˜å‚¨ä¼˜åŒ–æŠ€å·§"></a>4. å­˜å‚¨ä¼˜åŒ–æŠ€å·§</h2><h3 id="4-1-åˆ†ç‰‡å­˜å‚¨"><a href="#4-1-åˆ†ç‰‡å­˜å‚¨" class="headerlink" title="4.1 åˆ†ç‰‡å­˜å‚¨"></a>4.1 åˆ†ç‰‡å­˜å‚¨</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ChunkStorage</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="variable constant_">CHUNK_SIZE</span> = <span class="number">1024</span> * <span class="number">1024</span> <span class="comment">// 1MB</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">set</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(value)</span><br><span class="line">    <span class="keyword">const</span> chunks = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ†ç‰‡å­˜å‚¨</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; data.<span class="property">length</span>; i += <span class="variable language_">this</span>.<span class="property">CHUNK_SIZE</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> chunk = data.<span class="title function_">slice</span>(i, i + <span class="variable language_">this</span>.<span class="property">CHUNK_SIZE</span>)</span><br><span class="line">      chunks.<span class="title function_">push</span>(chunk)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å­˜å‚¨åˆ†ç‰‡ä¿¡æ¯</span></span><br><span class="line">    uni.<span class="title function_">setStorageSync</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span>_info`</span>, &#123;</span><br><span class="line">      <span class="attr">chunks</span>: chunks.<span class="property">length</span>,</span><br><span class="line">      <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å­˜å‚¨å„ä¸ªåˆ†ç‰‡</span></span><br><span class="line">    chunks.<span class="title function_">forEach</span>(<span class="function">(<span class="params">chunk, index</span>) =&gt;</span> &#123;</span><br><span class="line">      uni.<span class="title function_">setStorageSync</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span>_<span class="subst">$&#123;index&#125;</span>`</span>, chunk)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> info = uni.<span class="title function_">getStorageSync</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span>_info`</span>)</span><br><span class="line">    <span class="keyword">if</span> (!info) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå¹¶åˆ†ç‰‡</span></span><br><span class="line">    <span class="keyword">let</span> data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; info.<span class="property">chunks</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> chunk = uni.<span class="title function_">getStorageSync</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span>_<span class="subst">$&#123;i&#125;</span>`</span>)</span><br><span class="line">      data += chunk</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-å­˜å‚¨ç›‘æ§"><a href="#4-2-å­˜å‚¨ç›‘æ§" class="headerlink" title="4.2 å­˜å‚¨ç›‘æ§"></a>4.2 å­˜å‚¨ç›‘æ§</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StorageMonitor</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">checkSize</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; currentSize, limitSize &#125; = <span class="keyword">await</span> uni.<span class="title function_">getStorageInfo</span>()</span><br><span class="line">      <span class="keyword">const</span> usage = (currentSize / limitSize) * <span class="number">100</span></span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (usage &gt; <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">`å­˜å‚¨ç©ºé—´ä½¿ç”¨ç‡è¿‡é«˜: <span class="subst">$&#123;usage.toFixed(<span class="number">2</span>)&#125;</span>%`</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">cleanExpiredData</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;å­˜å‚¨ç›‘æ§å¤±è´¥&#x27;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">cleanExpiredData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> keys = uni.<span class="title function_">getStorageInfoSync</span>().<span class="property">keys</span></span><br><span class="line">    keys.<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> data = uni.<span class="title function_">getStorageSync</span>(key)</span><br><span class="line">      <span class="keyword">if</span> (data &amp;&amp; data.<span class="property">expired</span> &amp;&amp; data.<span class="property">expired</span> &lt; <span class="title class_">Date</span>.<span class="title function_">now</span>()) &#123;</span><br><span class="line">        uni.<span class="title function_">removeStorageSync</span>(key)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-å®è·µå»ºè®®"><a href="#5-å®è·µå»ºè®®" class="headerlink" title="5. å®è·µå»ºè®®"></a>5. å®è·µå»ºè®®</h2><h3 id="5-1-æ€§èƒ½ä¼˜åŒ–"><a href="#5-1-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="5.1 æ€§èƒ½ä¼˜åŒ–"></a>5.1 æ€§èƒ½ä¼˜åŒ–</h3><ol><li>é¿å…é¢‘ç¹è¯»å†™æ“ä½œ</li><li>åˆç†ä½¿ç”¨è¿‡æœŸæ—¶é—´</li><li>åŠæ—¶æ¸…ç†æ— ç”¨æ•°æ®</li><li>å¤§æ•°æ®è€ƒè™‘åˆ†ç‰‡å­˜å‚¨</li></ol><h3 id="5-2-å®‰å…¨å»ºè®®"><a href="#5-2-å®‰å…¨å»ºè®®" class="headerlink" title="5.2 å®‰å…¨å»ºè®®"></a>5.2 å®‰å…¨å»ºè®®</h3><ol><li>æ•æ„Ÿæ•°æ®å¿…é¡»åŠ å¯†</li><li>å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®</li><li>é¿å…å­˜å‚¨æ˜æ–‡å¯†ç </li><li>æ§åˆ¶å­˜å‚¨å¤§å°</li></ol><h2 id="6-æ€»ç»“"><a href="#6-æ€»ç»“" class="headerlink" title="6. æ€»ç»“"></a>6. æ€»ç»“</h2><ol><li>åˆç†å°è£…Storage API</li><li>é€‰æ‹©åˆé€‚çš„å­˜å‚¨æ–¹æ¡ˆ</li><li>å®ç°æ•°æ®æŒä¹…åŒ–</li><li>æ³¨æ„æ€§èƒ½å’Œå®‰å…¨</li><li>åšå¥½å­˜å‚¨ç›‘æ§</li></ol><hr><blockquote><p>å¦‚æœè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©,æ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«,ä½ çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼</p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/uni-app/">uni-app</category>
      
      
      <category domain="https://www.hzv5.cn/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/tags/uni-app/">uni-app</category>
      
      <category domain="https://www.hzv5.cn/tags/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/">æ•°æ®å­˜å‚¨</category>
      
      <category domain="https://www.hzv5.cn/tags/%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8/">æœ¬åœ°å­˜å‚¨</category>
      
      
      <comments>https://www.hzv5.cn/2024/01/05/uniapp-storage/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>uni-appç½‘ç»œè¯·æ±‚æœ€ä½³å®è·µï¼šå°è£…ã€æ‹¦æˆªä¸é”™è¯¯å¤„ç†</title>
      <link>https://www.hzv5.cn/2023/11/28/uniapp-request/</link>
      <guid>https://www.hzv5.cn/2023/11/28/uniapp-request/</guid>
      <pubDate>Tue, 28 Nov 2023 01:45:00 GMT</pubDate>
      
      <description>è¯¦ç»†ä»‹ç»uni-appä¸­ç½‘ç»œè¯·æ±‚çš„æœ€ä½³å®è·µ,åŒ…æ‹¬è¯·æ±‚å°è£…ã€æ‹¦æˆªå™¨é…ç½®ã€é”™è¯¯å¤„ç†ã€tokenåˆ·æ–°ç­‰å…³é”®æŠ€æœ¯ç‚¹,å¸®åŠ©ä½ æ„å»ºæ›´å¥å£®çš„åº”ç”¨ã€‚</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>ç½‘ç»œè¯·æ±‚æ˜¯å‰ç«¯åº”ç”¨çš„é‡ä¸­ä¹‹é‡,ä¸€ä¸ªå¥½çš„è¯·æ±‚å°è£…å¯ä»¥è®©å¼€å‘äº‹åŠåŠŸå€ã€‚æœ¬æ–‡å°†åˆ†äº«uni-appç½‘ç»œè¯·æ±‚çš„æœ€ä½³å®è·µç»éªŒã€‚</p></blockquote><span id="more"></span><h2 id="1-åŸºç¡€è¯·æ±‚å°è£…"><a href="#1-åŸºç¡€è¯·æ±‚å°è£…" class="headerlink" title="1. åŸºç¡€è¯·æ±‚å°è£…"></a>1. åŸºç¡€è¯·æ±‚å°è£…</h2><h3 id="1-1-åˆ›å»ºè¯·æ±‚å®ä¾‹"><a href="#1-1-åˆ›å»ºè¯·æ±‚å®ä¾‹" class="headerlink" title="1.1 åˆ›å»ºè¯·æ±‚å®ä¾‹"></a>1.1 åˆ›å»ºè¯·æ±‚å®ä¾‹</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/request.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">request</span> = (<span class="params">options = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_BASE_API</span> + options.<span class="property">url</span>,</span><br><span class="line">      <span class="attr">method</span>: options.<span class="property">method</span> || <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: options.<span class="property">data</span> || &#123;&#125;,</span><br><span class="line">      <span class="attr">header</span>: options.<span class="property">header</span> || &#123;&#125;,</span><br><span class="line">      <span class="attr">timeout</span>: options.<span class="property">timeout</span> || <span class="number">60000</span>,</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> <span class="title function_">resolve</span>(res.<span class="property">data</span>),</span><br><span class="line">      <span class="attr">fail</span>: <span class="function">(<span class="params">err</span>) =&gt;</span> <span class="title function_">reject</span>(err)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> request</span><br></pre></td></tr></table></figure><h3 id="1-2-æ·»åŠ æ‹¦æˆªå™¨"><a href="#1-2-æ·»åŠ æ‹¦æˆªå™¨" class="headerlink" title="1.2 æ·»åŠ æ‹¦æˆªå™¨"></a>1.2 æ·»åŠ æ‹¦æˆªå™¨</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> httpInterceptor = &#123;</span><br><span class="line">  <span class="comment">// è¯·æ±‚æ‹¦æˆª</span></span><br><span class="line">  <span class="title function_">invoke</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="comment">// 1. éhttpå¼€å¤´éœ€æ‹¼æ¥åœ°å€</span></span><br><span class="line">    <span class="keyword">if</span> (!options.<span class="property">url</span>.<span class="title function_">startsWith</span>(<span class="string">&#x27;http&#x27;</span>)) &#123;</span><br><span class="line">      options.<span class="property">url</span> = baseURL + options.<span class="property">url</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. è¯·æ±‚è¶…æ—¶</span></span><br><span class="line">    options.<span class="property">timeout</span> = <span class="number">10000</span></span><br><span class="line">    <span class="comment">// 3. æ·»åŠ å°ç¨‹åºç«¯è¯·æ±‚å¤´æ ‡è¯†</span></span><br><span class="line">    options.<span class="property">header</span> = &#123;</span><br><span class="line">      ...options.<span class="property">header</span>,</span><br><span class="line">      <span class="string">&#x27;source-client&#x27;</span>: <span class="string">&#x27;miniapp&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. æ·»åŠ tokenè¯·æ±‚å¤´æ ‡è¯†</span></span><br><span class="line">    <span class="keyword">const</span> token = uni.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">      options.<span class="property">header</span>.<span class="property">Authorization</span> = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> options</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œæ‹¦æˆªå™¨</span></span><br><span class="line">uni.<span class="title function_">addInterceptor</span>(<span class="string">&#x27;request&#x27;</span>, httpInterceptor)</span><br><span class="line">uni.<span class="title function_">addInterceptor</span>(<span class="string">&#x27;uploadFile&#x27;</span>, httpInterceptor)</span><br></pre></td></tr></table></figure><h2 id="2-å¸¸è§é”™è¯¯å¤„ç†"><a href="#2-å¸¸è§é”™è¯¯å¤„ç†" class="headerlink" title="2. å¸¸è§é”™è¯¯å¤„ç†"></a>2. å¸¸è§é”™è¯¯å¤„ç†</h2><h3 id="2-1-ç»Ÿä¸€é”™è¯¯å¤„ç†"><a href="#2-1-ç»Ÿä¸€é”™è¯¯å¤„ç†" class="headerlink" title="2.1 ç»Ÿä¸€é”™è¯¯å¤„ç†"></a>2.1 ç»Ÿä¸€é”™è¯¯å¤„ç†</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">errorHandle</span> = (<span class="params">response</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> status = response.<span class="property">statusCode</span></span><br><span class="line">  <span class="comment">// çŠ¶æ€ç åˆ¤æ–­</span></span><br><span class="line">  <span class="keyword">switch</span> (status) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">401</span>:</span><br><span class="line">      <span class="comment">// tokenå¤±æ•ˆ,é‡æ–°ç™»å½•</span></span><br><span class="line">      uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/pages/login/index&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">403</span>:</span><br><span class="line">      <span class="comment">// æœåŠ¡å™¨æ‹’ç»æ‰§è¡Œ</span></span><br><span class="line">      uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;æœåŠ¡å™¨æ‹’ç»æ‰§è¡Œ&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">404</span>:</span><br><span class="line">      <span class="comment">// è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨</span></span><br><span class="line">      uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="comment">// å…¶ä»–é”™è¯¯</span></span><br><span class="line">      uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: response.<span class="property">data</span>.<span class="property">message</span> || <span class="string">&#x27;è¯·æ±‚å¤±è´¥&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(response)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-è¯·æ±‚é‡è¯•æœºåˆ¶"><a href="#2-2-è¯·æ±‚é‡è¯•æœºåˆ¶" class="headerlink" title="2.2 è¯·æ±‚é‡è¯•æœºåˆ¶"></a>2.2 è¯·æ±‚é‡è¯•æœºåˆ¶</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">retry</span> = (<span class="params">fn, times = <span class="number">3</span>, delay = <span class="number">1000</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">attempt</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">fn</span>().<span class="title function_">then</span>(resolve).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`è¯·æ±‚å¤±è´¥,å‰©ä½™é‡è¯•æ¬¡æ•°:<span class="subst">$&#123;times - <span class="number">1</span>&#125;</span>`</span>)</span><br><span class="line">        <span class="keyword">if</span> (times - <span class="number">1</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          times--</span><br><span class="line">          <span class="built_in">setTimeout</span>(attempt, delay)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title function_">reject</span>(err)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">attempt</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="title function_">retry</span>(<span class="function">() =&gt;</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;/api/data&#x27;</span>,</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span></span><br><span class="line">&#125;)).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¯·æ±‚æˆåŠŸ&#x27;</span>, res)</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;é‡è¯•åä¾ç„¶å¤±è´¥&#x27;</span>, err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="3-Tokenåˆ·æ–°æ–¹æ¡ˆ"><a href="#3-Tokenåˆ·æ–°æ–¹æ¡ˆ" class="headerlink" title="3. Tokenåˆ·æ–°æ–¹æ¡ˆ"></a>3. Tokenåˆ·æ–°æ–¹æ¡ˆ</h2><h3 id="3-1-æ— æ„Ÿåˆ·æ–°Token"><a href="#3-1-æ— æ„Ÿåˆ·æ–°Token" class="headerlink" title="3.1 æ— æ„Ÿåˆ·æ–°Token"></a>3.1 æ— æ„Ÿåˆ·æ–°Token</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> isRefreshing = <span class="literal">false</span></span><br><span class="line"><span class="keyword">let</span> requests = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">refreshToken</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (isRefreshing) &#123;</span><br><span class="line">    <span class="comment">// è¿”å›Promise,å°†å…¶ä»–è¯·æ±‚ç¼“å­˜</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">      requests.<span class="title function_">push</span>(<span class="function">(<span class="params">token</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(token)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  isRefreshing = <span class="literal">true</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/auth/refresh&#x27;</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">refresh_token</span>: uni.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;refresh_token&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      isRefreshing = <span class="literal">false</span></span><br><span class="line">      <span class="comment">// æ›´æ–°token</span></span><br><span class="line">      uni.<span class="title function_">setStorageSync</span>(<span class="string">&#x27;token&#x27;</span>, res.<span class="property">token</span>)</span><br><span class="line">      <span class="comment">// æ‰§è¡Œç¼“å­˜çš„è¯·æ±‚</span></span><br><span class="line">      requests.<span class="title function_">forEach</span>(<span class="function"><span class="params">cb</span> =&gt;</span> <span class="title function_">cb</span>(res.<span class="property">token</span>))</span><br><span class="line">      requests = []</span><br><span class="line">      <span class="title function_">resolve</span>(res.<span class="property">token</span>)</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      isRefreshing = <span class="literal">false</span></span><br><span class="line">      <span class="comment">// tokenåˆ·æ–°å¤±è´¥,æ¸…ç©ºç¼“å­˜</span></span><br><span class="line">      uni.<span class="title function_">clearStorageSync</span>()</span><br><span class="line">      <span class="comment">// è·³è½¬ç™»å½•é¡µ</span></span><br><span class="line">      uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/pages/login/index&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="title function_">reject</span>(err)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-è¯·æ±‚æ‹¦æˆªä¸­åº”ç”¨"><a href="#3-2-è¯·æ±‚æ‹¦æˆªä¸­åº”ç”¨" class="headerlink" title="3.2 è¯·æ±‚æ‹¦æˆªä¸­åº”ç”¨"></a>3.2 è¯·æ±‚æ‹¦æˆªä¸­åº”ç”¨</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> httpInterceptor = &#123;</span><br><span class="line">  <span class="title function_">invoke</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="comment">// ... å…¶ä»–é…ç½®</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ¤æ–­tokenæ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isTokenExpired</span>() &amp;&amp; !options.<span class="property">url</span>.<span class="title function_">includes</span>(<span class="string">&#x27;/auth&#x27;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">refreshToken</span>().<span class="title function_">then</span>(<span class="function"><span class="params">token</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// æ›´æ–°tokenåé‡æ–°å‘èµ·è¯·æ±‚</span></span><br><span class="line">        options.<span class="property">header</span>.<span class="property">Authorization</span> = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span></span><br><span class="line">        <span class="keyword">return</span> uni.<span class="title function_">request</span>(options)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> options</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-ä¸Šä¼ ä¸‹è½½å¤„ç†"><a href="#4-ä¸Šä¼ ä¸‹è½½å¤„ç†" class="headerlink" title="4. ä¸Šä¼ ä¸‹è½½å¤„ç†"></a>4. ä¸Šä¼ ä¸‹è½½å¤„ç†</h2><h3 id="4-1-æ–‡ä»¶ä¸Šä¼ å°è£…"><a href="#4-1-æ–‡ä»¶ä¸Šä¼ å°è£…" class="headerlink" title="4.1 æ–‡ä»¶ä¸Šä¼ å°è£…"></a>4.1 æ–‡ä»¶ä¸Šä¼ å°è£…</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">upload</span> = (<span class="params">options = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    uni.<span class="title function_">uploadFile</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_BASE_API</span> + options.<span class="property">url</span>,</span><br><span class="line">      <span class="attr">filePath</span>: options.<span class="property">filePath</span>,</span><br><span class="line">      <span class="attr">name</span>: options.<span class="property">name</span> || <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">      <span class="attr">header</span>: &#123;</span><br><span class="line">        ...options.<span class="property">header</span>,</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;multipart/form-data&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> <span class="title function_">resolve</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(res.<span class="property">data</span>)),</span><br><span class="line">      <span class="attr">fail</span>: <span class="function">(<span class="params">err</span>) =&gt;</span> <span class="title function_">reject</span>(err)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-æ–‡ä»¶ä¸‹è½½å°è£…"><a href="#4-2-æ–‡ä»¶ä¸‹è½½å°è£…" class="headerlink" title="4.2 æ–‡ä»¶ä¸‹è½½å°è£…"></a>4.2 æ–‡ä»¶ä¸‹è½½å°è£…</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">download</span> = (<span class="params">options = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    uni.<span class="title function_">downloadFile</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: options.<span class="property">url</span>,</span><br><span class="line">      <span class="attr">header</span>: options.<span class="property">header</span>,</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">statusCode</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(res.<span class="property">tempFilePath</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;ä¸‹è½½å¤±è´¥&#x27;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">fail</span>: <span class="function">(<span class="params">err</span>) =&gt;</span> <span class="title function_">reject</span>(err)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-ä½¿ç”¨ç¤ºä¾‹"><a href="#5-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="5. ä½¿ç”¨ç¤ºä¾‹"></a>5. ä½¿ç”¨ç¤ºä¾‹</h2><h3 id="5-1-åŸºç¡€è¯·æ±‚"><a href="#5-1-åŸºç¡€è¯·æ±‚" class="headerlink" title="5.1 åŸºç¡€è¯·æ±‚"></a>5.1 åŸºç¡€è¯·æ±‚</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// api/user.js</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getUserInfo</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/user/info&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// pages/index/index.vue</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> userInfo = <span class="keyword">await</span> <span class="title function_">getUserInfo</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">userInfo</span> = userInfo</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2-æ–‡ä»¶ä¸Šä¼ "><a href="#5-2-æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="5.2 æ–‡ä»¶ä¸Šä¼ "></a>5.2 æ–‡ä»¶ä¸Šä¼ </h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€‰æ‹©å›¾ç‰‡å¹¶ä¸Šä¼ </span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">chooseAndUpload</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [tempFile] = <span class="keyword">await</span> uni.<span class="title function_">chooseImage</span>(&#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">1</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">upload</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/upload&#x27;</span>,</span><br><span class="line">      <span class="attr">filePath</span>: tempFile.<span class="property">path</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;file&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ä¸Šä¼ æˆåŠŸ&#x27;</span>, res)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;ä¸Šä¼ å¤±è´¥&#x27;</span>, err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-æ€»ç»“"><a href="#6-æ€»ç»“" class="headerlink" title="6. æ€»ç»“"></a>6. æ€»ç»“</h2><ol><li>ç»Ÿä¸€å°è£…è¯·æ±‚æ–¹æ³•</li><li>æ·»åŠ è¯·æ±‚/å“åº”æ‹¦æˆªå™¨</li><li>å®ç°é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶</li><li>å¤„ç†tokenåˆ·æ–°</li><li>å°è£…ä¸Šä¼ ä¸‹è½½æ–¹æ³•</li></ol><hr><blockquote><p>å¦‚æœè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©,æ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«,ä½ çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼</p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/uni-app/">uni-app</category>
      
      
      <category domain="https://www.hzv5.cn/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/tags/uni-app/">uni-app</category>
      
      <category domain="https://www.hzv5.cn/tags/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/">ç½‘ç»œè¯·æ±‚</category>
      
      <category domain="https://www.hzv5.cn/tags/API%E5%B0%81%E8%A3%85/">APIå°è£…</category>
      
      
      <comments>https://www.hzv5.cn/2023/11/28/uniapp-request/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>uni-appç”Ÿå‘½å‘¨æœŸè¸©å‘æŒ‡å—ï¼šå¸¸è§é”™è¯¯ä¸æœ€ä½³å®è·µ</title>
      <link>https://www.hzv5.cn/2023/10/15/uniapp-lifecycle/</link>
      <guid>https://www.hzv5.cn/2023/10/15/uniapp-lifecycle/</guid>
      <pubDate>Sun, 15 Oct 2023 06:30:00 GMT</pubDate>
      
      <description>æ·±å…¥è§£æuni-appä¸­çš„ç”Ÿå‘½å‘¨æœŸæœºåˆ¶,åŒ…æ‹¬åº”ç”¨ç”Ÿå‘½å‘¨æœŸã€é¡µé¢ç”Ÿå‘½å‘¨æœŸå’Œç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„åŒºåˆ«ä¸è”ç³»,ä»¥åŠå®é™…å¼€å‘ä¸­çš„å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆã€‚</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>åœ¨uni-appå¼€å‘ä¸­,æ­£ç¡®ç†è§£å’Œä½¿ç”¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ˜¯é¿å…å„ç§å¼‚å¸¸é—®é¢˜çš„å…³é”®ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»uni-appç”Ÿå‘½å‘¨æœŸä¸­çš„å¸¸è§é™·é˜±å’Œè§£å†³æ–¹æ¡ˆã€‚</p></blockquote><span id="more"></span><h2 id="1-ç”Ÿå‘½å‘¨æœŸçš„ä¸‰ä¸ªå±‚æ¬¡"><a href="#1-ç”Ÿå‘½å‘¨æœŸçš„ä¸‰ä¸ªå±‚æ¬¡" class="headerlink" title="1. ç”Ÿå‘½å‘¨æœŸçš„ä¸‰ä¸ªå±‚æ¬¡"></a>1. ç”Ÿå‘½å‘¨æœŸçš„ä¸‰ä¸ªå±‚æ¬¡</h2><h3 id="1-1-åº”ç”¨ç”Ÿå‘½å‘¨æœŸ"><a href="#1-1-åº”ç”¨ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="1.1 åº”ç”¨ç”Ÿå‘½å‘¨æœŸ"></a>1.1 åº”ç”¨ç”Ÿå‘½å‘¨æœŸ</h3><ul><li>onLaunch: åˆå§‹åŒ–å®Œæˆæ—¶è§¦å‘,<strong>åªè§¦å‘ä¸€æ¬¡</strong></li><li>onShow: ä»åå°è¿›å…¥å‰å°æ˜¾ç¤ºæ—¶è§¦å‘</li><li>onHide: ä»å‰å°è¿›å…¥åå°æ—¶è§¦å‘</li></ul><h3 id="1-2-é¡µé¢ç”Ÿå‘½å‘¨æœŸ"><a href="#1-2-é¡µé¢ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="1.2 é¡µé¢ç”Ÿå‘½å‘¨æœŸ"></a>1.2 é¡µé¢ç”Ÿå‘½å‘¨æœŸ</h3><ul><li>onLoad: é¡µé¢åŠ è½½æ—¶è§¦å‘,å¯è·å–è·¯ç”±å‚æ•°</li><li>onShow: é¡µé¢æ˜¾ç¤º/åˆ‡å…¥å‰å°æ—¶è§¦å‘</li><li>onReady: é¡µé¢åˆæ¬¡æ¸²æŸ“å®Œæˆæ—¶è§¦å‘</li><li>onHide: é¡µé¢éšè—/åˆ‡å…¥åå°æ—¶è§¦å‘</li><li>onUnload: é¡µé¢å¸è½½æ—¶è§¦å‘</li></ul><h3 id="1-3-ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ"><a href="#1-3-ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="1.3 ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ"></a>1.3 ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ</h3><ul><li>beforeCreate/created: Vueç»„ä»¶ç”Ÿå‘½å‘¨æœŸ</li><li>beforeMount/mounted: Vueç»„ä»¶ç”Ÿå‘½å‘¨æœŸ</li><li>beforeUpdate/updated: Vueç»„ä»¶ç”Ÿå‘½å‘¨æœŸ</li><li>beforeDestroy/destroyed: Vueç»„ä»¶ç”Ÿå‘½å‘¨æœŸ</li></ul><h2 id="2-å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ"><a href="#2-å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ" class="headerlink" title="2. å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ"></a>2. å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ</h2><h3 id="2-1-è·å–æ•°æ®æ—¶æœºé”™è¯¯"><a href="#2-1-è·å–æ•°æ®æ—¶æœºé”™è¯¯" class="headerlink" title="2.1 è·å–æ•°æ®æ—¶æœºé”™è¯¯"></a>2.1 è·å–æ•°æ®æ—¶æœºé”™è¯¯</h3><p>âŒ é”™è¯¯ç¤ºä¾‹:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">userInfo</span>: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// é”™è¯¯:åœ¨createdä¸­è·å–DOMå…ƒç´ </span></span><br><span class="line">    <span class="keyword">const</span> dom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>âœ… æ­£ç¡®ç¤ºä¾‹:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">userInfo</span>: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// æ­£ç¡®:åœ¨mountedä¸­è·å–DOMå…ƒç´ </span></span><br><span class="line">    <span class="keyword">const</span> dom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-è·¯ç”±å‚æ•°è·å–æ—¶æœº"><a href="#2-2-è·¯ç”±å‚æ•°è·å–æ—¶æœº" class="headerlink" title="2.2 è·¯ç”±å‚æ•°è·å–æ—¶æœº"></a>2.2 è·¯ç”±å‚æ•°è·å–æ—¶æœº</h3><p>âŒ é”™è¯¯ç¤ºä¾‹:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">onShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// é”™è¯¯:åœ¨onShowä¸­è·å–è·¯ç”±å‚æ•°</span></span><br><span class="line">    <span class="keyword">const</span> id = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>.<span class="property">id</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>âœ… æ­£ç¡®ç¤ºä¾‹:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">onLoad</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="comment">// æ­£ç¡®:åœ¨onLoadä¸­è·å–è·¯ç”±å‚æ•°</span></span><br><span class="line">    <span class="keyword">const</span> id = options.<span class="property">id</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-æ¡ä»¶ç¼–è¯‘ä½¿ç”¨é”™è¯¯"><a href="#2-3-æ¡ä»¶ç¼–è¯‘ä½¿ç”¨é”™è¯¯" class="headerlink" title="2.3 æ¡ä»¶ç¼–è¯‘ä½¿ç”¨é”™è¯¯"></a>2.3 æ¡ä»¶ç¼–è¯‘ä½¿ç”¨é”™è¯¯</h3><p>âŒ é”™è¯¯ç¤ºä¾‹:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// é”™è¯¯:ç›´æ¥åœ¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°å¤–ä½¿ç”¨æ¡ä»¶ç¼–è¯‘</span></span><br><span class="line">  #ifdef <span class="variable constant_">MP</span>-<span class="variable constant_">WEIXIN</span></span><br><span class="line">  <span class="title function_">onShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// å¾®ä¿¡å°ç¨‹åºç›¸å…³ä»£ç </span></span><br><span class="line">  &#125;</span><br><span class="line">  #endif</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>âœ… æ­£ç¡®ç¤ºä¾‹:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">onShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// æ­£ç¡®:åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨æ¡ä»¶ç¼–è¯‘</span></span><br><span class="line">    <span class="comment">// #ifdef MP-WEIXIN</span></span><br><span class="line">    <span class="comment">// å¾®ä¿¡å°ç¨‹åºç›¸å…³ä»£ç </span></span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-æ€§èƒ½ä¼˜åŒ–å»ºè®®"><a href="#3-æ€§èƒ½ä¼˜åŒ–å»ºè®®" class="headerlink" title="3. æ€§èƒ½ä¼˜åŒ–å»ºè®®"></a>3. æ€§èƒ½ä¼˜åŒ–å»ºè®®</h2><h3 id="3-1-åˆç†ä½¿ç”¨onLoadå’ŒonShow"><a href="#3-1-åˆç†ä½¿ç”¨onLoadå’ŒonShow" class="headerlink" title="3.1 åˆç†ä½¿ç”¨onLoadå’ŒonShow"></a>3.1 åˆç†ä½¿ç”¨onLoadå’ŒonShow</h3><ul><li>onLoad: é€‚åˆä¸€æ¬¡æ€§åˆå§‹åŒ–æ•°æ®</li><li>onShow: é€‚åˆéœ€è¦å®æ—¶æ›´æ–°çš„æ•°æ®</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">staticData</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">dynamicData</span>: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// è·å–ä¸€æ¬¡æ€§åˆå§‹åŒ–æ•°æ®</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getStaticData</span>()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// è·å–éœ€è¦å®æ—¶æ›´æ–°çš„æ•°æ®</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getDynamicData</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-é¿å…é‡å¤åˆå§‹åŒ–"><a href="#3-2-é¿å…é‡å¤åˆå§‹åŒ–" class="headerlink" title="3.2 é¿å…é‡å¤åˆå§‹åŒ–"></a>3.2 é¿å…é‡å¤åˆå§‹åŒ–</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">isInitialized</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">isInitialized</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">initialize</span>()</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isInitialized</span> = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-è·¨ç«¯å…¼å®¹å¤„ç†"><a href="#4-è·¨ç«¯å…¼å®¹å¤„ç†" class="headerlink" title="4. è·¨ç«¯å…¼å®¹å¤„ç†"></a>4. è·¨ç«¯å…¼å®¹å¤„ç†</h2><h3 id="4-1-å¹³å°å·®å¼‚åŒ–å¤„ç†"><a href="#4-1-å¹³å°å·®å¼‚åŒ–å¤„ç†" class="headerlink" title="4.1 å¹³å°å·®å¼‚åŒ–å¤„ç†"></a>4.1 å¹³å°å·®å¼‚åŒ–å¤„ç†</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// #ifdef MP-WEIXIN</span></span><br><span class="line">    <span class="comment">// å¾®ä¿¡å°ç¨‹åºç‰¹æœ‰çš„åˆå§‹åŒ–</span></span><br><span class="line">    wx.<span class="title function_">getSystemInfo</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">systemInfo</span> = res</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// #ifdef H5</span></span><br><span class="line">    <span class="comment">// H5ç‰¹æœ‰çš„åˆå§‹åŒ–</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleResize</span>)</span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onUnload</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// #ifdef H5</span></span><br><span class="line">    <span class="comment">// æ³¨æ„åœ¨é¡µé¢å¸è½½æ—¶ç§»é™¤äº‹ä»¶ç›‘å¬</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleResize</span>)</span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-ç”Ÿå‘½å‘¨æœŸè¡¥å……è¯´æ˜"><a href="#4-2-ç”Ÿå‘½å‘¨æœŸè¡¥å……è¯´æ˜" class="headerlink" title="4.2 ç”Ÿå‘½å‘¨æœŸè¡¥å……è¯´æ˜"></a>4.2 ç”Ÿå‘½å‘¨æœŸè¡¥å……è¯´æ˜</h3><p>æŸäº›å¹³å°ç‰¹æœ‰çš„ç”Ÿå‘½å‘¨æœŸ:</p><ul><li>onPageScroll: é¡µé¢æ»šåŠ¨è§¦å‘</li><li>onReachBottom: é¡µé¢ä¸Šæ‹‰è§¦åº•äº‹ä»¶</li><li>onPullDownRefresh: ä¸‹æ‹‰åˆ·æ–°äº‹ä»¶</li><li>onTabItemTap: tabç‚¹å‡»äº‹ä»¶</li></ul><h2 id="5-æ€»ç»“"><a href="#5-æ€»ç»“" class="headerlink" title="5. æ€»ç»“"></a>5. æ€»ç»“</h2><ol><li>åˆç†ä½¿ç”¨ä¸åŒå±‚æ¬¡çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°</li><li>æ³¨æ„æ•°æ®è·å–å’ŒDOMæ“ä½œçš„æ—¶æœº</li><li>æ­£ç¡®ä½¿ç”¨æ¡ä»¶ç¼–è¯‘</li><li>åšå¥½è·¨ç«¯å…¼å®¹å¤„ç†</li><li>æ³¨æ„æ€§èƒ½ä¼˜åŒ–</li></ol><hr><blockquote><p>å¦‚æœè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©,æ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«,ä½ çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼</p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">å‰ç«¯å¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/uni-app/">uni-app</category>
      
      
      <category domain="https://www.hzv5.cn/tags/uni-app/">uni-app</category>
      
      <category domain="https://www.hzv5.cn/tags/Vue/">Vue</category>
      
      <category domain="https://www.hzv5.cn/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/">å°ç¨‹åºå¼€å‘</category>
      
      <category domain="https://www.hzv5.cn/tags/%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/">ç”Ÿå‘½å‘¨æœŸ</category>
      
      
      <comments>https://www.hzv5.cn/2023/10/15/uniapp-lifecycle/#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
