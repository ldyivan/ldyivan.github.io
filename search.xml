<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>支付宝0门槛红包，每日都可以领取1次</title>
    <url>/2023/09/27/zfb-hb/</url>
    <content><![CDATA[<p>支付宝专属大额红包，0门槛，每人每日都可以领取1次：</p>
<p>1：使用浏览器打开链接自动领取：</p>
<p><a href="https://dz.hzv5.cn/hb/">https://dz.hzv5.cn/hb/</a></p>
<p>2：使用支付宝扫码自动领取：</p>
<p><img src="/img/Alipay/ZFB_hb.png" alt="支付宝领红包"></p>
<span id="more"></span>

<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>领取的红包为0门槛红包，使用支付宝支付时，会自动抵扣金额。</p>
<p>或者赞赏本博客。</p>
<p>当天领取的红包金额支付完，第二天才能继续领取新的红包。</p>
]]></content>
      <categories>
        <category>收集控</category>
      </categories>
      <tags>
        <tag>支付宝</tag>
        <tag>红包</tag>
      </tags>
  </entry>
  <entry>
    <title>自写与收集的一些免费的API接口（获取QQ昵称、头像、QQ秀等等...）</title>
    <url>/2018/04/24/my-apis/</url>
    <content><![CDATA[<p>自写的一些API接口，以及收集的一些QQ相关的（官方）免费API接口，有需要的可以拿去用：</p>
<h1 id="1、获取QQ头像："><a href="#1、获取QQ头像：" class="headerlink" title="1、获取QQ头像："></a>1、获取QQ头像：</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">① http://q2.qlogo.cn/headimg_dl?dst_uin=QQ号码&amp;spec=100</span><br><span class="line">② http://q1.qlogo.cn/g?b=qq&amp;nk=QQ号码&amp;s=100</span><br><span class="line">③ http://qlogo1.store.qq.com/qzone/QQ号码/QQ号码/100</span><br></pre></td></tr></table></figure>

<h1 id="2、获取QQ群头像："><a href="#2、获取QQ群头像：" class="headerlink" title="2、获取QQ群头像："></a>2、获取QQ群头像：</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://p.qlogo.cn/gh/QQ群号码/QQ群号码/100/</span><br></pre></td></tr></table></figure>

<h1 id="3、获取QQ秀接口："><a href="#3、获取QQ秀接口：" class="headerlink" title="3、获取QQ秀接口："></a>3、获取QQ秀接口：</h1><p><s><a href="http://qqshow-user.tencent.com/QQ号/10/00">http://qqshow-user.tencent.com/QQ号/10/00</a></s></p>
<h1 id="4、获取QQ空间音乐列表："><a href="#4、获取QQ空间音乐列表：" class="headerlink" title="4、获取QQ空间音乐列表："></a>4、获取QQ空间音乐列表：</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://qzone-music.qq.com/fcg-bin/cgi_playlist_xml.fcg?g_tk=1916754934&amp;json=1&amp;uin=QQ号码</span><br></pre></td></tr></table></figure>

<h1 id="5、获取QQ昵称："><a href="#5、获取QQ昵称：" class="headerlink" title="5、获取QQ昵称："></a>5、获取QQ昵称：</h1><h3 id="①-已失效"><a href="#①-已失效" class="headerlink" title="① 已失效"></a>① 已失效</h3><p><s><a href="http://r.pengyou.com/fcg-bin/cgi_get_portrait.fcg?uins=QQ号码">http://r.pengyou.com/fcg-bin/cgi_get_portrait.fcg?uins=QQ号码</a></s></p>
<h3 id="②-已失效"><a href="#②-已失效" class="headerlink" title="② 已失效"></a>② 已失效</h3><p><s><a href="http://users.qzone.qq.com/fcg-bin/cgi_get_portrait.fcg?uins=QQ号码">http://users.qzone.qq.com/fcg-bin/cgi_get_portrait.fcg?uins=QQ号码</a></s></p>
<h3 id="全新的有效的接口"><a href="#全新的有效的接口" class="headerlink" title="全新的有效的接口"></a>全新的有效的接口</h3><span id="more"></span>

<h3 id="③-已失效"><a href="#③-已失效" class="headerlink" title="③ 已失效"></a>③ 已失效</h3><p><s><a href="https://h5.qzone.qq.com/proxy/domain/r.qzone.qq.com/cgi-bin/user/cgi_personal_card?g_tk=542577957&amp;uin=QQ号码">https://h5.qzone.qq.com/proxy/domain/r.qzone.qq.com/cgi-bin/user/cgi_personal_card?g_tk=542577957&amp;uin=QQ号码</a></s></p>
<h1 id="6、百度文字转语音合成接口："><a href="#6、百度文字转语音合成接口：" class="headerlink" title="6、百度文字转语音合成接口："></a>6、百度文字转语音合成接口：</h1><p><s><a href="http://tts.baidu.com/text2audio?lan=zh&amp;ie=UTF-8&amp;spd=2&amp;text=要转换的文字">http://tts.baidu.com/text2audio?lan=zh&amp;ie=UTF-8&amp;spd=2&amp;text=要转换的文字</a></s></p>
<p>lan=zh：语言是中文，如果改为lan=en，则语言是英文。</p>
<p>ie=UTF-8：文字格式。</p>
<p>spd=2：语速，可以是1-9的数字，数字越大，语速越快。</p>
<p>text=**：这个就是你要转换的文字。</p>
<h1 id="7、随机颜色代码："><a href="#7、随机颜色代码：" class="headerlink" title="7、随机颜色代码："></a>7、随机颜色代码：</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://api.hzv5.cn/ys.php?n=hex&amp;t=json</span><br></pre></td></tr></table></figure>

<p>参数n有两种属性，rgb和hex,留空默认两个属性数据都返回！</p>
<p>参数t属性也有两种，text和json，留空默认返回json数据!</p>
<h1 id="8、生成随机密码："><a href="#8、生成随机密码：" class="headerlink" title="8、生成随机密码："></a>8、生成随机密码：</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://api.hzv5.cn/randomcode.php?n=15</span><br></pre></td></tr></table></figure>

<p>参数n符合条件：50000≥n≥3</p>
<h1 id="9、文本加密与解密-有一些小问题-："><a href="#9、文本加密与解密-有一些小问题-：" class="headerlink" title="9、文本加密与解密(有一些小问题)："></a>9、文本加密与解密(有一些小问题)：</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://api.hzv5.cn/textencryption.php?t=text&amp;amp;w=encode&amp;amp;n=json</span><br></pre></td></tr></table></figure>

<p>参数t：需要加密解密的文本内容</p>
<p>参数w：加密 encode ，解密 decode</p>
<p>参数n：返回的数据类型，可以是json和text</p>
<h1 id="10、二维码生成："><a href="#10、二维码生成：" class="headerlink" title="10、二维码生成："></a>10、二维码生成：</h1><p><s><a href="http://api.hzv5.cn/ewm.php?n=内容">http://api.hzv5.cn/ewm.php?n=内容</a></s></p>
<p>参数n为需要生成的二维码内容！</p>
<h1 id="11、看美女："><a href="#11、看美女：" class="headerlink" title="11、看美女："></a>11、看美女：</h1><p><s><a href="http://api.hzv5.cn/kmn.php">http://api.hzv5.cn/kmn.php</a></s></p>
<h1 id="12、查快递："><a href="#12、查快递：" class="headerlink" title="12、查快递："></a>12、查快递：</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;s&gt;http://api.hzv5.cn/kd.php?n=&lt;s&gt;</span><br></pre></td></tr></table></figure>

<p>参数n为快递单号。</p>
<h1 id="13、百度百科词条："><a href="#13、百度百科词条：" class="headerlink" title="13、百度百科词条："></a>13、百度百科词条：</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://api.hzv5.cn/bk.php?n=你好</span><br></pre></td></tr></table></figure>

<p>参数n为要搜索的关键字。</p>
<h1 id="14、更多二维码生成api"><a href="#14、更多二维码生成api" class="headerlink" title="14、更多二维码生成api"></a>14、更多二维码生成api</h1><p>① iClick接口 (无https)</p>
<p><s><a href="http://bshare.optimix.asia/barCode?site=weixin&amp;url=http://www.hzv5.cn">http://bshare.optimix.asia/barCode?site=weixin&amp;url=http://www.hzv5.cn</a></s></p>
<p>② 联图网(无https)</p>
<p><s><a href="http://qr.liantu.com/api.php?text=http://www.hzv5.cn">http://qr.liantu.com/api.php?text=http://www.hzv5.cn</a></s></p>
<p>③ K780数据网(支持https和http)</p>
<s>
http://api.k780.com:88/?app=qr.get&data=http://www.hzv5.cn&level=L&size=6

<p><a href="https://sapi.k780.com/?app=qr.get&amp;data=http://www.hzv5.cn&amp;level=L&amp;size=6">https://sapi.k780.com/?app=qr.get&amp;data=http://www.hzv5.cn&amp;level=L&amp;size=6</a><br></s></p>
<p>④ QR Code Generator(https接口)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://api.qrserver.com/v1/create-qr-code/?size=150x150&amp;data=http://www.hzv5.cn</span><br></pre></td></tr></table></figure>


<h1 id="失效"><a href="#失效" class="headerlink" title="失效"></a>失效</h1><p>如果有接口失效，请留言评论告诉我。</p>
<p>另：更多其他接口，或者找寻失效接口的替代接口，可以在博客上自行搜索。</p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>更多api正在不断收集中，若你也有好的免费接口想要分享，请评论留言吧。</p>
]]></content>
      <categories>
        <category>收集控</category>
      </categories>
      <tags>
        <tag>免费api</tag>
        <tag>接口收集</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo博客实现随机文章功能的完整教程</title>
    <url>/2025/01/01/hexo-random-post/</url>
    <content><![CDATA[<blockquote>
<p>想要给博客增加一些趣味性？让读者可以随机浏览你的文章是个不错的选择。本文将详细介绍如何在Hexo博客中实现随机文章功能，就跟本博客的侧栏导航中的【<a href="/random" title="随机获取一篇博文 - 吖远zzy">手气</a>】菜单一样的效果。</p>
</blockquote>
<span id="more"></span>

<h2 id="1-功能介绍"><a href="#1-功能介绍" class="headerlink" title="1. 功能介绍"></a>1. 功能介绍</h2><p>随机文章功能可以让访问者随机浏览博客中的任意一篇文章,这不仅能增加博客的趣味性,还能提高文章的曝光率,让一些早期的优质文章也有机会被读者发现。</p>
<h2 id="2-实现步骤"><a href="#2-实现步骤" class="headerlink" title="2. 实现步骤"></a>2. 实现步骤</h2><h3 id="2-1-创建模板文件"><a href="#2-1-创建模板文件" class="headerlink" title="2.1 创建模板文件"></a>2.1 创建模板文件</h3><p>首先在主题的<code>layout</code>目录下创建<code>random.ejs</code>文件:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">// 获取所有文章</span><br><span class="line">const posts = site.posts.data;</span><br><span class="line">// 随机选择一篇文章</span><br><span class="line">const randomPost = posts[Math.floor(Math.random() * posts.length)];</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 立即重定向到随机文章</span><br><span class="line">window.location.href = &#x27;&lt;%- url_for(randomPost.path) %&gt;&#x27;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;noscript&gt;</span><br><span class="line">  &lt;div style=&quot;text-align: center; padding: 20px;&quot;&gt;</span><br><span class="line">    &lt;p&gt;请点击下方链接访问随机文章：&lt;/p&gt;</span><br><span class="line">    &lt;a href=&quot;&lt;%- url_for(randomPost.path) %&gt;&quot;&gt;&lt;%- randomPost.title %&gt;&lt;/a&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/noscript&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-创建页面文件"><a href="#2-2-创建页面文件" class="headerlink" title="2.2 创建页面文件"></a>2.2 创建页面文件</h3><p>在<code>source</code>目录下创建<code>random</code>文件夹,并在其中创建<code>index.md</code>:</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: 随机文章</span><br><span class="line">date: 2023-12-31 12:00:00</span><br><span class="line">type: random</span><br><span class="line">layout: random</span><br><span class="line"><span class="section">comments: false</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-添加菜单项"><a href="#2-3-添加菜单项" class="headerlink" title="2.3 添加菜单项"></a>2.3 添加菜单项</h3><p>在主题的<code>_config.yml</code>中添加菜单项:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">random:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/random</span></span><br><span class="line">    <span class="attr">text:</span> <span class="string">手气</span></span><br><span class="line">    <span class="attr">icon:</span> <span class="string">fas</span> <span class="string">fa-random</span></span><br></pre></td></tr></table></figure>

<h2 id="3-功能说明"><a href="#3-功能说明" class="headerlink" title="3. 功能说明"></a>3. 功能说明</h2><h3 id="3-1-工作原理"><a href="#3-1-工作原理" class="headerlink" title="3.1 工作原理"></a>3.1 工作原理</h3><ol>
<li>当访问者点击”随机文章”菜单时,会访问<code>/random</code>页面</li>
<li>模板会从所有文章中随机选择一篇</li>
<li>通过JavaScript自动跳转到选中的文章</li>
<li>如果浏览器禁用了JavaScript,则显示一个可点击的链接</li>
</ol>
<h3 id="3-2-优化建议"><a href="#3-2-优化建议" class="headerlink" title="3.2 优化建议"></a>3.2 优化建议</h3><ol>
<li><strong>性能优化</strong>: 如果博客文章很多,可以考虑缓存文章列表</li>
<li><strong>用户体验</strong>: 可以添加加载动画</li>
<li><strong>功能扩展</strong>: 可以按分类或标签随机</li>
</ol>
<h2 id="4-常见问题"><a href="#4-常见问题" class="headerlink" title="4. 常见问题"></a>4. 常见问题</h2><h3 id="4-1-页面闪烁"><a href="#4-1-页面闪烁" class="headerlink" title="4.1 页面闪烁"></a>4.1 页面闪烁</h3><p>如果出现页面闪烁,可以添加loading效果:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">.loading &#123;</span><br><span class="line">  text-align: center;</span><br><span class="line">  padding: 20px;</span><br><span class="line">&#125;</span><br><span class="line">.loading:after &#123;</span><br><span class="line">  content: &#x27;正在随机选择文章...&#x27;;</span><br><span class="line">  color: #666;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;div class=&quot;loading&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-重复访问"><a href="#4-2-重复访问" class="headerlink" title="4.2 重复访问"></a>4.2 重复访问</h3><p>如果想避免连续访问同一篇文章,可以使用sessionStorage记录历史:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取历史记录</span></span><br><span class="line"><span class="keyword">const</span> history = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">sessionStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;randomHistory&#x27;</span>) || <span class="string">&#x27;[]&#x27;</span>);</span><br><span class="line"><span class="comment">// 过滤已访问的文章</span></span><br><span class="line"><span class="keyword">const</span> availablePosts = posts.<span class="title function_">filter</span>(<span class="function"><span class="params">post</span> =&gt;</span> !history.<span class="title function_">includes</span>(post.<span class="property">path</span>));</span><br><span class="line"><span class="comment">// 如果所有文章都访问过,清空历史</span></span><br><span class="line"><span class="keyword">if</span> (availablePosts.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="variable language_">sessionStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&#x27;randomHistory&#x27;</span>);</span><br><span class="line">  availablePosts = posts;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 随机选择文章</span></span><br><span class="line"><span class="keyword">const</span> randomPost = availablePosts[<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * availablePosts.<span class="property">length</span>)];</span><br><span class="line"><span class="comment">// 记录到历史</span></span><br><span class="line">history.<span class="title function_">push</span>(randomPost.<span class="property">path</span>);</span><br><span class="line"><span class="variable language_">sessionStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;randomHistory&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(history));</span><br></pre></td></tr></table></figure>

<h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5. 总结"></a>5. 总结</h2><p>随机文章功能虽然实现简单,但能大大提升博客的趣味性和用户体验。你还可以基于这个基础功能,添加更多个性化的扩展,比如按照文章热度随机、按照阅读时间随机等。</p>
<hr>
<blockquote>
<p>如果觉得文章对你有帮助,欢迎点赞、评论、分享,你的支持是我继续创作的动力！ </p>
</blockquote>
]]></content>
      <categories>
        <category>Web开发</category>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>博客优化</tag>
        <tag>Hexo</tag>
        <tag>JavaScript</tag>
        <tag>前端开发</tag>
      </tags>
  </entry>
  <entry>
    <title>QQ频道机器人Android客户端使用指南</title>
    <url>/2024/12/19/qqch-bot-readme/</url>
    <content><![CDATA[<h1 id="QQ频道机器人-Android客户端"><a href="#QQ频道机器人-Android客户端" class="headerlink" title="QQ频道机器人 Android客户端"></a>QQ频道机器人 Android客户端</h1><p>一个用于管理和操作QQ频道机器人的Android客户端应用，基于uniapp开发，提供了直观的用户界面和丰富的功能特性。</p>
<h2 id="客户端界面预览"><a href="#客户端界面预览" class="headerlink" title="客户端界面预览"></a>客户端界面预览</h2><p><img src="/img/qqBot/login_chat.png" alt="登录频道聊天查看和发送消息"></p>
<p><img src="/img/qqBot/plugin_setting_log.png" alt="插件功能运行日志和设置"></p>
<h2 id="功能特性"><a href="#功能特性" class="headerlink" title="功能特性"></a>功能特性</h2><h3 id="1-账号管理"><a href="#1-账号管理" class="headerlink" title="1. 账号管理"></a>1. 账号管理</h3><ul>
<li>App ID和Token登录</li>
<li>记住登录状态</li>
<li>自动登录选项</li>
<li>沙盒/正式环境切换</li>
<li>多账号管理</li>
<li>账号安全保护</li>
</ul>
<h3 id="2-频道管理"><a href="#2-频道管理" class="headerlink" title="2. 频道管理"></a>2. 频道管理</h3><ul>
<li>频道列表显示<ul>
<li>分组展示</li>
<li>在线人数显示</li>
<li>频道类型图标</li>
<li>频道状态标识</li>
</ul>
</li>
<li>未读消息统计<ul>
<li>普通消息计数</li>
<li>@消息特别标记</li>
<li>按频道分类统计</li>
</ul>
</li>
<li>频道权限管理<ul>
<li>自动识别管理员权限</li>
<li>权限值实时计算</li>
<li>权限检查功能</li>
</ul>
</li>
</ul>
<h3 id="3-消息功能"><a href="#3-消息功能" class="headerlink" title="3. 消息功能"></a>3. 消息功能</h3><ul>
<li><p>实时消息接收</p>
<span id="more"></span>

<ul>
<li>WebSocket长连接</li>
<li>断线自动重连</li>
<li>心跳保活机制</li>
</ul>
</li>
<li><p>消息发送功能</p>
<ul>
<li>文本消息支持</li>
<li>消息审核处理</li>
<li>审核状态显示</li>
</ul>
</li>
<li><p>消息管理</p>
<ul>
<li>消息撤回</li>
<li>历史记录查看</li>
<li>系统消息显示</li>
<li>在线状态更新</li>
</ul>
</li>
<li><p>消息展示</p>
<ul>
<li>时间戳显示</li>
<li>用户身份标识</li>
<li>消息状态图标</li>
<li>长按菜单操作</li>
</ul>
</li>
</ul>
<h3 id="4-插件系统"><a href="#4-插件系统" class="headerlink" title="4. 插件系统"></a>4. 插件系统</h3><ul>
<li>插件管理<ul>
<li>启用/禁用控制</li>
<li>本地存储支持</li>
<li>配置项管理</li>
</ul>
</li>
<li>插件功能<ul>
<li>命令处理</li>
<li>数据持久化</li>
<li>日志记录</li>
<li>API调用</li>
</ul>
</li>
<li>内置插件<ul>
<li>每日签到</li>
<li>百度百科</li>
</ul>
</li>
<li>开发支持<ul>
<li>完整API文档</li>
<li>示例代码</li>
<li>开发指南</li>
</ul>
</li>
</ul>
<h3 id="5-通知系统"><a href="#5-通知系统" class="headerlink" title="5. 通知系统"></a>5. 通知系统</h3><ul>
<li>消息通知<ul>
<li>新消息提醒</li>
<li>@消息特殊提示</li>
<li>消息合并显示</li>
<li>通知延迟处理</li>
</ul>
</li>
<li>通知管理<ul>
<li>是否开启通知</li>
<li>是否震动提醒</li>
<li>是否系统通知</li>
<li>免打扰设置</li>
</ul>
</li>
<li>通知优化<ul>
<li>消息去重</li>
<li>批量处理</li>
<li>智能延迟</li>
<li>性能优化</li>
</ul>
</li>
</ul>
<h2 id="系统要求"><a href="#系统要求" class="headerlink" title="系统要求"></a>系统要求</h2><h3 id="基本要求"><a href="#基本要求" class="headerlink" title="基本要求"></a>基本要求</h3><ul>
<li>Android 5.0+</li>
<li>网络连接</li>
<li>存储空间 &gt;= 50MB</li>
<li>通知权限(可选)</li>
<li>后台运行权限(推荐)</li>
</ul>
<h3 id="权限说明"><a href="#权限说明" class="headerlink" title="权限说明"></a>权限说明</h3><ol>
<li><p>必需权限</p>
<ul>
<li>网络访问</li>
<li>存储读写</li>
<li>后台运行</li>
</ul>
</li>
<li><p>可选权限</p>
<ul>
<li>通知显示</li>
<li>开机自启</li>
<li>震动控制</li>
</ul>
</li>
</ol>
<h2 id="安装说明"><a href="#安装说明" class="headerlink" title="安装说明"></a>安装说明</h2><ol>
<li><p>下载安装</p>
<ul>
<li>从Release页面下载最新APK</li>
<li>允许安装未知来源应用</li>
<li>按提示完成安装</li>
</ul>
</li>
<li><p>首次配置</p>
<ul>
<li>授予必要权限</li>
<li>登录机器人账号</li>
<li>配置基本设置</li>
</ul>
</li>
</ol>
<h2 id="使用指南"><a href="#使用指南" class="headerlink" title="使用指南"></a>使用指南</h2><h3 id="1-登录配置"><a href="#1-登录配置" class="headerlink" title="1. 登录配置"></a>1. 登录配置</h3><h4 id="1-1-获取凭据"><a href="#1-1-获取凭据" class="headerlink" title="1.1 获取凭据"></a>1.1 获取凭据</h4><ol>
<li>访问<a href="https://q.qq.com">QQ机器人管理平台</a></li>
<li>创建/选择机器人</li>
<li>获取App ID和Token</li>
<li>确认机器人状态正常</li>
</ol>
<h4 id="1-2-登录设置"><a href="#1-2-登录设置" class="headerlink" title="1.2 登录设置"></a>1.2 登录设置</h4><ol>
<li>输入App ID和Token</li>
<li>选择环境(沙盒/正式)</li>
<li>设置自动登录(可选)</li>
<li>配置安全选项</li>
</ol>
<h3 id="2-频道操作"><a href="#2-频道操作" class="headerlink" title="2. 频道操作"></a>2. 频道操作</h3><h4 id="2-1-查看频道"><a href="#2-1-查看频道" class="headerlink" title="2.1 查看频道"></a>2.1 查看频道</h4><ol>
<li><p>打开频道列表</p>
<ul>
<li>点击顶部频道信息展开列表</li>
<li>查看分组和子频道</li>
<li>观察在线人数和状态</li>
</ul>
</li>
<li><p>频道分类</p>
<ul>
<li>文字频道(#)</li>
<li>语音频道(🔊)</li>
<li>直播频道(📺)</li>
<li>公告频道(📢)</li>
<li>应用频道(💬)</li>
<li>论坛频道(🎮)</li>
</ul>
</li>
<li><p>未读消息</p>
<ul>
<li>红点显示未读数</li>
<li>橙色标记@消息</li>
<li>点击清除未读</li>
</ul>
</li>
</ol>
<h4 id="2-2-消息管理"><a href="#2-2-消息管理" class="headerlink" title="2.2 消息管理"></a>2.2 消息管理</h4><ol>
<li><p>发送消息</p>
<ul>
<li>在输入框输入内容</li>
<li>点击发送按钮</li>
<li>等待发送状态</li>
<li>查看审核结果</li>
</ul>
</li>
<li><p>消息操作</p>
<ul>
<li>长按消息显示菜单</li>
<li>选择撤回等操作</li>
<li>查看消息详情</li>
</ul>
</li>
<li><p>消息状态</p>
<ul>
<li>正常消息</li>
<li>审核中(灰色)</li>
<li>审核拒绝(红色)</li>
<li>已撤回(灰色斜体)</li>
</ul>
</li>
</ol>
<h3 id="3-插件使用"><a href="#3-插件使用" class="headerlink" title="3. 插件使用"></a>3. 插件使用</h3><h4 id="3-1-插件管理"><a href="#3-1-插件管理" class="headerlink" title="3.1 插件管理"></a>3.1 插件管理</h4><ol>
<li><p>内置插件</p>
<ul>
<li>每日签到(/签到)</li>
<li>百度百科(/百科)</li>
</ul>
</li>
<li><p>插件控制</p>
<ul>
<li>启用/禁用插件</li>
<li>查看插件信息</li>
<li>管理插件数据</li>
</ul>
</li>
</ol>
<h4 id="3-2-插件命令"><a href="#3-2-插件命令" class="headerlink" title="3.2 插件命令"></a>3.2 插件命令</h4><ol>
<li><p>命令格式</p>
<ul>
<li>以/开头</li>
<li>严格匹配命令名</li>
<li>空格分隔参数</li>
</ul>
</li>
<li><p>使用示例</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/签到              # 执行签到</span><br><span class="line">/百科 太阳         # 查询百科</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="4-通知设置"><a href="#4-通知设置" class="headerlink" title="4. 通知设置"></a>4. 通知设置</h3><h4 id="4-1-通知选项"><a href="#4-1-通知选项" class="headerlink" title="4.1 通知选项"></a>4.1 通知选项</h4><ol>
<li><p>基本设置</p>
<ul>
<li>启用通知</li>
<li>震动提醒</li>
<li>系统通知</li>
</ul>
</li>
<li><p>通知规则</p>
<ul>
<li>新消息延迟2秒</li>
<li>多条消息合并</li>
<li>@消息立即提醒</li>
<li>非当前频道通知</li>
</ul>
</li>
</ol>
<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="1-连接问题"><a href="#1-连接问题" class="headerlink" title="1. 连接问题"></a>1. 连接问题</h3><ul>
<li>问题: 无法连接或频繁断开</li>
<li>解决: <ol>
<li>检查网络连接</li>
<li>确认Token正确</li>
<li>查看机器人状态</li>
<li>等待自动重连</li>
</ol>
</li>
</ul>
<h3 id="2-消息问题"><a href="#2-消息问题" class="headerlink" title="2. 消息问题"></a>2. 消息问题</h3><ul>
<li>问题: 消息发送失败</li>
<li>解决:<ol>
<li>检查频道权限</li>
<li>确认消息格式</li>
<li>等待审核通过</li>
<li>查看错误提示</li>
</ol>
</li>
</ul>
<h3 id="3-插件问题"><a href="#3-插件问题" class="headerlink" title="3. 插件问题"></a>3. 插件问题</h3><ul>
<li>问题: 插件无响应</li>
<li>解决:<ol>
<li>检查插件状态</li>
<li>确认命令格式</li>
<li>查看错误日志</li>
<li>重启应用</li>
</ol>
</li>
</ul>
<h3 id="4-通知问题"><a href="#4-通知问题" class="headerlink" title="4. 通知问题"></a>4. 通知问题</h3><ul>
<li>问题: 收不到通知</li>
<li>解决:<ol>
<li>检查通知权限</li>
<li>确认通知设置</li>
<li>关闭省电模式</li>
<li>允许后台运行</li>
</ol>
</li>
</ul>
<h2 id="更新日志"><a href="#更新日志" class="headerlink" title="更新日志"></a>更新日志</h2><h3 id="v1-1-0-2024-01-20"><a href="#v1-1-0-2024-01-20" class="headerlink" title="v1.1.0 (2024-01-20)"></a>v1.1.0 (2024-01-20)</h3><ul>
<li>优化WebSocket连接</li>
<li>改进消息处理逻辑</li>
<li>完善插件系统</li>
<li>优化通知机制</li>
<li>修复已知问题</li>
</ul>
<h3 id="v1-0-0-2023-12-25"><a href="#v1-0-0-2023-12-25" class="headerlink" title="v1.0.0 (2023-12-25)"></a>v1.0.0 (2023-12-25)</h3><ul>
<li>首次发布</li>
<li>基础功能实现</li>
<li>插件系统支持</li>
<li>通知系统集成</li>
</ul>
<h2 id="更多待补充"><a href="#更多待补充" class="headerlink" title="更多待补充"></a>更多待补充</h2><p>么么哒~~</p>
]]></content>
      <categories>
        <category>知识点</category>
      </categories>
      <tags>
        <tag>笔记</tag>
        <tag>QQ</tag>
        <tag>QQ频道</tag>
        <tag>QQ机器人</tag>
        <tag>使用文档</tag>
      </tags>
  </entry>
  <entry>
    <title>安卓版QQ频道机器人APP客户端插件开发指南</title>
    <url>/2024/12/19/qqch-bot-plugin/</url>
    <content><![CDATA[<p>本文档将指导您如何为QQ频道机器人客户端开发插件。</p>
<h2 id="插件结构"><a href="#插件结构" class="headerlink" title="插件结构"></a>插件结构</h2><p>每个插件都是一个标准的 JavaScript 文件，需要导出一个包含以下字段的对象:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 插件对象</span></span><br><span class="line"><span class="keyword">const</span> plugin = &#123;</span><br><span class="line">  <span class="comment">// 基本信息(必需)</span></span><br><span class="line">  <span class="attr">id</span>: <span class="string">&#x27;plugin-id&#x27;</span>,          <span class="comment">// 插件ID,只能包含小写字母、数字、下划线和横线</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;插件名称&#x27;</span>,         <span class="comment">// 插件显示名称</span></span><br><span class="line">  <span class="attr">description</span>: <span class="string">&#x27;插件描述&#x27;</span>,  <span class="comment">// 插件功能描述</span></span><br><span class="line">  <span class="attr">command</span>: <span class="string">&#x27;/命令&#x27;</span>,         <span class="comment">// 触发命令,必须以/开头</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 基本信息(可选)</span></span><br><span class="line">  <span class="attr">version</span>: <span class="string">&#x27;1.0.0&#x27;</span>,        <span class="comment">// 插件版本号</span></span><br><span class="line">  <span class="attr">author</span>: <span class="string">&#x27;作者名称&#x27;</span>,      <span class="comment">// 插件作者</span></span><br><span class="line">  <span class="attr">enabled</span>: <span class="literal">true</span>,           <span class="comment">// 插件是否启用</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 配置项(可选)</span></span><br><span class="line">  <span class="attr">config</span>: &#123;</span><br><span class="line">    <span class="comment">// 插件的配置项</span></span><br><span class="line">    <span class="attr">minPoints</span>: <span class="number">10</span>,         <span class="comment">// 示例:最小积分</span></span><br><span class="line">    <span class="attr">maxPoints</span>: <span class="number">100</span>,        <span class="comment">// 示例:最大积分</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 数据存储(可选)</span></span><br><span class="line">  <span class="attr">storage</span>: &#123;</span><br><span class="line">    <span class="comment">// 插件的数据存储</span></span><br><span class="line">    <span class="attr">records</span>: <span class="keyword">new</span> <span class="title class_">Map</span>()     <span class="comment">// 示例:记录存储</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 消息处理函数(必需)</span></span><br><span class="line">  <span class="attr">handler</span>: <span class="title function_">async</span> (message, channel, context) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 返回值:</span></span><br><span class="line">    <span class="comment">// - 字符串: 要发送的回复消息</span></span><br><span class="line">    <span class="comment">// - null/undefined: 不发送回复</span></span><br><span class="line">    <span class="comment">// - Promise&lt;string&gt;: 异步返回回复消息</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;回复消息&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出插件</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = plugin</span><br></pre></td></tr></table></figure>

<h2 id="API-说明"><a href="#API-说明" class="headerlink" title="API 说明"></a>API 说明</h2><h3 id="1-消息对象-message"><a href="#1-消息对象-message" class="headerlink" title="1. 消息对象(message)"></a>1. 消息对象(message)</h3>  <span id="more"></span>

<p>消息对象包含了消息的完整信息：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&quot;消息ID&quot;</span>,</span><br><span class="line">  <span class="attr">channel_id</span>: <span class="string">&quot;频道ID&quot;</span>, </span><br><span class="line">  <span class="attr">guild_id</span>: <span class="string">&quot;服务器ID&quot;</span>,</span><br><span class="line">  <span class="attr">content</span>: <span class="string">&quot;消息内容&quot;</span>,</span><br><span class="line">  <span class="attr">cleanContent</span>: <span class="string">&quot;去除命令前缀的消息内容&quot;</span>, <span class="comment">// 新增:清理后的内容</span></span><br><span class="line">  <span class="attr">timestamp</span>: <span class="string">&quot;2023-01-01T00:00:00.000Z&quot;</span>,</span><br><span class="line">  <span class="attr">status</span>: <span class="string">&quot;normal&quot;</span>, <span class="comment">// 消息状态: normal-正常, auditing-审核中, rejected-审核拒绝</span></span><br><span class="line">  <span class="attr">author</span>: &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&quot;用户ID&quot;</span>,</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&quot;用户名&quot;</span>,</span><br><span class="line">    <span class="attr">bot</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">avatar</span>: <span class="string">&quot;头像URL&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">member</span>: &#123;</span><br><span class="line">    <span class="attr">roles</span>: [<span class="string">&quot;角色ID1&quot;</span>, <span class="string">&quot;角色ID2&quot;</span>],</span><br><span class="line">    <span class="attr">joined_at</span>: <span class="string">&quot;加入时间&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mentions</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="string">&quot;被@用户ID&quot;</span>,</span><br><span class="line">      <span class="attr">username</span>: <span class="string">&quot;被@用户名&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">mention_everyone</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-频道对象-channel"><a href="#2-频道对象-channel" class="headerlink" title="2. 频道对象(channel)"></a>2. 频道对象(channel)</h3><p>频道对象包含了频道的基本信息：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&quot;频道ID&quot;</span>,</span><br><span class="line">  <span class="attr">guild_id</span>: <span class="string">&quot;服务器ID&quot;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;频道名称&quot;</span>,</span><br><span class="line">  <span class="attr">type</span>: <span class="number">0</span>, <span class="comment">// 频道类型</span></span><br><span class="line">  <span class="attr">position</span>: <span class="number">1</span>, <span class="comment">// 显示位置</span></span><br><span class="line">  <span class="attr">parent_id</span>: <span class="string">&quot;父频道ID&quot;</span>,</span><br><span class="line">  <span class="attr">owner_id</span>: <span class="string">&quot;创建者ID&quot;</span>,</span><br><span class="line">  <span class="attr">permissions</span>: <span class="string">&quot;权限值&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-上下文对象-context"><a href="#3-上下文对象-context" class="headerlink" title="3. 上下文对象(context)"></a>3. 上下文对象(context)</h3><p>上下文对象提供了插件运行时的环境和工具：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 存储API - 持久化存储插件数据</span></span><br><span class="line">  <span class="attr">storage</span>: &#123;</span><br><span class="line">    <span class="attr">get</span>: <span class="function">(<span class="params">key</span>) =&gt;</span> value, <span class="comment">// 获取存储的值</span></span><br><span class="line">    <span class="attr">set</span>: <span class="function">(<span class="params">key, value</span>) =&gt;</span> <span class="keyword">void</span>, <span class="comment">// 设置存储的值</span></span><br><span class="line">    <span class="attr">delete</span>: <span class="function">(<span class="params">key</span>) =&gt;</span> <span class="keyword">void</span>, <span class="comment">// 删除存储的值</span></span><br><span class="line">    <span class="attr">clear</span>: <span class="function">() =&gt;</span> <span class="keyword">void</span>, <span class="comment">// 清空存储</span></span><br><span class="line">    <span class="attr">has</span>: <span class="function">(<span class="params">key</span>) =&gt;</span> boolean <span class="comment">// 检查键是否存在</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 配置API - 管理插件配置</span></span><br><span class="line">  <span class="attr">config</span>: &#123;</span><br><span class="line">    <span class="attr">get</span>: <span class="function">(<span class="params">key</span>) =&gt;</span> value, <span class="comment">// 获取配置项</span></span><br><span class="line">    <span class="attr">set</span>: <span class="function">(<span class="params">key, value</span>) =&gt;</span> <span class="keyword">void</span>, <span class="comment">// 设置配置项</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 日志API - 记录插件运行日志</span></span><br><span class="line">  <span class="attr">log</span>: &#123;</span><br><span class="line">    <span class="attr">info</span>: <span class="function">(<span class="params">message, details</span>) =&gt;</span> <span class="keyword">void</span>, <span class="comment">// 记录信息日志</span></span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">message, details</span>) =&gt;</span> <span class="keyword">void</span>, <span class="comment">// 记录成功日志</span></span><br><span class="line">    <span class="attr">warning</span>: <span class="function">(<span class="params">message, details</span>) =&gt;</span> <span class="keyword">void</span>, <span class="comment">// 记录警告日志</span></span><br><span class="line">    <span class="attr">error</span>: <span class="function">(<span class="params">message, details</span>) =&gt;</span> <span class="keyword">void</span> <span class="comment">// 记录错误日志</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 工具API</span></span><br><span class="line">  <span class="attr">api</span>: &#123;</span><br><span class="line">    <span class="comment">// 发送消息</span></span><br><span class="line">    <span class="attr">sendMessage</span>: <span class="title function_">async</span> (channelId, content, options) =&gt; &#123;</span><br><span class="line">      <span class="comment">// channelId: 频道ID</span></span><br><span class="line">      <span class="comment">// content: 消息内容</span></span><br><span class="line">      <span class="comment">// options: 可选参数</span></span><br><span class="line">      <span class="comment">//   - msg_id: 回复的消息ID</span></span><br><span class="line">      <span class="comment">//   - event_id: 事件ID</span></span><br><span class="line">      <span class="comment">// 返回:</span></span><br><span class="line">      <span class="comment">// - 成功: messageObject</span></span><br><span class="line">      <span class="comment">// - 审核: &#123; code: 304023, data: &#123; message_audit: &#123; audit_id: &quot;xxx&quot; &#125; &#125; &#125;</span></span><br><span class="line">      <span class="keyword">return</span> response</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 删除消息</span></span><br><span class="line">    <span class="attr">deleteMessage</span>: <span class="title function_">async</span> (channelId, messageId) =&gt; &#123;</span><br><span class="line">      <span class="comment">// channelId: 频道ID</span></span><br><span class="line">      <span class="comment">// messageId: 消息ID</span></span><br><span class="line">      <span class="keyword">return</span> boolean</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取成员信息</span></span><br><span class="line">    <span class="attr">getMember</span>: <span class="title function_">async</span> (guildId, userId) =&gt; &#123;</span><br><span class="line">      <span class="comment">// guildId: 服务器ID</span></span><br><span class="line">      <span class="comment">// userId: 用户ID</span></span><br><span class="line">      <span class="keyword">return</span> memberObject</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取服务器角色列表</span></span><br><span class="line">    <span class="attr">getGuildRoles</span>: <span class="title function_">async</span> (guildId) =&gt; &#123;</span><br><span class="line">      <span class="comment">// guildId: 服务器ID</span></span><br><span class="line">      <span class="keyword">return</span> rolesArray</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查权限</span></span><br><span class="line">    <span class="attr">hasPermission</span>: <span class="function">(<span class="params">permissions, permission</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// permissions: 权限值</span></span><br><span class="line">      <span class="comment">// permission: 要检查的权限</span></span><br><span class="line">      <span class="keyword">return</span> boolean</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="插件功能界面预览"><a href="#插件功能界面预览" class="headerlink" title="插件功能界面预览"></a>插件功能界面预览</h2><p><img src="/img/qqBot/log.jpg" alt="插件功能界面"></p>
<h2 id="消息处理流程"><a href="#消息处理流程" class="headerlink" title="消息处理流程"></a>消息处理流程</h2><ol>
<li><p>消息接收</p>
<ul>
<li>系统接收到新消息时，会检查消息内容是否以配置的命令前缀开始</li>
<li>解析出命令和参数</li>
<li>查找所有匹配的已启用插件</li>
</ul>
</li>
<li><p>插件执行</p>
<ul>
<li>对每个匹配的插件：<ul>
<li>创建独立的插件上下文对象</li>
<li>调用插件的handler函数</li>
<li>等待处理结果</li>
</ul>
</li>
<li>多个插件可以使用相同的命令</li>
<li>插件按照加载顺序依次执行</li>
<li>某个插件执行失败不会影响其他插件</li>
</ul>
</li>
<li><p>响应处理</p>
<ul>
<li>每个插件的handler如果返回字符串，系统会自动发送响应消息</li>
<li>每个响应都是独立的，会分别发送到频道</li>
<li>发送的消息可能进入审核状态(code: 304023)</li>
<li>审核通过或拒绝会触发相应的事件</li>
</ul>
</li>
</ol>
<h2 id="权限处理"><a href="#权限处理" class="headerlink" title="权限处理"></a>权限处理</h2><p>系统会自动计算机器人的权限：</p>
<ol>
<li><p>管理员权限</p>
<ul>
<li>频道主</li>
<li>管理员</li>
<li>超级管理员</li>
<li>子频道管理员<br>拥有以上角色时自动获得所有权限(1099511627775)</li>
</ul>
</li>
<li><p>普通权限</p>
<ul>
<li>根据角色的permissions值按位计算</li>
<li>多个角色的权限值进行按位或运算</li>
<li>可以使用api.hasPermission检查特定权限</li>
</ul>
</li>
</ol>
<h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><ol>
<li><p>错误处理</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">handler</span>: <span class="title function_">async</span> (message, channel, context) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 处理逻辑</span></span><br><span class="line">    context.<span class="property">log</span>.<span class="title function_">info</span>(<span class="string">&#x27;处理成功&#x27;</span>, &#123; <span class="attr">messageId</span>: message.<span class="property">id</span> &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;成功消息&#x27;</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    context.<span class="property">log</span>.<span class="title function_">error</span>(<span class="string">&#x27;处理失败&#x27;</span>, &#123; error, <span class="attr">messageId</span>: message.<span class="property">id</span> &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;处理失败，请稍后重试&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>数据持久化</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用storage API保存数据</span></span><br><span class="line"><span class="keyword">const</span> records = context.<span class="property">storage</span>.<span class="title function_">get</span>(<span class="string">&#x27;records&#x27;</span>) || &#123;&#125;</span><br><span class="line">records[userId] = &#123; <span class="comment">/* 数据 */</span> &#125;</span><br><span class="line">context.<span class="property">storage</span>.<span class="title function_">set</span>(<span class="string">&#x27;records&#x27;</span>, records)</span><br></pre></td></tr></table></figure>
</li>
<li><p>消息审核处理</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> response = <span class="keyword">await</span> context.<span class="property">api</span>.<span class="title function_">sendMessage</span>(channelId, content)</span><br><span class="line"><span class="keyword">if</span> (response.<span class="property">code</span> === <span class="number">304023</span>) &#123;</span><br><span class="line">  context.<span class="property">log</span>.<span class="title function_">info</span>(<span class="string">&#x27;消息进入审核&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">auditId</span>: response.<span class="property">data</span>.<span class="property">message_audit</span>.<span class="property">audit_id</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>权限检查</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!context.<span class="property">api</span>.<span class="title function_">hasPermission</span>(channel.<span class="property">permissions</span>, <span class="string">&#x27;MANAGE_MESSAGES&#x27;</span>)) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;权限不足，需要管理消息的权限&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>么么扎~~</p>
]]></content>
      <categories>
        <category>知识点</category>
      </categories>
      <tags>
        <tag>笔记</tag>
        <tag>QQ</tag>
        <tag>QQ频道</tag>
        <tag>QQ机器人</tag>
        <tag>开发文档</tag>
      </tags>
  </entry>
  <entry>
    <title>2024年AI编程助手深度评测：哪款最适合你？</title>
    <url>/2024/10/15/ai-coding-assistants/</url>
    <content><![CDATA[<blockquote>
<p>随着AI技术的快速发展，各种AI编程助手层出不穷。本文将深入对比主流AI编程助手的优缺点，帮助你找到最适合自己的AI编程伙伴。</p>
</blockquote>
<span id="more"></span>

<h2 id="1-Cursor-专注高效的AI编程助手"><a href="#1-Cursor-专注高效的AI编程助手" class="headerlink" title="1. Cursor - 专注高效的AI编程助手"></a>1. Cursor - 专注高效的AI编程助手</h2><h3 id="1-1-主要特点"><a href="#1-1-主要特点" class="headerlink" title="1.1 主要特点"></a>1.1 主要特点</h3><ul>
<li>基于先进的AI模型</li>
<li>完整的IDE功能</li>
<li>强大的代码补全和生成能力</li>
<li>支持多种编程语言</li>
<li>实时代码分析和建议</li>
</ul>
<h3 id="1-2-优点"><a href="#1-2-优点" class="headerlink" title="1.2 优点"></a>1.2 优点</h3><ol>
<li><p><strong>代码理解能力强</strong></p>
<ul>
<li>能准确理解项目上下文</li>
<li>提供精准的代码建议</li>
<li>支持复杂代码重构</li>
</ul>
</li>
<li><p><strong>交互体验优秀</strong></p>
<ul>
<li>界面简洁直观</li>
<li>响应速度快</li>
<li>支持自然语言交互</li>
</ul>
</li>
<li><p><strong>功能完整性</strong></p>
<ul>
<li>集成Git版本控制</li>
<li>支持代码调试</li>
<li>内置终端功能</li>
</ul>
</li>
</ol>
<h3 id="1-3-缺点"><a href="#1-3-缺点" class="headerlink" title="1.3 缺点"></a>1.3 缺点</h3><ol>
<li><p><strong>资源占用较高</strong></p>
<ul>
<li>运行需要较好的硬件配置</li>
<li>启动速度较慢</li>
</ul>
</li>
<li><p><strong>收费较高</strong></p>
<ul>
<li>完整功能需要付费订阅</li>
<li>价格对个人开发者略高</li>
</ul>
</li>
</ol>
<h2 id="2-CodeGeeX-国产优秀AI编程助手"><a href="#2-CodeGeeX-国产优秀AI编程助手" class="headerlink" title="2. CodeGeeX - 国产优秀AI编程助手"></a>2. CodeGeeX - 国产优秀AI编程助手</h2><h3 id="2-1-主要特点"><a href="#2-1-主要特点" class="headerlink" title="2.1 主要特点"></a>2.1 主要特点</h3><ul>
<li>支持中文交互</li>
<li>离线运行能力</li>
<li>跨平台支持</li>
<li>多种编辑器插件</li>
</ul>
<h3 id="2-2-优点"><a href="#2-2-优点" class="headerlink" title="2.2 优点"></a>2.2 优点</h3><ol>
<li><p><strong>本地化优势</strong></p>
<ul>
<li>完善的中文支持</li>
<li>符合国内开发习惯</li>
<li>响应速度快</li>
</ul>
</li>
<li><p><strong>性价比高</strong></p>
<ul>
<li>基础功能免费</li>
<li>企业版价格合理</li>
<li>教育优惠政策</li>
</ul>
</li>
<li><p><strong>安全性好</strong></p>
<ul>
<li>支持私有部署</li>
<li>代码不出境</li>
<li>数据安全有保障</li>
</ul>
</li>
</ol>
<h3 id="2-3-缺点"><a href="#2-3-缺点" class="headerlink" title="2.3 缺点"></a>2.3 缺点</h3><ol>
<li><p><strong>功能完整度</strong></p>
<ul>
<li>部分高级功能不如国外产品</li>
<li>IDE集成度有待提高</li>
</ul>
</li>
<li><p><strong>模型能力</strong></p>
<ul>
<li>在某些专业领域理解不够深入</li>
<li>代码生成质量略低于顶级产品</li>
</ul>
</li>
</ol>
<h2 id="3-GitHub-Copilot-最受欢迎的AI助手"><a href="#3-GitHub-Copilot-最受欢迎的AI助手" class="headerlink" title="3. GitHub Copilot - 最受欢迎的AI助手"></a>3. GitHub Copilot - 最受欢迎的AI助手</h2><h3 id="3-1-主要特点"><a href="#3-1-主要特点" class="headerlink" title="3.1 主要特点"></a>3.1 主要特点</h3><ul>
<li>微软和GitHub联合开发</li>
<li>基于OpenAI技术</li>
<li>支持主流编辑器</li>
<li>强大的代码生成能力</li>
</ul>
<h3 id="3-2-优点"><a href="#3-2-优点" class="headerlink" title="3.2 优点"></a>3.2 优点</h3><ol>
<li><p><strong>代码质量高</strong></p>
<ul>
<li>基于海量GitHub代码训练</li>
<li>生成代码可读性好</li>
<li>注释详细准确</li>
</ul>
</li>
<li><p><strong>集成度高</strong></p>
<ul>
<li>支持VS Code等主流IDE</li>
<li>操作便捷</li>
<li>学习成本低</li>
</ul>
</li>
<li><p><strong>更新频繁</strong></p>
<ul>
<li>持续改进和优化</li>
<li>Bug修复及时</li>
<li>新功能不断</li>
</ul>
</li>
</ol>
<h3 id="3-3-缺点"><a href="#3-3-缺点" class="headerlink" title="3.3 缺点"></a>3.3 缺点</h3><ol>
<li><p><strong>价格较贵</strong></p>
<ul>
<li>月付费用较高</li>
<li>没有永久授权选项</li>
</ul>
</li>
<li><p><strong>网络依赖</strong></p>
<ul>
<li>需要稳定的网络连接</li>
<li>无法离线使用</li>
</ul>
</li>
</ol>
<h2 id="4-国内其他AI编程助手"><a href="#4-国内其他AI编程助手" class="headerlink" title="4. 国内其他AI编程助手"></a>4. 国内其他AI编程助手</h2><h3 id="4-1-MarsCode-抖音官方AI编程助手"><a href="#4-1-MarsCode-抖音官方AI编程助手" class="headerlink" title="4.1 MarsCode - 抖音官方AI编程助手"></a>4.1 MarsCode - 抖音官方AI编程助手</h3><p><strong>主要特点：</strong></p>
<ul>
<li>字节跳动官方出品</li>
<li>基于先进的CodeFuse大模型</li>
<li>支持VSCode、JetBrains等主流IDE</li>
<li>提供Web版在线使用</li>
<li>完全免费使用</li>
</ul>
<p><strong>优点：</strong></p>
<ol>
<li><p><strong>强大的代码生成能力</strong></p>
<ul>
<li>基于海量字节跳动内部代码训练</li>
<li>支持40+种主流编程语言</li>
<li>代码质量和可用性较高</li>
<li>支持完整函数和类的生成</li>
</ul>
</li>
<li><p><strong>智能交互体验</strong></p>
<ul>
<li>支持自然语言对话</li>
<li>提供代码解释和优化建议</li>
<li>实时代码补全</li>
<li>多轮对话上下文理解</li>
</ul>
</li>
<li><p><strong>便捷的使用方式</strong></p>
<ul>
<li>完全免费，无需付费</li>
<li>支持Web端直接使用</li>
<li>IDE插件集成便捷</li>
<li>快速的响应速度</li>
</ul>
</li>
<li><p><strong>中文支持优秀</strong></p>
<ul>
<li>完善的中文交互</li>
<li>准确的中文需求理解</li>
<li>详细的中文注释生成</li>
<li>符合国内开发习惯</li>
</ul>
</li>
</ol>
<p><strong>缺点：</strong></p>
<ol>
<li><p><strong>功能限制</strong></p>
<ul>
<li>部分高级功能尚未开放</li>
<li>代码分析深度有限</li>
<li>重构功能相对基础</li>
</ul>
</li>
<li><p><strong>生态体系</strong></p>
<ul>
<li>插件数量较少</li>
<li>社区资源不够丰富</li>
<li>文档和教程较少</li>
</ul>
</li>
<li><p><strong>使用限制</strong></p>
<ul>
<li>需要抖音账号登录</li>
<li>可能有API调用限制</li>
<li>暂不支持私有部署</li>
</ul>
</li>
<li><p><strong>稳定性待提升</strong></p>
<ul>
<li>服务偶有波动</li>
<li>代码生成质量不够稳定</li>
<li>复杂场景支持有限</li>
</ul>
</li>
</ol>
<h3 id="4-2-百度智能编程助手"><a href="#4-2-百度智能编程助手" class="headerlink" title="4.2 百度智能编程助手"></a>4.2 百度智能编程助手</h3><p><strong>优点：</strong></p>
<ul>
<li>中文支持好</li>
<li>与百度生态集成</li>
<li>免费额度大</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>功能相对简单</li>
<li>仅支持部分语言</li>
<li>社区活跃度低</li>
</ul>
<h3 id="4-3-阿里云代码智能助手"><a href="#4-3-阿里云代码智能助手" class="headerlink" title="4.3 阿里云代码智能助手"></a>4.3 阿里云代码智能助手</h3><p><strong>优点：</strong></p>
<ul>
<li>阿里云生态集成</li>
<li>企业级支持</li>
<li>安全性高</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>需要阿里云账号</li>
<li>收费较高</li>
<li>通用性不足</li>
</ul>
<h2 id="5-选择建议"><a href="#5-选择建议" class="headerlink" title="5. 选择建议"></a>5. 选择建议</h2><h3 id="5-1-不同场景的选择建议"><a href="#5-1-不同场景的选择建议" class="headerlink" title="5.1 不同场景的选择建议"></a>5.1 不同场景的选择建议</h3><ol>
<li><p><strong>个人开发者</strong></p>
<ul>
<li>预算充足：Cursor或GitHub Copilot</li>
<li>预算有限：CodeGeeX</li>
<li>中文环境：CodeGeeX或百度智能编程助手</li>
</ul>
</li>
<li><p><strong>企业用户</strong></p>
<ul>
<li>注重安全：CodeGeeX企业版</li>
<li>团队协作：GitHub Copilot商业版</li>
<li>云生态：阿里云代码智能助手</li>
</ul>
</li>
<li><p><strong>学生用户</strong></p>
<ul>
<li>GitHub Copilot（有教育优惠）</li>
<li>CodeGeeX（免费版够用）</li>
</ul>
</li>
</ol>
<h3 id="5-2-选择考虑因素"><a href="#5-2-选择考虑因素" class="headerlink" title="5.2 选择考虑因素"></a>5.2 选择考虑因素</h3><ol>
<li><p><strong>预算</strong></p>
<ul>
<li>免费使用需求</li>
<li>性价比考虑</li>
<li>长期订阅成本</li>
</ul>
</li>
<li><p><strong>使用场景</strong></p>
<ul>
<li>个人/团队使用</li>
<li>项目规模</li>
<li>编程语言支持</li>
</ul>
</li>
<li><p><strong>特殊需求</strong></p>
<ul>
<li>中文支持</li>
<li>离线使用</li>
<li>安全合规</li>
</ul>
</li>
</ol>
<h2 id="6-使用技巧分享"><a href="#6-使用技巧分享" class="headerlink" title="6. 使用技巧分享"></a>6. 使用技巧分享</h2><h3 id="6-1-提高AI助手效率的技巧"><a href="#6-1-提高AI助手效率的技巧" class="headerlink" title="6.1 提高AI助手效率的技巧"></a>6.1 提高AI助手效率的技巧</h3><ol>
<li><p><strong>编写清晰的提示</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 好的提示示例</span></span><br><span class="line"><span class="comment">// 实现一个基于Promise的延迟函数，支持取消操作</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>善用上下文</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 先说明需求背景</span></span><br><span class="line"><span class="comment">// 再描述具体功能</span></span><br><span class="line"><span class="comment">// 最后指出关键点</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>结合文档使用</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 查看官方文档</span></span><br><span class="line"><span class="comment">// 参考示例代码</span></span><br><span class="line"><span class="comment">// 理解实现原理</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="6-2-避免常见误区"><a href="#6-2-避免常见误区" class="headerlink" title="6.2 避免常见误区"></a>6.2 避免常见误区</h3><ol>
<li><p><strong>过度依赖</strong></p>
<ul>
<li>不要完全依赖AI生成代码</li>
<li>保持代码审查习惯</li>
<li>理解代码逻辑</li>
</ul>
</li>
<li><p><strong>忽视性能</strong></p>
<ul>
<li>注意代码质量</li>
<li>考虑性能影响</li>
<li>测试生成代码</li>
</ul>
</li>
</ol>
<h2 id="7-未来展望"><a href="#7-未来展望" class="headerlink" title="7. 未来展望"></a>7. 未来展望</h2><ol>
<li><p><strong>技术趋势</strong></p>
<ul>
<li>模型能力持续提升</li>
<li>多模态交互增强</li>
<li>个性化推荐加强</li>
</ul>
</li>
<li><p><strong>行业影响</strong></p>
<ul>
<li>提高开发效率</li>
<li>降低入门门槛</li>
<li>改变开发模式</li>
</ul>
</li>
<li><p><strong>注意事项</strong></p>
<ul>
<li>保持学习能力</li>
<li>提高代码素养</li>
<li>关注安全合规</li>
</ul>
</li>
</ol>
<h2 id="8-总结"><a href="#8-总结" class="headerlink" title="8. 总结"></a>8. 总结</h2><ol>
<li>选择合适的AI编程助手很重要</li>
<li>根据实际需求和场景选择</li>
<li>合理使用提高开发效率</li>
<li>避免过度依赖</li>
<li>持续关注新技术发展</li>
</ol>
<h2 id="5-产品对比分析"><a href="#5-产品对比分析" class="headerlink" title="5. 产品对比分析"></a>5. 产品对比分析</h2><h3 id="5-1-功能对比"><a href="#5-1-功能对比" class="headerlink" title="5.1 功能对比"></a>5.1 功能对比</h3><table>
<thead>
<tr>
<th>功能特性</th>
<th>Cursor</th>
<th>GitHub Copilot</th>
<th>CodeGeeX</th>
<th>MarsCode</th>
</tr>
</thead>
<tbody><tr>
<td>代码补全</td>
<td>⭐⭐⭐⭐⭐</td>
<td>⭐⭐⭐⭐⭐</td>
<td>⭐⭐⭐⭐</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td>代码生成</td>
<td>⭐⭐⭐⭐⭐</td>
<td>⭐⭐⭐⭐⭐</td>
<td>⭐⭐⭐⭐</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td>中文支持</td>
<td>⭐⭐⭐</td>
<td>⭐⭐</td>
<td>⭐⭐⭐⭐⭐</td>
<td>⭐⭐⭐⭐⭐</td>
</tr>
<tr>
<td>IDE集成</td>
<td>⭐⭐⭐⭐⭐</td>
<td>⭐⭐⭐⭐⭐</td>
<td>⭐⭐⭐⭐</td>
<td>⭐⭐⭐</td>
</tr>
<tr>
<td>响应速度</td>
<td>⭐⭐⭐⭐</td>
<td>⭐⭐⭐⭐⭐</td>
<td>⭐⭐⭐⭐</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td>代码质量</td>
<td>⭐⭐⭐⭐⭐</td>
<td>⭐⭐⭐⭐⭐</td>
<td>⭐⭐⭐⭐</td>
<td>⭐⭐⭐⭐</td>
</tr>
</tbody></table>
<h3 id="5-2-价格对比"><a href="#5-2-价格对比" class="headerlink" title="5.2 价格对比"></a>5.2 价格对比</h3><table>
<thead>
<tr>
<th>产品</th>
<th>免费版</th>
<th>个人版</th>
<th>团队版</th>
<th>企业版</th>
</tr>
</thead>
<tbody><tr>
<td>Cursor</td>
<td>基础功能</td>
<td>$20/月</td>
<td>$40/人/月</td>
<td>联系商务</td>
</tr>
<tr>
<td>GitHub Copilot</td>
<td>无</td>
<td>$10/月</td>
<td>$19/人/月</td>
<td>联系商务</td>
</tr>
<tr>
<td>CodeGeeX</td>
<td>完整功能</td>
<td>免费</td>
<td>¥299/人/年</td>
<td>联系商务</td>
</tr>
<tr>
<td>MarsCode</td>
<td>完整功能</td>
<td>免费</td>
<td>免费</td>
<td>免费</td>
</tr>
</tbody></table>
<h3 id="5-3-适用场景对比"><a href="#5-3-适用场景对比" class="headerlink" title="5.3 适用场景对比"></a>5.3 适用场景对比</h3><ol>
<li><p><strong>个人开发者</strong></p>
<ul>
<li>预算充足：GitHub Copilot &gt; Cursor</li>
<li>预算有限：MarsCode &gt; CodeGeeX</li>
<li>中文环境：MarsCode = CodeGeeX &gt; 其他</li>
</ul>
</li>
<li><p><strong>团队使用</strong></p>
<ul>
<li>大型企业：GitHub Copilot &gt; Cursor &gt; CodeGeeX</li>
<li>中小企业：CodeGeeX &gt; MarsCode &gt; 其他</li>
<li>创业团队：MarsCode &gt; CodeGeeX &gt; 其他</li>
</ul>
</li>
<li><p><strong>特定需求</strong></p>
<ul>
<li>离线使用：CodeGeeX &gt; 其他</li>
<li>私有部署：CodeGeeX &gt; GitHub Copilot</li>
<li>中文支持：MarsCode = CodeGeeX &gt; 其他</li>
</ul>
</li>
</ol>
<hr>
<blockquote>
<p>如果觉得文章对你有帮助,欢迎点赞、评论、分享,你的支持是我继续创作的动力！ </p>
</blockquote>
]]></content>
      <categories>
        <category>技术评测</category>
        <category>AI工具</category>
      </categories>
      <tags>
        <tag>AI编程</tag>
        <tag>开发工具</tag>
        <tag>Cursor</tag>
        <tag>CodeGeeX</tag>
        <tag>编程助手</tag>
      </tags>
  </entry>
  <entry>
    <title>uni-app地图定位踩坑记：地图功能和定位的那些坑</title>
    <url>/2024/06/25/uniapp-map-location/</url>
    <content><![CDATA[<blockquote>
<p>在uni-app开发中，地图和定位功能经常会遇到各种问题。本文总结了一些常见的坑和解决方案，帮助大家更好地实现地图相关功能。</p>
</blockquote>
<span id="more"></span>

<h2 id="1-定位权限问题"><a href="#1-定位权限问题" class="headerlink" title="1. 定位权限问题"></a>1. 定位权限问题</h2><h3 id="1-1-获取定位权限"><a href="#1-1-获取定位权限" class="headerlink" title="1.1 获取定位权限"></a>1.1 获取定位权限</h3><p><strong>问题描述：</strong><br>用户拒绝定位权限后，无法正常使用定位功能。</p>
<p><strong>解决方案：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 检查定位权限</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">checkLocationAuth</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> uni.<span class="title function_">getSetting</span>()</span><br><span class="line">    <span class="keyword">if</span> (!res.<span class="property">authSetting</span>[<span class="string">&#x27;scope.userLocation&#x27;</span>]) &#123;</span><br><span class="line">      <span class="comment">// 未授权，引导用户开启</span></span><br><span class="line">      <span class="keyword">await</span> uni.<span class="title function_">showModal</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">        <span class="attr">content</span>: <span class="string">&#x27;需要获取您的位置信息，是否授权？&#x27;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="title function_">async</span> (res) =&gt; &#123;</span><br><span class="line">          <span class="keyword">if</span> (res.<span class="property">confirm</span>) &#123;</span><br><span class="line">            <span class="keyword">await</span> uni.<span class="title function_">openSetting</span>()</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="property">authSetting</span>[<span class="string">&#x27;scope.userLocation&#x27;</span>]</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;获取权限失败：&#x27;</span>, e)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-定位失败处理"><a href="#1-2-定位失败处理" class="headerlink" title="1.2 定位失败处理"></a>1.2 定位失败处理</h3><p><strong>问题描述：</strong><br>定位失败时没有合适的提示和处理。</p>
<p><strong>解决方案：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取位置信息</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">getLocation</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> auth = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">checkLocationAuth</span>()</span><br><span class="line">    <span class="keyword">if</span> (!auth) &#123;</span><br><span class="line">      uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;请先开启定位权限&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> location = <span class="keyword">await</span> uni.<span class="title function_">getLocation</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;gcj02&#x27;</span>, <span class="comment">// gcj02火星坐标系</span></span><br><span class="line">      <span class="attr">isHighAccuracy</span>: <span class="literal">true</span>, <span class="comment">// 开启高精度定位</span></span><br><span class="line">      <span class="attr">highAccuracyExpireTime</span>: <span class="number">3000</span> <span class="comment">// 超时时间</span></span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> location</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">let</span> message = <span class="string">&#x27;定位失败&#x27;</span></span><br><span class="line">    <span class="keyword">switch</span> (e.<span class="property">errMsg</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;getLocation:fail system permission denied&#x27;</span>:</span><br><span class="line">        message = <span class="string">&#x27;系统定位权限已关闭&#x27;</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;getLocation:fail timeout&#x27;</span>:</span><br><span class="line">        message = <span class="string">&#x27;定位超时，请重试&#x27;</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">        message = <span class="string">&#x27;定位失败，请检查网络&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: message,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-地图显示问题"><a href="#2-地图显示问题" class="headerlink" title="2. 地图显示问题"></a>2. 地图显示问题</h2><h3 id="2-1-地图加载失败"><a href="#2-1-地图加载失败" class="headerlink" title="2.1 地图加载失败"></a>2.1 地图加载失败</h3><p><strong>问题描述：</strong><br>地图组件加载失败或显示空白。</p>
<p><strong>解决方案：</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 地图组件使用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;map-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">map</span></span></span><br><span class="line"><span class="tag">      <span class="attr">id</span>=<span class="string">&quot;map&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:style</span>=<span class="string">&quot;mapStyle&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:latitude</span>=<span class="string">&quot;latitude&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:longitude</span>=<span class="string">&quot;longitude&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:markers</span>=<span class="string">&quot;markers&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:scale</span>=<span class="string">&quot;scale&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">regionchange</span>=<span class="string">&quot;onRegionChange&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">markertap</span>=<span class="string">&quot;onMarkerTap&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:show-location</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">mapStyle</span>: <span class="string">&#x27;width: 100%; height: 300px;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">latitude</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">longitude</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">markers</span>: [],</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">scale</span>: <span class="number">16</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">async</span> <span class="title function_">onReady</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 等待地图组件创建完成</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="property">mapContext</span> = uni.<span class="title function_">createMapContext</span>(<span class="string">&#x27;map&#x27;</span>, <span class="variable language_">this</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">initMap</span>()</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">async</span> <span class="title function_">initMap</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> location = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">getLocation</span>()</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (location) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">latitude</span> = location.<span class="property">latitude</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">longitude</span> = location.<span class="property">longitude</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 添加当前位置标记</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="title function_">addMarker</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">id</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">latitude</span>: location.<span class="property">latitude</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">longitude</span>: location.<span class="property">longitude</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">title</span>: <span class="string">&#x27;当前位置&#x27;</span></span></span><br><span class="line"><span class="language-javascript">          &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">catch</span> (e) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;初始化地图失败：&#x27;</span>, e)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-标记点显示问题"><a href="#2-2-标记点显示问题" class="headerlink" title="2.2 标记点显示问题"></a>2.2 标记点显示问题</h3><p><strong>问题描述：</strong><br>自定义标记点样式不生效或显示异常。</p>
<p><strong>解决方案：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 添加自定义标记</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addMarker</span>(<span class="params">point</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> marker = &#123;</span><br><span class="line">    <span class="attr">id</span>: point.<span class="property">id</span>,</span><br><span class="line">    <span class="attr">latitude</span>: point.<span class="property">latitude</span>,</span><br><span class="line">    <span class="attr">longitude</span>: point.<span class="property">longitude</span>,</span><br><span class="line">    <span class="attr">title</span>: point.<span class="property">title</span>,</span><br><span class="line">    <span class="attr">width</span>: <span class="number">32</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">32</span>,</span><br><span class="line">    <span class="attr">callout</span>: &#123;</span><br><span class="line">      <span class="attr">content</span>: point.<span class="property">title</span>,</span><br><span class="line">      <span class="attr">color</span>: <span class="string">&#x27;#ffffff&#x27;</span>,</span><br><span class="line">      <span class="attr">fontSize</span>: <span class="number">14</span>,</span><br><span class="line">      <span class="attr">borderRadius</span>: <span class="number">4</span>,</span><br><span class="line">      <span class="attr">bgColor</span>: <span class="string">&#x27;#1989fa&#x27;</span>,</span><br><span class="line">      <span class="attr">padding</span>: <span class="number">8</span>,</span><br><span class="line">      <span class="attr">display</span>: <span class="string">&#x27;ALWAYS&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 自定义图标</span></span><br><span class="line">    <span class="attr">iconPath</span>: point.<span class="property">iconPath</span> || <span class="string">&#x27;/static/images/marker.png&#x27;</span>,</span><br><span class="line">    <span class="comment">// 自定义气泡</span></span><br><span class="line">    <span class="attr">customCallout</span>: &#123;</span><br><span class="line">      <span class="attr">display</span>: <span class="string">&#x27;ALWAYS&#x27;</span>,</span><br><span class="line">      <span class="attr">anchorY</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">anchorX</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">markers</span>.<span class="title function_">push</span>(marker)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-路线规划问题"><a href="#3-路线规划问题" class="headerlink" title="3. 路线规划问题"></a>3. 路线规划问题</h2><h3 id="3-1-路线绘制错误"><a href="#3-1-路线绘制错误" class="headerlink" title="3.1 路线绘制错误"></a>3.1 路线绘制错误</h3><p><strong>问题描述：</strong><br>路线规划时绘制的路线不准确或无法显示。</p>
<p><strong>解决方案：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 规划路线</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">planRoute</span>(<span class="params">start, end</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 清除旧路线</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">polyline</span> = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取路线规划</span></span><br><span class="line">    <span class="keyword">const</span> route = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">getRoutePoints</span>(start, end)</span><br><span class="line">    <span class="keyword">if</span> (!route) <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 绘制路线</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">polyline</span> = [&#123;</span><br><span class="line">      <span class="attr">points</span>: route,</span><br><span class="line">      <span class="attr">color</span>: <span class="string">&#x27;#1989fa&#x27;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">4</span>,</span><br><span class="line">      <span class="attr">arrowLine</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">borderColor</span>: <span class="string">&#x27;#ffffff&#x27;</span>,</span><br><span class="line">      <span class="attr">borderWidth</span>: <span class="number">2</span></span><br><span class="line">    &#125;]</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 调整视野以显示整条路线</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">mapContext</span>.<span class="title function_">includePoints</span>(&#123;</span><br><span class="line">      <span class="attr">points</span>: [start, end],</span><br><span class="line">      <span class="attr">padding</span>: [<span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;规划路线失败：&#x27;</span>, e)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-导航问题"><a href="#3-2-导航问题" class="headerlink" title="3.2 导航问题"></a>3.2 导航问题</h3><p><strong>问题描述：</strong><br>调用导航功能时出现兼容性问题。</p>
<p><strong>解决方案：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 打开导航</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">openNavigation</span>(<span class="params">destination</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 检查平台</span></span><br><span class="line">    <span class="comment">// #ifdef APP-PLUS</span></span><br><span class="line">    <span class="comment">// APP端使用系统导航</span></span><br><span class="line">    plus.<span class="property">runtime</span>.<span class="title function_">openURL</span>(</span><br><span class="line">      <span class="string">`androidamap://navi?sourceApplication=appname&amp;lat=<span class="subst">$&#123;destination.latitude&#125;</span>&amp;lon=<span class="subst">$&#123;destination.longitude&#125;</span>&amp;dev=0&amp;style=2`</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// #ifdef H5</span></span><br><span class="line">    <span class="comment">// H5端使用Web导航</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">`https://uri.amap.com/navigation?to=<span class="subst">$&#123;destination.longitude&#125;</span>,<span class="subst">$&#123;destination.latitude&#125;</span>&amp;mode=car&amp;policy=1`</span></span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// #ifdef MP-WEIXIN</span></span><br><span class="line">    <span class="comment">// 小程序端使用微信导航</span></span><br><span class="line">    uni.<span class="title function_">openLocation</span>(&#123;</span><br><span class="line">      <span class="attr">latitude</span>: destination.<span class="property">latitude</span>,</span><br><span class="line">      <span class="attr">longitude</span>: destination.<span class="property">longitude</span>,</span><br><span class="line">      <span class="attr">name</span>: destination.<span class="property">name</span>,</span><br><span class="line">      <span class="attr">address</span>: destination.<span class="property">address</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;打开导航失败&#x27;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-性能优化问题"><a href="#4-性能优化问题" class="headerlink" title="4. 性能优化问题"></a>4. 性能优化问题</h2><h3 id="4-1-标记点过多"><a href="#4-1-标记点过多" class="headerlink" title="4.1 标记点过多"></a>4.1 标记点过多</h3><p><strong>问题描述：</strong><br>地图上标记点太多导致卡顿。</p>
<p><strong>解决方案：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 聚合标记点</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clusterMarkers</span>(<span class="params">markers, distance = <span class="number">20</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> clusters = []</span><br><span class="line">  <span class="keyword">const</span> used = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">  </span><br><span class="line">  markers.<span class="title function_">forEach</span>(<span class="function">(<span class="params">marker, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (used.<span class="title function_">has</span>(index)) <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> cluster = &#123;</span><br><span class="line">      <span class="attr">center</span>: &#123;</span><br><span class="line">        <span class="attr">latitude</span>: marker.<span class="property">latitude</span>,</span><br><span class="line">        <span class="attr">longitude</span>: marker.<span class="property">longitude</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">points</span>: [marker]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查找附近的点</span></span><br><span class="line">    markers.<span class="title function_">forEach</span>(<span class="function">(<span class="params">m, i</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (i === index || used.<span class="title function_">has</span>(i)) <span class="keyword">return</span></span><br><span class="line">      </span><br><span class="line">      <span class="keyword">const</span> d = <span class="variable language_">this</span>.<span class="title function_">calculateDistance</span>(</span><br><span class="line">        marker.<span class="property">latitude</span>,</span><br><span class="line">        marker.<span class="property">longitude</span>,</span><br><span class="line">        m.<span class="property">latitude</span>,</span><br><span class="line">        m.<span class="property">longitude</span></span><br><span class="line">      )</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (d &lt;= distance) &#123;</span><br><span class="line">        cluster.<span class="property">points</span>.<span class="title function_">push</span>(m)</span><br><span class="line">        used.<span class="title function_">add</span>(i)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    clusters.<span class="title function_">push</span>(cluster)</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> clusters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-频繁更新"><a href="#4-2-频繁更新" class="headerlink" title="4.2 频繁更新"></a>4.2 频繁更新</h3><p><strong>问题描述：</strong><br>频繁更新标记点位置导致性能问题。</p>
<p><strong>解决方案：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用节流更新位置</span></span><br><span class="line"><span class="keyword">const</span> throttleUpdate = <span class="title function_">throttle</span>(<span class="keyword">function</span>(<span class="params">markers</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">markers</span> = markers</span><br><span class="line">&#125;, <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新标记位置</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateMarkers</span>(<span class="params">newMarkers</span>) &#123;</span><br><span class="line">  <span class="title function_">throttleUpdate</span>(newMarkers)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 节流函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">fn, delay</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (timer) <span class="keyword">return</span></span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)</span><br><span class="line">      timer = <span class="literal">null</span></span><br><span class="line">    &#125;, delay)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-实用功能分享"><a href="#5-实用功能分享" class="headerlink" title="5. 实用功能分享"></a>5. 实用功能分享</h2><h3 id="5-1-计算距离"><a href="#5-1-计算距离" class="headerlink" title="5.1 计算距离"></a>5.1 计算距离</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 计算两点距离</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">calculateDistance</span>(<span class="params">lat1, lng1, lat2, lng2</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> R = <span class="number">6371</span> <span class="comment">// 地球半径，单位km</span></span><br><span class="line">  <span class="keyword">const</span> dLat = (lat2 - lat1) * <span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">180</span></span><br><span class="line">  <span class="keyword">const</span> dLng = (lng2 - lng1) * <span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">180</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> a = <span class="title class_">Math</span>.<span class="title function_">sin</span>(dLat/<span class="number">2</span>) * <span class="title class_">Math</span>.<span class="title function_">sin</span>(dLat/<span class="number">2</span>) +</span><br><span class="line">    <span class="title class_">Math</span>.<span class="title function_">cos</span>(lat1 * <span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">180</span>) * <span class="title class_">Math</span>.<span class="title function_">cos</span>(lat2 * <span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">180</span>) *</span><br><span class="line">    <span class="title class_">Math</span>.<span class="title function_">sin</span>(dLng/<span class="number">2</span>) * <span class="title class_">Math</span>.<span class="title function_">sin</span>(dLng/<span class="number">2</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> c = <span class="number">2</span> * <span class="title class_">Math</span>.<span class="title function_">atan2</span>(<span class="title class_">Math</span>.<span class="title function_">sqrt</span>(a), <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="number">1</span>-a))</span><br><span class="line">  <span class="keyword">return</span> R * c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-地址解析"><a href="#5-2-地址解析" class="headerlink" title="5.2 地址解析"></a>5.2 地址解析</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 地址转坐标</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">geocode</span>(<span class="params">address</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;geocode-api-url&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">address</span>: address,</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&#x27;your-api-key&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">data</span>.<span class="property">status</span> === <span class="string">&#x27;1&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">latitude</span>: res.<span class="property">data</span>.<span class="property">result</span>.<span class="property">location</span>.<span class="property">lat</span>,</span><br><span class="line">        <span class="attr">longitude</span>: res.<span class="property">data</span>.<span class="property">result</span>.<span class="property">location</span>.<span class="property">lng</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;地址解析失败：&#x27;</span>, e)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-最佳实践建议"><a href="#6-最佳实践建议" class="headerlink" title="6. 最佳实践建议"></a>6. 最佳实践建议</h2><ol>
<li>注意权限处理</li>
<li>做好错误提示</li>
<li>优化性能表现</li>
<li>处理兼容问题</li>
<li>注意用户体验</li>
</ol>
<h2 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. 总结</h2><ol>
<li>权限问题要提前处理</li>
<li>地图显示要做好兼容</li>
<li>路线规划要考虑性能</li>
<li>导航功能要适配平台</li>
<li>注意优化用户体验</li>
</ol>
<hr>
<blockquote>
<p>如果觉得文章对你有帮助,欢迎点赞、评论、分享,你的支持是我继续创作的动力！ </p>
</blockquote>
]]></content>
      <categories>
        <category>前端开发</category>
        <category>uni-app</category>
      </categories>
      <tags>
        <tag>前端开发</tag>
        <tag>uni-app</tag>
        <tag>地图功能</tag>
        <tag>定位服务</tag>
      </tags>
  </entry>
  <entry>
    <title>uni-app文件上传踩坑记：图片处理和上传全攻略</title>
    <url>/2024/06/01/uniapp-file-upload/</url>
    <content><![CDATA[<blockquote>
<p>在uni-app开发中，文件上传和图片处理是很常见的需求，但也经常会遇到各种问题。本文总结了一些常见问题和解决方案，希望能帮助大家更好地处理文件上传相关的需求。</p>
</blockquote>
<span id="more"></span>

<h2 id="1-图片选择问题"><a href="#1-图片选择问题" class="headerlink" title="1. 图片选择问题"></a>1. 图片选择问题</h2><h3 id="1-1-图片选择数量限制"><a href="#1-1-图片选择数量限制" class="headerlink" title="1.1 图片选择数量限制"></a>1.1 图片选择数量限制</h3><p><strong>问题描述：</strong><br>选择图片时没有限制数量，导致用户可能选择太多图片。</p>
<p><strong>解决方案：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 限制选择数量和大小</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">chooseImages</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> uni.<span class="title function_">chooseImage</span>(&#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">9</span>, <span class="comment">// 最多选择9张</span></span><br><span class="line">      <span class="attr">sizeType</span>: [<span class="string">&#x27;original&#x27;</span>, <span class="string">&#x27;compressed&#x27;</span>], <span class="comment">// 原图和压缩图都可以</span></span><br><span class="line">      <span class="attr">sourceType</span>: [<span class="string">&#x27;album&#x27;</span>, <span class="string">&#x27;camera&#x27;</span>] <span class="comment">// 相册和相机都可以</span></span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查文件大小</span></span><br><span class="line">    <span class="keyword">const</span> maxSize = <span class="number">5</span> * <span class="number">1024</span> * <span class="number">1024</span> <span class="comment">// 5MB</span></span><br><span class="line">    <span class="keyword">const</span> overSizeFiles = res.<span class="property">tempFiles</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">file</span> =&gt;</span> file.<span class="property">size</span> &gt; maxSize)</span><br><span class="line">    <span class="keyword">if</span> (overSizeFiles.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;图片大小不能超过5MB&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">handleUpload</span>(res.<span class="property">tempFilePaths</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;选择图片失败：&#x27;</span>, e)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-图片格式限制"><a href="#1-2-图片格式限制" class="headerlink" title="1.2 图片格式限制"></a>1.2 图片格式限制</h3><p><strong>问题描述：</strong><br>用户上传了不支持的图片格式。</p>
<p><strong>解决方案：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 检查图片格式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkImageType</span>(<span class="params">filePath</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> allowTypes = [<span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>, <span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>]</span><br><span class="line">  <span class="keyword">const</span> extension = filePath.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="title function_">pop</span>().<span class="title function_">toLowerCase</span>()</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (!allowTypes.<span class="title function_">includes</span>(extension)) &#123;</span><br><span class="line">    uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;只支持jpg、png、gif格式&#x27;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-图片压缩问题"><a href="#2-图片压缩问题" class="headerlink" title="2. 图片压缩问题"></a>2. 图片压缩问题</h2><h3 id="2-1-上传前压缩"><a href="#2-1-上传前压缩" class="headerlink" title="2.1 上传前压缩"></a>2.1 上传前压缩</h3><p><strong>问题描述：</strong><br>图片太大导致上传慢，浪费流量。</p>
<p><strong>解决方案：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 压缩图片</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">compressImage</span>(<span class="params">tempFilePath</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> uni.<span class="title function_">compressImage</span>(&#123;</span><br><span class="line">      <span class="attr">src</span>: tempFilePath,</span><br><span class="line">      <span class="attr">quality</span>: <span class="number">80</span> <span class="comment">// 压缩质量0-100</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> res.<span class="property">tempFilePath</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;压缩失败：&#x27;</span>, e)</span><br><span class="line">    <span class="keyword">return</span> tempFilePath <span class="comment">// 压缩失败返回原图</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">handleUpload</span>(<span class="params">tempFilePaths</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> compressedPaths = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> path <span class="keyword">of</span> tempFilePaths) &#123;</span><br><span class="line">    <span class="keyword">const</span> compressed = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">compressImage</span>(path)</span><br><span class="line">    compressedPaths.<span class="title function_">push</span>(compressed)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">uploadFiles</span>(compressedPaths)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-大图预览优化"><a href="#2-2-大图预览优化" class="headerlink" title="2.2 大图预览优化"></a>2.2 大图预览优化</h3><p><strong>问题描述：</strong><br>直接预览原图占用内存大，可能导致卡顿。</p>
<p><strong>解决方案：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 预览时使用缩略图，点击查看原图</span></span><br><span class="line"><span class="keyword">const</span> imageList = &#123;</span><br><span class="line">  <span class="attr">original</span>: [], <span class="comment">// 原图</span></span><br><span class="line">  <span class="attr">thumbnail</span>: [] <span class="comment">// 缩略图</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 预览图片</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">previewImage</span>(<span class="params">index</span>) &#123;</span><br><span class="line">  uni.<span class="title function_">previewImage</span>(&#123;</span><br><span class="line">    <span class="attr">urls</span>: imageList.<span class="property">original</span>,</span><br><span class="line">    <span class="attr">current</span>: index,</span><br><span class="line">    <span class="comment">// 显示加载提示</span></span><br><span class="line">    <span class="attr">showmenu</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;预览成功&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">fail</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;预览失败&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-上传进度问题"><a href="#3-上传进度问题" class="headerlink" title="3. 上传进度问题"></a>3. 上传进度问题</h2><h3 id="3-1-进度显示不准"><a href="#3-1-进度显示不准" class="headerlink" title="3.1 进度显示不准"></a>3.1 进度显示不准</h3><p><strong>问题描述：</strong><br>上传进度显示不准确，影响用户体验。</p>
<p><strong>解决方案：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 更精确的进度显示</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">uploadFile</span>(<span class="params">filePath</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> uploadTask = uni.<span class="title function_">uploadFile</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;your-upload-url&#x27;</span>,</span><br><span class="line">      <span class="attr">filePath</span>: filePath,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">      <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> <span class="title function_">resolve</span>(res),</span><br><span class="line">      <span class="attr">fail</span>: <span class="function"><span class="params">err</span> =&gt;</span> <span class="title function_">reject</span>(err)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 监听上传进度</span></span><br><span class="line">    uploadTask.<span class="title function_">onProgressUpdate</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> progress = res.<span class="property">progress</span></span><br><span class="line">      <span class="keyword">const</span> speed = (res.<span class="property">totalBytesSent</span> / <span class="number">1024</span> / <span class="number">1024</span>).<span class="title function_">toFixed</span>(<span class="number">2</span>)</span><br><span class="line">      </span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">uploadInfo</span> = &#123;</span><br><span class="line">        <span class="attr">progress</span>: progress,</span><br><span class="line">        <span class="attr">speed</span>: speed + <span class="string">&#x27;MB/s&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 更新UI显示</span></span><br><span class="line">      <span class="variable language_">this</span>.$set(<span class="variable language_">this</span>.<span class="property">uploadProgress</span>, filePath, progress)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-批量上传进度"><a href="#3-2-批量上传进度" class="headerlink" title="3.2 批量上传进度"></a>3.2 批量上传进度</h3><p><strong>问题描述：</strong><br>多文件上传时无法显示总体进度。</p>
<p><strong>解决方案：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 批量上传进度管理</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">uploadFiles</span>(<span class="params">files</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> total = files.<span class="property">length</span></span><br><span class="line">  <span class="keyword">let</span> completed = <span class="number">0</span></span><br><span class="line">  </span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">totalProgress</span> = <span class="number">0</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> uploads = files.<span class="title function_">map</span>(<span class="title function_">async</span> (file, index) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">uploadFile</span>(file)</span><br><span class="line">      completed++</span><br><span class="line">      <span class="comment">// 更新总进度</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">totalProgress</span> = <span class="title class_">Math</span>.<span class="title function_">floor</span>((completed / total) * <span class="number">100</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`文件<span class="subst">$&#123;index + <span class="number">1</span>&#125;</span>上传失败：`</span>, e)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(uploads)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-上传错误处理"><a href="#4-上传错误处理" class="headerlink" title="4. 上传错误处理"></a>4. 上传错误处理</h2><h3 id="4-1-断网重传"><a href="#4-1-断网重传" class="headerlink" title="4.1 断网重传"></a>4.1 断网重传</h3><p><strong>问题描述：</strong><br>上传过程中断网导致上传失败。</p>
<p><strong>解决方案：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 添加重试机制</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">uploadWithRetry</span>(<span class="params">file, maxRetries = <span class="number">3</span></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> retries = <span class="number">0</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">while</span> (retries &lt; maxRetries) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">uploadFile</span>(file)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      retries++</span><br><span class="line">      <span class="keyword">if</span> (retries === maxRetries) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;上传失败，请检查网络后重试&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 等待后重试</span></span><br><span class="line">      <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">1000</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-错误提示优化"><a href="#4-2-错误提示优化" class="headerlink" title="4.2 错误提示优化"></a>4.2 错误提示优化</h3><p><strong>问题描述：</strong><br>上传失败时提示不够友好。</p>
<p><strong>解决方案：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 优化错误提示</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleUploadError</span>(<span class="params">error</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> message = <span class="string">&#x27;上传失败&#x27;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 根据错误类型显示不同提示</span></span><br><span class="line">  <span class="keyword">switch</span> (error.<span class="property">code</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;NETWORK_ERROR&#x27;</span>:</span><br><span class="line">      message = <span class="string">&#x27;网络异常，请检查网络设置&#x27;</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;SIZE_EXCEED&#x27;</span>:</span><br><span class="line">      message = <span class="string">&#x27;文件大小超出限制&#x27;</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;TYPE_ERROR&#x27;</span>:</span><br><span class="line">      message = <span class="string">&#x27;不支持的文件类型&#x27;</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      message = error.<span class="property">message</span> || <span class="string">&#x27;上传失败，请重试&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">    <span class="attr">title</span>: message,</span><br><span class="line">    <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">    <span class="attr">duration</span>: <span class="number">2000</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-实用技巧分享"><a href="#5-实用技巧分享" class="headerlink" title="5. 实用技巧分享"></a>5. 实用技巧分享</h2><h3 id="5-1-自动重命名"><a href="#5-1-自动重命名" class="headerlink" title="5.1 自动重命名"></a>5.1 自动重命名</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 生成文件名</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateFileName</span>(<span class="params">file</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line">  <span class="keyword">const</span> random = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10000</span>)</span><br><span class="line">  <span class="keyword">const</span> extension = file.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="title function_">pop</span>()</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;date.getTime()&#125;</span>_<span class="subst">$&#123;random&#125;</span>.<span class="subst">$&#123;extension&#125;</span>`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-秒传优化"><a href="#5-2-秒传优化" class="headerlink" title="5.2 秒传优化"></a>5.2 秒传优化</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 检查文件是否已上传</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">checkFileExists</span>(<span class="params">file</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> md5 = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">calculateMD5</span>(file)</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">checkMD5</span>(md5)</span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">exists</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="property">url</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-最佳实践建议"><a href="#6-最佳实践建议" class="headerlink" title="6. 最佳实践建议"></a>6. 最佳实践建议</h2><ol>
<li>上传前做好校验</li>
<li>合理使用压缩</li>
<li>添加重试机制</li>
<li>优化用户体验</li>
<li>做好错误处理</li>
</ol>
<h2 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. 总结</h2><ol>
<li>注意文件大小限制</li>
<li>处理好进度显示</li>
<li>优化上传体验</li>
<li>做好容错处理</li>
<li>保持代码可维护</li>
</ol>
<hr>
<blockquote>
<p>如果觉得文章对你有帮助,欢迎点赞、评论、分享,你的支持是我继续创作的动力！ </p>
</blockquote>
]]></content>
      <categories>
        <category>前端开发</category>
        <category>uni-app</category>
      </categories>
      <tags>
        <tag>前端开发</tag>
        <tag>uni-app</tag>
        <tag>文件上传</tag>
        <tag>图片处理</tag>
      </tags>
  </entry>
  <entry>
    <title>uni-app表单验证踩坑记：这些坑我替你踩过了</title>
    <url>/2024/05/10/uniapp-form-validation/</url>
    <content><![CDATA[<blockquote>
<p>做过表单的同学都知道，表单验证看似简单，但总有一些意想不到的问题。本文整理了一些实用的表单验证经验，希望能帮你少走弯路。</p>
</blockquote>
<span id="more"></span>

<h2 id="1-常见验证踩坑"><a href="#1-常见验证踩坑" class="headerlink" title="1. 常见验证踩坑"></a>1. 常见验证踩坑</h2><h3 id="1-1-手机号验证不全面"><a href="#1-1-手机号验证不全面" class="headerlink" title="1.1 手机号验证不全面"></a>1.1 手机号验证不全面</h3><p><strong>问题描述：</strong><br>很多人只用一个简单的11位数字正则来验证手机号，但实际上这样并不严谨。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>更严谨的手机号验证：<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 更完整的手机号验证规则</span></span><br><span class="line"><span class="keyword">const</span> phoneReg = <span class="regexp">/^1[3-9]\d&#123;9&#125;$/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用方法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">validatePhone</span>(<span class="params">phone</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!phoneReg.<span class="title function_">test</span>(phone)) &#123;</span><br><span class="line">    uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;请输入正确的手机号&#x27;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="1-2-密码强度验证不够"><a href="#1-2-密码强度验证不够" class="headerlink" title="1.2 密码强度验证不够"></a>1.2 密码强度验证不够</h3><p><strong>问题描述：</strong><br>简单的密码验证容易导致用户设置过于简单的密码。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>添加密码强度检查：<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 密码必须包含数字、字母、特殊字符</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkPasswordStrength</span>(<span class="params">password</span>) &#123;</span><br><span class="line">  <span class="comment">// 至少8位，包含数字和字母</span></span><br><span class="line">  <span class="keyword">const</span> baseReg = <span class="regexp">/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]&#123;8,&#125;$/</span></span><br><span class="line">  <span class="comment">// 增加特殊字符要求</span></span><br><span class="line">  <span class="keyword">const</span> strongReg = <span class="regexp">/^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&amp;])[A-Za-z\d@$!%*#?&amp;]&#123;8,&#125;$/</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (!baseReg.<span class="title function_">test</span>(password)) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">valid</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;密码至少8位，必须包含数字和字母&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (!strongReg.<span class="title function_">test</span>(password)) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">valid</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">level</span>: <span class="string">&#x27;normal&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;建议增加特殊字符提高安全性&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">valid</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">level</span>: <span class="string">&#x27;strong&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;密码强度很好&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="2-实时验证问题"><a href="#2-实时验证问题" class="headerlink" title="2. 实时验证问题"></a>2. 实时验证问题</h2><h3 id="2-1-验证频率过高"><a href="#2-1-验证频率过高" class="headerlink" title="2.1 验证频率过高"></a>2.1 验证频率过高</h3><p><strong>问题描述：</strong><br>输入时实时验证，导致频繁提示，影响用户体验。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>使用防抖处理：<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounceValidate</span>(<span class="params">value, rule</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">  timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 执行验证</span></span><br><span class="line">    <span class="keyword">const</span> result = rule.<span class="title function_">test</span>(value)</span><br><span class="line">    <span class="keyword">if</span> (!result) &#123;</span><br><span class="line">      uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;格式不正确&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">500</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="2-2-失焦验证时机"><a href="#2-2-失焦验证时机" class="headerlink" title="2.2 失焦验证时机"></a>2.2 失焦验证时机</h3><p><strong>问题描述：</strong><br>在输入框失焦时才验证，但有时用户直接提交表单。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>结合多个验证时机：<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">&quot;form.phone&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">input</span>=<span class="string">&quot;onPhoneInput&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">blur</span>=<span class="string">&quot;validatePhone&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">placeholder</span>=<span class="string">&quot;请输入手机号&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 输入时简单验证</span></span><br><span class="line">    <span class="title function_">onPhoneInput</span>(<span class="params">e</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> value = e.<span class="property">target</span>.<span class="property">value</span></span><br><span class="line">      <span class="comment">// 只允许输入数字</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">phone</span> = value.<span class="title function_">replace</span>(<span class="regexp">/\D/g</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 失焦时完整验证</span></span><br><span class="line">    <span class="title function_">validatePhone</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">phone</span>) <span class="keyword">return</span></span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">checkPhone</span>(<span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">phone</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 提交时再次验证</span></span><br><span class="line">    <span class="title function_">submitForm</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">validatePhone</span>()) <span class="keyword">return</span></span><br><span class="line">      <span class="comment">// 继续提交流程</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-特殊场景验证"><a href="#3-特殊场景验证" class="headerlink" title="3. 特殊场景验证"></a>3. 特殊场景验证</h2><h3 id="3-1-身份证号验证"><a href="#3-1-身份证号验证" class="headerlink" title="3.1 身份证号验证"></a>3.1 身份证号验证</h3><p><strong>问题描述：</strong><br>简单的18位验证无法识别假身份证号。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>完整的身份证验证：<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">validateIdCard</span>(<span class="params">idCard</span>) &#123;</span><br><span class="line">  <span class="comment">// 基本格式验证</span></span><br><span class="line">  <span class="keyword">const</span> reg = <span class="regexp">/(^\d&#123;15&#125;$)|(^\d&#123;18&#125;$)|(^\d&#123;17&#125;(\d|X|x)$)/</span></span><br><span class="line">  <span class="keyword">if</span> (!reg.<span class="title function_">test</span>(idCard)) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 验证出生日期</span></span><br><span class="line">  <span class="keyword">const</span> year = idCard.<span class="title function_">substr</span>(<span class="number">6</span>, <span class="number">4</span>)</span><br><span class="line">  <span class="keyword">const</span> month = idCard.<span class="title function_">substr</span>(<span class="number">10</span>, <span class="number">2</span>)</span><br><span class="line">  <span class="keyword">const</span> day = idCard.<span class="title function_">substr</span>(<span class="number">12</span>, <span class="number">2</span>)</span><br><span class="line">  <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>(year + <span class="string">&#x27;-&#x27;</span> + month + <span class="string">&#x27;-&#x27;</span> + day)</span><br><span class="line">  <span class="keyword">if</span> (date &gt; <span class="keyword">new</span> <span class="title class_">Date</span>()) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 验证校验码（略）</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="3-2-金额输入验证"><a href="#3-2-金额输入验证" class="headerlink" title="3.2 金额输入验证"></a>3.2 金额输入验证</h3><p><strong>问题描述：</strong><br>金额输入需要限制小数位数和输入格式。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>金额输入处理：<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 限制只能输入数字和小数点，最多两位小数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">validateAmount</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="comment">// 先去除非数字和小数点</span></span><br><span class="line">  value = value.<span class="title function_">replace</span>(<span class="regexp">/[^\d.]/g</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  <span class="comment">// 只保留第一个小数点</span></span><br><span class="line">  value = value.<span class="title function_">replace</span>(<span class="regexp">/\.&#123;2,&#125;/g</span>, <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">  <span class="comment">// 保留两位小数</span></span><br><span class="line">  value = value.<span class="title function_">replace</span>(<span class="regexp">/^(\d+)\.(\d\d).*$/</span>, <span class="string">&#x27;$1.$2&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="title function_">onAmountInput</span>(<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">amount</span> = <span class="title function_">validateAmount</span>(e.<span class="property">target</span>.<span class="property">value</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="4-表单提交验证"><a href="#4-表单提交验证" class="headerlink" title="4. 表单提交验证"></a>4. 表单提交验证</h2><h3 id="4-1-重复提交问题"><a href="#4-1-重复提交问题" class="headerlink" title="4.1 重复提交问题"></a>4.1 重复提交问题</h3><p><strong>问题描述：</strong><br>用户快速点击提交按钮，导致表单重复提交。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>添加提交锁：<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">submitting</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">submitForm</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">submitting</span>) <span class="keyword">return</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">submitting</span> = <span class="literal">true</span></span><br><span class="line">      </span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">submit</span>()</span><br><span class="line">        uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&#x27;提交成功&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&#x27;提交失败&#x27;</span>,</span><br><span class="line">          <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">submitting</span> = <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="4-2-必填项检查"><a href="#4-2-必填项检查" class="headerlink" title="4.2 必填项检查"></a>4.2 必填项检查</h3><p><strong>问题描述：</strong><br>提交时才发现有必填项未填写，体验不好。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>实时显示必填状态：<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;form-item&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;label&quot;</span>&gt;</span></span><br><span class="line">    手机号</span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;required&quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">v-model</span>=<span class="string">&quot;form.phone&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:class</span>=<span class="string">&quot;&#123;&#x27;is-error&#x27;: showError &amp;&amp; !form.phone&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">placeholder</span>=<span class="string">&quot;请输入手机号&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">v-if</span>=<span class="string">&quot;showError &amp;&amp; !form.phone&quot;</span> <span class="attr">class</span>=<span class="string">&quot;error-tip&quot;</span>&gt;</span></span><br><span class="line">    手机号不能为空</span><br><span class="line">  <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="5-常用验证规则"><a href="#5-常用验证规则" class="headerlink" title="5. 常用验证规则"></a>5. 常用验证规则</h2><h3 id="5-1-常用正则表达式"><a href="#5-1-常用正则表达式" class="headerlink" title="5.1 常用正则表达式"></a>5.1 常用正则表达式</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> rules = &#123;</span><br><span class="line">  <span class="comment">// 手机号</span></span><br><span class="line">  <span class="attr">phone</span>: <span class="regexp">/^1[3-9]\d&#123;9&#125;$/</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 邮箱</span></span><br><span class="line">  <span class="attr">email</span>: <span class="regexp">/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]&#123;2,&#125;$/</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 车牌号</span></span><br><span class="line">  <span class="attr">carNo</span>: <span class="regexp">/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领A-Z]&#123;1&#125;[A-Z]&#123;1&#125;[A-Z0-9]&#123;4&#125;[A-Z0-9挂学警港澳]&#123;1&#125;$/</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 银行卡号</span></span><br><span class="line">  <span class="attr">bankCard</span>: <span class="regexp">/^([1-9]&#123;1&#125;)(\d&#123;15&#125;|\d&#123;18&#125;)$/</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 密码强度</span></span><br><span class="line">  <span class="attr">password</span>: <span class="regexp">/^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&amp;])[A-Za-z\d@$!%*#?&amp;]&#123;8,&#125;$/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-自定义验证函数"><a href="#5-2-自定义验证函数" class="headerlink" title="5.2 自定义验证函数"></a>5.2 自定义验证函数</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> validators = &#123;</span><br><span class="line">  <span class="comment">// 年龄验证</span></span><br><span class="line">  <span class="title function_">age</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> age = <span class="built_in">parseInt</span>(value)</span><br><span class="line">    <span class="keyword">return</span> age &gt;= <span class="number">0</span> &amp;&amp; age &lt;= <span class="number">120</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 日期验证</span></span><br><span class="line">  <span class="title function_">date</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="built_in">isNaN</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(value).<span class="title function_">getTime</span>())</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 金额验证</span></span><br><span class="line">  <span class="title function_">amount</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="regexp">/^\d+(\.\d&#123;1,2&#125;)?$/</span>.<span class="title function_">test</span>(value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-最佳实践建议"><a href="#6-最佳实践建议" class="headerlink" title="6. 最佳实践建议"></a>6. 最佳实践建议</h2><ol>
<li>合理使用验证时机</li>
<li>注意验证提示的友好性</li>
<li>考虑特殊情况处理</li>
<li>做好防重复提交</li>
<li>保持代码可维护性</li>
</ol>
<h2 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. 总结</h2><ol>
<li>验证规则要严谨但不过度</li>
<li>注意用户体验</li>
<li>考虑各种异常情况</li>
<li>做好性能优化</li>
<li>保持代码整洁</li>
</ol>
<hr>
<blockquote>
<p>如果觉得文章对你有帮助,欢迎点赞、评论、分享,你的支持是我继续创作的动力！ </p>
</blockquote>
]]></content>
      <categories>
        <category>前端开发</category>
        <category>uni-app</category>
      </categories>
      <tags>
        <tag>前端开发</tag>
        <tag>uni-app</tag>
        <tag>表单验证</tag>
        <tag>实战经验</tag>
      </tags>
  </entry>
  <entry>
    <title>uni-app开发踩坑记录：新手必看的常见问题与解决方案</title>
    <url>/2024/04/20/uniapp-common-issues/</url>
    <content><![CDATA[<blockquote>
<p>在uni-app开发中，总会遇到一些让人头疼的问题。本文整理了一些常见的坑和解决方案，希望能帮助大家少走弯路。</p>
</blockquote>
<span id="more"></span>

<h2 id="1-页面相关问题"><a href="#1-页面相关问题" class="headerlink" title="1. 页面相关问题"></a>1. 页面相关问题</h2><h3 id="1-1-页面返回数据刷新问题"><a href="#1-1-页面返回数据刷新问题" class="headerlink" title="1.1 页面返回数据刷新问题"></a>1.1 页面返回数据刷新问题</h3><p><strong>问题描述：</strong><br>从A页面跳转到B页面，在B页面修改了数据后返回A页面，发现A页面的数据没有更新。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li><p>使用事件总线：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在B页面修改数据后发送事件</span></span><br><span class="line">uni.$emit(<span class="string">&#x27;updateData&#x27;</span>, &#123; <span class="attr">data</span>: <span class="string">&#x27;新数据&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在A页面监听事件</span></span><br><span class="line"><span class="title function_">onShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">  uni.$on(<span class="string">&#x27;updateData&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleUpdate</span>)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">onHide</span>(<span class="params"></span>) &#123;</span><br><span class="line">  uni.$off(<span class="string">&#x27;updateData&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleUpdate</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用页面生命周期：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在A页面的onShow中刷新数据</span></span><br><span class="line"><span class="title function_">onShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">loadData</span>() <span class="comment">// 重新加载数据</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="1-2-页面返回卡顿问题"><a href="#1-2-页面返回卡顿问题" class="headerlink" title="1.2 页面返回卡顿问题"></a>1.2 页面返回卡顿问题</h3><p><strong>问题描述：</strong><br>使用uni.navigateBack返回上一页时出现明显卡顿。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>检查页面是否有大量数据或复杂计算</li>
<li>使用分页加载代替一次性加载</li>
<li>在返回前清理不必要的定时器和监听器</li>
<li>避免在onShow中进行耗时操作</li>
</ol>
<h2 id="2-样式兼容问题"><a href="#2-样式兼容问题" class="headerlink" title="2. 样式兼容问题"></a>2. 样式兼容问题</h2><h3 id="2-1-不同平台样式差异"><a href="#2-1-不同平台样式差异" class="headerlink" title="2.1 不同平台样式差异"></a>2.1 不同平台样式差异</h3><p><strong>问题描述：</strong><br>同样的样式在不同平台（iOS、Android、H5）显示效果不一致。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>使用flex布局代替固定宽高</li>
<li>避免使用复杂的CSS3特性</li>
<li>使用条件编译处理平台差异：<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* #ifdef H5 */</span></span><br><span class="line"><span class="selector-class">.box</span> &#123; <span class="attribute">height</span>: <span class="number">100vh</span>; &#125;</span><br><span class="line"><span class="comment">/* #endif */</span></span><br><span class="line"><span class="comment">/* #ifdef MP */</span></span><br><span class="line"><span class="selector-class">.box</span> &#123; <span class="attribute">height</span>: <span class="number">100%</span>; &#125;</span><br><span class="line"><span class="comment">/* #endif */</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="2-2-滚动穿透问题"><a href="#2-2-滚动穿透问题" class="headerlink" title="2.2 滚动穿透问题"></a>2.2 滚动穿透问题</h3><p><strong>问题描述：</strong><br>弹窗打开时，背景页面仍可滚动。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li><p>弹窗打开时给body添加类：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 打开弹窗时</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">overflow</span> = <span class="string">&#x27;hidden&#x27;</span></span><br><span class="line"><span class="comment">// 关闭弹窗时</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">overflow</span> = <span class="string">&#x27;auto&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用@touchmove.prevent阻止滚动：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;mask&quot;</span> @<span class="attr">touchmove.prevent</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="3-网络请求问题"><a href="#3-网络请求问题" class="headerlink" title="3. 网络请求问题"></a>3. 网络请求问题</h2><h3 id="3-1-请求超时处理"><a href="#3-1-请求超时处理" class="headerlink" title="3.1 请求超时处理"></a>3.1 请求超时处理</h3><p><strong>问题描述：</strong><br>网络请求偶尔超时，导致页面卡死。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>设置合理的超时时间</li>
<li>添加重试机制</li>
<li>显示加载提示和错误提示：<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">uni.<span class="title function_">showLoading</span>(&#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;加载中...&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">loadData</span>()</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;加载失败，请重试&#x27;</span>,</span><br><span class="line">    <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  uni.<span class="title function_">hideLoading</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="3-2-登录失效处理"><a href="#3-2-登录失效处理" class="headerlink" title="3.2 登录失效处理"></a>3.2 登录失效处理</h3><p><strong>问题描述：</strong><br>token过期后继续请求接口导致报错。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>统一处理token过期：<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 请求拦截器中处理</span></span><br><span class="line"><span class="keyword">if</span> (response.<span class="property">code</span> === <span class="number">401</span>) &#123;</span><br><span class="line">  <span class="comment">// 清除登录信息</span></span><br><span class="line">  uni.<span class="title function_">clearStorageSync</span>()</span><br><span class="line">  <span class="comment">// 跳转登录页</span></span><br><span class="line">  uni.<span class="title function_">reLaunch</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/pages/login/index&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="4-性能优化问题"><a href="#4-性能优化问题" class="headerlink" title="4. 性能优化问题"></a>4. 性能优化问题</h2><h3 id="4-1-图片加载优化"><a href="#4-1-图片加载优化" class="headerlink" title="4.1 图片加载优化"></a>4.1 图片加载优化</h3><p><strong>问题描述：</strong><br>页面中图片较多，加载慢且占用内存。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li><p>使用懒加载：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;url&quot;</span> <span class="attr">lazy-load</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>压缩图片</p>
</li>
<li><p>使用CDN加速</p>
</li>
<li><p>预加载重要图片</p>
</li>
</ol>
<h3 id="4-2-列表卡顿问题"><a href="#4-2-列表卡顿问题" class="headerlink" title="4.2 列表卡顿问题"></a>4.2 列表卡顿问题</h3><p><strong>问题描述：</strong><br>长列表滚动时出现卡顿。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>使用分页加载</li>
<li>避免在滚动时进行复杂计算</li>
<li>使用骨架屏优化体验</li>
<li>减少不必要的数据绑定</li>
</ol>
<h2 id="5-小程序相关问题"><a href="#5-小程序相关问题" class="headerlink" title="5. 小程序相关问题"></a>5. 小程序相关问题</h2><h3 id="5-1-包体积超限"><a href="#5-1-包体积超限" class="headerlink" title="5.1 包体积超限"></a>5.1 包体积超限</h3><p><strong>问题描述：</strong><br>小程序打包后提示超出大小限制。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>使用分包加载</li>
<li>压缩图片和资源文件</li>
<li>删除未使用的组件和文件</li>
<li>使用CDN加载大文件</li>
</ol>
<h3 id="5-2-微信授权问题"><a href="#5-2-微信授权问题" class="headerlink" title="5.2 微信授权问题"></a>5.2 微信授权问题</h3><p><strong>问题描述：</strong><br>获取用户信息时授权弹窗显示不出来。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li><p>使用button触发授权：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">open-type</span>=<span class="string">&quot;getUserInfo&quot;</span> @<span class="attr">getuserinfo</span>=<span class="string">&quot;handleGetUserInfo&quot;</span>&gt;</span></span><br><span class="line">  获取用户信息</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>检查是否已授权：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">uni.<span class="title function_">getSetting</span>(&#123;</span><br><span class="line">  <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!res.<span class="property">authSetting</span>[<span class="string">&#x27;scope.userInfo&#x27;</span>]) &#123;</span><br><span class="line">      <span class="comment">// 未授权，显示授权按钮</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="6-开发工具问题"><a href="#6-开发工具问题" class="headerlink" title="6. 开发工具问题"></a>6. 开发工具问题</h2><h3 id="6-1-HBuilderX卡顿"><a href="#6-1-HBuilderX卡顿" class="headerlink" title="6.1 HBuilderX卡顿"></a>6.1 HBuilderX卡顿</h3><p><strong>问题描述：</strong><br>HBuilderX运行缓慢，经常卡死。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>关闭不需要的项目</li>
<li>定期清理缓存</li>
<li>更新到最新版本</li>
<li>增加内存分配</li>
</ol>
<h3 id="6-2-真机调试问题"><a href="#6-2-真机调试问题" class="headerlink" title="6.2 真机调试问题"></a>6.2 真机调试问题</h3><p><strong>问题描述：</strong><br>真机调试时连接不上设备。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>检查USB调试是否开启</li>
<li>更新手机驱动</li>
<li>更换数据线</li>
<li>重启开发工具和手机</li>
</ol>
<h2 id="7-总结建议"><a href="#7-总结建议" class="headerlink" title="7. 总结建议"></a>7. 总结建议</h2><ol>
<li>多看官方文档和更新日志</li>
<li>保持良好的代码习惯</li>
<li>做好版本管理</li>
<li>常见问题记录总结</li>
<li>定期更新开发工具</li>
</ol>
<hr>
<blockquote>
<p>如果觉得文章对你有帮助,欢迎点赞、评论、分享,你的支持是我继续创作的动力！ </p>
</blockquote>
]]></content>
      <categories>
        <category>前端开发</category>
        <category>uni-app</category>
      </categories>
      <tags>
        <tag>前端开发</tag>
        <tag>uni-app</tag>
        <tag>踩坑记录</tag>
        <tag>问题解决</tag>
      </tags>
  </entry>
  <entry>
    <title>uni-app安全防护指南：构建可靠的跨端应用</title>
    <url>/2024/04/15/uniapp-security/</url>
    <content><![CDATA[<blockquote>
<p>安全防护是应用开发中不可忽视的环节,本文将详细介绍如何在uni-app中实现全方位的安全防护,助你打造安全可靠的应用。</p>
</blockquote>
<span id="more"></span>

<h2 id="1-数据加密"><a href="#1-数据加密" class="headerlink" title="1. 数据加密"></a>1. 数据加密</h2><h3 id="1-1-加密工具类"><a href="#1-1-加密工具类" class="headerlink" title="1.1 加密工具类"></a>1.1 加密工具类</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/crypto.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">CryptoJS</span> <span class="keyword">from</span> <span class="string">&#x27;crypto-js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Crypto</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">key</span> = options.<span class="property">key</span> || <span class="string">&#x27;default_key&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">iv</span> = options.<span class="property">iv</span> || <span class="string">&#x27;default_iv&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// AES加密</span></span><br><span class="line">  <span class="title function_">encrypt</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> key = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">key</span>)</span><br><span class="line">    <span class="keyword">const</span> iv = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">iv</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> encrypted = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">encrypt</span>(</span><br><span class="line">      <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data),</span><br><span class="line">      key,</span><br><span class="line">      &#123;</span><br><span class="line">        iv,</span><br><span class="line">        <span class="attr">mode</span>: <span class="title class_">CryptoJS</span>.<span class="property">mode</span>.<span class="property">CBC</span>,</span><br><span class="line">        <span class="attr">padding</span>: <span class="title class_">CryptoJS</span>.<span class="property">pad</span>.<span class="property">Pkcs7</span></span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> encrypted.<span class="title function_">toString</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// AES解密</span></span><br><span class="line">  <span class="title function_">decrypt</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> key = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">key</span>)</span><br><span class="line">    <span class="keyword">const</span> iv = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">iv</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> decrypted = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">decrypt</span>(</span><br><span class="line">      data,</span><br><span class="line">      key,</span><br><span class="line">      &#123;</span><br><span class="line">        iv,</span><br><span class="line">        <span class="attr">mode</span>: <span class="title class_">CryptoJS</span>.<span class="property">mode</span>.<span class="property">CBC</span>,</span><br><span class="line">        <span class="attr">padding</span>: <span class="title class_">CryptoJS</span>.<span class="property">pad</span>.<span class="property">Pkcs7</span></span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(decrypted.<span class="title function_">toString</span>(<span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// RSA加密</span></span><br><span class="line">  <span class="title function_">rsaEncrypt</span>(<span class="params">data, publicKey</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> jsencrypt = <span class="keyword">new</span> <span class="title class_">JSEncrypt</span>()</span><br><span class="line">    jsencrypt.<span class="title function_">setPublicKey</span>(publicKey)</span><br><span class="line">    <span class="keyword">return</span> jsencrypt.<span class="title function_">encrypt</span>(data)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// RSA解密</span></span><br><span class="line">  <span class="title function_">rsaDecrypt</span>(<span class="params">data, privateKey</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> jsencrypt = <span class="keyword">new</span> <span class="title class_">JSEncrypt</span>()</span><br><span class="line">    jsencrypt.<span class="title function_">setPrivateKey</span>(privateKey)</span><br><span class="line">    <span class="keyword">return</span> jsencrypt.<span class="title function_">decrypt</span>(data)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// MD5加密</span></span><br><span class="line">  <span class="title function_">md5</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">CryptoJS</span>.<span class="title class_">MD5</span>(data).<span class="title function_">toString</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Base64编码</span></span><br><span class="line">  <span class="title function_">base64Encode</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Base64</span>.<span class="title function_">stringify</span>(</span><br><span class="line">      <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(data)</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Base64解码</span></span><br><span class="line">  <span class="title function_">base64Decode</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Base64</span>.<span class="title function_">parse</span>(data).<span class="title function_">toString</span>(</span><br><span class="line">      <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Crypto</span>(&#123;</span><br><span class="line">  <span class="attr">key</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_CRYPTO_KEY</span>,</span><br><span class="line">  <span class="attr">iv</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_CRYPTO_IV</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="1-2-敏感数据存储"><a href="#1-2-敏感数据存储" class="headerlink" title="1.2 敏感数据存储"></a>1.2 敏感数据存储</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/secure-storage.js</span></span><br><span class="line"><span class="keyword">import</span> crypto <span class="keyword">from</span> <span class="string">&#x27;./crypto&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SecureStorage</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">prefix</span> = options.<span class="property">prefix</span> || <span class="string">&#x27;secure_&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">expire</span> = options.<span class="property">expire</span> || <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 加密存储</span></span><br><span class="line">  <span class="title function_">set</span>(<span class="params">key, value, expire = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">      value,</span><br><span class="line">      <span class="attr">time</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">      <span class="attr">expire</span>: expire || <span class="variable language_">this</span>.<span class="property">expire</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> encrypted = crypto.<span class="title function_">encrypt</span>(data)</span><br><span class="line">    uni.<span class="title function_">setStorageSync</span>(</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">prefix</span> + key,</span><br><span class="line">      encrypted</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 解密读取</span></span><br><span class="line">  <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> encrypted = uni.<span class="title function_">getStorageSync</span>(<span class="variable language_">this</span>.<span class="property">prefix</span> + key)</span><br><span class="line">    <span class="keyword">if</span> (!encrypted) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; value, time, expire &#125; = crypto.<span class="title function_">decrypt</span>(encrypted)</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 判断是否过期</span></span><br><span class="line">      <span class="keyword">if</span> (expire &amp;&amp; <span class="title class_">Date</span>.<span class="title function_">now</span>() - time &gt; expire * <span class="number">1000</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">remove</span>(key)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 移除数据</span></span><br><span class="line">  <span class="title function_">remove</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    uni.<span class="title function_">removeStorageSync</span>(<span class="variable language_">this</span>.<span class="property">prefix</span> + key)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 清空数据</span></span><br><span class="line">  <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> keys = uni.<span class="title function_">getStorageInfoSync</span>().<span class="property">keys</span></span><br><span class="line">    keys.<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (key.<span class="title function_">startsWith</span>(<span class="variable language_">this</span>.<span class="property">prefix</span>)) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">remove</span>(key.<span class="title function_">slice</span>(<span class="variable language_">this</span>.<span class="property">prefix</span>.<span class="property">length</span>))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">SecureStorage</span>()</span><br></pre></td></tr></table></figure>

<h2 id="2-网络安全"><a href="#2-网络安全" class="headerlink" title="2. 网络安全"></a>2. 网络安全</h2><h3 id="2-1-请求加密"><a href="#2-1-请求加密" class="headerlink" title="2.1 请求加密"></a>2.1 请求加密</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/secure-request.js</span></span><br><span class="line"><span class="keyword">import</span> crypto <span class="keyword">from</span> <span class="string">&#x27;./crypto&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SecureRequest</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">publicKey</span> = <span class="string">&#x27;&#x27;</span> <span class="comment">// RSA公钥</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 初始化</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 获取服务器公钥</span></span><br><span class="line">    <span class="keyword">const</span> &#123; publicKey &#125; = <span class="keyword">await</span> uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/api/public-key&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">publicKey</span> = publicKey</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 加密请求</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">request</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="comment">// 生成随机密钥</span></span><br><span class="line">    <span class="keyword">const</span> randomKey = <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">slice</span>(-<span class="number">8</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用RSA加密随机密钥</span></span><br><span class="line">    <span class="keyword">const</span> encryptedKey = crypto.<span class="title function_">rsaEncrypt</span>(</span><br><span class="line">      randomKey,</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">publicKey</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用随机密钥加密数据</span></span><br><span class="line">    <span class="keyword">const</span> encryptedData = crypto.<span class="title function_">encrypt</span>(</span><br><span class="line">      options.<span class="property">data</span>,</span><br><span class="line">      randomKey</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 发送请求</span></span><br><span class="line">    <span class="keyword">return</span> uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">      ...options,</span><br><span class="line">      <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">key</span>: encryptedKey,</span><br><span class="line">        <span class="attr">data</span>: encryptedData</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">SecureRequest</span>()</span><br></pre></td></tr></table></figure>

<h3 id="2-2-防重放攻击"><a href="#2-2-防重放攻击" class="headerlink" title="2.2 防重放攻击"></a>2.2 防重放攻击</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/anti-replay.js</span></span><br><span class="line"><span class="keyword">import</span> crypto <span class="keyword">from</span> <span class="string">&#x27;./crypto&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AntiReplay</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cache</span> = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 生成请求签名</span></span><br><span class="line">  <span class="title function_">sign</span>(<span class="params">params</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> timestamp = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    <span class="keyword">const</span> nonce = <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">slice</span>(-<span class="number">8</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">      ...params,</span><br><span class="line">      timestamp,</span><br><span class="line">      nonce</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 按键名排序</span></span><br><span class="line">    <span class="keyword">const</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(data).<span class="title function_">sort</span>()</span><br><span class="line">    <span class="keyword">const</span> signStr = keys.<span class="title function_">map</span>(<span class="function"><span class="params">key</span> =&gt;</span> <span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;data[key]&#125;</span>`</span>).<span class="title function_">join</span>(<span class="string">&#x27;&amp;&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      ...data,</span><br><span class="line">      <span class="attr">sign</span>: crypto.<span class="title function_">md5</span>(signStr)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 验证签名</span></span><br><span class="line">  <span class="title function_">verify</span>(<span class="params">params</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; timestamp, nonce, sign, ...rest &#125; = params</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查时间戳是否过期</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Date</span>.<span class="title function_">now</span>() - timestamp &gt; <span class="number">5</span> * <span class="number">60</span> * <span class="number">1000</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查是否重放</span></span><br><span class="line">    <span class="keyword">const</span> cacheKey = <span class="string">`<span class="subst">$&#123;timestamp&#125;</span>:<span class="subst">$&#123;nonce&#125;</span>`</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">has</span>(cacheKey)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 验证签名</span></span><br><span class="line">    <span class="keyword">const</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(rest).<span class="title function_">sort</span>()</span><br><span class="line">    <span class="keyword">const</span> signStr = keys.<span class="title function_">map</span>(<span class="function"><span class="params">key</span> =&gt;</span> <span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;rest[key]&#125;</span>`</span>).<span class="title function_">join</span>(<span class="string">&#x27;&amp;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (crypto.<span class="title function_">md5</span>(signStr) !== sign) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 缓存请求标识</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">set</span>(cacheKey, <span class="literal">true</span>)</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">delete</span>(cacheKey)</span><br><span class="line">    &#125;, <span class="number">5</span> * <span class="number">60</span> * <span class="number">1000</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">AntiReplay</span>()</span><br></pre></td></tr></table></figure>

<h2 id="3-代码保护"><a href="#3-代码保护" class="headerlink" title="3. 代码保护"></a>3. 代码保护</h2><h3 id="3-1-代码混淆"><a href="#3-1-代码混淆" class="headerlink" title="3.1 代码混淆"></a>3.1 代码混淆</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// vue.config.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;terser-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">configureWebpack</span>: &#123;</span><br><span class="line">    <span class="attr">optimization</span>: &#123;</span><br><span class="line">      <span class="attr">minimizer</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">          <span class="attr">terserOptions</span>: &#123;</span><br><span class="line">            <span class="attr">compress</span>: &#123;</span><br><span class="line">              <span class="attr">drop_console</span>: <span class="literal">true</span>, <span class="comment">// 移除console</span></span><br><span class="line">              <span class="attr">pure_funcs</span>: [<span class="string">&#x27;console.log&#x27;</span>] <span class="comment">// 移除指定函数</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">mangle</span>: &#123;</span><br><span class="line">              <span class="attr">safari10</span>: <span class="literal">true</span> <span class="comment">// 兼容safari10</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">output</span>: &#123;</span><br><span class="line">              <span class="attr">ascii_only</span>: <span class="literal">true</span>, <span class="comment">// 输出ASCII字符</span></span><br><span class="line">              <span class="attr">comments</span>: <span class="literal">false</span> <span class="comment">// 移除注释</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-源码加密"><a href="#3-2-源码加密" class="headerlink" title="3.2 源码加密"></a>3.2 源码加密</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/code-protection.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CodeProtection</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isDebug</span> = <span class="literal">false</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">init</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 初始化</span></span><br><span class="line">  <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 检测调试模式</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">checkDebugger</span>()</span><br><span class="line">    <span class="comment">// 禁用控制台</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">disableConsole</span>()</span><br><span class="line">    <span class="comment">// 禁用右键菜单</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">disableContextMenu</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 检测调试模式</span></span><br><span class="line">  <span class="title function_">checkDebugger</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> startTime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">      <span class="keyword">debugger</span></span><br><span class="line">      <span class="keyword">const</span> endTime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (endTime - startTime &gt; <span class="number">100</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isDebug</span> = <span class="literal">true</span></span><br><span class="line">        <span class="comment">// 检测到调试行为</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">handleDebug</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 禁用控制台</span></span><br><span class="line">  <span class="title function_">disableConsole</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// #ifdef H5</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">noop</span> = (<span class="params"></span>) =&gt; &#123;&#125;</span><br><span class="line">      <span class="keyword">const</span> methods = [</span><br><span class="line">        <span class="string">&#x27;log&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;debug&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;warn&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;assert&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;dir&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;dirxml&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;trace&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;group&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;groupEnd&#x27;</span></span><br><span class="line">      ]</span><br><span class="line">      </span><br><span class="line">      methods.<span class="title function_">forEach</span>(<span class="function"><span class="params">method</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>[method] = noop</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 禁用右键菜单</span></span><br><span class="line">  <span class="title function_">disableContextMenu</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// #ifdef H5</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">oncontextmenu</span> = <span class="function">() =&gt;</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 处理调试行为</span></span><br><span class="line">  <span class="title function_">handleDebug</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isDebug</span>) &#123;</span><br><span class="line">      <span class="comment">// 退出应用</span></span><br><span class="line">      <span class="comment">// #ifdef APP-PLUS</span></span><br><span class="line">      plus.<span class="property">runtime</span>.<span class="title function_">quit</span>()</span><br><span class="line">      <span class="comment">// #endif</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 返回首页</span></span><br><span class="line">      <span class="comment">// #ifdef H5 || MP</span></span><br><span class="line">      uni.<span class="title function_">reLaunch</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/pages/index/index&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// #endif</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">CodeProtection</span>()</span><br></pre></td></tr></table></figure>

<h2 id="4-数据防护"><a href="#4-数据防护" class="headerlink" title="4. 数据防护"></a>4. 数据防护</h2><h3 id="4-1-防止SQL注入"><a href="#4-1-防止SQL注入" class="headerlink" title="4.1 防止SQL注入"></a>4.1 防止SQL注入</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/sql-escape.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SqlEscape</span> &#123;</span><br><span class="line">  <span class="comment">// 转义SQL特殊字符</span></span><br><span class="line">  <span class="title function_">escape</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> str !== <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> str</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">replace</span>(<span class="regexp">/[\0\n\r\b\t\\&#x27;&quot;\x1a]/g</span>, <span class="function"><span class="params">s</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">switch</span> (s) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;\0&#x27;</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&#x27;\\0&#x27;</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;\n&#x27;</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&#x27;\\n&#x27;</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;\r&#x27;</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&#x27;\\r&#x27;</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;\b&#x27;</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&#x27;\\b&#x27;</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;\t&#x27;</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&#x27;\\t&#x27;</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;\x1a&#x27;</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&#x27;\\Z&#x27;</span></span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&#x27;\\&#x27;</span> + s</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 验证SQL注入</span></span><br><span class="line">  <span class="title function_">validate</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> pattern = <span class="regexp">/select|update|delete|exec|count|&#x27;|&quot;|=|;|&gt;|&lt;|%/i</span></span><br><span class="line">    <span class="keyword">return</span> !pattern.<span class="title function_">test</span>(str)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">SqlEscape</span>()</span><br></pre></td></tr></table></figure>

<h3 id="4-2-防止XSS攻击"><a href="#4-2-防止XSS攻击" class="headerlink" title="4.2 防止XSS攻击"></a>4.2 防止XSS攻击</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/xss-filter.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">XssFilter</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rules</span> = &#123;</span><br><span class="line">      <span class="attr">whiteList</span>: &#123;</span><br><span class="line">        <span class="attr">a</span>: [<span class="string">&#x27;href&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;target&#x27;</span>],</span><br><span class="line">        <span class="attr">img</span>: [<span class="string">&#x27;src&#x27;</span>, <span class="string">&#x27;alt&#x27;</span>],</span><br><span class="line">        <span class="attr">p</span>: [],</span><br><span class="line">        <span class="attr">div</span>: [],</span><br><span class="line">        <span class="attr">span</span>: [],</span><br><span class="line">        <span class="attr">br</span>: [],</span><br><span class="line">        <span class="attr">strong</span>: [],</span><br><span class="line">        <span class="attr">em</span>: []</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">stripIgnoreTag</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">stripIgnoreTagBody</span>: [<span class="string">&#x27;script&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 过滤HTML</span></span><br><span class="line">  <span class="title function_">filter</span>(<span class="params">html</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> html !== <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> html</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> html.<span class="title function_">replace</span>(<span class="regexp">/&lt;\/?[^&gt;]*&gt;/g</span>, <span class="string">&#x27;&#x27;</span>).<span class="title function_">replace</span>(<span class="regexp">/&amp;[^;]+;/g</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 转义HTML</span></span><br><span class="line">  <span class="title function_">escape</span>(<span class="params">html</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> html.<span class="title function_">replace</span>(<span class="regexp">/[&amp;&lt;&gt;&quot;&#x27;]/g</span>, <span class="function"><span class="params">match</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="built_in">escape</span> = &#123;</span><br><span class="line">        <span class="string">&#x27;&amp;&#x27;</span>: <span class="string">&#x27;&amp;amp;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;&lt;&#x27;</span>: <span class="string">&#x27;&amp;lt;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;&gt;&#x27;</span>: <span class="string">&#x27;&amp;gt;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;&quot;&#x27;</span>: <span class="string">&#x27;&amp;quot;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;&#x27;&quot;</span>: <span class="string">&#x27;&amp;#39;&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">escape</span>[match]</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 验证XSS</span></span><br><span class="line">  <span class="title function_">validate</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> pattern = <span class="regexp">/&lt;script|javascript:|on\w+\s*=|style\s*=|href\s*=|alert\s*\(|confirm\s*\(|prompt\s*\(/i</span></span><br><span class="line">    <span class="keyword">return</span> !pattern.<span class="title function_">test</span>(str)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">XssFilter</span>()</span><br></pre></td></tr></table></figure>

<h2 id="5-最佳实践建议"><a href="#5-最佳实践建议" class="headerlink" title="5. 最佳实践建议"></a>5. 最佳实践建议</h2><ol>
<li>使用HTTPS通信</li>
<li>实现请求签名</li>
<li>加密敏感数据</li>
<li>防止代码泄露</li>
<li>做好数据校验</li>
<li>定期安全审计</li>
<li>及时更新依赖</li>
<li>记录安全日志</li>
</ol>
<h2 id="6-安全监控"><a href="#6-安全监控" class="headerlink" title="6. 安全监控"></a>6. 安全监控</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/security-monitor.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SecurityMonitor</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">logs</span> = []</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">maxLogs</span> = <span class="number">1000</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 记录安全日志</span></span><br><span class="line">  <span class="title function_">log</span>(<span class="params">type, data</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> log = &#123;</span><br><span class="line">      type,</span><br><span class="line">      data,</span><br><span class="line">      <span class="attr">time</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">      <span class="attr">page</span>: <span class="variable language_">this</span>.<span class="title function_">getCurrentPage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">logs</span>.<span class="title function_">push</span>(log)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 超出限制清理旧日志</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">logs</span>.<span class="property">length</span> &gt; <span class="variable language_">this</span>.<span class="property">maxLogs</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">logs</span> = <span class="variable language_">this</span>.<span class="property">logs</span>.<span class="title function_">slice</span>(-<span class="variable language_">this</span>.<span class="property">maxLogs</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 上报日志</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">report</span>(log)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 获取当前页面</span></span><br><span class="line">  <span class="title function_">getCurrentPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> pages = <span class="title function_">getCurrentPages</span>()</span><br><span class="line">    <span class="keyword">const</span> page = pages[pages.<span class="property">length</span> - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> page ? page.<span class="property">route</span> : <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 上报日志</span></span><br><span class="line">  <span class="title function_">report</span>(<span class="params">log</span>) &#123;</span><br><span class="line">    uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/api/security/log&#x27;</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: log</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 获取日志</span></span><br><span class="line">  <span class="title function_">getLogs</span>(<span class="params">type</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (type) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">logs</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">log</span> =&gt;</span> log.<span class="property">type</span> === type)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">logs</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 清理日志</span></span><br><span class="line">  <span class="title function_">clearLogs</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">logs</span> = []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">SecurityMonitor</span>()</span><br></pre></td></tr></table></figure>

<h2 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. 总结</h2><ol>
<li>实现数据加密</li>
<li>保护网络安全</li>
<li>防护代码泄露</li>
<li>过滤危险数据</li>
<li>监控安全风险</li>
</ol>
<hr>
<blockquote>
<p>如果觉得文章对你有帮助,欢迎点赞、评论、分享,你的支持是我继续创作的动力！ </p>
</blockquote>
]]></content>
      <categories>
        <category>前端开发</category>
        <category>uni-app</category>
      </categories>
      <tags>
        <tag>uni-app</tag>
        <tag>安全防护</tag>
        <tag>前端安全</tag>
        <tag>数据加密</tag>
      </tags>
  </entry>
  <entry>
    <title>uni-app性能优化指南：从加载到渲染的全方位提升</title>
    <url>/2024/04/10/uniapp-optimization/</url>
    <content><![CDATA[<blockquote>
<p>性能优化是提升用户体验的关键因素,本文将从多个维度详细介绍uni-app应用的性能优化策略,帮助你构建流畅的跨端应用。</p>
</blockquote>
<span id="more"></span>

<h2 id="1-首屏加载优化"><a href="#1-首屏加载优化" class="headerlink" title="1. 首屏加载优化"></a>1. 首屏加载优化</h2><h3 id="1-1-分包加载"><a href="#1-1-分包加载" class="headerlink" title="1.1 分包加载"></a>1.1 分包加载</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// pages.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;pages&quot;</span>: [&#123;</span><br><span class="line">    <span class="string">&quot;path&quot;</span>: <span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line">    <span class="string">&quot;style&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;首页&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;],</span><br><span class="line">  <span class="string">&quot;subPackages&quot;</span>: [&#123;</span><br><span class="line">    <span class="string">&quot;root&quot;</span>: <span class="string">&quot;pagesA&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pages&quot;</span>: [&#123;</span><br><span class="line">      <span class="string">&quot;path&quot;</span>: <span class="string">&quot;list/index&quot;</span>,</span><br><span class="line">      <span class="string">&quot;style&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;列表页&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 预加载分包</span></span><br><span class="line"><span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 进入首页时预加载分包</span></span><br><span class="line">  uni.<span class="title function_">preloadSubPackage</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;pagesA&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;分包预加载成功&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">fail</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;分包预加载失败&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-图片优化"><a href="#1-2-图片优化" class="headerlink" title="1.2 图片优化"></a>1.2 图片优化</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;!-- 使用懒加载 --&gt;</span><br><span class="line">    &lt;image </span><br><span class="line">      v-for=&quot;(item, index) in images&quot; </span><br><span class="line">      :key=&quot;index&quot;</span><br><span class="line">      :src=&quot;item.url&quot;</span><br><span class="line">      :lazy-load=&quot;true&quot;</span><br><span class="line">      mode=&quot;aspectFill&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 使用webp格式 --&gt;</span><br><span class="line">    &lt;image </span><br><span class="line">      :src=&quot;getWebpUrl(image.url)&quot;</span><br><span class="line">      mode=&quot;aspectFill&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 判断是否支持webp</span><br><span class="line">    checkWebp() &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        return document.createElement(&#x27;canvas&#x27;)</span><br><span class="line">          .toDataURL(&#x27;image/webp&#x27;)</span><br><span class="line">          .indexOf(&#x27;data:image/webp&#x27;) === 0</span><br><span class="line">      &#125; catch (e) &#123;</span><br><span class="line">        return false</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    // 获取webp图片地址</span><br><span class="line">    getWebpUrl(url) &#123;</span><br><span class="line">      if (this.checkWebp()) &#123;</span><br><span class="line">        return url.replace(/\.(jpg|png)$/, &#x27;.webp&#x27;)</span><br><span class="line">      &#125;</span><br><span class="line">      return url</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-骨架屏"><a href="#1-3-骨架屏" class="headerlink" title="1.3 骨架屏"></a>1.3 骨架屏</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- components/skeleton.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;skeleton&quot; v-if=&quot;loading&quot;&gt;</span><br><span class="line">    &lt;view class=&quot;skeleton-header&quot;&gt;</span><br><span class="line">      &lt;view class=&quot;skeleton-avatar&quot;&gt;&lt;/view&gt;</span><br><span class="line">      &lt;view class=&quot;skeleton-content&quot;&gt;</span><br><span class="line">        &lt;view class=&quot;skeleton-title&quot;&gt;&lt;/view&gt;</span><br><span class="line">        &lt;view class=&quot;skeleton-desc&quot;&gt;&lt;/view&gt;</span><br><span class="line">      &lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">    &lt;view class=&quot;skeleton-list&quot;&gt;</span><br><span class="line">      &lt;view </span><br><span class="line">        class=&quot;skeleton-item&quot;</span><br><span class="line">        v-for=&quot;i in 5&quot;</span><br><span class="line">        :key=&quot;i&quot;</span><br><span class="line">      &gt;&lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">.skeleton &#123;</span><br><span class="line">  padding: 20rpx;</span><br><span class="line">  </span><br><span class="line">  &amp;-header &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    margin-bottom: 30rpx;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;-avatar &#123;</span><br><span class="line">    width: 100rpx;</span><br><span class="line">    height: 100rpx;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    background: #f0f0f0;</span><br><span class="line">    margin-right: 20rpx;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;-content &#123;</span><br><span class="line">    flex: 1;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;-title &#123;</span><br><span class="line">    width: 60%;</span><br><span class="line">    height: 40rpx;</span><br><span class="line">    background: #f0f0f0;</span><br><span class="line">    margin-bottom: 20rpx;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;-desc &#123;</span><br><span class="line">    width: 80%;</span><br><span class="line">    height: 32rpx;</span><br><span class="line">    background: #f0f0f0;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;-item &#123;</span><br><span class="line">    height: 160rpx;</span><br><span class="line">    background: #f0f0f0;</span><br><span class="line">    margin-bottom: 20rpx;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;-avatar,</span><br><span class="line">  &amp;-title,</span><br><span class="line">  &amp;-desc,</span><br><span class="line">  &amp;-item &#123;</span><br><span class="line">    animation: skeleton-loading 1.4s ease infinite;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@keyframes skeleton-loading &#123;</span><br><span class="line">  0% &#123;</span><br><span class="line">    opacity: 1;</span><br><span class="line">  &#125;</span><br><span class="line">  50% &#123;</span><br><span class="line">    opacity: 0.5;</span><br><span class="line">  &#125;</span><br><span class="line">  100% &#123;</span><br><span class="line">    opacity: 1;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-渲染性能优化"><a href="#2-渲染性能优化" class="headerlink" title="2. 渲染性能优化"></a>2. 渲染性能优化</h2><h3 id="2-1-长列表优化"><a href="#2-1-长列表优化" class="headerlink" title="2.1 长列表优化"></a>2.1 长列表优化</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;list-container&quot;&gt;</span><br><span class="line">    &lt;!-- 虚拟列表 --&gt;</span><br><span class="line">    &lt;recycle-list</span><br><span class="line">      :list=&quot;list&quot;</span><br><span class="line">      :height=&quot;listHeight&quot;</span><br><span class="line">      :item-height=&quot;itemHeight&quot;</span><br><span class="line">      :buffer-scale=&quot;1&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;template v-slot=&quot;&#123; item &#125;&quot;&gt;</span><br><span class="line">        &lt;view class=&quot;list-item&quot;&gt;</span><br><span class="line">          &#123;&#123; item.title &#125;&#125;</span><br><span class="line">        &lt;/view&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/recycle-list&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import RecycleList from &#x27;@/components/recycle-list&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    RecycleList</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      list: [],</span><br><span class="line">      listHeight: 600,</span><br><span class="line">      itemHeight: 100</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 分页加载数据</span><br><span class="line">    async loadData(page = 1) &#123;</span><br><span class="line">      const &#123; list &#125; = await this.$api.getList(&#123; page &#125;)</span><br><span class="line">      this.list = [...this.list, ...list]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-避免频繁更新"><a href="#2-2-避免频繁更新" class="headerlink" title="2.2 避免频繁更新"></a>2.2 避免频繁更新</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      timer: null,</span><br><span class="line">      count: 0</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 使用节流</span><br><span class="line">    throttleUpdate() &#123;</span><br><span class="line">      if (this.timer) return</span><br><span class="line">      this.timer = setTimeout(() =&gt; &#123;</span><br><span class="line">        this.count++</span><br><span class="line">        this.timer = null</span><br><span class="line">      &#125;, 16)</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    // 使用requestAnimationFrame</span><br><span class="line">    rafUpdate() &#123;</span><br><span class="line">      requestAnimationFrame(() =&gt; &#123;</span><br><span class="line">        this.count++</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  beforeDestroy() &#123;</span><br><span class="line">    // 清理定时器</span><br><span class="line">    if (this.timer) &#123;</span><br><span class="line">      clearTimeout(this.timer)</span><br><span class="line">      this.timer = null</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-内存优化"><a href="#3-内存优化" class="headerlink" title="3. 内存优化"></a>3. 内存优化</h2><h3 id="3-1-及时清理资源"><a href="#3-1-及时清理资源" class="headerlink" title="3.1 及时清理资源"></a>3.1 及时清理资源</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">observer</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">listeners</span>: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">initObserver</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">observer</span> = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(<span class="function"><span class="params">entries</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 处理逻辑</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">addListener</span>(<span class="params">element, event, handler</span>) &#123;</span><br><span class="line">      element.<span class="title function_">addEventListener</span>(event, handler)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">push</span>(&#123; element, event, handler &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeDestroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 清理观察者</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">observer</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">observer</span>.<span class="title function_">disconnect</span>()</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">observer</span> = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 移除事件监听</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">&#123; element, event, handler &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      element.<span class="title function_">removeEventListener</span>(event, handler)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">listeners</span> = []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-缓存管理"><a href="#3-2-缓存管理" class="headerlink" title="3.2 缓存管理"></a>3.2 缓存管理</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/cache.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cache</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">storage</span> = options.<span class="property">storage</span> || uni.<span class="property">getStorageSync</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">prefix</span> = options.<span class="property">prefix</span> || <span class="string">&#x27;cache_&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">expire</span> = options.<span class="property">expire</span> || <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 设置缓存</span></span><br><span class="line">  <span class="title function_">set</span>(<span class="params">key, value, expire = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">      value,</span><br><span class="line">      <span class="attr">expire</span>: expire ? <span class="title class_">Date</span>.<span class="title function_">now</span>() + expire * <span class="number">1000</span> : <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">storage</span>(<span class="variable language_">this</span>.<span class="property">prefix</span> + key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 获取缓存</span></span><br><span class="line">  <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="variable language_">this</span>.<span class="title function_">storage</span>(<span class="variable language_">this</span>.<span class="property">prefix</span> + key)</span><br><span class="line">    <span class="keyword">if</span> (!data) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; value, expire &#125; = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data)</span><br><span class="line">      <span class="comment">// 判断是否过期</span></span><br><span class="line">      <span class="keyword">if</span> (expire &amp;&amp; expire &lt; <span class="title class_">Date</span>.<span class="title function_">now</span>()) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">remove</span>(key)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 移除缓存</span></span><br><span class="line">  <span class="title function_">remove</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">storage</span>(<span class="variable language_">this</span>.<span class="property">prefix</span> + key, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 清空缓存</span></span><br><span class="line">  <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> keys = uni.<span class="title function_">getStorageInfoSync</span>().<span class="property">keys</span></span><br><span class="line">    keys.<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (key.<span class="title function_">startsWith</span>(<span class="variable language_">this</span>.<span class="property">prefix</span>)) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">remove</span>(key.<span class="title function_">slice</span>(<span class="variable language_">this</span>.<span class="property">prefix</span>.<span class="property">length</span>))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Cache</span>()</span><br></pre></td></tr></table></figure>

<h2 id="4-网络优化"><a href="#4-网络优化" class="headerlink" title="4. 网络优化"></a>4. 网络优化</h2><h3 id="4-1-请求优化"><a href="#4-1-请求优化" class="headerlink" title="4.1 请求优化"></a>4.1 请求优化</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/request.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Request</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">queue</span> = <span class="keyword">new</span> <span class="title class_">Map</span>() <span class="comment">// 请求队列</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cache</span> = <span class="keyword">new</span> <span class="title class_">Map</span>() <span class="comment">// 请求缓存</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 发送请求</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">request</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> key = <span class="variable language_">this</span>.<span class="title function_">getRequestKey</span>(options)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 判断是否有相同请求在队列中</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">has</span>(key)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">get</span>(key)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 判断是否有缓存</span></span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">useCache</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> cached = <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">get</span>(key)</span><br><span class="line">      <span class="keyword">if</span> (cached &amp;&amp; cached.<span class="property">expire</span> &gt; <span class="title class_">Date</span>.<span class="title function_">now</span>()) &#123;</span><br><span class="line">        <span class="keyword">return</span> cached.<span class="property">data</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 发送请求</span></span><br><span class="line">    <span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">        ...options,</span><br><span class="line">        <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 缓存响应</span></span><br><span class="line">          <span class="keyword">if</span> (options.<span class="property">useCache</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">set</span>(key, &#123;</span><br><span class="line">              <span class="attr">data</span>: res.<span class="property">data</span>,</span><br><span class="line">              <span class="attr">expire</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>() + (options.<span class="property">cacheTime</span> || <span class="number">60000</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="title function_">resolve</span>(res.<span class="property">data</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">fail</span>: reject,</span><br><span class="line">        <span class="attr">complete</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 请求完成后从队列移除</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">delete</span>(key)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加到队列</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">set</span>(key, promise)</span><br><span class="line">    <span class="keyword">return</span> promise</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 生成请求的唯一标识</span></span><br><span class="line">  <span class="title function_">getRequestKey</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;options.url&#125;</span>:<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(options.data)&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Request</span>()</span><br></pre></td></tr></table></figure>

<h3 id="4-2-离线缓存"><a href="#4-2-离线缓存" class="headerlink" title="4.2 离线缓存"></a>4.2 离线缓存</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/offline.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OfflineStorage</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">version</span> = <span class="string">&#x27;1.0.0&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">table</span> = <span class="string">&#x27;offline_data&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 初始化数据库</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      plus.<span class="property">sqlite</span>.<span class="title function_">openDatabase</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;app.db&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;_doc/app.db&#x27;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">createTable</span>()</span><br><span class="line">          <span class="title function_">resolve</span>()</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">fail</span>: reject</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 创建表</span></span><br><span class="line">  <span class="title function_">createTable</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> sql = <span class="string">`</span></span><br><span class="line"><span class="string">      CREATE TABLE IF NOT EXISTS <span class="subst">$&#123;<span class="variable language_">this</span>.table&#125;</span> (</span></span><br><span class="line"><span class="string">        id TEXT PRIMARY KEY,</span></span><br><span class="line"><span class="string">        data TEXT,</span></span><br><span class="line"><span class="string">        expire INTEGER,</span></span><br><span class="line"><span class="string">        version TEXT</span></span><br><span class="line"><span class="string">      )</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">    plus.<span class="property">sqlite</span>.<span class="title function_">executeSql</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;app.db&#x27;</span>,</span><br><span class="line">      sql</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 保存数据</span></span><br><span class="line">  <span class="title function_">save</span>(<span class="params">key, data, expire = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> sql = <span class="string">`</span></span><br><span class="line"><span class="string">      REPLACE INTO <span class="subst">$&#123;<span class="variable language_">this</span>.table&#125;</span> (id, data, expire, version)</span></span><br><span class="line"><span class="string">      VALUES (?, ?, ?, ?)</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">    <span class="keyword">const</span> values = [</span><br><span class="line">      key,</span><br><span class="line">      <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data),</span><br><span class="line">      expire ? <span class="title class_">Date</span>.<span class="title function_">now</span>() + expire * <span class="number">1000</span> : <span class="number">0</span>,</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">version</span></span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    plus.<span class="property">sqlite</span>.<span class="title function_">executeSql</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;app.db&#x27;</span>,</span><br><span class="line">      sql,</span><br><span class="line">      values</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 获取数据</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> sql = <span class="string">`</span></span><br><span class="line"><span class="string">        SELECT * FROM <span class="subst">$&#123;<span class="variable language_">this</span>.table&#125;</span></span></span><br><span class="line"><span class="string">        WHERE id = ? AND version = ?</span></span><br><span class="line"><span class="string">      `</span></span><br><span class="line">      plus.<span class="property">sqlite</span>.<span class="title function_">selectSql</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;app.db&#x27;</span>,</span><br><span class="line">        sql,</span><br><span class="line">        <span class="attr">values</span>: [key, <span class="variable language_">this</span>.<span class="property">version</span>],</span><br><span class="line">        <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (!res.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">          &#125;</span><br><span class="line">          </span><br><span class="line">          <span class="keyword">const</span> &#123; data, expire &#125; = res[<span class="number">0</span>]</span><br><span class="line">          <span class="comment">// 判断是否过期</span></span><br><span class="line">          <span class="keyword">if</span> (expire &amp;&amp; expire &lt; <span class="title class_">Date</span>.<span class="title function_">now</span>()) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">remove</span>(key)</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">          &#125;</span><br><span class="line">          </span><br><span class="line">          <span class="title function_">resolve</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(data))</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">fail</span>: reject</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 移除数据</span></span><br><span class="line">  <span class="title function_">remove</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> sql = <span class="string">`</span></span><br><span class="line"><span class="string">      DELETE FROM <span class="subst">$&#123;<span class="variable language_">this</span>.table&#125;</span></span></span><br><span class="line"><span class="string">      WHERE id = ?</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">    plus.<span class="property">sqlite</span>.<span class="title function_">executeSql</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;app.db&#x27;</span>,</span><br><span class="line">      sql,</span><br><span class="line">      <span class="attr">values</span>: [key]</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 清空数据</span></span><br><span class="line">  <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> sql = <span class="string">`</span></span><br><span class="line"><span class="string">      DELETE FROM <span class="subst">$&#123;<span class="variable language_">this</span>.table&#125;</span></span></span><br><span class="line"><span class="string">      WHERE version = ?</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">    plus.<span class="property">sqlite</span>.<span class="title function_">executeSql</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;app.db&#x27;</span>,</span><br><span class="line">      sql,</span><br><span class="line">      <span class="attr">values</span>: [<span class="variable language_">this</span>.<span class="property">version</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">OfflineStorage</span>()</span><br></pre></td></tr></table></figure>

<h2 id="5-最佳实践建议"><a href="#5-最佳实践建议" class="headerlink" title="5. 最佳实践建议"></a>5. 最佳实践建议</h2><ol>
<li>合理使用分包加载</li>
<li>优化图片加载策略</li>
<li>实现虚拟列表</li>
<li>避免频繁更新</li>
<li>及时清理资源</li>
<li>做好缓存管理</li>
<li>优化网络请求</li>
<li>实现离线缓存</li>
</ol>
<h2 id="6-性能监控"><a href="#6-性能监控" class="headerlink" title="6. 性能监控"></a>6. 性能监控</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/performance.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Performance</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span> = &#123;</span><br><span class="line">      <span class="comment">// 页面性能</span></span><br><span class="line">      <span class="attr">page</span>: &#123;</span><br><span class="line">        <span class="attr">ready</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">load</span>: <span class="number">0</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 接口性能</span></span><br><span class="line">      <span class="attr">api</span>: <span class="keyword">new</span> <span class="title class_">Map</span>(),</span><br><span class="line">      <span class="comment">// 资源性能</span></span><br><span class="line">      <span class="attr">resource</span>: <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 记录页面性能</span></span><br><span class="line">  <span class="title function_">recordPage</span>(<span class="params">type, time</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">page</span>[type] = time</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 记录接口性能</span></span><br><span class="line">  <span class="title function_">recordApi</span>(<span class="params">url, time</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> api = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">api</span>.<span class="title function_">get</span>(url) || &#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">total</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">max</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">min</span>: <span class="title class_">Infinity</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    api.<span class="property">count</span>++</span><br><span class="line">    api.<span class="property">total</span> += time</span><br><span class="line">    api.<span class="property">max</span> = <span class="title class_">Math</span>.<span class="title function_">max</span>(api.<span class="property">max</span>, time)</span><br><span class="line">    api.<span class="property">min</span> = <span class="title class_">Math</span>.<span class="title function_">min</span>(api.<span class="property">min</span>, time)</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">api</span>.<span class="title function_">set</span>(url, api)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 记录资源性能</span></span><br><span class="line">  <span class="title function_">recordResource</span>(<span class="params">url, time</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">resource</span>.<span class="title function_">set</span>(url, time)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 获取性能数据</span></span><br><span class="line">  <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; page, api, resource &#125; = <span class="variable language_">this</span>.<span class="property">data</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      page,</span><br><span class="line">      <span class="attr">api</span>: <span class="title class_">Array</span>.<span class="title function_">from</span>(api.<span class="title function_">entries</span>()).<span class="title function_">map</span>(<span class="function">(<span class="params">[url, data]</span>) =&gt;</span> (&#123;</span><br><span class="line">        url,</span><br><span class="line">        ...data,</span><br><span class="line">        <span class="attr">avg</span>: data.<span class="property">total</span> / data.<span class="property">count</span></span><br><span class="line">      &#125;)),</span><br><span class="line">      <span class="attr">resource</span>: <span class="title class_">Array</span>.<span class="title function_">from</span>(resource.<span class="title function_">entries</span>()).<span class="title function_">map</span>(<span class="function">(<span class="params">[url, time]</span>) =&gt;</span> (&#123;</span><br><span class="line">        url,</span><br><span class="line">        time</span><br><span class="line">      &#125;))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 上报性能数据</span></span><br><span class="line">  <span class="title function_">report</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="variable language_">this</span>.<span class="title function_">getData</span>()</span><br><span class="line">    <span class="comment">// 上报逻辑</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;性能数据:&#x27;</span>, data)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Performance</span>()</span><br></pre></td></tr></table></figure>

<h2 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. 总结</h2><ol>
<li>优化首屏加载</li>
<li>提升渲染性能</li>
<li>管理内存资源</li>
<li>优化网络请求</li>
<li>实现性能监控</li>
</ol>
<hr>
<blockquote>
<p>如果觉得文章对你有帮助,欢迎点赞、评论、分享,你的支持是我继续创作的动力！ </p>
</blockquote>
]]></content>
      <categories>
        <category>前端开发</category>
        <category>uni-app</category>
      </categories>
      <tags>
        <tag>前端开发</tag>
        <tag>uni-app</tag>
        <tag>性能优化</tag>
        <tag>小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>uni-app动画效果实战：从基础到高级的动画实现指南</title>
    <url>/2024/04/05/uniapp-animation/</url>
    <content><![CDATA[<blockquote>
<p>优秀的动画效果可以大大提升应用的用户体验,本文将详细介绍如何在uni-app中实现各种动画效果,助你打造出色的交互体验。</p>
</blockquote>
<span id="more"></span>

<h2 id="1-CSS动画基础"><a href="#1-CSS动画基础" class="headerlink" title="1. CSS动画基础"></a>1. CSS动画基础</h2><h3 id="1-1-过渡动画"><a href="#1-1-过渡动画" class="headerlink" title="1.1 过渡动画"></a>1.1 过渡动画</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;view </span><br><span class="line">      class=&quot;box&quot;</span><br><span class="line">      :class=&quot;&#123; active: isActive &#125;&quot;</span><br><span class="line">      @click=&quot;toggleActive&quot;</span><br><span class="line">    &gt;&lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      isActive: false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    toggleActive() &#123;</span><br><span class="line">      this.isActive = !this.isActive</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">.box &#123;</span><br><span class="line">  width: 100rpx;</span><br><span class="line">  height: 100rpx;</span><br><span class="line">  background: #409eff;</span><br><span class="line">  transition: all 0.3s ease;</span><br><span class="line">  </span><br><span class="line">  &amp;.active &#123;</span><br><span class="line">    transform: scale(1.5) rotate(45deg);</span><br><span class="line">    background: #67c23a;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-关键帧动画"><a href="#1-2-关键帧动画" class="headerlink" title="1.2 关键帧动画"></a>1.2 关键帧动画</h3><figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.loading</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">60</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">60</span>rpx;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">4</span>rpx solid <span class="number">#f3f3f3</span>;</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">4</span>rpx solid <span class="number">#3498db</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">animation</span>: spin <span class="number">1s</span> linear infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> spin &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">360deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.pulse</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100</span>rpx;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#409eff</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">animation</span>: pulse <span class="number">2s</span> ease-in-out infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> pulse &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">50%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1.5</span>);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-JS动画实现"><a href="#2-JS动画实现" class="headerlink" title="2. JS动画实现"></a>2. JS动画实现</h2><h3 id="2-1-使用animation对象"><a href="#2-1-使用animation对象" class="headerlink" title="2.1 使用animation对象"></a>2.1 使用animation对象</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/animation.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createAnimation</span>(<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> uni.<span class="title function_">createAnimation</span>(&#123;</span><br><span class="line">    <span class="attr">duration</span>: options.<span class="property">duration</span> || <span class="number">300</span>,</span><br><span class="line">    <span class="attr">timingFunction</span>: options.<span class="property">timingFunction</span> || <span class="string">&#x27;ease&#x27;</span>,</span><br><span class="line">    <span class="attr">delay</span>: options.<span class="property">delay</span> || <span class="number">0</span>,</span><br><span class="line">    <span class="attr">transformOrigin</span>: options.<span class="property">transformOrigin</span> || <span class="string">&#x27;50% 50% 0&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">:animation</span>=<span class="string">&quot;animationData&quot;</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;startAnimation&quot;</span>&gt;</span>开始动画<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; createAnimation &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/animation&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">animation</span>: <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">animationData</span>: &#123;&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">startAnimation</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 创建动画实例</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">const</span> animation = <span class="title function_">createAnimation</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 定义动画</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      animation</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        .<span class="title function_">scale</span>(<span class="number">1.5</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        .<span class="title function_">rotate</span>(<span class="number">45</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        .<span class="title function_">step</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        .<span class="title function_">scale</span>(<span class="number">1</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        .<span class="title function_">rotate</span>(<span class="number">0</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        .<span class="title function_">step</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 导出动画数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="property">animationData</span> = animation.<span class="title function_">export</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-requestAnimationFrame实现"><a href="#2-2-requestAnimationFrame实现" class="headerlink" title="2.2 requestAnimationFrame实现"></a>2.2 requestAnimationFrame实现</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/raf.js</span></span><br><span class="line"><span class="keyword">let</span> lastTime = <span class="number">0</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">raf</span> = callback =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> currTime = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>()</span><br><span class="line">  <span class="keyword">const</span> timeToCall = <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="number">0</span>, <span class="number">16</span> - (currTime - lastTime))</span><br><span class="line">  <span class="keyword">const</span> id = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">callback</span>(currTime + timeToCall)</span><br><span class="line">  &#125;, timeToCall)</span><br><span class="line">  lastTime = currTime + timeToCall</span><br><span class="line">  <span class="keyword">return</span> id</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">caf</span> = id =&gt; &#123;</span><br><span class="line">  <span class="built_in">clearTimeout</span>(id)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> requestAnimationFrame = <span class="keyword">typeof</span> <span class="variable language_">window</span> !== <span class="string">&#x27;undefined&#x27;</span> </span><br><span class="line">  ? <span class="variable language_">window</span>.<span class="property">requestAnimationFrame</span> || raf</span><br><span class="line">  : raf</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> cancelAnimationFrame = <span class="keyword">typeof</span> <span class="variable language_">window</span> !== <span class="string">&#x27;undefined&#x27;</span></span><br><span class="line">  ? <span class="variable language_">window</span>.<span class="property">cancelAnimationFrame</span> || caf</span><br><span class="line">  : caf</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Animator</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">duration</span> = options.<span class="property">duration</span> || <span class="number">300</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">easing</span> = options.<span class="property">easing</span> || (<span class="function"><span class="params">t</span> =&gt;</span> t)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">running</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">animate</span>(<span class="params"><span class="keyword">from</span>, to, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> startTime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    <span class="keyword">const</span> change = to - <span class="keyword">from</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">update</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> currentTime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">      <span class="keyword">const</span> elapsed = currentTime - startTime</span><br><span class="line">      <span class="keyword">const</span> progress = <span class="title class_">Math</span>.<span class="title function_">min</span>(elapsed / <span class="variable language_">this</span>.<span class="property">duration</span>, <span class="number">1</span>)</span><br><span class="line">      <span class="keyword">const</span> value = <span class="keyword">from</span> + change * <span class="variable language_">this</span>.<span class="title function_">easing</span>(progress)</span><br><span class="line">      </span><br><span class="line">      <span class="title function_">callback</span>(value)</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (progress &lt; <span class="number">1</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">running</span>) &#123;</span><br><span class="line">        <span class="title function_">requestAnimationFrame</span>(update)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">running</span> = <span class="literal">true</span></span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(update)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">stop</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">running</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">const</span> animator = <span class="keyword">new</span> <span class="title class_">Animator</span>(&#123;</span><br><span class="line">  <span class="attr">duration</span>: <span class="number">1000</span>,</span><br><span class="line">  <span class="attr">easing</span>: <span class="function"><span class="params">t</span> =&gt;</span> t * t <span class="comment">// 缓动函数</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">animator.<span class="title function_">animate</span>(<span class="number">0</span>, <span class="number">100</span>, <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 更新元素位置</span></span><br><span class="line">  element.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`translateX(<span class="subst">$&#123;value&#125;</span>px)`</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="3-手势动画"><a href="#3-手势动画" class="headerlink" title="3. 手势动画"></a>3. 手势动画</h2><h3 id="3-1-拖拽动画"><a href="#3-1-拖拽动画" class="headerlink" title="3.1 拖拽动画"></a>3.1 拖拽动画</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;drag-container&quot;&gt;</span><br><span class="line">    &lt;view</span><br><span class="line">      class=&quot;drag-item&quot;</span><br><span class="line">      :style=&quot;itemStyle&quot;</span><br><span class="line">      @touchstart=&quot;handleTouchStart&quot;</span><br><span class="line">      @touchmove=&quot;handleTouchMove&quot;</span><br><span class="line">      @touchend=&quot;handleTouchEnd&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      拖拽我</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      startX: 0,</span><br><span class="line">      startY: 0,</span><br><span class="line">      moveX: 0,</span><br><span class="line">      moveY: 0,</span><br><span class="line">      isDragging: false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    itemStyle() &#123;</span><br><span class="line">      if (!this.isDragging) &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          transform: `translate3d($&#123;this.moveX&#125;px, $&#123;this.moveY&#125;px, 0)`,</span><br><span class="line">          transition: &#x27;transform 0.3s&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      return &#123;</span><br><span class="line">        transform: `translate3d($&#123;this.moveX&#125;px, $&#123;this.moveY&#125;px, 0)`</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleTouchStart(e) &#123;</span><br><span class="line">      const touch = e.touches[0]</span><br><span class="line">      this.startX = touch.clientX - this.moveX</span><br><span class="line">      this.startY = touch.clientY - this.moveY</span><br><span class="line">      this.isDragging = true</span><br><span class="line">    &#125;,</span><br><span class="line">    handleTouchMove(e) &#123;</span><br><span class="line">      const touch = e.touches[0]</span><br><span class="line">      this.moveX = touch.clientX - this.startX</span><br><span class="line">      this.moveY = touch.clientY - this.startY</span><br><span class="line">      </span><br><span class="line">      // 防止页面滚动</span><br><span class="line">      e.preventDefault()</span><br><span class="line">    &#125;,</span><br><span class="line">    handleTouchEnd() &#123;</span><br><span class="line">      this.isDragging = false</span><br><span class="line">      </span><br><span class="line">      // 判断是否超出边界,如果是则回弹</span><br><span class="line">      const maxX = this.containerWidth - this.itemWidth</span><br><span class="line">      const maxY = this.containerHeight - this.itemHeight</span><br><span class="line">      </span><br><span class="line">      if (this.moveX &lt; 0) this.moveX = 0</span><br><span class="line">      if (this.moveY &lt; 0) this.moveY = 0</span><br><span class="line">      if (this.moveX &gt; maxX) this.moveX = maxX</span><br><span class="line">      if (this.moveY &gt; maxY) this.moveY = maxY</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">.drag-container &#123;</span><br><span class="line">  position: relative;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 500rpx;</span><br><span class="line">  background: #f5f5f5;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.drag-item &#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  width: 200rpx;</span><br><span class="line">  height: 200rpx;</span><br><span class="line">  background: #409eff;</span><br><span class="line">  color: #fff;</span><br><span class="line">  display: flex;</span><br><span class="line">  align-items: center;</span><br><span class="line">  justify-content: center;</span><br><span class="line">  user-select: none;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-滑动删除"><a href="#3-2-滑动删除" class="headerlink" title="3.2 滑动删除"></a>3.2 滑动删除</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;swipe-container&quot;&gt;</span><br><span class="line">    &lt;view</span><br><span class="line">      class=&quot;swipe-item&quot;</span><br><span class="line">      :style=&quot;itemStyle&quot;</span><br><span class="line">      @touchstart=&quot;handleTouchStart&quot;</span><br><span class="line">      @touchmove=&quot;handleTouchMove&quot;</span><br><span class="line">      @touchend=&quot;handleTouchEnd&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;view class=&quot;swipe-content&quot;&gt;</span><br><span class="line">        列表项内容</span><br><span class="line">      &lt;/view&gt;</span><br><span class="line">      &lt;view class=&quot;swipe-actions&quot;&gt;</span><br><span class="line">        &lt;view class=&quot;swipe-btn delete&quot; @click=&quot;handleDelete&quot;&gt;删除&lt;/view&gt;</span><br><span class="line">      &lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">const THRESHOLD = 80 // 滑动阈值</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      startX: 0,</span><br><span class="line">      moveX: 0,</span><br><span class="line">      isMoving: false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    itemStyle() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        transform: `translate3d($&#123;this.moveX&#125;px, 0, 0)`,</span><br><span class="line">        transition: this.isMoving ? &#x27;&#x27; : &#x27;transform 0.3s&#x27;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleTouchStart(e) &#123;</span><br><span class="line">      this.startX = e.touches[0].clientX - this.moveX</span><br><span class="line">      this.isMoving = true</span><br><span class="line">    &#125;,</span><br><span class="line">    handleTouchMove(e) &#123;</span><br><span class="line">      const moveX = e.touches[0].clientX - this.startX</span><br><span class="line">      // 限制只能向左滑动</span><br><span class="line">      this.moveX = Math.min(0, moveX)</span><br><span class="line">    &#125;,</span><br><span class="line">    handleTouchEnd() &#123;</span><br><span class="line">      this.isMoving = false</span><br><span class="line">      // 判断是否超过阈值</span><br><span class="line">      if (Math.abs(this.moveX) &gt; THRESHOLD) &#123;</span><br><span class="line">        this.moveX = -100 // 展开删除按钮</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        this.moveX = 0 // 回弹</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    handleDelete() &#123;</span><br><span class="line">      // 删除逻辑</span><br><span class="line">      this.$emit(&#x27;delete&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">.swipe-item &#123;</span><br><span class="line">  position: relative;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100rpx;</span><br><span class="line">  background: #fff;</span><br><span class="line">  </span><br><span class="line">  .swipe-content &#123;</span><br><span class="line">    height: 100%;</span><br><span class="line">    padding: 0 30rpx;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  .swipe-actions &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    top: 0;</span><br><span class="line">    right: 0;</span><br><span class="line">    height: 100%;</span><br><span class="line">    display: flex;</span><br><span class="line">    transform: translateX(100%);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  .swipe-btn &#123;</span><br><span class="line">    width: 100rpx;</span><br><span class="line">    height: 100%;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    color: #fff;</span><br><span class="line">    </span><br><span class="line">    &amp;.delete &#123;</span><br><span class="line">      background: #f56c6c;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="4-高级动画技巧"><a href="#4-高级动画技巧" class="headerlink" title="4. 高级动画技巧"></a>4. 高级动画技巧</h2><h3 id="4-1-路由转场动画"><a href="#4-1-路由转场动画" class="headerlink" title="4.1 路由转场动画"></a>4.1 路由转场动画</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;page-container&quot;&gt;</span><br><span class="line">    &lt;view </span><br><span class="line">      class=&quot;page-wrapper&quot;</span><br><span class="line">      :class=&quot;transitionClass&quot;</span><br><span class="line">      :style=&quot;&#123; &#x27;z-index&#x27;: zIndex &#125;&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    name: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: &#x27;fade&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      transitionClass: &#x27;&#x27;,</span><br><span class="line">      zIndex: 1</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    enter() &#123;</span><br><span class="line">      this.zIndex = 2</span><br><span class="line">      this.transitionClass = `$&#123;this.name&#125;-enter`</span><br><span class="line">      requestAnimationFrame(() =&gt; &#123;</span><br><span class="line">        this.transitionClass = `$&#123;this.name&#125;-enter $&#123;this.name&#125;-enter-active`</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    leave() &#123;</span><br><span class="line">      this.zIndex = 1</span><br><span class="line">      this.transitionClass = `$&#123;this.name&#125;-leave`</span><br><span class="line">      requestAnimationFrame(() =&gt; &#123;</span><br><span class="line">        this.transitionClass = `$&#123;this.name&#125;-leave $&#123;this.name&#125;-leave-active`</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">.page-container &#123;</span><br><span class="line">  position: relative;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.page-wrapper &#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100%;</span><br><span class="line">  transition: all 0.3s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 淡入淡出</span><br><span class="line">.fade-enter &#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">&#125;</span><br><span class="line">.fade-enter-active &#123;</span><br><span class="line">  opacity: 1;</span><br><span class="line">&#125;</span><br><span class="line">.fade-leave &#123;</span><br><span class="line">  opacity: 1;</span><br><span class="line">&#125;</span><br><span class="line">.fade-leave-active &#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 滑动</span><br><span class="line">.slide-enter &#123;</span><br><span class="line">  transform: translateX(100%);</span><br><span class="line">&#125;</span><br><span class="line">.slide-enter-active &#123;</span><br><span class="line">  transform: translateX(0);</span><br><span class="line">&#125;</span><br><span class="line">.slide-leave &#123;</span><br><span class="line">  transform: translateX(0);</span><br><span class="line">&#125;</span><br><span class="line">.slide-leave-active &#123;</span><br><span class="line">  transform: translateX(-100%);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-列表动画"><a href="#4-2-列表动画" class="headerlink" title="4.2 列表动画"></a>4.2 列表动画</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;list-container&quot;&gt;</span><br><span class="line">    &lt;view</span><br><span class="line">      v-for=&quot;(item, index) in list&quot;</span><br><span class="line">      :key=&quot;item.id&quot;</span><br><span class="line">      class=&quot;list-item&quot;</span><br><span class="line">      :style=&quot;getItemStyle(index)&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;&#123; item.text &#125;&#125;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      list: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    getItemStyle(index) &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        animation: `slideIn 0.3s ease-out $&#123;index * 0.1&#125;s both`</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    addItem() &#123;</span><br><span class="line">      this.list.push(&#123;</span><br><span class="line">        id: Date.now(),</span><br><span class="line">        text: &#x27;新项目&#x27;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    removeItem(index) &#123;</span><br><span class="line">      this.list.splice(index, 1)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">.list-item &#123;</span><br><span class="line">  height: 100rpx;</span><br><span class="line">  margin: 20rpx;</span><br><span class="line">  background: #fff;</span><br><span class="line">  border-radius: 8rpx;</span><br><span class="line">  box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@keyframes slideIn &#123;</span><br><span class="line">  from &#123;</span><br><span class="line">    opacity: 0;</span><br><span class="line">    transform: translateY(60rpx);</span><br><span class="line">  &#125;</span><br><span class="line">  to &#123;</span><br><span class="line">    opacity: 1;</span><br><span class="line">    transform: translateY(0);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="5-性能优化"><a href="#5-性能优化" class="headerlink" title="5. 性能优化"></a>5. 性能优化</h2><ol>
<li>使用transform代替位置属性</li>
<li>使用will-change提示浏览器</li>
<li>避免同时动画过多元素</li>
<li>适当使用硬件加速</li>
<li>合理设置动画帧率</li>
</ol>
<h2 id="6-最佳实践建议"><a href="#6-最佳实践建议" class="headerlink" title="6. 最佳实践建议"></a>6. 最佳实践建议</h2><ol>
<li>动画要有目的性</li>
<li>遵循物理运动规律</li>
<li>注意动画时长控制</li>
<li>提供动画开关选项</li>
<li>做好性能优化</li>
</ol>
<h2 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. 总结</h2><ol>
<li>掌握动画基础知识</li>
<li>灵活运用多种实现方式</li>
<li>注意性能优化</li>
<li>提升用户体验</li>
<li>保持代码可维护性</li>
</ol>
<hr>
<blockquote>
<p>如果觉得文章对你有帮助,欢迎点赞、评论、分享,你的支持是我继续创作的动力！ </p>
</blockquote>
]]></content>
      <categories>
        <category>前端开发</category>
        <category>uni-app</category>
      </categories>
      <tags>
        <tag>前端开发</tag>
        <tag>uni-app</tag>
        <tag>动画效果</tag>
        <tag>CSS动画</tag>
        <tag>JS动画</tag>
      </tags>
  </entry>
  <entry>
    <title>uni-app组件开发实战：从基础到进阶的最佳实践</title>
    <url>/2024/03/30/uniapp-component/</url>
    <content><![CDATA[<blockquote>
<p>组件化开发是现代前端的重要特征,本文将详细介绍如何在uni-app中开发高质量的UI组件,助你打造自己的组件库。</p>
</blockquote>
<span id="more"></span>

<h2 id="1-组件基础开发"><a href="#1-组件基础开发" class="headerlink" title="1. 组件基础开发"></a>1. 组件基础开发</h2><h3 id="1-1-组件目录结构"><a href="#1-1-组件目录结构" class="headerlink" title="1.1 组件目录结构"></a>1.1 组件目录结构</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">components</span><br><span class="line">├── base              <span class="comment"># 基础组件</span></span><br><span class="line">│   ├── button</span><br><span class="line">│   ├── input</span><br><span class="line">│   └── icon</span><br><span class="line">├── business          <span class="comment"># 业务组件</span></span><br><span class="line">│   ├── product-card</span><br><span class="line">│   ├── order-item</span><br><span class="line">│   └── user-info</span><br><span class="line">└── common           <span class="comment"># 公共组件</span></span><br><span class="line">    ├── loading</span><br><span class="line">    ├── empty</span><br><span class="line">    └── error</span><br></pre></td></tr></table></figure>

<h3 id="1-2-基础组件示例"><a href="#1-2-基础组件示例" class="headerlink" title="1.2 基础组件示例"></a>1.2 基础组件示例</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- components/base/button/index.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view </span><br><span class="line">    class=&quot;custom-button&quot;</span><br><span class="line">    :class=&quot;[</span><br><span class="line">      `custom-button--$&#123;type&#125;`,</span><br><span class="line">      `custom-button--$&#123;size&#125;`,</span><br><span class="line">      &#123;</span><br><span class="line">        &#x27;custom-button--plain&#x27;: plain,</span><br><span class="line">        &#x27;custom-button--disabled&#x27;: disabled,</span><br><span class="line">        &#x27;custom-button--loading&#x27;: loading</span><br><span class="line">      &#125;</span><br><span class="line">    ]&quot;</span><br><span class="line">    :hover-class=&quot;disabled ? &#x27;&#x27; : &#x27;custom-button--hover&#x27;&quot;</span><br><span class="line">    @click=&quot;handleClick&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;view class=&quot;custom-button__content&quot;&gt;</span><br><span class="line">      &lt;text v-if=&quot;loading&quot; class=&quot;custom-button__loading&quot;&gt;&lt;/text&gt;</span><br><span class="line">      &lt;text v-if=&quot;icon&quot; class=&quot;custom-button__icon&quot; :class=&quot;icon&quot;&gt;&lt;/text&gt;</span><br><span class="line">      &lt;text class=&quot;custom-button__text&quot;&gt;&lt;slot&gt;&lt;/slot&gt;&lt;/text&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;CustomButton&#x27;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    // 按钮类型</span><br><span class="line">    type: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: &#x27;default&#x27;,</span><br><span class="line">      validator: value =&gt; &#123;</span><br><span class="line">        return [&#x27;default&#x27;, &#x27;primary&#x27;, &#x27;success&#x27;, &#x27;warning&#x27;, &#x27;danger&#x27;].includes(value)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 按钮尺寸</span><br><span class="line">    size: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: &#x27;normal&#x27;,</span><br><span class="line">      validator: value =&gt; &#123;</span><br><span class="line">        return [&#x27;small&#x27;, &#x27;normal&#x27;, &#x27;large&#x27;].includes(value)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 是否朴素按钮</span><br><span class="line">    plain: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">      default: false</span><br><span class="line">    &#125;,</span><br><span class="line">    // 是否禁用</span><br><span class="line">    disabled: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">      default: false</span><br><span class="line">    &#125;,</span><br><span class="line">    // 是否加载中</span><br><span class="line">    loading: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">      default: false</span><br><span class="line">    &#125;,</span><br><span class="line">    // 图标类名</span><br><span class="line">    icon: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: &#x27;&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleClick(event) &#123;</span><br><span class="line">      if (this.disabled || this.loading) return</span><br><span class="line">      this.$emit(&#x27;click&#x27;, event)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">.custom-button &#123;</span><br><span class="line">  position: relative;</span><br><span class="line">  display: inline-flex;</span><br><span class="line">  align-items: center;</span><br><span class="line">  justify-content: center;</span><br><span class="line">  padding: 0 30rpx;</span><br><span class="line">  font-size: 28rpx;</span><br><span class="line">  height: 80rpx;</span><br><span class="line">  line-height: 1;</span><br><span class="line">  text-align: center;</span><br><span class="line">  border-radius: 8rpx;</span><br><span class="line">  background: #fff;</span><br><span class="line">  border: 2rpx solid #dcdfe6;</span><br><span class="line">  box-sizing: border-box;</span><br><span class="line">  transition: all 0.3s;</span><br><span class="line">  </span><br><span class="line">  &amp;--hover &#123;</span><br><span class="line">    opacity: 0.8;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;--primary &#123;</span><br><span class="line">    color: #fff;</span><br><span class="line">    background: #409eff;</span><br><span class="line">    border-color: #409eff;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;--success &#123;</span><br><span class="line">    color: #fff;</span><br><span class="line">    background: #67c23a;</span><br><span class="line">    border-color: #67c23a;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;--warning &#123;</span><br><span class="line">    color: #fff;</span><br><span class="line">    background: #e6a23c;</span><br><span class="line">    border-color: #e6a23c;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;--danger &#123;</span><br><span class="line">    color: #fff;</span><br><span class="line">    background: #f56c6c;</span><br><span class="line">    border-color: #f56c6c;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;--plain &#123;</span><br><span class="line">    background: transparent;</span><br><span class="line">    </span><br><span class="line">    &amp;.custom-button--primary &#123;</span><br><span class="line">      color: #409eff;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &amp;.custom-button--success &#123;</span><br><span class="line">      color: #67c23a;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &amp;.custom-button--warning &#123;</span><br><span class="line">      color: #e6a23c;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &amp;.custom-button--danger &#123;</span><br><span class="line">      color: #f56c6c;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;--disabled &#123;</span><br><span class="line">    opacity: 0.5;</span><br><span class="line">    cursor: not-allowed;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;--small &#123;</span><br><span class="line">    height: 60rpx;</span><br><span class="line">    padding: 0 20rpx;</span><br><span class="line">    font-size: 24rpx;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;--large &#123;</span><br><span class="line">    height: 100rpx;</span><br><span class="line">    padding: 0 40rpx;</span><br><span class="line">    font-size: 32rpx;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;__content &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: center;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;__loading &#123;</span><br><span class="line">    width: 28rpx;</span><br><span class="line">    height: 28rpx;</span><br><span class="line">    margin-right: 10rpx;</span><br><span class="line">    border: 2rpx solid currentColor;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    border-right-color: transparent;</span><br><span class="line">    animation: button-loading 0.8s linear infinite;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;__icon &#123;</span><br><span class="line">    margin-right: 10rpx;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@keyframes button-loading &#123;</span><br><span class="line">  from &#123;</span><br><span class="line">    transform: rotate(0);</span><br><span class="line">  &#125;</span><br><span class="line">  to &#123;</span><br><span class="line">    transform: rotate(360deg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-组件通信方式"><a href="#2-组件通信方式" class="headerlink" title="2. 组件通信方式"></a>2. 组件通信方式</h2><h3 id="2-1-Props-Events"><a href="#2-1-Props-Events" class="headerlink" title="2.1 Props/Events"></a>2.1 Props/Events</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 父组件 --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;custom-form</span><br><span class="line">    :model=&quot;formData&quot;</span><br><span class="line">    :rules=&quot;formRules&quot;</span><br><span class="line">    @submit=&quot;handleSubmit&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;custom-form-item label=&quot;用户名&quot; prop=&quot;username&quot;&gt;</span><br><span class="line">      &lt;custom-input v-model=&quot;formData.username&quot; /&gt;</span><br><span class="line">    &lt;/custom-form-item&gt;</span><br><span class="line">  &lt;/custom-form&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      formData: &#123;</span><br><span class="line">        username: &#x27;&#x27;</span><br><span class="line">      &#125;,</span><br><span class="line">      formRules: &#123;</span><br><span class="line">        username: [</span><br><span class="line">          &#123; required: true, message: &#x27;请输入用户名&#x27; &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleSubmit(values) &#123;</span><br><span class="line">      console.log(&#x27;表单提交:&#x27;, values)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-Provide-Inject"><a href="#2-2-Provide-Inject" class="headerlink" title="2.2 Provide/Inject"></a>2.2 Provide/Inject</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- components/form/index.vue --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;CustomForm&#x27;,</span><br><span class="line">  provide() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      form: this</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    model: &#123;</span><br><span class="line">      type: Object,</span><br><span class="line">      required: true</span><br><span class="line">    &#125;,</span><br><span class="line">    rules: &#123;</span><br><span class="line">      type: Object,</span><br><span class="line">      default: () =&gt; (&#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    validate(callback) &#123;</span><br><span class="line">      // 表单验证逻辑</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- components/form-item/index.vue --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;CustomFormItem&#x27;,</span><br><span class="line">  inject: [&#x27;form&#x27;],</span><br><span class="line">  props: &#123;</span><br><span class="line">    label: String,</span><br><span class="line">    prop: String</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    if (this.prop) &#123;</span><br><span class="line">      this.form.fields.push(this)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-跨端适配"><a href="#3-跨端适配" class="headerlink" title="3. 跨端适配"></a>3. 跨端适配</h2><h3 id="3-1-条件编译"><a href="#3-1-条件编译" class="headerlink" title="3.1 条件编译"></a>3.1 条件编译</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;custom-input&quot;&gt;</span><br><span class="line">    &lt;!-- #ifdef MP --&gt;</span><br><span class="line">    &lt;input </span><br><span class="line">      :value=&quot;value&quot;</span><br><span class="line">      :type=&quot;type&quot;</span><br><span class="line">      :password=&quot;password&quot;</span><br><span class="line">      :placeholder=&quot;placeholder&quot;</span><br><span class="line">      :disabled=&quot;disabled&quot;</span><br><span class="line">      :maxlength=&quot;maxlength&quot;</span><br><span class="line">      @input=&quot;handleInput&quot;</span><br><span class="line">      @focus=&quot;handleFocus&quot;</span><br><span class="line">      @blur=&quot;handleBlur&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;!-- #endif --&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- #ifdef H5 --&gt;</span><br><span class="line">    &lt;input </span><br><span class="line">      v-model=&quot;inputValue&quot;</span><br><span class="line">      :type=&quot;type&quot;</span><br><span class="line">      :placeholder=&quot;placeholder&quot;</span><br><span class="line">      :disabled=&quot;disabled&quot;</span><br><span class="line">      :maxlength=&quot;maxlength&quot;</span><br><span class="line">      @focus=&quot;handleFocus&quot;</span><br><span class="line">      @blur=&quot;handleBlur&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;!-- #endif --&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;CustomInput&#x27;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    value: String,</span><br><span class="line">    type: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: &#x27;text&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    password: Boolean,</span><br><span class="line">    placeholder: String,</span><br><span class="line">    disabled: Boolean,</span><br><span class="line">    maxlength: &#123;</span><br><span class="line">      type: Number,</span><br><span class="line">      default: -1</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      inputValue: this.value</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    value(val) &#123;</span><br><span class="line">      this.inputValue = val</span><br><span class="line">    &#125;,</span><br><span class="line">    inputValue(val) &#123;</span><br><span class="line">      this.$emit(&#x27;input&#x27;, val)</span><br><span class="line">      this.$emit(&#x27;change&#x27;, val)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleInput(e) &#123;</span><br><span class="line">      // #ifdef MP</span><br><span class="line">      const value = e.detail.value</span><br><span class="line">      // #endif</span><br><span class="line">      </span><br><span class="line">      // #ifdef H5</span><br><span class="line">      const value = e.target.value</span><br><span class="line">      // #endif</span><br><span class="line">      </span><br><span class="line">      this.inputValue = value</span><br><span class="line">    &#125;,</span><br><span class="line">    handleFocus(e) &#123;</span><br><span class="line">      this.$emit(&#x27;focus&#x27;, e)</span><br><span class="line">    &#125;,</span><br><span class="line">    handleBlur(e) &#123;</span><br><span class="line">      this.$emit(&#x27;blur&#x27;, e)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-样式适配"><a href="#3-2-样式适配" class="headerlink" title="3.2 样式适配"></a>3.2 样式适配</h3><figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* styles/mixins.scss */</span></span><br><span class="line"><span class="comment">// 1px边框</span></span><br><span class="line"><span class="keyword">@mixin</span> hairline(<span class="variable">$position</span>: bottom, <span class="variable">$color</span>: <span class="number">#dcdfe6</span>) &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  </span><br><span class="line">  &amp;<span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    #&#123;<span class="variable">$position</span>&#125;: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="variable">$color</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scaleY</span>(<span class="number">0.5</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// #ifdef H5</span></span><br><span class="line">    <span class="keyword">@media</span> (<span class="attribute">-webkit-min-device-pixel-ratio</span>: <span class="number">2</span>) &#123;</span><br><span class="line">      <span class="attribute">transform</span>: <span class="built_in">scaleY</span>(<span class="number">0.5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 安全区域</span></span><br><span class="line"><span class="keyword">@mixin</span> safe-area(<span class="variable">$position</span>: bottom) &#123;</span><br><span class="line">  <span class="comment">// #ifdef H5</span></span><br><span class="line">  <span class="attribute">padding</span>-#&#123;<span class="variable">$position</span>&#125;: <span class="built_in">constant</span>(safe-area-inset-#&#123;<span class="variable">$position</span>&#125;);</span><br><span class="line">  <span class="attribute">padding</span>-#&#123;<span class="variable">$position</span>&#125;: <span class="built_in">env</span>(safe-area-inset-#&#123;<span class="variable">$position</span>&#125;);</span><br><span class="line">  <span class="comment">// #endif</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// #ifdef MP</span></span><br><span class="line">  <span class="attribute">padding</span>-#&#123;<span class="variable">$position</span>&#125;: <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// #endif</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-组件优化"><a href="#4-组件优化" class="headerlink" title="4. 组件优化"></a>4. 组件优化</h2><h3 id="4-1-性能优化"><a href="#4-1-性能优化" class="headerlink" title="4.1 性能优化"></a>4.1 性能优化</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;CustomList&#x27;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    list: Array</span><br><span class="line">  &#125;,</span><br><span class="line">  // 避免不必要的更新</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      renderList: this.list.map(item =&gt; (&#123;</span><br><span class="line">        ...item,</span><br><span class="line">        _id: item.id</span><br><span class="line">      &#125;))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    list: &#123;</span><br><span class="line">      handler(val) &#123;</span><br><span class="line">        this.renderList = val.map(item =&gt; (&#123;</span><br><span class="line">          ...item,</span><br><span class="line">          _id: item.id</span><br><span class="line">        &#125;))</span><br><span class="line">      &#125;,</span><br><span class="line">      deep: true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-体验优化"><a href="#4-2-体验优化" class="headerlink" title="4.2 体验优化"></a>4.2 体验优化</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;custom-image&quot; :style=&quot;imageStyle&quot;&gt;</span><br><span class="line">    &lt;image</span><br><span class="line">      :src=&quot;src&quot;</span><br><span class="line">      :mode=&quot;mode&quot;</span><br><span class="line">      :lazy-load=&quot;lazyLoad&quot;</span><br><span class="line">      @load=&quot;handleLoad&quot;</span><br><span class="line">      @error=&quot;handleError&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;view v-if=&quot;loading&quot; class=&quot;custom-image__loading&quot;&gt;</span><br><span class="line">      &lt;text class=&quot;custom-image__loading-text&quot;&gt;加载中...&lt;/text&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">    &lt;view v-if=&quot;error&quot; class=&quot;custom-image__error&quot;&gt;</span><br><span class="line">      &lt;text class=&quot;custom-image__error-text&quot;&gt;加载失败&lt;/text&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;CustomImage&#x27;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    src: String,</span><br><span class="line">    mode: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: &#x27;aspectFill&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    width: &#123;</span><br><span class="line">      type: [String, Number],</span><br><span class="line">      default: &#x27;100%&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    height: &#123;</span><br><span class="line">      type: [String, Number],</span><br><span class="line">      default: &#x27;100%&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    lazyLoad: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">      default: true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      loading: true,</span><br><span class="line">      error: false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    imageStyle() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        width: typeof this.width === &#x27;number&#x27; ? `$&#123;this.width&#125;rpx` : this.width,</span><br><span class="line">        height: typeof this.height === &#x27;number&#x27; ? `$&#123;this.height&#125;rpx` : this.height</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleLoad(e) &#123;</span><br><span class="line">      this.loading = false</span><br><span class="line">      this.$emit(&#x27;load&#x27;, e)</span><br><span class="line">    &#125;,</span><br><span class="line">    handleError(e) &#123;</span><br><span class="line">      this.loading = false</span><br><span class="line">      this.error = true</span><br><span class="line">      this.$emit(&#x27;error&#x27;, e)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="5-最佳实践建议"><a href="#5-最佳实践建议" class="headerlink" title="5. 最佳实践建议"></a>5. 最佳实践建议</h2><ol>
<li>组件命名规范</li>
<li>合理的目录结构</li>
<li>完善的文档说明</li>
<li>统一的样式规范</li>
<li>做好跨端适配</li>
</ol>
<h2 id="6-总结"><a href="#6-总结" class="headerlink" title="6. 总结"></a>6. 总结</h2><ol>
<li>掌握组件开发基础</li>
<li>实现组件通信</li>
<li>处理跨端适配</li>
<li>优化组件性能</li>
<li>提升用户体验</li>
</ol>
<hr>
<blockquote>
<p>如果觉得文章对你有帮助,欢迎点赞、评论、分享,你的支持是我继续创作的动力！ </p>
</blockquote>
]]></content>
      <categories>
        <category>前端开发</category>
        <category>uni-app</category>
      </categories>
      <tags>
        <tag>前端开发</tag>
        <tag>uni-app</tag>
        <tag>组件开发</tag>
        <tag>UI组件</tag>
      </tags>
  </entry>
  <entry>
    <title>uni-app网络请求与缓存策略：构建高效的数据层</title>
    <url>/2024/03/25/uniapp-network/</url>
    <content><![CDATA[<blockquote>
<p>网络请求和数据缓存是应用开发中的关键环节,本文将详细介绍如何在uni-app中构建高效可靠的数据层。</p>
</blockquote>
<span id="more"></span>

<h2 id="1-网络请求封装"><a href="#1-网络请求封装" class="headerlink" title="1. 网络请求封装"></a>1. 网络请求封装</h2><h3 id="1-1-基础请求类"><a href="#1-1-基础请求类" class="headerlink" title="1.1 基础请求类"></a>1.1 基础请求类</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/request.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Request</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">baseURL</span> = options.<span class="property">baseURL</span> || <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">timeout</span> = options.<span class="property">timeout</span> || <span class="number">60000</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">header</span> = options.<span class="property">header</span> || &#123;&#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">beforeRequest</span> = options.<span class="property">beforeRequest</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">afterRequest</span> = options.<span class="property">afterRequest</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 请求拦截</span></span><br><span class="line">  <span class="title function_">beforeRequest</span>(<span class="params">config</span>) &#123;</span><br><span class="line">    <span class="comment">// 添加token</span></span><br><span class="line">    <span class="keyword">const</span> token = uni.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">      config.<span class="property">header</span>.<span class="property">Authorization</span> = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 响应拦截</span></span><br><span class="line">  <span class="title function_">afterRequest</span>(<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; statusCode, data &#125; = response</span><br><span class="line">    <span class="keyword">if</span> (statusCode &gt;= <span class="number">200</span> &amp;&amp; statusCode &lt; <span class="number">300</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> data</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(response)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 请求方法</span></span><br><span class="line">  <span class="title function_">request</span>(<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">    options.<span class="property">baseURL</span> = options.<span class="property">baseURL</span> || <span class="variable language_">this</span>.<span class="property">baseURL</span></span><br><span class="line">    options.<span class="property">timeout</span> = options.<span class="property">timeout</span> || <span class="variable language_">this</span>.<span class="property">timeout</span></span><br><span class="line">    options.<span class="property">header</span> = &#123; ...<span class="variable language_">this</span>.<span class="property">header</span>, ...options.<span class="property">header</span> &#125;</span><br><span class="line">    options.<span class="property">method</span> = options.<span class="property">method</span> || <span class="string">&#x27;GET&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 请求拦截</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">beforeRequest</span>) &#123;</span><br><span class="line">      options = <span class="variable language_">this</span>.<span class="title function_">beforeRequest</span>(options)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">        ...options,</span><br><span class="line">        <span class="attr">url</span>: options.<span class="property">baseURL</span> + options.<span class="property">url</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 响应拦截</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">afterRequest</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="keyword">const</span> data = <span class="variable language_">this</span>.<span class="title function_">afterRequest</span>(res)</span><br><span class="line">              <span class="title function_">resolve</span>(data)</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">              <span class="title function_">reject</span>(error)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(res.<span class="property">data</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">fail</span>: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">reject</span>(err)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 封装常用请求方法</span></span><br><span class="line">  <span class="title function_">get</span>(<span class="params">url, data = &#123;&#125;, options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(&#123;</span><br><span class="line">      url,</span><br><span class="line">      data,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">      ...options</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">post</span>(<span class="params">url, data = &#123;&#125;, options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(&#123;</span><br><span class="line">      url,</span><br><span class="line">      data,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">      ...options</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">put</span>(<span class="params">url, data = &#123;&#125;, options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(&#123;</span><br><span class="line">      url,</span><br><span class="line">      data,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;PUT&#x27;</span>,</span><br><span class="line">      ...options</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">delete</span>(<span class="params">url, data = &#123;&#125;, options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(&#123;</span><br><span class="line">      url,</span><br><span class="line">      data,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;DELETE&#x27;</span>,</span><br><span class="line">      ...options</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Request</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_BASE_API</span>,</span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">10000</span>,</span><br><span class="line">  <span class="attr">header</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="1-2-请求拦截器"><a href="#1-2-请求拦截器" class="headerlink" title="1.2 请求拦截器"></a>1.2 请求拦截器</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/interceptors.js</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求队列</span></span><br><span class="line"><span class="keyword">let</span> requestQueue = []</span><br><span class="line"><span class="comment">// 是否正在刷新token</span></span><br><span class="line"><span class="keyword">let</span> isRefreshing = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">requestInterceptor</span> = (<span class="params">config</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 添加token</span></span><br><span class="line">  <span class="keyword">const</span> token = uni.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> (token) &#123;</span><br><span class="line">    config.<span class="property">header</span>.<span class="property">Authorization</span> = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">responseInterceptor</span> = <span class="keyword">async</span> (<span class="params">response</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; statusCode, data &#125; = response</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// token过期处理</span></span><br><span class="line">  <span class="keyword">if</span> (statusCode === <span class="number">401</span>) &#123;</span><br><span class="line">    <span class="comment">// 将请求添加到队列</span></span><br><span class="line">    <span class="keyword">const</span> retryRequest = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">      requestQueue.<span class="title function_">push</span>(<span class="function">(<span class="params">token</span>) =&gt;</span> &#123;</span><br><span class="line">        config.<span class="property">header</span>.<span class="property">Authorization</span> = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span></span><br><span class="line">        <span class="title function_">resolve</span>(request.<span class="title function_">request</span>(config))</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 是否正在刷新token</span></span><br><span class="line">    <span class="keyword">if</span> (!isRefreshing) &#123;</span><br><span class="line">      isRefreshing = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 刷新token</span></span><br><span class="line">        <span class="keyword">const</span> &#123; token &#125; = <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/refreshToken&#x27;</span>)</span><br><span class="line">        <span class="comment">// 重试队列中的请求</span></span><br><span class="line">        requestQueue.<span class="title function_">forEach</span>(<span class="function"><span class="params">callback</span> =&gt;</span> <span class="title function_">callback</span>(token))</span><br><span class="line">        requestQueue = []</span><br><span class="line">        <span class="keyword">return</span> request.<span class="title function_">request</span>(config)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="comment">// 刷新token失败,跳转登录页</span></span><br><span class="line">        store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/logout&#x27;</span>)</span><br><span class="line">        uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">          <span class="attr">url</span>: <span class="string">&#x27;/pages/login/index&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        isRefreshing = <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> retryRequest</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-数据缓存策略"><a href="#2-数据缓存策略" class="headerlink" title="2. 数据缓存策略"></a>2. 数据缓存策略</h2><h3 id="2-1-缓存管理类"><a href="#2-1-缓存管理类" class="headerlink" title="2.1 缓存管理类"></a>2.1 缓存管理类</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/cache.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cache</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">prefix</span> = options.<span class="property">prefix</span> || <span class="string">&#x27;app_&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">expire</span> = options.<span class="property">expire</span> || <span class="number">0</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isEncrypt</span> = options.<span class="property">isEncrypt</span> || <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置缓存</span></span><br><span class="line">  <span class="title function_">setItem</span>(<span class="params">key, value, expire = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">      value,</span><br><span class="line">      <span class="attr">time</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">      <span class="attr">expire</span>: expire || <span class="variable language_">this</span>.<span class="property">expire</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 加密处理</span></span><br><span class="line">    <span class="keyword">const</span> stringData = <span class="variable language_">this</span>.<span class="property">isEncrypt</span> </span><br><span class="line">      ? <span class="variable language_">this</span>.<span class="title function_">encrypt</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))</span><br><span class="line">      : <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data)</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      uni.<span class="title function_">setStorageSync</span>(<span class="variable language_">this</span>.<span class="property">prefix</span> + key, stringData)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;缓存设置失败:&#x27;</span>, error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取缓存</span></span><br><span class="line">  <span class="title function_">getItem</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> data = uni.<span class="title function_">getStorageSync</span>(<span class="variable language_">this</span>.<span class="property">prefix</span> + key)</span><br><span class="line">      <span class="keyword">if</span> (!data) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 解密处理</span></span><br><span class="line">      <span class="keyword">const</span> storage = <span class="variable language_">this</span>.<span class="property">isEncrypt</span> </span><br><span class="line">        ? <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="title function_">decrypt</span>(data))</span><br><span class="line">        : <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data)</span><br><span class="line">        </span><br><span class="line">      <span class="comment">// 过期判断</span></span><br><span class="line">      <span class="keyword">if</span> (storage.<span class="property">expire</span> &amp;&amp; <span class="title class_">Date</span>.<span class="title function_">now</span>() - storage.<span class="property">time</span> &gt; storage.<span class="property">expire</span> * <span class="number">1000</span>) &#123;</span><br><span class="line">        uni.<span class="title function_">removeStorageSync</span>(<span class="variable language_">this</span>.<span class="property">prefix</span> + key)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> storage.<span class="property">value</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;缓存获取失败:&#x27;</span>, error)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 移除缓存</span></span><br><span class="line">  <span class="title function_">removeItem</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      uni.<span class="title function_">removeStorageSync</span>(<span class="variable language_">this</span>.<span class="property">prefix</span> + key)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;缓存移除失败:&#x27;</span>, error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 清空缓存</span></span><br><span class="line">  <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      uni.<span class="title function_">clearStorageSync</span>()</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;缓存清空失败:&#x27;</span>, error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 加密方法</span></span><br><span class="line">  <span class="title function_">encrypt</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="comment">// 实现加密逻辑</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 解密方法</span></span><br><span class="line">  <span class="title function_">decrypt</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="comment">// 实现解密逻辑</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Cache</span>(&#123;</span><br><span class="line">  <span class="attr">prefix</span>: <span class="string">&#x27;app_&#x27;</span>,</span><br><span class="line">  <span class="attr">expire</span>: <span class="number">7</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>, <span class="comment">// 默认7天过期</span></span><br><span class="line">  <span class="attr">isEncrypt</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span> <span class="comment">// 生产环境开启加密</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="2-2-数据预加载"><a href="#2-2-数据预加载" class="headerlink" title="2.2 数据预加载"></a>2.2 数据预加载</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/preload.js</span></span><br><span class="line"><span class="keyword">import</span> cache <span class="keyword">from</span> <span class="string">&#x27;./cache&#x27;</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;./request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Preload</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">tasks</span> = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 添加预加载任务</span></span><br><span class="line">  <span class="title function_">add</span>(<span class="params">key, promiseCreator</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">tasks</span>.<span class="title function_">has</span>(key)) &#123;</span><br><span class="line">      <span class="keyword">const</span> task = <span class="title function_">promiseCreator</span>().<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        cache.<span class="title function_">setItem</span>(key, data)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">tasks</span>.<span class="title function_">set</span>(key, task)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">tasks</span>.<span class="title function_">get</span>(key)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取预加载数据</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">get</span>(<span class="params">key, promiseCreator</span>) &#123;</span><br><span class="line">    <span class="comment">// 优先从缓存获取</span></span><br><span class="line">    <span class="keyword">const</span> cached = cache.<span class="title function_">getItem</span>(key)</span><br><span class="line">    <span class="keyword">if</span> (cached) <span class="keyword">return</span> cached</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 其次从预加载任务获取</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">tasks</span>.<span class="title function_">has</span>(key)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">tasks</span>.<span class="title function_">get</span>(key)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 最后实时加载</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">add</span>(key, promiseCreator)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 清除预加载任务</span></span><br><span class="line">  <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">tasks</span>.<span class="title function_">clear</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Preload</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">const</span> preload = <span class="keyword">new</span> <span class="title class_">Preload</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 预加载数据</span></span><br><span class="line">preload.<span class="title function_">add</span>(<span class="string">&#x27;userInfo&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/api/user/info&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取数据</span></span><br><span class="line"><span class="keyword">const</span> userInfo = <span class="keyword">await</span> preload.<span class="title function_">get</span>(<span class="string">&#x27;userInfo&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/api/user/info&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="3-实际应用示例"><a href="#3-实际应用示例" class="headerlink" title="3. 实际应用示例"></a>3. 实际应用示例</h2><h3 id="3-1-API封装"><a href="#3-1-API封装" class="headerlink" title="3.1 API封装"></a>3.1 API封装</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// api/user.js</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"><span class="keyword">import</span> cache <span class="keyword">from</span> <span class="string">&#x27;@/utils/cache&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">login</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">post</span>(<span class="string">&#x27;/api/login&#x27;</span>, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getUserInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> cache.<span class="title function_">remember</span>(<span class="string">&#x27;user_info&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/api/user/info&#x27;</span>)</span><br><span class="line">  &#125;, <span class="number">30</span> * <span class="number">60</span>) <span class="comment">// 缓存30分钟</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">updateUserInfo</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">put</span>(<span class="string">&#x27;/api/user/info&#x27;</span>, data).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 更新后清除缓存</span></span><br><span class="line">    cache.<span class="title function_">removeItem</span>(<span class="string">&#x27;user_info&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-数据预加载"><a href="#3-2-数据预加载" class="headerlink" title="3.2 数据预加载"></a>3.2 数据预加载</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// pages/index/index.vue</span></span><br><span class="line"><span class="keyword">import</span> preload <span class="keyword">from</span> <span class="string">&#x27;@/utils/preload&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 预加载下一页数据</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">preloadNextPage</span>()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">preloadNextPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> nextPage = <span class="variable language_">this</span>.<span class="property">currentPage</span> + <span class="number">1</span></span><br><span class="line">      preload.<span class="title function_">add</span>(<span class="string">`list_page_<span class="subst">$&#123;nextPage&#125;</span>`</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/api/list&#x27;</span>, &#123;</span><br><span class="line">          <span class="attr">page</span>: nextPage,</span><br><span class="line">          <span class="attr">size</span>: <span class="number">10</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">loadNextPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> nextPage = <span class="variable language_">this</span>.<span class="property">currentPage</span> + <span class="number">1</span></span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">await</span> preload.<span class="title function_">get</span>(<span class="string">`list_page_<span class="subst">$&#123;nextPage&#125;</span>`</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/api/list&#x27;</span>, &#123;</span><br><span class="line">          <span class="attr">page</span>: nextPage,</span><br><span class="line">          <span class="attr">size</span>: <span class="number">10</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">push</span>(...data.<span class="property">list</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">currentPage</span> = nextPage</span><br><span class="line">      <span class="comment">// 继续预加载下一页</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">preloadNextPage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-最佳实践建议"><a href="#4-最佳实践建议" class="headerlink" title="4. 最佳实践建议"></a>4. 最佳实践建议</h2><ol>
<li>统一封装请求方法</li>
<li>实现请求拦截和响应拦截</li>
<li>合理使用数据缓存</li>
<li>实现数据预加载</li>
<li>注意安全性处理</li>
</ol>
<h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5. 总结"></a>5. 总结</h2><ol>
<li>掌握请求封装技巧</li>
<li>实现数据缓存策略</li>
<li>优化数据加载体验</li>
<li>处理异常情况</li>
<li>保证数据安全性</li>
</ol>
<hr>
<blockquote>
<p>如果觉得文章对你有帮助,欢迎点赞、评论、分享,你的支持是我继续创作的动力！ </p>
</blockquote>
]]></content>
      <categories>
        <category>前端开发</category>
        <category>uni-app</category>
      </categories>
      <tags>
        <tag>前端开发</tag>
        <tag>uni-app</tag>
        <tag>网络请求</tag>
        <tag>数据缓存</tag>
      </tags>
  </entry>
  <entry>
    <title>uni-app状态管理进阶：Vuex最佳实践与性能优化</title>
    <url>/2024/03/20/uniapp-state-management/</url>
    <content><![CDATA[<blockquote>
<p>状态管理是uni-app应用开发中的重要环节,本文将深入介绍Vuex在uni-app中的应用,以及如何构建高效的数据流方案。</p>
</blockquote>
<span id="more"></span>

<h2 id="1-Vuex基础配置"><a href="#1-Vuex基础配置" class="headerlink" title="1. Vuex基础配置"></a>1. Vuex基础配置</h2><h3 id="1-1-目录结构"><a href="#1-1-目录结构" class="headerlink" title="1.1 目录结构"></a>1.1 目录结构</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">store</span><br><span class="line">├── index.js          <span class="comment"># 入口文件</span></span><br><span class="line">├── state.js          <span class="comment"># 根级别的state</span></span><br><span class="line">├── mutations.js      <span class="comment"># 根级别的mutations</span></span><br><span class="line">├── actions.js        <span class="comment"># 根级别的actions</span></span><br><span class="line">├── getters.js        <span class="comment"># 根级别的getters</span></span><br><span class="line">└── modules          <span class="comment"># 模块目录</span></span><br><span class="line">    ├── user.js      <span class="comment"># 用户模块</span></span><br><span class="line">    ├── cart.js      <span class="comment"># 购物车模块</span></span><br><span class="line">    └── order.js     <span class="comment"># 订单模块</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-基础配置"><a href="#1-2-基础配置" class="headerlink" title="1.2 基础配置"></a>1.2 基础配置</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// store/index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> state <span class="keyword">from</span> <span class="string">&#x27;./state&#x27;</span></span><br><span class="line"><span class="keyword">import</span> mutations <span class="keyword">from</span> <span class="string">&#x27;./mutations&#x27;</span></span><br><span class="line"><span class="keyword">import</span> actions <span class="keyword">from</span> <span class="string">&#x27;./actions&#x27;</span></span><br><span class="line"><span class="keyword">import</span> getters <span class="keyword">from</span> <span class="string">&#x27;./getters&#x27;</span></span><br><span class="line"><span class="keyword">import</span> user <span class="keyword">from</span> <span class="string">&#x27;./modules/user&#x27;</span></span><br><span class="line"><span class="keyword">import</span> cart <span class="keyword">from</span> <span class="string">&#x27;./modules/cart&#x27;</span></span><br><span class="line"><span class="keyword">import</span> order <span class="keyword">from</span> <span class="string">&#x27;./modules/order&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  state,</span><br><span class="line">  mutations,</span><br><span class="line">  actions,</span><br><span class="line">  getters,</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">    user,</span><br><span class="line">    cart,</span><br><span class="line">    order</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">strict</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<h2 id="2-模块化设计"><a href="#2-模块化设计" class="headerlink" title="2. 模块化设计"></a>2. 模块化设计</h2><h3 id="2-1-用户模块"><a href="#2-1-用户模块" class="headerlink" title="2.1 用户模块"></a>2.1 用户模块</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// store/modules/user.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; login, getUserInfo, updateUserInfo &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/user&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">token</span>: uni.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;token&#x27;</span>) || <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">userInfo</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">permissions</span>: []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  <span class="title function_">SET_TOKEN</span>(<span class="params">state, token</span>) &#123;</span><br><span class="line">    state.<span class="property">token</span> = token</span><br><span class="line">    uni.<span class="title function_">setStorageSync</span>(<span class="string">&#x27;token&#x27;</span>, token)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">SET_USER_INFO</span>(<span class="params">state, info</span>) &#123;</span><br><span class="line">    state.<span class="property">userInfo</span> = info</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">SET_PERMISSIONS</span>(<span class="params">state, permissions</span>) &#123;</span><br><span class="line">    state.<span class="property">permissions</span> = permissions</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">CLEAR_USER_DATA</span>(<span class="params">state</span>) &#123;</span><br><span class="line">    state.<span class="property">token</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    state.<span class="property">userInfo</span> = <span class="literal">null</span></span><br><span class="line">    state.<span class="property">permissions</span> = []</span><br><span class="line">    uni.<span class="title function_">removeStorageSync</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="comment">// 登录</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">login</span>(<span class="params">&#123; commit &#125;, params</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; token &#125; = <span class="keyword">await</span> <span class="title function_">login</span>(params)</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;SET_TOKEN&#x27;</span>, token)</span><br><span class="line">      <span class="keyword">return</span> token</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;登录失败&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 获取用户信息</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getUserInfo</span>(<span class="params">&#123; commit &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; userInfo, permissions &#125; = <span class="keyword">await</span> <span class="title function_">getUserInfo</span>()</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;SET_USER_INFO&#x27;</span>, userInfo)</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;SET_PERMISSIONS&#x27;</span>, permissions)</span><br><span class="line">      <span class="keyword">return</span> userInfo</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;获取用户信息失败&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 更新用户信息</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">updateUserInfo</span>(<span class="params">&#123; commit &#125;, params</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> info = <span class="keyword">await</span> <span class="title function_">updateUserInfo</span>(params)</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;SET_USER_INFO&#x27;</span>, info)</span><br><span class="line">      <span class="keyword">return</span> info</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;更新用户信息失败&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 退出登录</span></span><br><span class="line">  <span class="title function_">logout</span>(<span class="params">&#123; commit &#125;</span>) &#123;</span><br><span class="line">    <span class="title function_">commit</span>(<span class="string">&#x27;CLEAR_USER_DATA&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">  <span class="attr">isLogin</span>: <span class="function"><span class="params">state</span> =&gt;</span> !!state.<span class="property">token</span>,</span><br><span class="line">  <span class="attr">userInfo</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">userInfo</span> || &#123;&#125;,</span><br><span class="line">  <span class="attr">permissions</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">permissions</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  state,</span><br><span class="line">  mutations,</span><br><span class="line">  actions,</span><br><span class="line">  getters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-购物车模块"><a href="#2-2-购物车模块" class="headerlink" title="2.2 购物车模块"></a>2.2 购物车模块</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// store/modules/cart.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; getCartList, updateCart, removeFromCart &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/cart&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">cartList</span>: [],</span><br><span class="line">  <span class="attr">selectedIds</span>: []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  <span class="title function_">SET_CART_LIST</span>(<span class="params">state, list</span>) &#123;</span><br><span class="line">    state.<span class="property">cartList</span> = list</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">UPDATE_CART_ITEM</span>(<span class="params">state, &#123; id, data &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> index = state.<span class="property">cartList</span>.<span class="title function_">findIndex</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">id</span> === id)</span><br><span class="line">    <span class="keyword">if</span> (index &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">      state.<span class="property">cartList</span>[index] = &#123; ...state.<span class="property">cartList</span>[index], ...data &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">REMOVE_CART_ITEM</span>(<span class="params">state, id</span>) &#123;</span><br><span class="line">    state.<span class="property">cartList</span> = state.<span class="property">cartList</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">id</span> !== id)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">SET_SELECTED_IDS</span>(<span class="params">state, ids</span>) &#123;</span><br><span class="line">    state.<span class="property">selectedIds</span> = ids</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="comment">// 获取购物车列表</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getCartList</span>(<span class="params">&#123; commit &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> list = <span class="keyword">await</span> <span class="title function_">getCartList</span>()</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;SET_CART_LIST&#x27;</span>, list)</span><br><span class="line">      <span class="keyword">return</span> list</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;获取购物车列表失败&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 更新购物车商品</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">updateCartItem</span>(<span class="params">&#123; commit &#125;, &#123; id, data &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">updateCart</span>(id, data)</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;UPDATE_CART_ITEM&#x27;</span>, &#123; id, data &#125;)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;更新购物车商品失败&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 删除购物车商品</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">removeCartItem</span>(<span class="params">&#123; commit &#125;, id</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">removeFromCart</span>(id)</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;REMOVE_CART_ITEM&#x27;</span>, id)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;删除购物车商品失败&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">  <span class="attr">cartCount</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">cartList</span>.<span class="property">length</span>,</span><br><span class="line">  <span class="attr">selectedCount</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">selectedIds</span>.<span class="property">length</span>,</span><br><span class="line">  <span class="attr">totalPrice</span>: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> state.<span class="property">cartList</span></span><br><span class="line">      .<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> state.<span class="property">selectedIds</span>.<span class="title function_">includes</span>(item.<span class="property">id</span>))</span><br><span class="line">      .<span class="title function_">reduce</span>(<span class="function">(<span class="params">total, item</span>) =&gt;</span> total + item.<span class="property">price</span> * item.<span class="property">quantity</span>, <span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  state,</span><br><span class="line">  mutations,</span><br><span class="line">  actions,</span><br><span class="line">  getters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-数据持久化"><a href="#3-数据持久化" class="headerlink" title="3. 数据持久化"></a>3. 数据持久化</h2><h3 id="3-1-插件封装"><a href="#3-1-插件封装" class="headerlink" title="3.1 插件封装"></a>3.1 插件封装</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// store/plugins/persist.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">STORAGE_KEY</span> = <span class="string">&#x27;vuex_storage&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">createPersistPlugin</span>(<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    key = <span class="variable constant_">STORAGE_KEY</span>,</span><br><span class="line">    paths = [],</span><br><span class="line">    storage = uni.<span class="property">getStorageSync</span></span><br><span class="line">  &#125; = options</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 获取持久化数据</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">getState</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> data = <span class="title function_">storage</span>(key)</span><br><span class="line">      <span class="keyword">return</span> data ? <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data) : &#123;&#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;获取持久化数据失败:&#x27;</span>, err)</span><br><span class="line">      <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 设置持久化数据</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">setState</span> = (<span class="params">state, paths</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> data = paths.<span class="property">length</span></span><br><span class="line">        ? paths.<span class="title function_">reduce</span>(<span class="function">(<span class="params">obj, path</span>) =&gt;</span> &#123;</span><br><span class="line">            obj[path] = state[path]</span><br><span class="line">            <span class="keyword">return</span> obj</span><br><span class="line">          &#125;, &#123;&#125;)</span><br><span class="line">        : state</span><br><span class="line">      <span class="title function_">storage</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;设置持久化数据失败:&#x27;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">store</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 初始化时获取持久化数据</span></span><br><span class="line">    <span class="keyword">const</span> data = <span class="title function_">getState</span>()</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="title function_">keys</span>(data).<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      store.<span class="title function_">replaceState</span>(&#123;</span><br><span class="line">        ...store.<span class="property">state</span>,</span><br><span class="line">        ...data</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 监听数据变化</span></span><br><span class="line">    store.<span class="title function_">subscribe</span>(<span class="function">(<span class="params">mutation, state</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setState</span>(state, paths)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-使用插件"><a href="#3-2-使用插件" class="headerlink" title="3.2 使用插件"></a>3.2 使用插件</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// store/index.js</span></span><br><span class="line"><span class="keyword">import</span> createPersistPlugin <span class="keyword">from</span> <span class="string">&#x27;./plugins/persist&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> persistPlugin = <span class="title function_">createPersistPlugin</span>(&#123;</span><br><span class="line">  <span class="attr">paths</span>: [<span class="string">&#x27;user.token&#x27;</span>, <span class="string">&#x27;user.userInfo&#x27;</span>, <span class="string">&#x27;cart.cartList&#x27;</span>],</span><br><span class="line">  <span class="attr">storage</span>: uni.<span class="property">setStorageSync</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="comment">// ...其他配置</span></span><br><span class="line">  <span class="attr">plugins</span>: [persistPlugin]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="4-性能优化"><a href="#4-性能优化" class="headerlink" title="4. 性能优化"></a>4. 性能优化</h2><h3 id="4-1-避免频繁更新"><a href="#4-1-避免频繁更新" class="headerlink" title="4.1 避免频繁更新"></a>4.1 避免频繁更新</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// store/modules/cart.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; debounce &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/tools&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="comment">// 使用防抖优化更新</span></span><br><span class="line">  <span class="attr">updateCartItem</span>: <span class="title function_">debounce</span>(<span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">&#123; commit &#125;, &#123; id, data &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">updateCart</span>(id, data)</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;UPDATE_CART_ITEM&#x27;</span>, &#123; id, data &#125;)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;更新购物车商品失败&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">300</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-批量更新"><a href="#4-2-批量更新" class="headerlink" title="4.2 批量更新"></a>4.2 批量更新</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// store/modules/cart.js</span></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="comment">// 批量更新购物车</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">batchUpdateCart</span>(<span class="params">&#123; commit &#125;, items</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(items.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> <span class="title function_">updateCart</span>(item.<span class="property">id</span>, item.<span class="property">data</span>)))</span><br><span class="line">      items.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&#x27;UPDATE_CART_ITEM&#x27;</span>, item)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;批量更新购物车失败&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-辅助函数使用"><a href="#5-辅助函数使用" class="headerlink" title="5. 辅助函数使用"></a>5. 辅助函数使用</h2><h3 id="5-1-组件中使用"><a href="#5-1-组件中使用" class="headerlink" title="5.1 组件中使用"></a>5.1 组件中使用</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;cart&quot;&gt;</span><br><span class="line">    &lt;view class=&quot;total&quot;&gt;总价: ￥&#123;&#123; totalPrice &#125;&#125;&lt;/view&gt;</span><br><span class="line">    &lt;view </span><br><span class="line">      v-for=&quot;item in cartList&quot;</span><br><span class="line">      :key=&quot;item.id&quot;</span><br><span class="line">      class=&quot;cart-item&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;text&gt;&#123;&#123; item.name &#125;&#125;&lt;/text&gt;</span><br><span class="line">      &lt;text&gt;￥&#123;&#123; item.price &#125;&#125;&lt;/text&gt;</span><br><span class="line">      &lt;button @click=&quot;updateQuantity(item.id, item.quantity + 1)&quot;&gt;+&lt;/button&gt;</span><br><span class="line">      &lt;text&gt;&#123;&#123; item.quantity &#125;&#125;&lt;/text&gt;</span><br><span class="line">      &lt;button @click=&quot;updateQuantity(item.id, item.quantity - 1)&quot;&gt;-&lt;/button&gt;</span><br><span class="line">      &lt;button @click=&quot;removeItem(item.id)&quot;&gt;删除&lt;/button&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; mapState, mapGetters, mapActions &#125; from &#x27;vuex&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  computed: &#123;</span><br><span class="line">    ...mapState(&#x27;cart&#x27;, [&#x27;cartList&#x27;]),</span><br><span class="line">    ...mapGetters(&#x27;cart&#x27;, [&#x27;totalPrice&#x27;])</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    ...mapActions(&#x27;cart&#x27;, [&#x27;updateCartItem&#x27;, &#x27;removeCartItem&#x27;]),</span><br><span class="line">    async updateQuantity(id, quantity) &#123;</span><br><span class="line">      if (quantity &lt; 1) return</span><br><span class="line">      try &#123;</span><br><span class="line">        await this.updateCartItem(&#123; id, data: &#123; quantity &#125; &#125;)</span><br><span class="line">        uni.showToast(&#123; title: &#x27;更新成功&#x27; &#125;)</span><br><span class="line">      &#125; catch (err) &#123;</span><br><span class="line">        uni.showToast(&#123; title: err.message, icon: &#x27;none&#x27; &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    async removeItem(id) &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        await this.removeCartItem(id)</span><br><span class="line">        uni.showToast(&#123; title: &#x27;删除成功&#x27; &#125;)</span><br><span class="line">      &#125; catch (err) &#123;</span><br><span class="line">        uni.showToast(&#123; title: err.message, icon: &#x27;none&#x27; &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-自定义辅助函数"><a href="#5-2-自定义辅助函数" class="headerlink" title="5.2 自定义辅助函数"></a>5.2 自定义辅助函数</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// store/helpers.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">mapCache</span>(<span class="params">namespace, maps</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> res = &#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">normalizeMap</span>(maps).<span class="title function_">forEach</span>(<span class="function">(<span class="params">&#123; key, val &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    res[key] = <span class="keyword">function</span> <span class="title function_">mappedCache</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> store = <span class="variable language_">this</span>.<span class="property">$store</span></span><br><span class="line">      <span class="keyword">const</span> cache = store.<span class="property">_cache</span> || (store.<span class="property">_cache</span> = &#123;&#125;)</span><br><span class="line">      <span class="keyword">const</span> cacheKey = namespace + <span class="string">&#x27;:&#x27;</span> + key</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (cache[cacheKey]) &#123;</span><br><span class="line">        <span class="keyword">return</span> cache[cacheKey]</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">const</span> value = <span class="keyword">typeof</span> val === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">        ? val.<span class="title function_">call</span>(<span class="variable language_">this</span>, store.<span class="property">state</span>[namespace], store.<span class="property">getters</span>)</span><br><span class="line">        : store.<span class="property">state</span>[namespace][val]</span><br><span class="line">        </span><br><span class="line">      cache[cacheKey] = value</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeMap</span>(<span class="params">map</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">isArray</span>(map)</span><br><span class="line">    ? map.<span class="title function_">map</span>(<span class="function"><span class="params">key</span> =&gt;</span> (&#123; key, <span class="attr">val</span>: key &#125;))</span><br><span class="line">    : <span class="title class_">Object</span>.<span class="title function_">keys</span>(map).<span class="title function_">map</span>(<span class="function"><span class="params">key</span> =&gt;</span> (&#123; key, <span class="attr">val</span>: map[key] &#125;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-最佳实践建议"><a href="#6-最佳实践建议" class="headerlink" title="6. 最佳实践建议"></a>6. 最佳实践建议</h2><ol>
<li>合理划分模块</li>
<li>实现数据持久化</li>
<li>注意性能优化</li>
<li>使用辅助函数</li>
<li>做好错误处理</li>
</ol>
<h2 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. 总结</h2><ol>
<li>掌握Vuex基础配置</li>
<li>实现模块化设计</li>
<li>处理数据持久化</li>
<li>优化更新性能</li>
<li>灵活使用辅助函数</li>
</ol>
<hr>
<blockquote>
<p>如果觉得文章对你有帮助,欢迎点赞、评论、分享,你的支持是我继续创作的动力！ </p>
</blockquote>
]]></content>
      <categories>
        <category>前端开发</category>
        <category>uni-app</category>
      </categories>
      <tags>
        <tag>前端开发</tag>
        <tag>uni-app</tag>
        <tag>Vuex</tag>
        <tag>状态管理</tag>
      </tags>
  </entry>
  <entry>
    <title>uni-app路由与页面跳转：最佳实践与踩坑指南</title>
    <url>/2024/03/15/uniapp-router/</url>
    <content><![CDATA[<blockquote>
<p>路由与页面跳转是uni-app应用的核心功能之一,本文将详细介绍各种跳转方式及其最佳实践,帮助你构建流畅的页面导航体验。</p>
</blockquote>
<span id="more"></span>

<h2 id="1-基础路由方法"><a href="#1-基础路由方法" class="headerlink" title="1. 基础路由方法"></a>1. 基础路由方法</h2><h3 id="1-1-页面跳转方式"><a href="#1-1-页面跳转方式" class="headerlink" title="1.1 页面跳转方式"></a>1.1 页面跳转方式</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 保留当前页面，跳转到应用内的某个页面</span></span><br><span class="line">uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;/pages/detail/detail?id=1&#x27;</span>,</span><br><span class="line">  <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;跳转成功&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">fail</span>: <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;跳转失败:&#x27;</span>, err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭当前页面，跳转到应用内的某个页面</span></span><br><span class="line">uni.<span class="title function_">redirectTo</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;/pages/index/index&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭所有页面，打开到应用内的某个页面</span></span><br><span class="line">uni.<span class="title function_">reLaunch</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;/pages/home/home&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭当前页面，返回上一页面或多级页面</span></span><br><span class="line">uni.<span class="title function_">navigateBack</span>(&#123;</span><br><span class="line">  <span class="attr">delta</span>: <span class="number">1</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 跳转到 tabBar 页面</span></span><br><span class="line">uni.<span class="title function_">switchTab</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;/pages/user/user&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="1-2-参数传递"><a href="#1-2-参数传递" class="headerlink" title="1.2 参数传递"></a>1.2 参数传递</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 页面A：传递参数</span></span><br><span class="line">uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;/pages/detail/detail?id=1&amp;type=product&amp;data=&#x27;</span> + <span class="built_in">encodeURIComponent</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 页面B：接收参数</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">onLoad</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> id = options.<span class="property">id</span></span><br><span class="line">    <span class="keyword">const</span> type = options.<span class="property">type</span></span><br><span class="line">    <span class="keyword">const</span> data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="built_in">decodeURIComponent</span>(options.<span class="property">data</span>))</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;接收到的参数:&#x27;</span>, id, type, data)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-路由拦截与权限控制"><a href="#2-路由拦截与权限控制" class="headerlink" title="2. 路由拦截与权限控制"></a>2. 路由拦截与权限控制</h2><h3 id="2-1-全局路由拦截"><a href="#2-1-全局路由拦截" class="headerlink" title="2.1 全局路由拦截"></a>2.1 全局路由拦截</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册全局路由拦截器</span></span><br><span class="line"><span class="keyword">const</span> whiteList = [<span class="string">&#x27;/pages/login/login&#x27;</span>, <span class="string">&#x27;/pages/register/register&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$beforeRouter</span> = <span class="keyword">function</span>(<span class="params">to</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 检查是否需要登录</span></span><br><span class="line">    <span class="keyword">if</span> (whiteList.<span class="title function_">includes</span>(to)) &#123;</span><br><span class="line">      <span class="title function_">resolve</span>()</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查登录状态</span></span><br><span class="line">    <span class="keyword">const</span> token = uni.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (!token) &#123;</span><br><span class="line">      uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;请先登录&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/pages/login/login&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;未登录&#x27;</span>))</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查权限</span></span><br><span class="line">    <span class="keyword">const</span> userInfo = store.<span class="property">state</span>.<span class="property">user</span>.<span class="property">userInfo</span></span><br><span class="line">    <span class="keyword">if</span> (to.<span class="property">requiresAuth</span> &amp;&amp; !userInfo.<span class="property">permissions</span>.<span class="title function_">includes</span>(to.<span class="property">permission</span>)) &#123;</span><br><span class="line">      uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;暂无权限访问&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;无权限&#x27;</span>))</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">resolve</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 页面中使用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.$beforeRouter(<span class="string">&#x27;/pages/user/user&#x27;</span>)</span><br><span class="line">      <span class="comment">// 继续执行页面逻辑</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;路由拦截:&#x27;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-页面级权限控制"><a href="#2-2-页面级权限控制" class="headerlink" title="2.2 页面级权限控制"></a>2.2 页面级权限控制</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// mixins/auth.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">hasPermission</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">checkPermission</span>()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">checkPermission</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> userPermissions = <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">user</span>.<span class="property">permissions</span></span><br><span class="line">      <span class="keyword">const</span> pagePermission = <span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">permission</span></span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (!pagePermission) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hasPermission</span> = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">hasPermission</span> = userPermissions.<span class="title function_">includes</span>(pagePermission)</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">hasPermission</span>) &#123;</span><br><span class="line">        uni.<span class="title function_">showModal</span>(&#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">          <span class="attr">content</span>: <span class="string">&#x27;暂无访问权限&#x27;</span>,</span><br><span class="line">          <span class="attr">showCancel</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">success</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            uni.<span class="title function_">navigateBack</span>()</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 页面中使用</span></span><br><span class="line"><span class="keyword">import</span> authMixin <span class="keyword">from</span> <span class="string">&#x27;@/mixins/auth&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">mixins</span>: [authMixin],</span><br><span class="line">  <span class="attr">permission</span>: <span class="string">&#x27;user:edit&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-页面通信方案"><a href="#3-页面通信方案" class="headerlink" title="3. 页面通信方案"></a>3. 页面通信方案</h2><h3 id="3-1-页面间事件通信"><a href="#3-1-页面间事件通信" class="headerlink" title="3.1 页面间事件通信"></a>3.1 页面间事件通信</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 页面A：发送事件</span></span><br><span class="line"><span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 注册事件监听</span></span><br><span class="line">  uni.$on(<span class="string">&#x27;updateList&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleUpdateList</span>)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">onUnload</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 注销事件监听</span></span><br><span class="line">  uni.$off(<span class="string">&#x27;updateList&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleUpdateList</span>)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">handleUpdateList</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;收到更新数据:&#x27;</span>, data)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">refreshList</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 页面B：触发事件</span></span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">submitSuccess</span>(<span class="params"></span>) &#123;</span><br><span class="line">    uni.$emit(<span class="string">&#x27;updateList&#x27;</span>, &#123; <span class="attr">type</span>: <span class="string">&#x27;add&#x27;</span>, <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">formData</span> &#125;)</span><br><span class="line">    uni.<span class="title function_">navigateBack</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-页面栈管理"><a href="#3-2-页面栈管理" class="headerlink" title="3.2 页面栈管理"></a>3.2 页面栈管理</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/page.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PageManager</span> &#123;</span><br><span class="line">  <span class="comment">// 获取当前页面栈</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">getCurrentPages</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> pages = <span class="title function_">getCurrentPages</span>()</span><br><span class="line">    <span class="keyword">return</span> pages</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 获取上一个页面实例</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">getPrevPage</span>(<span class="params">delta = <span class="number">1</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> pages = <span class="variable language_">this</span>.<span class="title function_">getCurrentPages</span>()</span><br><span class="line">    <span class="keyword">const</span> prevPage = pages[pages.<span class="property">length</span> - <span class="number">1</span> - delta]</span><br><span class="line">    <span class="keyword">return</span> prevPage</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 调用上一个页面的方法</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">callPrevPageMethod</span>(<span class="params">methodName, args, delta = <span class="number">1</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> prevPage = <span class="variable language_">this</span>.<span class="title function_">getPrevPage</span>(delta)</span><br><span class="line">    <span class="keyword">if</span> (prevPage &amp;&amp; <span class="keyword">typeof</span> prevPage[methodName] === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> prevPage[methodName](args)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 检查是否可以返回</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">canBack</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> pages = <span class="variable language_">this</span>.<span class="title function_">getCurrentPages</span>()</span><br><span class="line">    <span class="keyword">return</span> pages.<span class="property">length</span> &gt; <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">PageManager</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PageManager</span> <span class="keyword">from</span> <span class="string">&#x27;@/utils/page&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用上一页面方法</span></span><br><span class="line"><span class="title class_">PageManager</span>.<span class="title function_">callPrevPageMethod</span>(<span class="string">&#x27;refreshData&#x27;</span>, &#123; <span class="attr">type</span>: <span class="string">&#x27;update&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查是否可以返回</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title class_">PageManager</span>.<span class="title function_">canBack</span>()) &#123;</span><br><span class="line">  uni.<span class="title function_">navigateBack</span>()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  uni.<span class="title function_">reLaunch</span>(&#123; <span class="attr">url</span>: <span class="string">&#x27;/pages/index/index&#x27;</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-路由动画与转场效果"><a href="#4-路由动画与转场效果" class="headerlink" title="4. 路由动画与转场效果"></a>4. 路由动画与转场效果</h2><h3 id="4-1-基础动画配置"><a href="#4-1-基础动画配置" class="headerlink" title="4.1 基础动画配置"></a>4.1 基础动画配置</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// pages.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;pages&quot;</span>: [&#123;</span><br><span class="line">    <span class="string">&quot;path&quot;</span>: <span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line">    <span class="string">&quot;style&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;首页&quot;</span>,</span><br><span class="line">      <span class="string">&quot;app-plus&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;animationType&quot;</span>: <span class="string">&quot;slide-in-right&quot;</span>,</span><br><span class="line">        <span class="string">&quot;animationDuration&quot;</span>: <span class="number">300</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 页面跳转时指定动画</span></span><br><span class="line">uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;/pages/detail/detail&#x27;</span>,</span><br><span class="line">  <span class="attr">animationType</span>: <span class="string">&#x27;slide-in-bottom&#x27;</span>,</span><br><span class="line">  <span class="attr">animationDuration</span>: <span class="number">300</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="4-2-自定义转场动画"><a href="#4-2-自定义转场动画" class="headerlink" title="4.2 自定义转场动画"></a>4.2 自定义转场动画</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- components/page-transition.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;page-transition&quot; :class=&quot;[transitionClass]&quot;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      transitionClass: &#x27;&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    enter() &#123;</span><br><span class="line">      this.transitionClass = &#x27;slide-enter&#x27;</span><br><span class="line">      setTimeout(() =&gt; &#123;</span><br><span class="line">        this.transitionClass = &#x27;slide-enter-active&#x27;</span><br><span class="line">      &#125;, 50)</span><br><span class="line">    &#125;,</span><br><span class="line">    leave() &#123;</span><br><span class="line">      this.transitionClass = &#x27;slide-leave&#x27;</span><br><span class="line">      setTimeout(() =&gt; &#123;</span><br><span class="line">        this.transitionClass = &#x27;slide-leave-active&#x27;</span><br><span class="line">      &#125;, 50)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.page-transition &#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100%;</span><br><span class="line">  transition: all 0.3s ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.slide-enter &#123;</span><br><span class="line">  transform: translateX(100%);</span><br><span class="line">&#125;</span><br><span class="line">.slide-enter-active &#123;</span><br><span class="line">  transform: translateX(0);</span><br><span class="line">&#125;</span><br><span class="line">.slide-leave &#123;</span><br><span class="line">  transform: translateX(0);</span><br><span class="line">&#125;</span><br><span class="line">.slide-leave-active &#123;</span><br><span class="line">  transform: translateX(-100%);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="5-常见问题与解决方案"><a href="#5-常见问题与解决方案" class="headerlink" title="5. 常见问题与解决方案"></a>5. 常见问题与解决方案</h2><h3 id="5-1-页面栈溢出"><a href="#5-1-页面栈溢出" class="headerlink" title="5.1 页面栈溢出"></a>5.1 页面栈溢出</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 检查页面栈深度</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkPageStack</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> pages = <span class="title function_">getCurrentPages</span>()</span><br><span class="line">  <span class="keyword">const</span> maxStack = <span class="number">10</span> <span class="comment">// 最大页面栈深度</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (pages.<span class="property">length</span> &gt;= maxStack) &#123;</span><br><span class="line">    uni.<span class="title function_">showModal</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">      <span class="attr">content</span>: <span class="string">&#x27;页面层级过深，是否返回首页？&#x27;</span>,</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">confirm</span>) &#123;</span><br><span class="line">          uni.<span class="title function_">reLaunch</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/pages/index/index&#x27;</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">navigateToDetail</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">checkPageStack</span>()) <span class="keyword">return</span></span><br><span class="line">    uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/pages/detail/detail&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-参数长度限制"><a href="#5-2-参数长度限制" class="headerlink" title="5.2 参数长度限制"></a>5.2 参数长度限制</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 处理长参数传递</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleLongParams</span>(<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> params !== <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    params = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(params)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 检查参数长度</span></span><br><span class="line">  <span class="keyword">if</span> (params.<span class="property">length</span> &gt; <span class="number">2048</span>) &#123;</span><br><span class="line">    <span class="comment">// 存储到本地</span></span><br><span class="line">    <span class="keyword">const</span> key = <span class="string">&#x27;temp_params_&#x27;</span> + <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    uni.<span class="title function_">setStorageSync</span>(key, params)</span><br><span class="line">    <span class="keyword">return</span> key</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> params</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 页面A：传递参数</span></span><br><span class="line"><span class="keyword">const</span> params = <span class="title function_">handleLongParams</span>(<span class="variable language_">this</span>.<span class="property">longData</span>)</span><br><span class="line">uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">`/pages/detail/detail?key=<span class="subst">$&#123;params&#125;</span>`</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 页面B：接收参数</span></span><br><span class="line"><span class="title function_">onLoad</span>(<span class="params">options</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> data = options.<span class="property">key</span></span><br><span class="line">  <span class="keyword">if</span> (data.<span class="title function_">startsWith</span>(<span class="string">&#x27;temp_params_&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">// 从本地存储获取</span></span><br><span class="line">    data = uni.<span class="title function_">getStorageSync</span>(data)</span><br><span class="line">    <span class="comment">// 清理存储</span></span><br><span class="line">    uni.<span class="title function_">removeStorageSync</span>(data)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">handleData</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(data))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-最佳实践建议"><a href="#6-最佳实践建议" class="headerlink" title="6. 最佳实践建议"></a>6. 最佳实践建议</h2><ol>
<li>合理使用页面跳转方式</li>
<li>实现统一的路由拦截</li>
<li>注意页面栈管理</li>
<li>优化转场动画</li>
<li>处理异常情况</li>
</ol>
<h2 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. 总结</h2><ol>
<li>掌握基础路由方法</li>
<li>实现权限控制</li>
<li>处理页面通信</li>
<li>优化用户体验</li>
<li>解决常见问题</li>
</ol>
<hr>
<blockquote>
<p>如果觉得文章对你有帮助,欢迎点赞、评论、分享,你的支持是我继续创作的动力！ </p>
</blockquote>
]]></content>
      <categories>
        <category>前端开发</category>
        <category>uni-app</category>
      </categories>
      <tags>
        <tag>前端开发</tag>
        <tag>uni-app</tag>
        <tag>路由跳转</tag>
        <tag>页面通信</tag>
      </tags>
  </entry>
  <entry>
    <title>uni-app性能优化实战：从加载到渲染的全方位提升</title>
    <url>/2024/03/10/uniapp-performance/</url>
    <content><![CDATA[<blockquote>
<p>性能优化是提升用户体验的关键因素,本文将从多个维度详细介绍uni-app应用的性能优化策略,帮助你构建流畅的跨端应用。</p>
</blockquote>
<span id="more"></span>

<h2 id="1-首屏加载优化"><a href="#1-首屏加载优化" class="headerlink" title="1. 首屏加载优化"></a>1. 首屏加载优化</h2><h3 id="1-1-分包加载"><a href="#1-1-分包加载" class="headerlink" title="1.1 分包加载"></a>1.1 分包加载</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// pages.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;pages&quot;</span>: [&#123;</span><br><span class="line">    <span class="string">&quot;path&quot;</span>: <span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line">    <span class="string">&quot;style&quot;</span>: &#123; ... &#125;</span><br><span class="line">  &#125;],</span><br><span class="line">  <span class="string">&quot;subPackages&quot;</span>: [&#123;</span><br><span class="line">    <span class="string">&quot;root&quot;</span>: <span class="string">&quot;pagesA&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pages&quot;</span>: [&#123;</span><br><span class="line">      <span class="string">&quot;path&quot;</span>: <span class="string">&quot;list/index&quot;</span>,</span><br><span class="line">      <span class="string">&quot;style&quot;</span>: &#123; ... &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-预加载策略"><a href="#1-2-预加载策略" class="headerlink" title="1.2 预加载策略"></a>1.2 预加载策略</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 预加载分包</span></span><br><span class="line">uni.<span class="title function_">preloadSubPackage</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;pagesA&#x27;</span>,</span><br><span class="line">  <span class="attr">success</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;分包预加载成功&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">fail</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;分包预加载失败&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 预加载页面</span></span><br><span class="line"><span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 在首页预加载其他页面</span></span><br><span class="line">  uni.<span class="title function_">preloadPage</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/pagesA/list/index&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-骨架屏实现"><a href="#1-3-骨架屏实现" class="headerlink" title="1.3 骨架屏实现"></a>1.3 骨架屏实现</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- components/skeleton.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;skeleton&quot; v-if=&quot;loading&quot;&gt;</span><br><span class="line">    &lt;view class=&quot;skeleton-header&quot;&gt;&lt;/view&gt;</span><br><span class="line">    &lt;view class=&quot;skeleton-content&quot;&gt;</span><br><span class="line">      &lt;view class=&quot;skeleton-item&quot; v-for=&quot;i in 5&quot; :key=&quot;i&quot;&gt;&lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.skeleton &#123;</span><br><span class="line">  padding: 20rpx;</span><br><span class="line">&#125;</span><br><span class="line">.skeleton-header &#123;</span><br><span class="line">  height: 40rpx;</span><br><span class="line">  background: #f0f0f0;</span><br><span class="line">  margin-bottom: 20rpx;</span><br><span class="line">  animation: skeleton-loading 1s infinite;</span><br><span class="line">&#125;</span><br><span class="line">.skeleton-item &#123;</span><br><span class="line">  height: 100rpx;</span><br><span class="line">  background: #f0f0f0;</span><br><span class="line">  margin-bottom: 20rpx;</span><br><span class="line">  animation: skeleton-loading 1s infinite;</span><br><span class="line">&#125;</span><br><span class="line">@keyframes skeleton-loading &#123;</span><br><span class="line">  0% &#123; opacity: 1; &#125;</span><br><span class="line">  50% &#123; opacity: 0.5; &#125;</span><br><span class="line">  100% &#123; opacity: 1; &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-渲染性能优化"><a href="#2-渲染性能优化" class="headerlink" title="2. 渲染性能优化"></a>2. 渲染性能优化</h2><h3 id="2-1-长列表优化"><a href="#2-1-长列表优化" class="headerlink" title="2.1 长列表优化"></a>2.1 长列表优化</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 虚拟列表实现 --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class=&quot;list-container&quot;&gt;</span><br><span class="line">    &lt;view </span><br><span class="line">      class=&quot;list-phantom&quot;</span><br><span class="line">      :style=&quot;&#123; height: listHeight + &#x27;px&#x27; &#125;&quot;</span><br><span class="line">    &gt;&lt;/view&gt;</span><br><span class="line">    &lt;view </span><br><span class="line">      class=&quot;list-content&quot;</span><br><span class="line">      :style=&quot;&#123; transform: getTransform &#125;&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;view </span><br><span class="line">        class=&quot;list-item&quot;</span><br><span class="line">        v-for=&quot;item in visibleData&quot;</span><br><span class="line">        :key=&quot;item.id&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;&#123; item.content &#125;&#125;</span><br><span class="line">      &lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      listData: [], // 完整列表数据</span><br><span class="line">      itemHeight: 50, // 每项高度</span><br><span class="line">      visibleCount: 10, // 可视区域显示的数量</span><br><span class="line">      startIndex: 0, // 起始索引</span><br><span class="line">      endIndex: 0 // 结束索引</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    listHeight() &#123;</span><br><span class="line">      return this.listData.length * this.itemHeight</span><br><span class="line">    &#125;,</span><br><span class="line">    visibleData() &#123;</span><br><span class="line">      return this.listData.slice(this.startIndex, this.endIndex)</span><br><span class="line">    &#125;,</span><br><span class="line">    getTransform() &#123;</span><br><span class="line">      return `translate3d(0, $&#123;this.startIndex * this.itemHeight&#125;px, 0)`</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleScroll(e) &#123;</span><br><span class="line">      const scrollTop = e.detail.scrollTop</span><br><span class="line">      this.startIndex = Math.floor(scrollTop / this.itemHeight)</span><br><span class="line">      this.endIndex = this.startIndex + this.visibleCount</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-避免频繁更新"><a href="#2-2-避免频繁更新" class="headerlink" title="2.2 避免频繁更新"></a>2.2 避免频繁更新</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用防抖</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">fn, delay</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)</span><br><span class="line">    &#125;, delay)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用节流</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">fn, delay</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">let</span> start = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> current = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    <span class="keyword">const</span> remaining = delay - (current - start)</span><br><span class="line">    <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">    <span class="keyword">if</span> (remaining &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)</span><br><span class="line">      start = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)</span><br><span class="line">        start = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">      &#125;, remaining)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在组件中使用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="attr">updateData</span>: <span class="title function_">debounce</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 更新数据的操作</span></span><br><span class="line">    &#125;, <span class="number">300</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-内存优化"><a href="#3-内存优化" class="headerlink" title="3. 内存优化"></a>3. 内存优化</h2><h3 id="3-1-及时销毁"><a href="#3-1-及时销毁" class="headerlink" title="3.1 及时销毁"></a>3.1 及时销毁</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">timer</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">observer</span>: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeDestroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 清除定时器</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">timer</span>) &#123;</span><br><span class="line">      <span class="built_in">clearTimeout</span>(<span class="variable language_">this</span>.<span class="property">timer</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">timer</span> = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 清除监听器</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">observer</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">observer</span>.<span class="title function_">disconnect</span>()</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">observer</span> = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-避免内存泄漏"><a href="#3-2-避免内存泄漏" class="headerlink" title="3.2 避免内存泄漏"></a>3.2 避免内存泄漏</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 图片预加载</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">preloadImages</span> = (<span class="params">urls</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> promises = urls.<span class="title function_">map</span>(<span class="function"><span class="params">url</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> image = <span class="keyword">new</span> <span class="title class_">Image</span>()</span><br><span class="line">      image.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        image.<span class="property">onload</span> = <span class="literal">null</span> <span class="comment">// 清除事件监听</span></span><br><span class="line">        <span class="title function_">resolve</span>(url)</span><br><span class="line">      &#125;</span><br><span class="line">      image.<span class="property">onerror</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        image.<span class="property">onerror</span> = <span class="literal">null</span> <span class="comment">// 清除事件监听</span></span><br><span class="line">        <span class="title function_">reject</span>(url)</span><br><span class="line">      &#125;</span><br><span class="line">      image.<span class="property">src</span> = url</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(promises)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-网络优化"><a href="#4-网络优化" class="headerlink" title="4. 网络优化"></a>4. 网络优化</h2><h3 id="4-1-请求合并"><a href="#4-1-请求合并" class="headerlink" title="4.1 请求合并"></a>4.1 请求合并</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 请求队列管理</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RequestQueue</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">queue</span> = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">request</span>(<span class="params">key, promiseCreator</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">has</span>(key)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">get</span>(key)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> promise = <span class="title function_">promiseCreator</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">set</span>(key, promise)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> promise</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">delete</span>(key)</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">delete</span>(key)</span><br><span class="line">      <span class="keyword">throw</span> err</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">const</span> requestQueue = <span class="keyword">new</span> <span class="title class_">RequestQueue</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> requestQueue.<span class="title function_">request</span>(<span class="string">`data_<span class="subst">$&#123;id&#125;</span>`</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(&#123; id, <span class="attr">data</span>: <span class="string">&#x27;some data&#x27;</span> &#125;)</span><br><span class="line">      &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-数据缓存"><a href="#4-2-数据缓存" class="headerlink" title="4.2 数据缓存"></a>4.2 数据缓存</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CacheManager</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">expire = <span class="number">5</span> * <span class="number">60</span> * <span class="number">1000</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cache</span> = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">expire</span> = expire</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">set</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">set</span>(key, &#123;</span><br><span class="line">      value,</span><br><span class="line">      <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">get</span>(key)</span><br><span class="line">    <span class="keyword">if</span> (!data) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Date</span>.<span class="title function_">now</span>() - data.<span class="property">timestamp</span> &gt; <span class="variable language_">this</span>.<span class="property">expire</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">delete</span>(key)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> data.<span class="property">value</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">clear</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">const</span> cache = <span class="keyword">new</span> <span class="title class_">CacheManager</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getData</span>(<span class="params">key</span>) &#123;</span><br><span class="line">  <span class="comment">// 先从缓存获取</span></span><br><span class="line">  <span class="keyword">const</span> cached = cache.<span class="title function_">get</span>(key)</span><br><span class="line">  <span class="keyword">if</span> (cached) <span class="keyword">return</span> cached</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 缓存不存在则请求</span></span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">fetchData</span>(key)</span><br><span class="line">  cache.<span class="title function_">set</span>(key, data)</span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-其他优化技巧"><a href="#5-其他优化技巧" class="headerlink" title="5. 其他优化技巧"></a>5. 其他优化技巧</h2><h3 id="5-1-图片优化"><a href="#5-1-图片优化" class="headerlink" title="5.1 图片优化"></a>5.1 图片优化</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 图片懒加载指令</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;lazy&#x27;</span>, &#123;</span><br><span class="line">  <span class="title function_">bind</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(<span class="function"><span class="params">entries</span> =&gt;</span> &#123;</span><br><span class="line">      entries.<span class="title function_">forEach</span>(<span class="function"><span class="params">entry</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (entry.<span class="property">isIntersecting</span>) &#123;</span><br><span class="line">          el.<span class="property">src</span> = binding.<span class="property">value</span></span><br><span class="line">          observer.<span class="title function_">unobserve</span>(el)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    observer.<span class="title function_">observe</span>(el)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line">&lt;image v-lazy=<span class="string">&quot;imageUrl&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-组件优化"><a href="#5-2-组件优化" class="headerlink" title="5.2 组件优化"></a>5.2 组件优化</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用keep-alive缓存组件</span></span><br><span class="line">&lt;keep-alive&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;currentComponent&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span></span><br><span class="line">&lt;/keep-alive&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">AsyncComponent</span> = (<span class="params"></span>) =&gt; (&#123;</span><br><span class="line">  <span class="attr">component</span>: <span class="keyword">import</span>(<span class="string">&#x27;./heavy-component.vue&#x27;</span>),</span><br><span class="line">  <span class="attr">loading</span>: <span class="title class_">LoadingComponent</span>,</span><br><span class="line">  <span class="attr">error</span>: <span class="title class_">ErrorComponent</span>,</span><br><span class="line">  <span class="attr">delay</span>: <span class="number">200</span>,</span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">3000</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="6-性能监控"><a href="#6-性能监控" class="headerlink" title="6. 性能监控"></a>6. 性能监控</h2><h3 id="6-1-页面性能监控"><a href="#6-1-页面性能监控" class="headerlink" title="6.1 页面性能监控"></a>6.1 页面性能监控</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> performance = &#123;</span><br><span class="line">  <span class="comment">// 记录时间点</span></span><br><span class="line">  <span class="title function_">mark</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> performance !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">      performance.<span class="title function_">mark</span>(name)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 测量两个时间点之间的时间</span></span><br><span class="line">  <span class="title function_">measure</span>(<span class="params">name, startMark, endMark</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> performance !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">      performance.<span class="title function_">measure</span>(name, startMark, endMark)</span><br><span class="line">      <span class="keyword">const</span> measures = performance.<span class="title function_">getEntriesByName</span>(name)</span><br><span class="line">      <span class="keyword">return</span> measures[<span class="number">0</span>].<span class="property">duration</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 上报性能数据</span></span><br><span class="line">  <span class="title function_">report</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="comment">// 上报逻辑</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;性能数据:&#x27;</span>, data)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. 总结</h2><ol>
<li>合理使用分包加载</li>
<li>实现虚拟列表</li>
<li>优化更新机制</li>
<li>注意内存管理</li>
<li>做好网络优化</li>
<li>监控性能指标</li>
</ol>
<hr>
<blockquote>
<p>如果觉得文章对你有帮助,欢迎点赞、评论、分享,你的支持是我继续创作的动力！ </p>
</blockquote>
]]></content>
      <categories>
        <category>前端开发</category>
        <category>uni-app</category>
      </categories>
      <tags>
        <tag>前端开发</tag>
        <tag>uni-app</tag>
        <tag>性能优化</tag>
        <tag>小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>uni-app组件通信完全指南：从基础到进阶</title>
    <url>/2024/02/18/uniapp-component-communication/</url>
    <content><![CDATA[<blockquote>
<p>组件通信是uni-app开发中的重要环节,选择合适的通信方式对提升代码质量和开发效率至关重要。本文将详细介绍各种组件通信方案的使用场景和最佳实践。</p>
</blockquote>
<span id="more"></span>

<h2 id="1-基础通信方式"><a href="#1-基础通信方式" class="headerlink" title="1. 基础通信方式"></a>1. 基础通信方式</h2><h3 id="1-1-Props-Emit"><a href="#1-1-Props-Emit" class="headerlink" title="1.1 Props/Emit"></a>1.1 Props/Emit</h3><p>父组件向子组件传值：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 父组件 --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;child-component </span><br><span class="line">    :title=&quot;title&quot;</span><br><span class="line">    :list=&quot;dataList&quot;</span><br><span class="line">    @on-click=&quot;handleClick&quot;</span><br><span class="line">  /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      title: &#x27;标题&#x27;,</span><br><span class="line">      dataList: [&#x27;item1&#x27;, &#x27;item2&#x27;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleClick(data) &#123;</span><br><span class="line">      console.log(&#x27;子组件点击事件:&#x27;, data)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 子组件 --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view&gt;</span><br><span class="line">    &lt;text&gt;&#123;&#123;title&#125;&#125;&lt;/text&gt;</span><br><span class="line">    &lt;view </span><br><span class="line">      v-for=&quot;(item, index) in list&quot; </span><br><span class="line">      :key=&quot;index&quot;</span><br><span class="line">      @click=&quot;onClick(item)&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;&#123;item&#125;&#125;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    title: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: &#x27;&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    list: &#123;</span><br><span class="line">      type: Array,</span><br><span class="line">      default: () =&gt; []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    onClick(item) &#123;</span><br><span class="line">      this.$emit(&#x27;on-click&#x27;, item)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-Provide-Inject"><a href="#1-2-Provide-Inject" class="headerlink" title="1.2 Provide/Inject"></a>1.2 Provide/Inject</h3><p>跨层级组件通信：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 父组件 --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  provide() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      theme: this.theme,</span><br><span class="line">      updateTheme: this.updateTheme</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      theme: &#x27;light&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    updateTheme(newTheme) &#123;</span><br><span class="line">      this.theme = newTheme</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 子组件(任意层级) --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  inject: [&#x27;theme&#x27;, &#x27;updateTheme&#x27;],</span><br><span class="line">  methods: &#123;</span><br><span class="line">    toggleTheme() &#123;</span><br><span class="line">      this.updateTheme(this.theme === &#x27;light&#x27; ? &#x27;dark&#x27; : &#x27;light&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-进阶通信方案"><a href="#2-进阶通信方案" class="headerlink" title="2. 进阶通信方案"></a>2. 进阶通信方案</h2><h3 id="2-1-EventBus"><a href="#2-1-EventBus" class="headerlink" title="2.1 EventBus"></a>2.1 EventBus</h3><p>适用于任意组件间通信：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/event-bus.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EventBus</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">events</span> = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">on</span>(<span class="params">eventName, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">events</span>[eventName]) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">events</span>[eventName] = []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">events</span>[eventName].<span class="title function_">push</span>(callback)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">emit</span>(<span class="params">eventName, data</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">events</span>[eventName]) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">events</span>[eventName].<span class="title function_">forEach</span>(<span class="function"><span class="params">callback</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">callback</span>(data)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">off</span>(<span class="params">eventName, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">events</span>[eventName]) &#123;</span><br><span class="line">      <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">events</span>[eventName] = <span class="variable language_">this</span>.<span class="property">events</span>[eventName].<span class="title function_">filter</span>(<span class="function"><span class="params">cb</span> =&gt;</span> cb !== callback)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">delete</span> <span class="variable language_">this</span>.<span class="property">events</span>[eventName]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">EventBus</span>()</span><br></pre></td></tr></table></figure>

<p>使用示例：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 组件A --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import eventBus from &#x27;@/utils/event-bus&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    sendMessage() &#123;</span><br><span class="line">      eventBus.emit(&#x27;message&#x27;, &#123; type: &#x27;success&#x27;, content: &#x27;操作成功&#x27; &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 组件B --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import eventBus from &#x27;@/utils/event-bus&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    eventBus.on(&#x27;message&#x27;, this.handleMessage)</span><br><span class="line">  &#125;,</span><br><span class="line">  beforeDestroy() &#123;</span><br><span class="line">    eventBus.off(&#x27;message&#x27;, this.handleMessage)</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleMessage(data) &#123;</span><br><span class="line">      console.log(&#x27;收到消息:&#x27;, data)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-Vuex状态管理"><a href="#2-2-Vuex状态管理" class="headerlink" title="2.2 Vuex状态管理"></a>2.2 Vuex状态管理</h3><p>复杂组件通信推荐使用：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// store/index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">userInfo</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">cartList</span>: []</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">setUserInfo</span>(<span class="params">state, info</span>) &#123;</span><br><span class="line">      state.<span class="property">userInfo</span> = info</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">addToCart</span>(<span class="params">state, item</span>) &#123;</span><br><span class="line">      state.<span class="property">cartList</span>.<span class="title function_">push</span>(item)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">updateUserInfo</span>(<span class="params">&#123; commit &#125;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> info = <span class="keyword">await</span> <span class="title function_">getUserInfo</span>()</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;setUserInfo&#x27;</span>, info)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="attr">cartCount</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">cartList</span>.<span class="property">length</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>使用示例：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 组件中使用 --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; mapState, mapMutations, mapActions &#125; from &#x27;vuex&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  computed: &#123;</span><br><span class="line">    ...mapState([&#x27;userInfo&#x27;, &#x27;cartList&#x27;]),</span><br><span class="line">    ...mapGetters([&#x27;cartCount&#x27;])</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    ...mapMutations([&#x27;setUserInfo&#x27;, &#x27;addToCart&#x27;]),</span><br><span class="line">    ...mapActions([&#x27;updateUserInfo&#x27;]),</span><br><span class="line">    async init() &#123;</span><br><span class="line">      await this.updateUserInfo()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-特殊场景处理"><a href="#3-特殊场景处理" class="headerlink" title="3. 特殊场景处理"></a>3. 特殊场景处理</h2><h3 id="3-1-跨页面通信"><a href="#3-1-跨页面通信" class="headerlink" title="3.1 跨页面通信"></a>3.1 跨页面通信</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 页面A</span></span><br><span class="line">uni.$on(<span class="string">&#x27;pageMessage&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleMessage</span>)</span><br><span class="line">uni.$emit(<span class="string">&#x27;pageMessage&#x27;</span>, &#123; <span class="attr">data</span>: <span class="string">&#x27;hello&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 页面B</span></span><br><span class="line">uni.$once(<span class="string">&#x27;pageMessage&#x27;</span>, <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;收到一次性消息:&#x27;</span>, data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意在页面销毁时解除监听</span></span><br><span class="line"><span class="title function_">onUnload</span>(<span class="params"></span>) &#123;</span><br><span class="line">  uni.$off(<span class="string">&#x27;pageMessage&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleMessage</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-组件ref通信"><a href="#3-2-组件ref通信" class="headerlink" title="3.2 组件ref通信"></a>3.2 组件ref通信</h3><p>直接访问组件实例：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 父组件 --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;child-component ref=&quot;child&quot; /&gt;</span><br><span class="line">  &lt;button @click=&quot;callChildMethod&quot;&gt;调用子组件方法&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    callChildMethod() &#123;</span><br><span class="line">      this.$refs.child.someMethod()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 子组件 --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    someMethod() &#123;</span><br><span class="line">      console.log(&#x27;子组件方法被调用&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="4-最佳实践建议"><a href="#4-最佳实践建议" class="headerlink" title="4. 最佳实践建议"></a>4. 最佳实践建议</h2><h3 id="4-1-选择合适的通信方式"><a href="#4-1-选择合适的通信方式" class="headerlink" title="4.1 选择合适的通信方式"></a>4.1 选择合适的通信方式</h3><ol>
<li>父子组件：优先使用props/emit</li>
<li>跨层级组件：考虑provide/inject</li>
<li>复杂数据管理：使用Vuex</li>
<li>简单全局通信：使用EventBus</li>
<li>临时跨页面：使用uni.$emit/$on</li>
</ol>
<h3 id="4-2-性能优化"><a href="#4-2-性能优化" class="headerlink" title="4.2 性能优化"></a>4.2 性能优化</h3><ol>
<li>避免过度使用EventBus</li>
<li>及时解除事件监听</li>
<li>Vuex中合理划分模块</li>
<li>减少不必要的数据监听</li>
</ol>
<h2 id="5-常见问题"><a href="#5-常见问题" class="headerlink" title="5. 常见问题"></a>5. 常见问题</h2><h3 id="5-1-数据同步问题"><a href="#5-1-数据同步问题" class="headerlink" title="5.1 数据同步问题"></a>5.1 数据同步问题</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 父组件数据变化子组件不更新</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">list</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Array</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="function">() =&gt;</span> []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">watch</span>: &#123;</span><br><span class="line">    <span class="attr">list</span>: &#123;</span><br><span class="line">      <span class="title function_">handler</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">        <span class="comment">// 深度监听数据变化</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">handleListChange</span>(newVal)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">deep</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-事件解绑问题"><a href="#5-2-事件解绑问题" class="headerlink" title="5.2 事件解绑问题"></a>5.2 事件解绑问题</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">handlers</span>: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">addEventHandler</span>(<span class="params">handler</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">handlers</span>.<span class="title function_">push</span>(handler)</span><br><span class="line">      eventBus.<span class="title function_">on</span>(<span class="string">&#x27;someEvent&#x27;</span>, handler)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeDestroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 统一解绑事件</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">handlers</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">handler</span> =&gt;</span> &#123;</span><br><span class="line">      eventBus.<span class="title function_">off</span>(<span class="string">&#x27;someEvent&#x27;</span>, handler)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-总结"><a href="#6-总结" class="headerlink" title="6. 总结"></a>6. 总结</h2><ol>
<li>了解各种通信方式的特点</li>
<li>根据场景选择合适的方案</li>
<li>注意性能和内存问题</li>
<li>做好事件解绑和销毁</li>
<li>保持代码的可维护性</li>
</ol>
<hr>
<blockquote>
<p>如果觉得文章对你有帮助,欢迎点赞、评论、分享,你的支持是我继续创作的动力！ </p>
</blockquote>
]]></content>
      <categories>
        <category>前端开发</category>
        <category>uni-app</category>
      </categories>
      <tags>
        <tag>前端开发</tag>
        <tag>uni-app</tag>
        <tag>Vue</tag>
        <tag>组件通信</tag>
      </tags>
  </entry>
  <entry>
    <title>uni-app数据存储全攻略：从本地存储到持久化方案</title>
    <url>/2024/01/05/uniapp-storage/</url>
    <content><![CDATA[<blockquote>
<p>数据存储是应用开发中的重要环节,选择合适的存储方案对提升用户体验至关重要。本文将详细介绍uni-app中的数据存储最佳实践。</p>
</blockquote>
<span id="more"></span>

<h2 id="1-本地存储基础"><a href="#1-本地存储基础" class="headerlink" title="1. 本地存储基础"></a>1. 本地存储基础</h2><h3 id="1-1-Storage-API封装"><a href="#1-1-Storage-API封装" class="headerlink" title="1.1 Storage API封装"></a>1.1 Storage API封装</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/storage.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Storage</span> &#123;</span><br><span class="line">  <span class="comment">// 设置存储</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">set</span>(<span class="params">key, value, expired = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">      value,</span><br><span class="line">      <span class="attr">expired</span>: expired ? <span class="title class_">Date</span>.<span class="title function_">now</span>() + expired * <span class="number">1000</span> : <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    uni.<span class="title function_">setStorageSync</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 获取存储</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = uni.<span class="title function_">getStorageSync</span>(key)</span><br><span class="line">    <span class="keyword">if</span> (!data) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> &#123; value, expired &#125; = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data)</span><br><span class="line">    <span class="comment">// 判断是否过期</span></span><br><span class="line">    <span class="keyword">if</span> (expired &amp;&amp; expired &lt; <span class="title class_">Date</span>.<span class="title function_">now</span>()) &#123;</span><br><span class="line">      uni.<span class="title function_">removeStorageSync</span>(key)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 移除存储</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">remove</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    uni.<span class="title function_">removeStorageSync</span>(key)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 清空存储</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    uni.<span class="title function_">clearStorageSync</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Storage</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-使用示例"><a href="#1-2-使用示例" class="headerlink" title="1.2 使用示例"></a>1.2 使用示例</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 存储数据(7天过期)</span></span><br><span class="line"><span class="title class_">Storage</span>.<span class="title function_">set</span>(<span class="string">&#x27;userInfo&#x27;</span>, &#123; <span class="attr">name</span>: <span class="string">&#x27;Tom&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;, <span class="number">7</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取数据</span></span><br><span class="line"><span class="keyword">const</span> userInfo = <span class="title class_">Storage</span>.<span class="title function_">get</span>(<span class="string">&#x27;userInfo&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 移除数据</span></span><br><span class="line"><span class="title class_">Storage</span>.<span class="title function_">remove</span>(<span class="string">&#x27;userInfo&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清空所有数据</span></span><br><span class="line"><span class="title class_">Storage</span>.<span class="title function_">clear</span>()</span><br></pre></td></tr></table></figure>

<h2 id="2-高级存储方案"><a href="#2-高级存储方案" class="headerlink" title="2. 高级存储方案"></a>2. 高级存储方案</h2><h3 id="2-1-加密存储"><a href="#2-1-加密存储" class="headerlink" title="2.1 加密存储"></a>2.1 加密存储</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/crypto.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">CryptoJS</span> <span class="keyword">from</span> <span class="string">&#x27;crypto-js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SECRET_KEY</span> = <span class="string">&#x27;your-secret-key&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">encrypt</span> = (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">encrypt</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data), <span class="variable constant_">SECRET_KEY</span>).<span class="title function_">toString</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">decrypt</span> = (<span class="params">ciphertext</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> bytes = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">decrypt</span>(ciphertext, <span class="variable constant_">SECRET_KEY</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(bytes.<span class="title function_">toString</span>(<span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加密存储类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SecureStorage</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">set</span>(<span class="params">key, value, expired = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">      <span class="attr">value</span>: <span class="title function_">encrypt</span>(value),</span><br><span class="line">      <span class="attr">expired</span>: expired ? <span class="title class_">Date</span>.<span class="title function_">now</span>() + expired * <span class="number">1000</span> : <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    uni.<span class="title function_">setStorageSync</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = uni.<span class="title function_">getStorageSync</span>(key)</span><br><span class="line">    <span class="keyword">if</span> (!data) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> &#123; value, expired &#125; = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data)</span><br><span class="line">    <span class="keyword">if</span> (expired &amp;&amp; expired &lt; <span class="title class_">Date</span>.<span class="title function_">now</span>()) &#123;</span><br><span class="line">      uni.<span class="title function_">removeStorageSync</span>(key)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">decrypt</span>(value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-数据压缩存储"><a href="#2-2-数据压缩存储" class="headerlink" title="2.2 数据压缩存储"></a>2.2 数据压缩存储</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/compress.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; deflate, inflate &#125; <span class="keyword">from</span> <span class="string">&#x27;pako&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CompressStorage</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">set</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">    <span class="comment">// 转换为JSON字符串并压缩</span></span><br><span class="line">    <span class="keyword">const</span> compressed = <span class="title function_">deflate</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(value))</span><br><span class="line">    uni.<span class="title function_">setStorageSync</span>(key, compressed)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> compressed = uni.<span class="title function_">getStorageSync</span>(key)</span><br><span class="line">    <span class="keyword">if</span> (!compressed) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 解压并解析JSON</span></span><br><span class="line">    <span class="keyword">const</span> decompressed = <span class="title function_">inflate</span>(compressed, &#123; <span class="attr">to</span>: <span class="string">&#x27;string&#x27;</span> &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(decompressed)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-持久化存储策略"><a href="#3-持久化存储策略" class="headerlink" title="3. 持久化存储策略"></a>3. 持久化存储策略</h2><h3 id="3-1-Vuex持久化"><a href="#3-1-Vuex持久化" class="headerlink" title="3.1 Vuex持久化"></a>3.1 Vuex持久化</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// store/index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Storage</span> <span class="keyword">from</span> <span class="string">&#x27;@/utils/storage&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">STORAGE_KEY</span> = <span class="string">&#x27;vuex_store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">userInfo</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">settings</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">setState</span>(<span class="params">state, payload</span>) &#123;</span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">assign</span>(state, payload)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">// 初始化状态</span></span><br><span class="line">    <span class="title function_">initState</span>(<span class="params">&#123; commit &#125;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> data = <span class="title class_">Storage</span>.<span class="title function_">get</span>(<span class="variable constant_">STORAGE_KEY</span>)</span><br><span class="line">      <span class="keyword">if</span> (data) &#123;</span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&#x27;setState&#x27;</span>, data)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 保存状态</span></span><br><span class="line">    <span class="title function_">saveState</span>(<span class="params">&#123; state &#125;</span>) &#123;</span><br><span class="line">      <span class="title class_">Storage</span>.<span class="title function_">set</span>(<span class="variable constant_">STORAGE_KEY</span>, state)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="3-2-自动同步机制"><a href="#3-2-自动同步机制" class="headerlink" title="3.2 自动同步机制"></a>3.2 自动同步机制</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// mixins/storage-sync.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 监听应用进入后台</span></span><br><span class="line">    uni.<span class="title function_">onAppHide</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&#x27;saveState&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 监听网络状态</span></span><br><span class="line">    uni.<span class="title function_">onNetworkStatusChange</span>(<span class="function">(<span class="params">&#123; isConnected &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (isConnected) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">syncDataToServer</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">syncDataToServer</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> localData = <span class="title class_">Storage</span>.<span class="title function_">get</span>(<span class="string">&#x27;offlineData&#x27;</span>) || []</span><br><span class="line">        <span class="keyword">if</span> (localData.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 上传本地数据到服务器</span></span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">$api</span>.<span class="title function_">syncData</span>(localData)</span><br><span class="line">        <span class="comment">// 清空本地缓存</span></span><br><span class="line">        <span class="title class_">Storage</span>.<span class="title function_">remove</span>(<span class="string">&#x27;offlineData&#x27;</span>)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;数据同步失败&#x27;</span>, err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-存储优化技巧"><a href="#4-存储优化技巧" class="headerlink" title="4. 存储优化技巧"></a>4. 存储优化技巧</h2><h3 id="4-1-分片存储"><a href="#4-1-分片存储" class="headerlink" title="4.1 分片存储"></a>4.1 分片存储</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ChunkStorage</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="variable constant_">CHUNK_SIZE</span> = <span class="number">1024</span> * <span class="number">1024</span> <span class="comment">// 1MB</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">set</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(value)</span><br><span class="line">    <span class="keyword">const</span> chunks = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 分片存储</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; data.<span class="property">length</span>; i += <span class="variable language_">this</span>.<span class="property">CHUNK_SIZE</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> chunk = data.<span class="title function_">slice</span>(i, i + <span class="variable language_">this</span>.<span class="property">CHUNK_SIZE</span>)</span><br><span class="line">      chunks.<span class="title function_">push</span>(chunk)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 存储分片信息</span></span><br><span class="line">    uni.<span class="title function_">setStorageSync</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span>_info`</span>, &#123;</span><br><span class="line">      <span class="attr">chunks</span>: chunks.<span class="property">length</span>,</span><br><span class="line">      <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 存储各个分片</span></span><br><span class="line">    chunks.<span class="title function_">forEach</span>(<span class="function">(<span class="params">chunk, index</span>) =&gt;</span> &#123;</span><br><span class="line">      uni.<span class="title function_">setStorageSync</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span>_<span class="subst">$&#123;index&#125;</span>`</span>, chunk)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> info = uni.<span class="title function_">getStorageSync</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span>_info`</span>)</span><br><span class="line">    <span class="keyword">if</span> (!info) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 合并分片</span></span><br><span class="line">    <span class="keyword">let</span> data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; info.<span class="property">chunks</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> chunk = uni.<span class="title function_">getStorageSync</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span>_<span class="subst">$&#123;i&#125;</span>`</span>)</span><br><span class="line">      data += chunk</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-存储监控"><a href="#4-2-存储监控" class="headerlink" title="4.2 存储监控"></a>4.2 存储监控</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StorageMonitor</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">checkSize</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; currentSize, limitSize &#125; = <span class="keyword">await</span> uni.<span class="title function_">getStorageInfo</span>()</span><br><span class="line">      <span class="keyword">const</span> usage = (currentSize / limitSize) * <span class="number">100</span></span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (usage &gt; <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">`存储空间使用率过高: <span class="subst">$&#123;usage.toFixed(<span class="number">2</span>)&#125;</span>%`</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">cleanExpiredData</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;存储监控失败&#x27;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">cleanExpiredData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> keys = uni.<span class="title function_">getStorageInfoSync</span>().<span class="property">keys</span></span><br><span class="line">    keys.<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> data = uni.<span class="title function_">getStorageSync</span>(key)</span><br><span class="line">      <span class="keyword">if</span> (data &amp;&amp; data.<span class="property">expired</span> &amp;&amp; data.<span class="property">expired</span> &lt; <span class="title class_">Date</span>.<span class="title function_">now</span>()) &#123;</span><br><span class="line">        uni.<span class="title function_">removeStorageSync</span>(key)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-实践建议"><a href="#5-实践建议" class="headerlink" title="5. 实践建议"></a>5. 实践建议</h2><h3 id="5-1-性能优化"><a href="#5-1-性能优化" class="headerlink" title="5.1 性能优化"></a>5.1 性能优化</h3><ol>
<li>避免频繁读写操作</li>
<li>合理使用过期时间</li>
<li>及时清理无用数据</li>
<li>大数据考虑分片存储</li>
</ol>
<h3 id="5-2-安全建议"><a href="#5-2-安全建议" class="headerlink" title="5.2 安全建议"></a>5.2 安全建议</h3><ol>
<li>敏感数据必须加密</li>
<li>定期清理过期数据</li>
<li>避免存储明文密码</li>
<li>控制存储大小</li>
</ol>
<h2 id="6-总结"><a href="#6-总结" class="headerlink" title="6. 总结"></a>6. 总结</h2><ol>
<li>合理封装Storage API</li>
<li>选择合适的存储方案</li>
<li>实现数据持久化</li>
<li>注意性能和安全</li>
<li>做好存储监控</li>
</ol>
<hr>
<blockquote>
<p>如果觉得文章对你有帮助,欢迎点赞、评论、分享,你的支持是我继续创作的动力！</p>
</blockquote>
]]></content>
      <categories>
        <category>前端开发</category>
        <category>uni-app</category>
      </categories>
      <tags>
        <tag>前端开发</tag>
        <tag>uni-app</tag>
        <tag>数据存储</tag>
        <tag>本地存储</tag>
      </tags>
  </entry>
  <entry>
    <title>uni-app网络请求最佳实践：封装、拦截与错误处理</title>
    <url>/2023/11/28/uniapp-request/</url>
    <content><![CDATA[<blockquote>
<p>网络请求是前端应用的重中之重,一个好的请求封装可以让开发事半功倍。本文将分享uni-app网络请求的最佳实践经验。</p>
</blockquote>
<span id="more"></span>

<h2 id="1-基础请求封装"><a href="#1-基础请求封装" class="headerlink" title="1. 基础请求封装"></a>1. 基础请求封装</h2><h3 id="1-1-创建请求实例"><a href="#1-1-创建请求实例" class="headerlink" title="1.1 创建请求实例"></a>1.1 创建请求实例</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/request.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">request</span> = (<span class="params">options = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_BASE_API</span> + options.<span class="property">url</span>,</span><br><span class="line">      <span class="attr">method</span>: options.<span class="property">method</span> || <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: options.<span class="property">data</span> || &#123;&#125;,</span><br><span class="line">      <span class="attr">header</span>: options.<span class="property">header</span> || &#123;&#125;,</span><br><span class="line">      <span class="attr">timeout</span>: options.<span class="property">timeout</span> || <span class="number">60000</span>,</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> <span class="title function_">resolve</span>(res.<span class="property">data</span>),</span><br><span class="line">      <span class="attr">fail</span>: <span class="function">(<span class="params">err</span>) =&gt;</span> <span class="title function_">reject</span>(err)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> request</span><br></pre></td></tr></table></figure>

<h3 id="1-2-添加拦截器"><a href="#1-2-添加拦截器" class="headerlink" title="1.2 添加拦截器"></a>1.2 添加拦截器</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> httpInterceptor = &#123;</span><br><span class="line">  <span class="comment">// 请求拦截</span></span><br><span class="line">  <span class="title function_">invoke</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="comment">// 1. 非http开头需拼接地址</span></span><br><span class="line">    <span class="keyword">if</span> (!options.<span class="property">url</span>.<span class="title function_">startsWith</span>(<span class="string">&#x27;http&#x27;</span>)) &#123;</span><br><span class="line">      options.<span class="property">url</span> = baseURL + options.<span class="property">url</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. 请求超时</span></span><br><span class="line">    options.<span class="property">timeout</span> = <span class="number">10000</span></span><br><span class="line">    <span class="comment">// 3. 添加小程序端请求头标识</span></span><br><span class="line">    options.<span class="property">header</span> = &#123;</span><br><span class="line">      ...options.<span class="property">header</span>,</span><br><span class="line">      <span class="string">&#x27;source-client&#x27;</span>: <span class="string">&#x27;miniapp&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. 添加token请求头标识</span></span><br><span class="line">    <span class="keyword">const</span> token = uni.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">      options.<span class="property">header</span>.<span class="property">Authorization</span> = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> options</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册拦截器</span></span><br><span class="line">uni.<span class="title function_">addInterceptor</span>(<span class="string">&#x27;request&#x27;</span>, httpInterceptor)</span><br><span class="line">uni.<span class="title function_">addInterceptor</span>(<span class="string">&#x27;uploadFile&#x27;</span>, httpInterceptor)</span><br></pre></td></tr></table></figure>

<h2 id="2-常见错误处理"><a href="#2-常见错误处理" class="headerlink" title="2. 常见错误处理"></a>2. 常见错误处理</h2><h3 id="2-1-统一错误处理"><a href="#2-1-统一错误处理" class="headerlink" title="2.1 统一错误处理"></a>2.1 统一错误处理</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">errorHandle</span> = (<span class="params">response</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> status = response.<span class="property">statusCode</span></span><br><span class="line">  <span class="comment">// 状态码判断</span></span><br><span class="line">  <span class="keyword">switch</span> (status) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">401</span>:</span><br><span class="line">      <span class="comment">// token失效,重新登录</span></span><br><span class="line">      uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/pages/login/index&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">403</span>:</span><br><span class="line">      <span class="comment">// 服务器拒绝执行</span></span><br><span class="line">      uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;服务器拒绝执行&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">404</span>:</span><br><span class="line">      <span class="comment">// 请求的资源不存在</span></span><br><span class="line">      uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;请求的资源不存在&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="comment">// 其他错误</span></span><br><span class="line">      uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: response.<span class="property">data</span>.<span class="property">message</span> || <span class="string">&#x27;请求失败&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(response)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-请求重试机制"><a href="#2-2-请求重试机制" class="headerlink" title="2.2 请求重试机制"></a>2.2 请求重试机制</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">retry</span> = (<span class="params">fn, times = <span class="number">3</span>, delay = <span class="number">1000</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">attempt</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">fn</span>().<span class="title function_">then</span>(resolve).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`请求失败,剩余重试次数:<span class="subst">$&#123;times - <span class="number">1</span>&#125;</span>`</span>)</span><br><span class="line">        <span class="keyword">if</span> (times - <span class="number">1</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          times--</span><br><span class="line">          <span class="built_in">setTimeout</span>(attempt, delay)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title function_">reject</span>(err)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">attempt</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="title function_">retry</span>(<span class="function">() =&gt;</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;/api/data&#x27;</span>,</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span></span><br><span class="line">&#125;)).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请求成功&#x27;</span>, res)</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;重试后依然失败&#x27;</span>, err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="3-Token刷新方案"><a href="#3-Token刷新方案" class="headerlink" title="3. Token刷新方案"></a>3. Token刷新方案</h2><h3 id="3-1-无感刷新Token"><a href="#3-1-无感刷新Token" class="headerlink" title="3.1 无感刷新Token"></a>3.1 无感刷新Token</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> isRefreshing = <span class="literal">false</span></span><br><span class="line"><span class="keyword">let</span> requests = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">refreshToken</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (isRefreshing) &#123;</span><br><span class="line">    <span class="comment">// 返回Promise,将其他请求缓存</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">      requests.<span class="title function_">push</span>(<span class="function">(<span class="params">token</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(token)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  isRefreshing = <span class="literal">true</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/auth/refresh&#x27;</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">refresh_token</span>: uni.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;refresh_token&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      isRefreshing = <span class="literal">false</span></span><br><span class="line">      <span class="comment">// 更新token</span></span><br><span class="line">      uni.<span class="title function_">setStorageSync</span>(<span class="string">&#x27;token&#x27;</span>, res.<span class="property">token</span>)</span><br><span class="line">      <span class="comment">// 执行缓存的请求</span></span><br><span class="line">      requests.<span class="title function_">forEach</span>(<span class="function"><span class="params">cb</span> =&gt;</span> <span class="title function_">cb</span>(res.<span class="property">token</span>))</span><br><span class="line">      requests = []</span><br><span class="line">      <span class="title function_">resolve</span>(res.<span class="property">token</span>)</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      isRefreshing = <span class="literal">false</span></span><br><span class="line">      <span class="comment">// token刷新失败,清空缓存</span></span><br><span class="line">      uni.<span class="title function_">clearStorageSync</span>()</span><br><span class="line">      <span class="comment">// 跳转登录页</span></span><br><span class="line">      uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/pages/login/index&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="title function_">reject</span>(err)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-请求拦截中应用"><a href="#3-2-请求拦截中应用" class="headerlink" title="3.2 请求拦截中应用"></a>3.2 请求拦截中应用</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> httpInterceptor = &#123;</span><br><span class="line">  <span class="title function_">invoke</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="comment">// ... 其他配置</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 判断token是否过期</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isTokenExpired</span>() &amp;&amp; !options.<span class="property">url</span>.<span class="title function_">includes</span>(<span class="string">&#x27;/auth&#x27;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">refreshToken</span>().<span class="title function_">then</span>(<span class="function"><span class="params">token</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 更新token后重新发起请求</span></span><br><span class="line">        options.<span class="property">header</span>.<span class="property">Authorization</span> = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span></span><br><span class="line">        <span class="keyword">return</span> uni.<span class="title function_">request</span>(options)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> options</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-上传下载处理"><a href="#4-上传下载处理" class="headerlink" title="4. 上传下载处理"></a>4. 上传下载处理</h2><h3 id="4-1-文件上传封装"><a href="#4-1-文件上传封装" class="headerlink" title="4.1 文件上传封装"></a>4.1 文件上传封装</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">upload</span> = (<span class="params">options = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    uni.<span class="title function_">uploadFile</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_BASE_API</span> + options.<span class="property">url</span>,</span><br><span class="line">      <span class="attr">filePath</span>: options.<span class="property">filePath</span>,</span><br><span class="line">      <span class="attr">name</span>: options.<span class="property">name</span> || <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">      <span class="attr">header</span>: &#123;</span><br><span class="line">        ...options.<span class="property">header</span>,</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;multipart/form-data&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> <span class="title function_">resolve</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(res.<span class="property">data</span>)),</span><br><span class="line">      <span class="attr">fail</span>: <span class="function">(<span class="params">err</span>) =&gt;</span> <span class="title function_">reject</span>(err)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-文件下载封装"><a href="#4-2-文件下载封装" class="headerlink" title="4.2 文件下载封装"></a>4.2 文件下载封装</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">download</span> = (<span class="params">options = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    uni.<span class="title function_">downloadFile</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: options.<span class="property">url</span>,</span><br><span class="line">      <span class="attr">header</span>: options.<span class="property">header</span>,</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">statusCode</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(res.<span class="property">tempFilePath</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;下载失败&#x27;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">fail</span>: <span class="function">(<span class="params">err</span>) =&gt;</span> <span class="title function_">reject</span>(err)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-使用示例"><a href="#5-使用示例" class="headerlink" title="5. 使用示例"></a>5. 使用示例</h2><h3 id="5-1-基础请求"><a href="#5-1-基础请求" class="headerlink" title="5.1 基础请求"></a>5.1 基础请求</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// api/user.js</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getUserInfo</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/user/info&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// pages/index/index.vue</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> userInfo = <span class="keyword">await</span> <span class="title function_">getUserInfo</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">userInfo</span> = userInfo</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-文件上传"><a href="#5-2-文件上传" class="headerlink" title="5.2 文件上传"></a>5.2 文件上传</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 选择图片并上传</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">chooseAndUpload</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [tempFile] = <span class="keyword">await</span> uni.<span class="title function_">chooseImage</span>(&#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">1</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">upload</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/upload&#x27;</span>,</span><br><span class="line">      <span class="attr">filePath</span>: tempFile.<span class="property">path</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;file&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;上传成功&#x27;</span>, res)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;上传失败&#x27;</span>, err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-总结"><a href="#6-总结" class="headerlink" title="6. 总结"></a>6. 总结</h2><ol>
<li>统一封装请求方法</li>
<li>添加请求/响应拦截器</li>
<li>实现错误处理和重试机制</li>
<li>处理token刷新</li>
<li>封装上传下载方法</li>
</ol>
<hr>
<blockquote>
<p>如果觉得文章对你有帮助,欢迎点赞、评论、分享,你的支持是我继续创作的动力！</p>
</blockquote>
]]></content>
      <categories>
        <category>前端开发</category>
        <category>uni-app</category>
      </categories>
      <tags>
        <tag>前端开发</tag>
        <tag>uni-app</tag>
        <tag>网络请求</tag>
        <tag>API封装</tag>
      </tags>
  </entry>
  <entry>
    <title>uni-app生命周期踩坑指南：常见错误与最佳实践</title>
    <url>/2023/10/15/uniapp-lifecycle/</url>
    <content><![CDATA[<blockquote>
<p>在uni-app开发中,正确理解和使用生命周期函数是避免各种异常问题的关键。本文将详细介绍uni-app生命周期中的常见陷阱和解决方案。</p>
</blockquote>
<span id="more"></span>

<h2 id="1-生命周期的三个层次"><a href="#1-生命周期的三个层次" class="headerlink" title="1. 生命周期的三个层次"></a>1. 生命周期的三个层次</h2><h3 id="1-1-应用生命周期"><a href="#1-1-应用生命周期" class="headerlink" title="1.1 应用生命周期"></a>1.1 应用生命周期</h3><ul>
<li>onLaunch: 初始化完成时触发,<strong>只触发一次</strong></li>
<li>onShow: 从后台进入前台显示时触发</li>
<li>onHide: 从前台进入后台时触发</li>
</ul>
<h3 id="1-2-页面生命周期"><a href="#1-2-页面生命周期" class="headerlink" title="1.2 页面生命周期"></a>1.2 页面生命周期</h3><ul>
<li>onLoad: 页面加载时触发,可获取路由参数</li>
<li>onShow: 页面显示/切入前台时触发</li>
<li>onReady: 页面初次渲染完成时触发</li>
<li>onHide: 页面隐藏/切入后台时触发</li>
<li>onUnload: 页面卸载时触发</li>
</ul>
<h3 id="1-3-组件生命周期"><a href="#1-3-组件生命周期" class="headerlink" title="1.3 组件生命周期"></a>1.3 组件生命周期</h3><ul>
<li>beforeCreate/created: Vue组件生命周期</li>
<li>beforeMount/mounted: Vue组件生命周期</li>
<li>beforeUpdate/updated: Vue组件生命周期</li>
<li>beforeDestroy/destroyed: Vue组件生命周期</li>
</ul>
<h2 id="2-常见错误与解决方案"><a href="#2-常见错误与解决方案" class="headerlink" title="2. 常见错误与解决方案"></a>2. 常见错误与解决方案</h2><h3 id="2-1-获取数据时机错误"><a href="#2-1-获取数据时机错误" class="headerlink" title="2.1 获取数据时机错误"></a>2.1 获取数据时机错误</h3><p>❌ 错误示例:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">userInfo</span>: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 错误:在created中获取DOM元素</span></span><br><span class="line">    <span class="keyword">const</span> dom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>✅ 正确示例:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">userInfo</span>: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 正确:在mounted中获取DOM元素</span></span><br><span class="line">    <span class="keyword">const</span> dom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-路由参数获取时机"><a href="#2-2-路由参数获取时机" class="headerlink" title="2.2 路由参数获取时机"></a>2.2 路由参数获取时机</h3><p>❌ 错误示例:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">onShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 错误:在onShow中获取路由参数</span></span><br><span class="line">    <span class="keyword">const</span> id = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>.<span class="property">id</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>✅ 正确示例:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">onLoad</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="comment">// 正确:在onLoad中获取路由参数</span></span><br><span class="line">    <span class="keyword">const</span> id = options.<span class="property">id</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-条件编译使用错误"><a href="#2-3-条件编译使用错误" class="headerlink" title="2.3 条件编译使用错误"></a>2.3 条件编译使用错误</h3><p>❌ 错误示例:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 错误:直接在生命周期函数外使用条件编译</span></span><br><span class="line">  #ifdef <span class="variable constant_">MP</span>-<span class="variable constant_">WEIXIN</span></span><br><span class="line">  <span class="title function_">onShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 微信小程序相关代码</span></span><br><span class="line">  &#125;</span><br><span class="line">  #endif</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>✅ 正确示例:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">onShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 正确:在函数内部使用条件编译</span></span><br><span class="line">    <span class="comment">// #ifdef MP-WEIXIN</span></span><br><span class="line">    <span class="comment">// 微信小程序相关代码</span></span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-性能优化建议"><a href="#3-性能优化建议" class="headerlink" title="3. 性能优化建议"></a>3. 性能优化建议</h2><h3 id="3-1-合理使用onLoad和onShow"><a href="#3-1-合理使用onLoad和onShow" class="headerlink" title="3.1 合理使用onLoad和onShow"></a>3.1 合理使用onLoad和onShow</h3><ul>
<li>onLoad: 适合一次性初始化数据</li>
<li>onShow: 适合需要实时更新的数据</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">staticData</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">dynamicData</span>: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 获取一次性初始化数据</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getStaticData</span>()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 获取需要实时更新的数据</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getDynamicData</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-避免重复初始化"><a href="#3-2-避免重复初始化" class="headerlink" title="3.2 避免重复初始化"></a>3.2 避免重复初始化</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">isInitialized</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">isInitialized</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">initialize</span>()</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isInitialized</span> = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-跨端兼容处理"><a href="#4-跨端兼容处理" class="headerlink" title="4. 跨端兼容处理"></a>4. 跨端兼容处理</h2><h3 id="4-1-平台差异化处理"><a href="#4-1-平台差异化处理" class="headerlink" title="4.1 平台差异化处理"></a>4.1 平台差异化处理</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// #ifdef MP-WEIXIN</span></span><br><span class="line">    <span class="comment">// 微信小程序特有的初始化</span></span><br><span class="line">    wx.<span class="title function_">getSystemInfo</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">systemInfo</span> = res</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// #ifdef H5</span></span><br><span class="line">    <span class="comment">// H5特有的初始化</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleResize</span>)</span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onUnload</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// #ifdef H5</span></span><br><span class="line">    <span class="comment">// 注意在页面卸载时移除事件监听</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleResize</span>)</span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-生命周期补充说明"><a href="#4-2-生命周期补充说明" class="headerlink" title="4.2 生命周期补充说明"></a>4.2 生命周期补充说明</h3><p>某些平台特有的生命周期:</p>
<ul>
<li>onPageScroll: 页面滚动触发</li>
<li>onReachBottom: 页面上拉触底事件</li>
<li>onPullDownRefresh: 下拉刷新事件</li>
<li>onTabItemTap: tab点击事件</li>
</ul>
<h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5. 总结"></a>5. 总结</h2><ol>
<li>合理使用不同层次的生命周期函数</li>
<li>注意数据获取和DOM操作的时机</li>
<li>正确使用条件编译</li>
<li>做好跨端兼容处理</li>
<li>注意性能优化</li>
</ol>
<hr>
<blockquote>
<p>如果觉得文章对你有帮助,欢迎点赞、评论、分享,你的支持是我继续创作的动力！</p>
</blockquote>
]]></content>
      <categories>
        <category>前端开发</category>
        <category>uni-app</category>
      </categories>
      <tags>
        <tag>uni-app</tag>
        <tag>Vue</tag>
        <tag>小程序开发</tag>
        <tag>生命周期</tag>
      </tags>
  </entry>
  <entry>
    <title>uni-app实现本地通知栏消息推送(不使用第三方插件)的知识点和一些坑</title>
    <url>/2023/09/08/uni_push/</url>
    <content><![CDATA[<h1 id="PUSH模块"><a href="#PUSH模块" class="headerlink" title="PUSH模块"></a>PUSH模块</h1><p>uni-app已经集成push服务，这是一个包括客户端和服务器的统一服务，整合了苹果APNs、华为、小米、OPPO、VIVO、魅族、谷歌FCM等多家厂商的系统推送和个推的独立推送，不管客户端还是服务器，一套代码多端推送。</p>
<p>并且只需要简单的到项目配置文件manifest.json模块项中勾选一下即可使用。</p>
<h2 id="坑：未添加PUSH模块"><a href="#坑：未添加PUSH模块" class="headerlink" title="坑：未添加PUSH模块"></a>坑：未添加PUSH模块</h2><p><img src="/img/uniPUSH/02.jpg" alt="未添加PUSH模块"></p>
<p>这个问题很奇怪，不管是云打包正式版，还是打包测试基座什么的，一直都是提示这个。</p>
<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>这个问题虽然很奇怪，但是也很简单，只需要在项目配置文件manifest.json勾选push模块后，重新打包一次测试基座。</p>
<span id="more"></span>

<h2 id="push模块2-0"><a href="#push模块2-0" class="headerlink" title="push模块2.0"></a>push模块2.0</h2><p>push2.0比1.0升级之处在于：</p>
<p>1.支持5+全端推送；</p>
<p>2.不使用后端集成个推api，只需要将云函数url化，给后端这个url就行；</p>
<p>3.还是要集成各大厂商的SDK，这点是和1.0一模一样的。</p>
<p>4.要调用云函数（收费），虽然不是很贵，但是只是为了推送个通知消息就要再买一个云服务器，有点无语住。。。</p>
<p>今天只是讲讲push1.0的实现本地通知，就不谈服务器得了。</p>
<p>勾选了PUSH模块后，点击配置按钮，会自动跳转到uni-app的网页端应用设置页，在上面配置一下自己的应用开通一下push即可。</p>
<p><img src="/img/uniPUSH/01.png" alt="勾选PUSH模块"></p>
<h2 id="判断是否开启通知权限"><a href="#判断是否开启通知权限" class="headerlink" title="判断是否开启通知权限"></a>判断是否开启通知权限</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">enablPermission()&#123;</span><br><span class="line">	let main = plus.android.runtimeMainActivity();</span><br><span class="line">	let pkName = main.getPackageName();</span><br><span class="line">	let uid = main.getApplicationInfo().plusGetAttribute(&quot;uid&quot;);</span><br><span class="line">	let NotificationManagerCompat = plus.android.importClass(&quot;android.support.v4.app.NotificationManagerCompat&quot;);</span><br><span class="line">	//android.support.v4升级为androidx</span><br><span class="line">	if (NotificationManagerCompat == null) &#123;</span><br><span class="line">		NotificationManagerCompat = plus.android.importClass(&quot;androidx.core.app.NotificationManagerCompat&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	let areNotificationsEnabled = NotificationManagerCompat.from(main).areNotificationsEnabled();</span><br><span class="line">	// 未开通‘允许通知&#x27;权限，则弹窗提醒开通，并点击确认后，跳转到系统设置页面进行设置  </span><br><span class="line">	if (!areNotificationsEnabled) &#123;</span><br><span class="line">		uni.showModal(&#123;</span><br><span class="line">			title: &#x27;通知权限开启提醒&#x27;,</span><br><span class="line">			content: &#x27;您还没有开启通知权限，无法接受到消息通知，请前往设置！&#x27;,</span><br><span class="line">			showCancel: false,</span><br><span class="line">			confirmText: &#x27;去设置&#x27;,</span><br><span class="line">			success: function(res) &#123;</span><br><span class="line">				if (res.confirm) &#123;</span><br><span class="line">					let Intent = plus.android.importClass(&#x27;android.content.Intent&#x27;);</span><br><span class="line">					let Build = plus.android.importClass(&quot;android.os.Build&quot;);</span><br><span class="line">					//android 8.0引导  </span><br><span class="line">					if (Build.VERSION.SDK_INT &gt;= 26) &#123;</span><br><span class="line">						let intent = new Intent(&#x27;android.settings.APP_NOTIFICATION_SETTINGS&#x27;);</span><br><span class="line">						intent.putExtra(&#x27;android.provider.extra.APP_PACKAGE&#x27;, pkName);</span><br><span class="line">					&#125; else if (Build.VERSION.SDK_INT &gt;= 21) &#123; //android 5.0-7.0  </span><br><span class="line">						let intent = new Intent(&#x27;android.settings.APP_NOTIFICATION_SETTINGS&#x27;);</span><br><span class="line">						intent.putExtra(&quot;app_package&quot;, pkName);</span><br><span class="line">						intent.putExtra(&quot;app_uid&quot;, uid);</span><br><span class="line">					&#125; else &#123; //(&lt;21)其他--跳转到该应用管理的详情页  </span><br><span class="line">						intent.setAction(Settings.ACTION_APPLICATION_DETAILS_SETTINGS);</span><br><span class="line">						let uri = Uri.fromParts(&quot;package&quot;, mainActivity.getPackageName(), null);</span><br><span class="line">						intent.setData(uri);</span><br><span class="line">					&#125;</span><br><span class="line">					// 跳转到该应用的系统通知设置页  </span><br><span class="line">					main.startActivity(intent);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="实现本地消息的推送"><a href="#实现本地消息的推送" class="headerlink" title="实现本地消息的推送"></a>实现本地消息的推送</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">let content = &quot;您有一条新的消息~&quot;;</span><br><span class="line">let options = &#123;</span><br><span class="line">	&quot;cover&quot; : false,</span><br><span class="line">	&quot;when&quot; : new Date(),</span><br><span class="line">	&#x27;title&#x27; : &quot;通知消息&quot;</span><br><span class="line">&#125;;</span><br><span class="line">let body = &#123;</span><br><span class="line">	&#x27;id&#x27; : &#x27;id&#x27;,</span><br><span class="line">	&#x27;key&#x27;: &quot;key&quot;</span><br><span class="line">&#125;</span><br><span class="line">let payload = JSON.stringify(body);</span><br><span class="line">plus.push.createMessage(content, payload, options);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>各项参数说明：<br><code>content</code>: ( String 类型) 必选，消息显示的内容，在系统通知中心中显示的文本内容。<br><code>payload</code>: ( String 类型 ) 可选，消息承载的数据，可根据业务逻辑自定义数据格式。<br><code>option</code>: ( MessageOptions ) 可选 创建消息的额外参数，参考MessageOptions。<br><code>MessageOptions</code>：JSON对象，获客户端创建本地消息的参数：<br>    ① title: (String 类型 )推送消息的标题。<br>    ② sound: (String 类型 )推送消息的提示音，显示消息时的播放的提示音，可取值：<br>        “system”-表示使用系统通知提示音； “none”-表示不使用提示音； 默认值为“system”。<br>    ③ cover: (Boolean 类型)是否覆盖上一次提示的消息。<br>        可取值true或false，true为覆盖，false不覆盖<br>    ④ when: (Date 类型 )消息上显示的提示时间。<br>    ⑤ delay: (Number 类型)提示消息延迟显示的时间。<br>        当设备接收到推送消息后，可不立即显示，而是延迟一段时间显示，延迟时间单位为s，默认为0s，立即显示。</p>
<h2 id="其他方法"><a href="#其他方法" class="headerlink" title="其他方法"></a>其他方法</h2><h3 id="获取所有信息"><a href="#获取所有信息" class="headerlink" title="获取所有信息"></a>获取所有信息</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">getAllMessage()&#123;</span><br><span class="line"> 	return plus.push.getAllMessage();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="获取客户端标识"><a href="#获取客户端标识" class="headerlink" title="获取客户端标识"></a>获取客户端标识</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">plus.push.getClientInfo(); </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="捕获点击的通知栏消息内容"><a href="#捕获点击的通知栏消息内容" class="headerlink" title="捕获点击的通知栏消息内容"></a>捕获点击的通知栏消息内容</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">plus.push.addEventListener( &quot;click&quot;, function(msg)&#123;</span><br><span class="line">	console.log( &quot;您点击了: &quot; + JSON.stringify(msg) );</span><br><span class="line">	// TODO...</span><br><span class="line">&#125;, false); </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="删除指定的通知栏消息"><a href="#删除指定的通知栏消息" class="headerlink" title="删除指定的通知栏消息"></a>删除指定的通知栏消息</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">plus.push.remove( message ); </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>参数：message: ( PushMessage ) 必填,要删除的消息对象，可通过getAllMessage()方法来获取消息。</p>
<h3 id="清空所有的通知栏消息"><a href="#清空所有的通知栏消息" class="headerlink" title="清空所有的通知栏消息"></a>清空所有的通知栏消息</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">plus.push.clear(); </span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>新的知识又增加了~</p>
<p>感谢阅读。</p>
<p>么么哒~~</p>
]]></content>
      <categories>
        <category>知识点</category>
        <category>笔记</category>
      </categories>
      <tags>
        <tag>知识点</tag>
        <tag>Android</tag>
        <tag>uniapp</tag>
      </tags>
  </entry>
  <entry>
    <title>使用vercel和github免费实现serverless api接口服务部署</title>
    <url>/2023/07/24/github_api/</url>
    <content><![CDATA[<h1 id="vercel"><a href="#vercel" class="headerlink" title="vercel"></a>vercel</h1><h2 id="简单介绍一下vercel"><a href="#简单介绍一下vercel" class="headerlink" title="简单介绍一下vercel"></a>简单介绍一下vercel</h2><p>vercel和github Pages一样，也是一个免费的托管平台，同类的平台还有Netlify，提供CDN加速。</p>
<p>但是在相比之下，vercel在国内的访问速度更快，可以托管动态网站，并且提供Production环境和development环境。</p>
<p>支持持续集成，一次push就会自动化构建发布，发布在development环境，都会生成不一样的链接可供预览。</p>
<p>自动配置https，不用自己去FreeSSL申请证书，更是省去了一大堆证书的配置，可以绑定自定义域名。</p>
<h2 id="注册vercel"><a href="#注册vercel" class="headerlink" title="注册vercel"></a>注册vercel</h2><p>打开vercel主页 <a href="https://vercel.com/login">https://vercel.com/login</a></p>
<p><img src="/img/vercel/01.png" alt="注册vercel"></p>
<span id="more"></span>


<p>使用GitHub账号去登录关联vercel，后续部署在github的代码就可以自动提交到vercel，自动触发部署。</p>
<h2 id="同步github项目和部署"><a href="#同步github项目和部署" class="headerlink" title="同步github项目和部署"></a>同步github项目和部署</h2><p>新建vercel项目</p>
<p><img src="/img/vercel/02.png" alt="新建vercel项目02"></p>
<p>如何点击绑定github仓库，会自动读取github的所有仓库，选择你要自动部署的仓库，点击Import即可导入，一路点击Deploy即可。</p>
<p><img src="/img/vercel/03.png" alt="新建vercel项目03"></p>
<p>等个几分钟自动部署完毕之后，就可以点击Visit访问部署的网站了，vercel还提供了多个开发预览域名和公开域名。</p>
<p><img src="/img/vercel/04.png" alt="新建vercel项目04"></p>
<p>你也可以绑定自定义域名：</p>
<p><img src="/img/vercel/05.png" alt="新建vercel项目05"></p>
<p>点击vercel项目的Setting设置栏目的Domains选项，在输入框输入你的域名，如何点击Add添加即可，最后把域名用CNAME方式解析到vercel指定的DNS地址即可完成自定义域名的绑定。</p>
<h1 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h1><h2 id="添加vercel-json"><a href="#添加vercel-json" class="headerlink" title="添加vercel.json"></a>添加vercel.json</h2><p>要实现可以访问执行php，需要在项目的根目录添加一个vercel.json文件。</p>
<p>大致格式为：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;functions&quot;: &#123;</span><br><span class="line">    &quot;api/index.php&quot;: &#123; &quot;runtime&quot;: &quot;vercel-php@0.5.2&quot; &#125;,</span><br><span class="line">    &quot;api/api.php&quot;: &#123; &quot;runtime&quot;: &quot;vercel-php@0.5.2&quot; &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;routes&quot;: [</span><br><span class="line">	  &#123; &quot;src&quot;: &quot;/&quot;, &quot;dest&quot;: &quot;/api/index.php&quot; &#125;,</span><br><span class="line">	  &#123; &quot;src&quot;: &quot;/index.php&quot;, &quot;dest&quot;: &quot;/api/index.php&quot; &#125;,</span><br><span class="line">	  &#123; &quot;src&quot;: &quot;/api.php&quot;, &quot;dest&quot;: &quot;/api/api.php&quot; &#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以使用正则表达式，更多配置参数可以在vercel的官网档案中查找，地址为 <a href="https://vercel.com/docs">https://vercel.com/docs</a></p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>新的知识又增加了~</p>
<p>感谢阅读。</p>
<p>么么哒~~</p>
]]></content>
      <categories>
        <category>知识点</category>
        <category>笔记</category>
      </categories>
      <tags>
        <tag>vercel</tag>
        <tag>github</tag>
        <tag>api</tag>
      </tags>
  </entry>
  <entry>
    <title>Unity一些常用的小知识点笔记，WebGL部署报Unable to parse Build解决笔记</title>
    <url>/2023/03/28/unity_note/</url>
    <content><![CDATA[<h1 id="Unity知识点一"><a href="#Unity知识点一" class="headerlink" title="Unity知识点一"></a>Unity知识点一</h1><h2 id="Unity打包WebGL报Unable-to-parse-Build"><a href="#Unity打包WebGL报Unable-to-parse-Build" class="headerlink" title="Unity打包WebGL报Unable to parse Build"></a>Unity打包WebGL报Unable to parse Build</h2><p>错误详情示例：</p>
<p>Unable to parse Build/*.framework.js.gz! This can happen if build compression was enabled but web server hosting the content was misconfigured to not serve the file with HTTP Response Header “Content-Encoding: gzip” present. Check browser Console and Devtools Network tab to debug.</p>
<p>图示：</p>
<p><img src="/img/unityNote/error.png" alt="unityError"></p>
<h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><span id="more"></span>

<p>在Unity的WebGL创建时的PlayerSettings中，拉到最下面展开Publishing settings选项卡，把Decompression Fallback 选项勾上即可。</p>
<p>图示：</p>
<p><img src="/img/unityNote/setting.png" alt="unitysetting"></p>
<h2 id="原因和原理"><a href="#原因和原理" class="headerlink" title="原因和原理"></a>原因和原理</h2><p>关于Decompression Fallback的unity官方的解释：</p>
<p><img src="/img/unityNote/tip.png" alt="unityTip"></p>
<p>参考翻译：在加载程序中包括生成文件的解压缩回退代码。如果无法根据选定的压缩方法配置服务器响应标头，请使用此选项。</p>
<h1 id="Unity知识点二"><a href="#Unity知识点二" class="headerlink" title="Unity知识点二"></a>Unity知识点二</h1><h2 id="一些常用的小知识"><a href="#一些常用的小知识" class="headerlink" title="一些常用的小知识"></a>一些常用的小知识</h2><h3 id="随机数生成"><a href="#随机数生成" class="headerlink" title="随机数生成"></a>随机数生成</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">Random.Range(0, 10); //随机生成0到10之间的整数。不包含10</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="在指定位置生成物体-小怪-道具等"><a href="#在指定位置生成物体-小怪-道具等" class="headerlink" title="在指定位置生成物体/小怪/道具等"></a>在指定位置生成物体/小怪/道具等</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">Instantiate&lt;GameObject&gt;(obj, position, Quaternion.identity);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>obj : 要新建物体/小怪/道具的GameObject</p>
<p>position：生成的位置</p>
<h3 id="2D角色转向"><a href="#2D角色转向" class="headerlink" title="2D角色转向"></a>2D角色转向</h3><p> 利用SpriteRenderer组件下的flipX属性</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">GetComponent&lt;SpriteRenderer&gt;().flipX = true;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>或使用transform的localScale属性</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">transform.localScale = new Vector3(-1, 1, 1);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="角色从一个点移动到另一点"><a href="#角色从一个点移动到另一点" class="headerlink" title="角色从一个点移动到另一点"></a>角色从一个点移动到另一点</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">transform.position = Vector3.MoveTowards(startPosition, endPosition, Time.deltaTime * speed); </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="计算两个点的距离"><a href="#计算两个点的距离" class="headerlink" title="计算两个点的距离"></a>计算两个点的距离</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">float dis = Vector3.Distance(startPosition, endPosition);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="查找物体和子物体"><a href="#查找物体和子物体" class="headerlink" title="查找物体和子物体"></a>查找物体和子物体</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">//查找物体方法</span><br><span class="line">GameObject go = GameObject.Find(&quot;Cube&quot;);</span><br><span class="line"></span><br><span class="line">//查找子物体，并且将得到的物体转换成gameobject</span><br><span class="line">GameObject objname = go.transform.FindChild(&quot;Sphere/Cylinder/Plane&quot;).gameObject;</span><br><span class="line">Debug.Log(&quot;得到最终子物体的名字是：&quot; + objname.name);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="重新加载当前场景"><a href="#重新加载当前场景" class="headerlink" title="重新加载当前场景"></a>重新加载当前场景</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">SceneManager.LoadScene(SceneManager.GetActiveScene().name);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="加载下一个场景"><a href="#加载下一个场景" class="headerlink" title="加载下一个场景"></a>加载下一个场景</h3><p>需要先在构建项目前，在设置中把所有的场景一次拖入列表中，从上到下顺序排列。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">SceneManager.LoadScene(SceneManager.GetActiveScene().buildIndex + 1);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>新的知识又又又增加了~</p>
<p>感谢阅读。</p>
<p>么么哒~~</p>
]]></content>
      <categories>
        <category>知识点</category>
        <category>笔记</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>WebGL</tag>
      </tags>
  </entry>
  <entry>
    <title>修改JS数组中一个元素的值，其它元素也会跟着变化</title>
    <url>/2023/03/13/js-array/</url>
    <content><![CDATA[<h1 id="js的神奇"><a href="#js的神奇" class="headerlink" title="js的神奇"></a>js的神奇</h1><h2 id="知识点问题复现"><a href="#知识点问题复现" class="headerlink" title="知识点问题复现"></a>知识点问题复现</h2><p>今天在码着代码调试的时候，根据条件判断将一个数组的一个元素值进行增或者减的操作，结果发现，数组中的其它元素也都跟着变了。</p>
<p>第一次碰见这种情况，检查了好几遍代码也没感觉哪里有写错，有点一头雾水，甚至写了各种小demo调试。</p>
<p>最后发现，是关于js的堆与栈问题…</p>
<p>示例代码：</p>
<span id="more"></span>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">var d = [</span><br><span class="line">	&#123;</span><br><span class="line">			a: 1</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">			a: 2</span><br><span class="line">	&#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">d[2].a = 100;</span><br><span class="line">console.log(d);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>按照我们通常的认知里，上述代码执行的结果应该是是：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">[&#123;a:1&#125;,&#123;a:100&#125;]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>而实际上的执行结果却是：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">[&#123;a:100&#125;,&#123;a:100&#125;]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>很奇怪吧~</p>
<h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>先把数组转换成字符串，再转换成对象，在进行数据修改，最后再赋值回去。</p>
<p>代码示例：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">var d = [</span><br><span class="line">	&#123;</span><br><span class="line">			a: 1</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">			a: 2</span><br><span class="line">	&#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">var tmp = JSON.parse(JSON.stringify(d));</span><br><span class="line">tmp[2].a = 100;</span><br><span class="line">d = tmp;</span><br><span class="line">console.log(d);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="原因和原理"><a href="#原因和原理" class="headerlink" title="原因和原理"></a>原因和原理</h2><p>js中的数组是引用类型，数组变量存储在栈，元素数据存储在堆中，将数组赋值不同的对象，所以的赋值对象都指向堆同一个数据，所以改变其中一个数组中的元素，别的数组元素也会改变。</p>
<p>把数组转换成字符串，再转换成对象，这样会新分配一块内存，就不会指向同一个堆中的数据了。</p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>新的知识又增加了~</p>
<p>感谢阅读。</p>
<p>么么哒~~</p>
]]></content>
      <categories>
        <category>知识点</category>
        <category>笔记</category>
      </categories>
      <tags>
        <tag>JScript</tag>
        <tag>大前端</tag>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>微信小程序的审核没有统一标准吗？真的太奇葩了...</title>
    <url>/2023/02/28/wx-mini/</url>
    <content><![CDATA[<h1 id="审核没有统一的标准"><a href="#审核没有统一的标准" class="headerlink" title="审核没有统一的标准"></a>审核没有统一的标准</h1><h2 id="审核规则"><a href="#审核规则" class="headerlink" title="审核规则"></a>审核规则</h2><p>微信小程序的审核机制，虽然写了超级多的规范，也把个人和企业能够上线的类目细分出了很多</p>
<p>但是审核人员貌似每个都不一样</p>
<p>有时候一样的代码，你这次没有做什么修改，就改个css样式，这次去提审可能就过不了</p>
<span id="more"></span>

<p>有人说 “可能是你上次提审的版本，审核人员没有审到违规的内容，这次审到了”</p>
<p>基本上很大部分开发者都接受了这个理由。</p>
<p>还有一个理由说的事：可能你这次提审的时候平台规则改版了</p>
<h2 id="依旧奇怪的现象"><a href="#依旧奇怪的现象" class="headerlink" title="依旧奇怪的现象"></a>依旧奇怪的现象</h2><p>虽然上面说的两个理由都很有道理，但是还是有这种现象：</p>
<p>同一套代码，多个账号同一天提交，偏偏就有那么一个或两个审核打回说你不通过得</p>
<p>这几就很充分说明一个事情，审核真的很看心情（起码占了狠大部分）。</p>
<p>如果你的账号是个人类型的账号，很大部分都被以</p>
<p> <code>个人资质未开放的类目</code></p>
<p>原因打回，希望你用认证为企业资质的账号提交。</p>
<p>我很纳闷，一个给游戏橘角色投票的页面，也会被打回，说是 </p>
<p> <code>属于资讯信息类目，个人资质未开放的类目，请整改</code></p>
<p>这是以本地自搭形式的投票，并非读取的网络资源或信息进行展示，也能规范为“资讯信息”类目</p>
<p>之前我还记得，审核不通过是可以进行申诉的，今天遇到的打回通知完全没有了，莫不是给我禁了？</p>
<p>反正就挺无语的。</p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>今天被小程序审核打回四五次，整的有点晕，随便吐槽吐槽</p>
<p>感谢阅读。</p>
<p>么么哒~~</p>
]]></content>
      <categories>
        <category>吐槽</category>
        <category>随笔</category>
      </categories>
      <tags>
        <tag>随笔</tag>
        <tag>吐槽</tag>
        <tag>微信小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>避坑：小程序canvas绘制不显示，动态请求图片报Unhandled promise rejection错误解决</title>
    <url>/2023/02/22/wx-xcx-canvas/</url>
    <content><![CDATA[<h1 id="Unhandled-promise-rejection错误"><a href="#Unhandled-promise-rejection错误" class="headerlink" title="Unhandled promise rejection错误"></a>Unhandled promise rejection错误</h1><h2 id="报错详情"><a href="#报错详情" class="headerlink" title="报错详情"></a>报错详情</h2><p>使用网络图片地址请求时，后台数据有正常返回，但前端promise处理报错。</p>
<p>例如图片链接失效出现404时，一报错的时候，就不继续往下执行后面的代码</p>
<h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><span id="more"></span>

<p>request.js的封装请求是当后台请求的status码不为200时，将会reject错误信息出去</p>
<p>reject函数并不会走入promise的then进行回调中，而是走入了catch的回调中：</p>
<p><img src="/img/wxCanvas/02.png" alt="promise回调"></p>
<p>再看看请求时的调用情况：</p>
<p><img src="/img/wxCanvas/03.png" alt="promise回调"></p>
<p>可以看到，在使用请求时并未catch错误信息，那么当后台的数据返回的status不为200时，错误信息就无法捕获，自然控制台就报错了。</p>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p><img src="/img/wxCanvas/04.png" alt="promise回调"></p>
<p>加一个catch来捕捉错误信息即可完美解决。</p>
<h1 id="canvas绘制的图片不显示"><a href="#canvas绘制的图片不显示" class="headerlink" title="canvas绘制的图片不显示"></a>canvas绘制的图片不显示</h1><h2 id="问题详情"><a href="#问题详情" class="headerlink" title="问题详情"></a>问题详情</h2><p>例如在页面上使用的图片均为上传到服务器上的图片</p>
<p>然后使用绘制函数draw()将网络图片绘制到canvas容器里</p>
<p>打开真机调试发现canvas上的图片内容并不显示~</p>
<h2 id="原因-1"><a href="#原因-1" class="headerlink" title="原因"></a>原因</h2><p>绘制时获取图片路径为网络图片时，API为异步操作的，若不转为同步操作，会将图片绘制在draw()方法后，这样是不能使图片绘制在页面上的。</p>
<h2 id="解决方法-1"><a href="#解决方法-1" class="headerlink" title="解决方法"></a>解决方法</h2><p>利用promise将其转为同步操作，等图片载入完毕再绘制到canvas里。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">getImge(path) &#123;</span><br><span class="line">	//利用promise异步转同步</span><br><span class="line">	return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">		uni.getImageInfo(&#123;</span><br><span class="line">			src: path,</span><br><span class="line">			success: function(res) &#123;</span><br><span class="line">				resolve(res)</span><br><span class="line">			&#125;,</span><br><span class="line">			fail: function(res) &#123;</span><br><span class="line">				reject(res)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">async cans() &#123;</span><br><span class="line">	// 绘制画布大小，填充颜色</span><br><span class="line">	this.ctx.setFillStyle(&quot;#ffffff&quot;)</span><br><span class="line">	this.ctx.fillRect(0, 0, this.windowW * this.pixelRatio, this.windowH * this.pixelRatio)</span><br><span class="line">	this.ctx.setTransform(this.pixelRatio, 0, 0, this.pixelRatio, 0, 0)</span><br><span class="line">	let backImg = this.imgUrlPrefix + &#x27;biankuang.png&#x27; //大边框</span><br><span class="line">	let that = this</span><br><span class="line">	await this.getImge(backImg).then(res =&gt; &#123;</span><br><span class="line">		this.ctx.drawImage(res.path, 15 * that.rpx, 15 * that.rpx, 345 * that.rpx, 571 * that.rpx)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="弊端缺点"><a href="#弊端缺点" class="headerlink" title="弊端缺点"></a>弊端缺点</h2><p>如果是需要绘制多张图片，导致需要多次调用drawImage方法，再加上需要判断文字换行等操作的话，可能会造成内容绘制时间过长。</p>
<p>canvas用在小程序上问题很多，优化起来真的很不易（除非咱要的某些功能处理不得不使用这种方法，一般真的推荐使用），canvas官方提供的优化方法之一：** 离屏 **。</p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>感谢阅读。</p>
<p>么么哒~~</p>
]]></content>
      <categories>
        <category>知识点</category>
        <category>笔记</category>
        <category>vue</category>
      </categories>
      <tags>
        <tag>JScript</tag>
        <tag>vue</tag>
        <tag>微信小程序</tag>
        <tag>canvas</tag>
      </tags>
  </entry>
  <entry>
    <title>笔记：实现数组排列组合图片合成，做一个NFT生成器！</title>
    <url>/2022/02/14/android-nft/</url>
    <content><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>NFT是前两年火起来的，被大家称为是去中心化的非同质化代币，是具有唯一性的数字资产加密货币令牌，并且是可以买卖的！</p>
<p>这是一场资本家的狂欢泡沫还是致富风口？</p>
<p>咱不知道，就是单纯的最近想自己玩一玩，弄一套上架到NFT交易平台上去看看2333..</p>
<p>然后自己p好了素材，苦于找不到批量生成工具，找了一圈发现网络上有很多js和python的脚本。</p>
<p>但是我自己下载下来运行后发现，不是缺这个模块就是缺那个环境没有部署，更难受的是安装模块还不成功！</p>
<p>最后就自己在Android上去实现了</p>
<p>下面直接看怎么实现的：</p>
<h1 id="Android实现图片合成"><a href="#Android实现图片合成" class="headerlink" title="Android实现图片合成"></a>Android实现图片合成</h1><span id="more"></span>

<h2 id="数组排列组合"><a href="#数组排列组合" class="headerlink" title="数组排列组合"></a>数组排列组合</h2><p>先把每个素材保存到单独的数组里，然后把全部数组合并为一个数组：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">allList.add(arr_1);</span><br><span class="line">allList.add(arr_2);</span><br><span class="line">allList.add(arr_3);</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>排列组合：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 算法，非递归计算所有组合</span><br><span class="line"> * @param inputList 所有数组的列表</span><br><span class="line"> * allList_new：排列组合后的新数组</span><br><span class="line"> * </span><br><span class="line"> * */</span><br><span class="line">public void def_calculateCombination(List&lt;List&lt;String&gt;&gt; inputList) &#123;</span><br><span class="line">    List&lt;Integer&gt; combination = new ArrayList&lt;Integer&gt;();</span><br><span class="line">    allList_new.clear();</span><br><span class="line">    int n=inputList.size();</span><br><span class="line">    for (int i = 0; i &lt; n; i++) &#123;</span><br><span class="line">        combination.add(0);</span><br><span class="line">    &#125;</span><br><span class="line">    int i=0;</span><br><span class="line">    boolean isContinue=false;</span><br><span class="line">    do&#123;</span><br><span class="line">        List&lt;String&gt; List = new ArrayList&lt;&gt;();</span><br><span class="line">        //打印一次循环生成的组合</span><br><span class="line">        for (int j = 0; j &lt; n; j++) &#123;</span><br><span class="line">            Log.e(&quot;=========&gt;&gt;&gt;&quot;, &quot;&quot; + inputList.get(j).get(combination.get(j)));</span><br><span class="line">            List.add(&quot;&quot; + inputList.get(j).get(combination.get(j)));</span><br><span class="line">        &#125;</span><br><span class="line">        Log.e(&quot;=========&quot;, &quot;====下一组====&quot;);</span><br><span class="line">        allList_new.add(List);</span><br><span class="line"></span><br><span class="line">        i++;</span><br><span class="line">        combination.set(n - 1, i);</span><br><span class="line">        for (int j = n - 1; j &gt;= 0; j--) &#123;</span><br><span class="line">            if (combination.get(j) &gt;= inputList.get(j).size()) &#123;</span><br><span class="line">                combination.set(j, 0);</span><br><span class="line">                i = 0;</span><br><span class="line">                if (j - 1 &gt;= 0) &#123;</span><br><span class="line">                    combination.set(j - 1, combination.get(j - 1) + 1);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        isContinue = false;</span><br><span class="line">        for (Integer integer : combination) &#123;</span><br><span class="line">            if (integer != 0) &#123;</span><br><span class="line">                isContinue = true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;while (isContinue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="图片合成"><a href="#图片合成" class="headerlink" title="图片合成"></a>图片合成</h2><p>图片合成，返回合成后的新图片Bitmap：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line">    * </span><br><span class="line">    * @param background 背景图</span><br><span class="line">    * @param body 前景图</span><br><span class="line">    * @return</span><br><span class="line">    */</span><br><span class="line">   public Bitmap def_combineBitmap(Bitmap background, Bitmap body) &#123;</span><br><span class="line">       if (background == null) &#123;</span><br><span class="line">           return null;</span><br><span class="line">       &#125;</span><br><span class="line">       int bgWidth = background.getWidth();</span><br><span class="line">       int bgHeight = background.getHeight();</span><br><span class="line">       /*</span><br><span class="line">        int fgWidth = body.getWidth();</span><br><span class="line">        int fgHeight = body.getHeight();</span><br><span class="line">        */</span><br><span class="line">       Bitmap newmap = Bitmap.createBitmap(bgWidth, bgHeight, Bitmap.Config.ARGB_8888);</span><br><span class="line">       Canvas canvas = new Canvas(newmap);</span><br><span class="line">	//添加每个素材图片到画布</span><br><span class="line">       if (background != null) &#123;</span><br><span class="line">           canvas.drawBitmap(background, 0, 0, null);//参数2和3是设置贴图的xy坐标位置</span><br><span class="line">       &#125;</span><br><span class="line">       if (body != null) &#123;</span><br><span class="line">           canvas.drawBitmap(body, 0, 0, null);</span><br><span class="line">       &#125;</span><br><span class="line">	//更多素材可以继续在后面添加</span><br><span class="line">       canvas.save();</span><br><span class="line">       canvas.restore();</span><br><span class="line">       return newmap;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="保存图片到手机"><a href="#保存图片到手机" class="headerlink" title="保存图片到手机"></a>保存图片到手机</h2><p>保存图片到sd卡指定目录：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">public void def_savePic(Bitmap btImage) &#123;</span><br><span class="line">       if (Environment.getExternalStorageState().equals(Environment.MEDIA_MOUNTED)) &#123;    </span><br><span class="line">           FileOutputStream out = null;</span><br><span class="line">           // 获取SDCard指定目录下</span><br><span class="line">           String sdCardDir = Environment.getExternalStorageDirectory() + &quot;/NFT/&quot;;</span><br><span class="line">           File dirFile  = new File(sdCardDir);  //目录转化成文件夹</span><br><span class="line">           if (!dirFile .exists()) &#123;  //如果不存在，那就建立这个文件夹</span><br><span class="line">               dirFile .mkdirs();</span><br><span class="line">           &#125;  </span><br><span class="line">           File file = new File(sdCardDir, &quot;NFT&quot; + System.currentTimeMillis() + &quot;.png&quot;);// 在SDcard的目录下创建图片文，以当前时间为其命名</span><br><span class="line">           try &#123;</span><br><span class="line">               out = new FileOutputStream(file);</span><br><span class="line">               btImage.compress(Bitmap.CompressFormat.PNG, 100, out);</span><br><span class="line">               //System.out.println(&quot;___保存到_sd_指定目录文件夹___&quot;);</span><br><span class="line">           &#125; catch (FileNotFoundException e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">           &#125;</span><br><span class="line">           try &#123;</span><br><span class="line">               out.flush();</span><br><span class="line">               out.close();</span><br><span class="line">           &#125; catch (IOException e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">           &#125;</span><br><span class="line">           //Toast.makeText(MainActivity.this, &quot;保存已经至&quot; + sdCardDir + &quot;目录文件夹下&quot;, Toast.LENGTH_SHORT).show();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>保存图片需要SD卡写入的权限，别忘了在 <code>AndroidManifest.xml</code> 中添加！</p>
<h2 id="附加：系统文件管理器选择文件素材并返回路径Uri"><a href="#附加：系统文件管理器选择文件素材并返回路径Uri" class="headerlink" title="附加：系统文件管理器选择文件素材并返回路径Uri"></a>附加：系统文件管理器选择文件素材并返回路径Uri</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">//存放需要过滤的类型的类</span><br><span class="line">public class MimeType &#123;</span><br><span class="line">    /*</span><br><span class="line">     public static final String DOC = &quot;application/msword&quot;;</span><br><span class="line">     public static final String DOCX = &quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;;</span><br><span class="line">     public static final String XLS = &quot;application/vnd.ms-excel&quot;;</span><br><span class="line">     public static final String XLSX = &quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;;</span><br><span class="line">     public static final String PPT = &quot;application/vnd.ms-powerpoint&quot;;</span><br><span class="line">     public static final String PPTX = &quot;application/vnd.openxmlformats-officedocument.presentationml.presentation&quot;;</span><br><span class="line">     public static final String PDF = &quot;application/pdf&quot;;</span><br><span class="line">     public static final String PNG = &quot;image/png&quot;;</span><br><span class="line">     */</span><br><span class="line">    public static final String JPG = &quot;image/*&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//选择文件</span><br><span class="line">private void def_performFileSearch() &#123;</span><br><span class="line">    Intent intent = new Intent(Intent.ACTION_OPEN_DOCUMENT);</span><br><span class="line">    intent.addCategory(Intent.CATEGORY_OPENABLE);</span><br><span class="line">    //允许多选 长按多选</span><br><span class="line">    intent.putExtra(Intent.EXTRA_ALLOW_MULTIPLE, true);</span><br><span class="line">    //不限制选取类型</span><br><span class="line">    intent.setType(&quot;*/*&quot;);</span><br><span class="line"></span><br><span class="line">    //如果想给选择器添加过滤的文件类型，只需要添加如下代码就可以了</span><br><span class="line">    String[] mimeTypes = &#123;</span><br><span class="line">        /*</span><br><span class="line">         MimeType.DOC, </span><br><span class="line">         MimeType.DOCX, </span><br><span class="line">         MimeType.PDF, </span><br><span class="line">         MimeType.PPT, </span><br><span class="line">         MimeType.PPTX, </span><br><span class="line">         MimeType.XLS, </span><br><span class="line">         MimeType.XLSX,</span><br><span class="line">         MimeType.PNG,*/</span><br><span class="line">         MimeType.JPG</span><br><span class="line">    &#125;;</span><br><span class="line">    intent.putExtra(Intent.EXTRA_MIME_TYPES, mimeTypes);</span><br><span class="line"></span><br><span class="line">    startActivityForResult(intent, 1); //第二个参数必须是大于0的，才会响应onActivityResult()回调函数</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//接收选择文件后的返回值</span><br><span class="line">@Override</span><br><span class="line">protected void onActivityResult(int requestCode, int resultCode, Intent data) &#123;</span><br><span class="line">    super.onActivityResult(requestCode, resultCode, data);</span><br><span class="line">    switch (requestCode) &#123;</span><br><span class="line">        case 1:</span><br><span class="line">            if (resultCode == Activity.RESULT_OK &amp;&amp; data != null) &#123;</span><br><span class="line">                //单选选了一个文件后返回</span><br><span class="line">                if (data.getData() != null) &#123;</span><br><span class="line">                    String uri = def_handleSingleDocument(data);</span><br><span class="line">                    //数据uri</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    //多选后返回</span><br><span class="line">                    ClipData clipData = data.getClipData();</span><br><span class="line">                    if (clipData != null) &#123;</span><br><span class="line">                        Uri[] uris = new Uri[clipData.getItemCount()];</span><br><span class="line">                        for (int i = 0; i &lt; clipData.getItemCount(); i++) &#123;</span><br><span class="line">                            uris[i] = clipData.getItemAt(i).getUri();</span><br><span class="line">                        &#125;</span><br><span class="line">			//数据uris</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//将uri转换为我们需要的path,多选类似</span><br><span class="line">private String def_handleSingleDocument(Intent data) &#123;</span><br><span class="line">    Uri uri = data.getData();</span><br><span class="line">    String filePath = null;</span><br><span class="line">    try &#123;</span><br><span class="line">        filePath = MyFileUtils.getPath(this, uri);</span><br><span class="line">    &#125; catch (Exception e) &#123;&#125;</span><br><span class="line">    return filePath;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>基本上，通关上面这些关键函数，就完全可以实现自己做一个“NFT生成器”App了。</p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>（PS：NFT还会跟当年的比特币那样火起来吗，还是泡沫破灭呢，值得深思emmm…）</p>
<p>OK，今天就这样，感谢阅读。</p>
<p>么么哒~~</p>
]]></content>
      <categories>
        <category>知识点</category>
        <category>吐槽</category>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>图片合成</tag>
        <tag>排列组合</tag>
        <tag>NFT</tag>
      </tags>
  </entry>
  <entry>
    <title>Android实现帧动画动态设置播放时间间隔</title>
    <url>/2021/06/07/android-gif/</url>
    <content><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>前些天在弄一个娱乐小工具App，需要播放gif，但是找了一圈，基本上是使用第三方库的<code>com.felipecsl:gifimageview:2.2.0</code>，和Android帧动画的。</p>
<p>第三方库貌似自定义局限性很大，帧动画的话在xml中把播放时间给写死了，也不好控制。</p>
<p>自带的api只看到getDuration，但是没有setDuration，就离谱。</p>
<p>找了一圈发现是有方法自己去实现setDuration的。</p>
<p>下面直接看怎么实现的：</p>
<h1 id="帧动画实现控制播放时间-速度"><a href="#帧动画实现控制播放时间-速度" class="headerlink" title="帧动画实现控制播放时间/速度"></a>帧动画实现控制播放时间/速度</h1><span id="more"></span>

<h2 id="帧动画的实现"><a href="#帧动画的实现" class="headerlink" title="帧动画的实现"></a>帧动画的实现</h2><p>首先，把帧动画的每一帧图片放到项目的drawable文件夹里。</p>
<p>然后在代码中写成数组待用：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">int[] filesNames = &#123;</span><br><span class="line">	R.drawable.sb0,</span><br><span class="line">       R.drawable.sb1,</span><br><span class="line">       R.drawable.sb2,</span><br><span class="line">       ...</span><br><span class="line">       ...</span><br><span class="line">       R.drawable.sb42,</span><br><span class="line">       R.drawable.sb43</span><br><span class="line">   &#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>利用循环，把每一帧添加到动画中：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">MyAnimationDrawable _animaition = new MyAnimationDrawable();</span><br><span class="line">   Drawable frame;</span><br><span class="line">   Bitmap bmp;</span><br><span class="line">int n = filesNames.length;</span><br><span class="line">       for (int i = 0; i &lt; n; i++) &#123;</span><br><span class="line">           bmp = BitmapFactory.decodeResource(getResources(), filesNames[i]);</span><br><span class="line">           frame = new BitmapDrawable(getResources(), bmp);</span><br><span class="line">           _animaition.addFrame(frame, 100);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后把动画数组到控件里去：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">iv.setBackground(_animaition);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>以上就把帧动画实现了，下面开始实现帧动画时间/速度的自定义控制。</p>
<h2 id="帧动画时间-速度控制"><a href="#帧动画时间-速度控制" class="headerlink" title="帧动画时间/速度控制"></a>帧动画时间/速度控制</h2><p>控制帧动画的时间，函数重写：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">//控制帧动画的时间，函数重写</span><br><span class="line">public class MyAnimationDrawable extends AnimationDrawable &#123;</span><br><span class="line"></span><br><span class="line">    private volatile int duration;//its volatile because another thread will update its value</span><br><span class="line">    private int currentFrame;</span><br><span class="line"></span><br><span class="line">    public MyAnimationDrawable() &#123;</span><br><span class="line">        currentFrame = 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        int n = getNumberOfFrames();</span><br><span class="line">        currentFrame++;</span><br><span class="line">        if (currentFrame &gt;= n) &#123;</span><br><span class="line">            currentFrame = 0;</span><br><span class="line">        &#125;</span><br><span class="line">        selectDrawable(currentFrame);</span><br><span class="line">        scheduleSelf(this, SystemClock.uptimeMillis() + duration);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setDuration(int duration) &#123;</span><br><span class="line">        this.duration = duration;</span><br><span class="line">        //we have to do the following or the next frame will be displayed after the old duration</span><br><span class="line">        unscheduleSelf(this);</span><br><span class="line">        selectDrawable(currentFrame);</span><br><span class="line">        scheduleSelf(this, SystemClock.uptimeMillis()+duration);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后就可以调用上面实现的函数了：<code>_animaition.setDuration(speed);</code></p>
<p>speed为自定义时间/速度参数。</p>
<p>最后启动动画：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">//是否仅仅启动一次？</span><br><span class="line">   _animaition.setOneShot(false);</span><br><span class="line">   if (_animaition.isRunning()) &#123; //是否正在运行？</span><br><span class="line">       _animaition.stop(); //停止</span><br><span class="line">   &#125;</span><br><span class="line">   _animaition.start();//启动</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>以上就完成了实现Android的帧动画时间控制和速度自定义控制的部署。</p>
<h1 id="附加：音频播放速度控制和播放完毕监控"><a href="#附加：音频播放速度控制和播放完毕监控" class="headerlink" title="附加：音频播放速度控制和播放完毕监控"></a>附加：音频播放速度控制和播放完毕监控</h1><h2 id="音频播放速度控制"><a href="#音频播放速度控制" class="headerlink" title="音频播放速度控制"></a>音频播放速度控制</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">//设置播放速度</span><br><span class="line">   private boolean setPlaySpeed(MediaPlayer mediaPlayer, float speed) &#123;</span><br><span class="line">       if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) &#123;</span><br><span class="line">           try &#123;</span><br><span class="line">               PlaybackParams params = mediaPlayer.getPlaybackParams();</span><br><span class="line">               params.setSpeed(speed);</span><br><span class="line">               mediaPlayer.setPlaybackParams(params);</span><br><span class="line">               return true;</span><br><span class="line">           &#125; catch (Exception e) &#123;</span><br><span class="line">               String TAG = &quot;设置播放速度 -------- &gt;&gt;&gt;&quot;;</span><br><span class="line">               Log.e(TAG, &quot;setPlaySpeed: &quot;, e);</span><br><span class="line">               return false;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       return false;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="音频播放完毕监控"><a href="#音频播放完毕监控" class="headerlink" title="音频播放完毕监控"></a>音频播放完毕监控</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">Sound_doing.setOnCompletionListener(new MediaPlayer.OnCompletionListener() &#123;</span><br><span class="line">       @Override</span><br><span class="line">       public void onCompletion(MediaPlayer mp) &#123;</span><br><span class="line">           // 在播放完毕被回调</span><br><span class="line">		// Do something...</span><br><span class="line">       &#125;;</span><br><span class="line">   &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Sound_doing为创建的mediaplayer对象</p>
<p>如：<code>MediaPlayer.create(MainActivity.this, R.raw.sound_success);</code></p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>（PS：手机上用AIDE码Android，操作起来真的好费眼，还是电脑使用Android Studio方便啊。只不过AIDE方便，随时随地可以码，emmm…）</p>
<p>OK，今天就这样，感谢阅读。</p>
<p>么么哒~~</p>
]]></content>
      <categories>
        <category>知识点</category>
        <category>吐槽</category>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Duration</tag>
        <tag>帧动画</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo添加完GitTalk评论系统后报错以及解决办法</title>
    <url>/2020/12/23/GitTalk-Error/</url>
    <content><![CDATA[<p>这几天在折腾hexo，通过github搭了这么一个博客，然后就去申请使用了gittalk的评论。</p>
<p>第一次折腾这玩意儿，完全不知道报这些错误是为什么，一开始博客的页面一直报Error:Not found，如下：</p>
<span id="more"></span>

<p><img src="/img/gittalk/01.jpg" alt="直报Error:Not found"></p>
<p>在搜索引擎的帮助下，发现是gittalk中的信息填写错了，</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">name随便写；</span><br><span class="line"></span><br><span class="line">Homepage URL是你的仓库的名字，</span><br><span class="line"></span><br><span class="line">Authorization callback URL如果你指向了新的域名就填新的，比如说我指向了域名 hexo.hzv5.cn；否则也写仓库的名字就可以。</span><br></pre></td></tr></table></figure>

<p>这样之后这个错误解决了。</p>
<p>另外，有的时候有些朋友也会有这样的一种情况，就是没有报错，但是点击登录Github按钮会自动重定向跳转到首页，这种情况也是上面的一些设置没有设置好导致的，按照上面说的重新设置一下就行。</p>
<p>注意：如果github博客开启了force https功能，需要将OAuth Apps中的地址改为https。</p>
<p>但是，登录打开评论一看，又报了新的错误：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Error:Issues are disabled for this repo</span><br></pre></td></tr></table></figure>

<p><img src="/img/gittalk/02.jpg" alt="新的错误信息"></p>
<p>这个错误你只需要去项目的设置里，设置一下就行了，Settings-Features-把Issures打勾</p>
<p><img src="/img/gittalk/03.jpg" alt="解决"></p>
<p>这样一顿倒腾之后，博主的gittalk已经能正常使用了。</p>
<p>欢迎登录Github评论留言…</p>
]]></content>
      <categories>
        <category>知识点</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>GitTalk</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo依靠yilia主题实现添加相册目录</title>
    <url>/2020/12/22/yilia-photos/</url>
    <content><![CDATA[<p>这是<a href="http://litten.me/">Litten</a>相册的修改版，版权归原作者所有</p>
<h4 id="点此预览效果"><a href="#点此预览效果" class="headerlink" title="点此预览效果"></a><a href="https://hexo.hzv5.cn/photos/">点此预览效果</a></h4><h1 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h1><h2 id="本相册适用于hexo-yilia主题，移植到其他主题需要改动"><a href="#本相册适用于hexo-yilia主题，移植到其他主题需要改动" class="headerlink" title="本相册适用于hexo-yilia主题，移植到其他主题需要改动"></a>本相册适用于hexo-yilia主题，移植到其他主题需要改动</h2><h3 id="与原作者相比改动"><a href="#与原作者相比改动" class="headerlink" title="与原作者相比改动"></a>与原作者相比改动</h3><span id="more"></span>
<p>1.由原作者图片托管在instagram改为托管在本地</p>
<p>2.由原作者图片尺寸固定改为尺寸可以写入ins.json</p>
<p>3.去掉原作者type选项，只可以放图片而不能放视频，并且图片格式只支持jpg（如果需要支持更多格式对ins.js稍作修改即可）</p>
<p>4.link作为图片名</p>
<p>5.去掉ins.jsn中的src选项</p>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><p>1.将本项目所有文件保存到您hexo的source目录下的一个目录里</p>
<p>2.在本目录新建ins与minins文件夹，将原图片保存到ins文件夹下，图片略缩图保存在minins文件夹下，略缩图推荐尺寸:328x328</p>
<p>3.之后source目录树一般如下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">├── _posts</span><br><span class="line">├── photos</span><br><span class="line">|   ├── ins</span><br><span class="line">|   |   ├──pic1.jpg</span><br><span class="line">|   |   ├──pic2.jpg</span><br><span class="line">|   |   └──pic3.jpg</span><br><span class="line">|   ├── minins</span><br><span class="line">|   |   ├──pic1.min.jpg</span><br><span class="line">|   |   ├──pic2.min.jpg</span><br><span class="line">|   |   └──pic3.min.jpg</span><br><span class="line">|   ├── index.ejs</span><br><span class="line">|   ├── ins.css</span><br><span class="line">|   ├── ins.js</span><br><span class="line">|   └── ins.json</span><br><span class="line">└── CNAME</span><br></pre></td></tr></table></figure>

<p>4.如果原图名称为xxxx.jpg，则略缩图名称为xxxx.min.jpg</p>
<p>5.修改ins.json与您实际情况相匹配，其中图片名不需要写后缀，描述部分随意，图片尺寸格式为图片宽度x图片高度，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;date&quot;: &quot;2015-05&quot;,</span><br><span class="line">	&quot;arr&quot;: &#123;</span><br><span class="line">		&quot;year&quot;: 2015,</span><br><span class="line">		&quot;month&quot;: 5,</span><br><span class="line">		&quot;link&quot;: [&quot;201505251818&quot;],</span><br><span class="line">		&quot;text&quot;: [&quot;这是一张在2015年五月拍摄的照片&quot;],</span><br><span class="line">		&quot;sizes&quot;: [&quot;1000x1000&quot;]</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>照片太多可以自己写程序简化操作</p>
<p>略缩图可下载这个软件批量生成</p>
<p>链接: <a href="https://pan.baidu.com/s/1slULnUd">https://pan.baidu.com/s/1slULnUd</a> 密码: 54je</p>
]]></content>
      <categories>
        <category>知识点</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>yilia</tag>
        <tag>相册</tag>
      </tags>
  </entry>
  <entry>
    <title>使用hexo+github搭建免费个人博客详细教程</title>
    <url>/2020/12/22/hexo-github/</url>
    <content><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>使用github pages服务搭建博客的好处有：</p>
<ol>
<li>全是静态文件，访问速度快；</li>
<li>免费方便，不用花一分钱就可以搭建一个自由的个人博客，不需要服务器不需要后台；</li>
<li>可以随意绑定自己的域名，不仔细看的话根本看不出来你的网站是基于github的；</li>
<li>数据绝对安全，基于github的版本管理，想恢复到哪个历史版本都行；</li>
<li>博客内容可以轻松打包、转移、发布到其它平台；</li>
<li>等等；<span id="more"></span>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2></li>
</ol>
<p>在开始一切之前，你必须已经：</p>
<ul>
<li>有一个github账号，没有的话去注册一个；</li>
<li>安装了node.js、npm，并了解相关基础知识；</li>
<li>安装了git for windows（或者其它git客户端）</li>
</ul>
<p>本文所使用的环境：</p>
<ul>
<li>Windows8.1</li>
<li><a href="mailto:node.js@5.5.0">node.js@5.5.0</a></li>
<li><a href="mailto:git@1.9.2">git@1.9.2</a></li>
<li><a href="mailto:hexo@3.2.2">hexo@3.2.2</a></li>
</ul>
<h1 id="搭建github博客"><a href="#搭建github博客" class="headerlink" title="搭建github博客"></a>搭建github博客</h1><h2 id="创建仓库"><a href="#创建仓库" class="headerlink" title="创建仓库"></a>创建仓库</h2><p>新建一个名为<code>你的用户名.github.io</code>的仓库，比如说，如果你的github用户名是test，那么你就新建<code>test.github.io</code>的仓库（必须是你的用户名，其它名称无效），将来你的网站访问地址就是 <a href="http://test.github.io">http://test.github.io</a> 了，是不是很方便？</p>
<p>由此可见，每一个github账户最多只能创建一个这样可以直接使用域名访问的仓库。</p>
<p>几个注意的地方：</p>
<ol>
<li>注册的邮箱一定要验证，否则不会成功；</li>
<li>仓库名字必须是：<code>username.github.io</code>，其中<code>username</code>是你的用户名；</li>
<li>仓库创建成功不会立即生效，需要过一段时间，大概10-30分钟，或者更久，我的等了半个小时才生效；</li>
</ol>
<p>创建成功后，默认会在你这个仓库里生成一些示例页面，以后你的网站所有代码都是放在这个仓库里啦。</p>
<h2 id="绑定域名"><a href="#绑定域名" class="headerlink" title="绑定域名"></a>绑定域名</h2><p>当然，你不绑定域名肯定也是可以的，就用默认的 <code>xxx.github.io</code> 来访问，如果你想更个性一点，想拥有一个属于自己的域名，那也是OK的。</p>
<p>首先你要注册一个域名，域名注册以前总是推荐去<code>godaddy</code>，现在觉得其实国内的阿里云也挺不错的，价格也不贵，毕竟是大公司，放心！</p>
<p>绑定域名分2种情况：带www和不带www的。</p>
<p>域名配置最常见有2种方式，CNAME和A记录，CNAME填写域名，A记录填写IP，由于不带www方式只能采用A记录，所以必须先ping一下<code>你的用户名.github.io</code>的IP，然后到你的域名DNS设置页，将A记录指向你ping出来的IP，将CNAME指向<code>你的用户名.github.io</code>，这样可以保证无论是否添加www都可以访问，如下：</p>
<p><img src="http://image.liuxianan.com/201608/20160823_191336_238_8683.png" alt="解析域名"></p>
<p>然后到你的github项目根目录新建一个名为CNAME的文件（无后缀），里面填写你的域名，加不加www看你自己喜好，因为经测试：</p>
<ul>
<li>如果你填写的是没有www的，比如 mygit.me，那么无论是访问 <a href="http://www.mygit.me">http://www.mygit.me</a> 还是 <a href="http://mygit.me">http://mygit.me</a> ，都会自动跳转到 <a href="http://mygit.me">http://mygit.me</a></li>
<li>如果你填写的是带www的，比如 <a href="http://www.mygit.me">www.mygit.me</a> ，那么无论是访问 <a href="http://www.mygit.me">http://www.mygit.me</a> 还是 <a href="http://mygit.me">http://mygit.me</a> ，都会自动跳转到 <a href="http://www.mygit.me">http://www.mygit.me</a></li>
<li>如果你填写的是其它子域名，比如 abc.mygit.me，那么访问 <a href="http://abc.mygit.me">http://abc.mygit.me</a> 没问题，但是访问 <a href="http://mygit.me">http://mygit.me</a> ，不会自动跳转到 <a href="http://abc.mygit.me">http://abc.mygit.me</a></li>
</ul>
<p>另外说一句，在你绑定了新域名之后，原来的<code>你的用户名.github.io</code>并没有失效，而是会自动跳转到你的新域名。</p>
<h1 id="配置SSH-key"><a href="#配置SSH-key" class="headerlink" title="配置SSH key"></a>配置SSH key</h1><p>为什么要配置这个呢？因为你提交代码肯定要拥有你的github权限才可以，但是直接使用用户名和密码太不安全了，所以我们使用ssh key来解决本地和服务器的连接问题。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ cd ~/. ssh #检查本机已存在的ssh密钥</span><br></pre></td></tr></table></figure>

<p>如果提示：No such file or directory 说明你是第一次使用git。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &#x27;邮件地址&#x27;</span><br></pre></td></tr></table></figure>

<p>然后连续3次回车，最终会生成一个文件在用户目录下，打开用户目录，找到<code>.ssh\id_rsa.pub</code>文件，记事本打开并复制里面的内容，打开你的github主页，进入个人设置 -&gt; SSH and GPG keys -&gt; New SSH key：</p>
<p><img src="http://image.liuxianan.com/201608/20160818_143914_495_9084.png" alt="SH key"></p>
<p>将刚复制的内容粘贴到key那里，title随便填，保存。</p>
<h2 id="测试是否成功"><a href="#测试是否成功" class="headerlink" title="测试是否成功"></a>测试是否成功</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ ssh -T git@github.com # 注意邮箱地址不用改</span><br></pre></td></tr></table></figure>

<p>如果提示<code>Are you sure you want to continue connecting (yes/no)?</code>，输入yes，然后会看到：</p>
<blockquote>
<p>Hi liuxianan! You’ve successfully authenticated, but GitHub does not provide shell access.</p>
</blockquote>
<p>看到这个信息说明SSH已配置成功！</p>
<p>此时你还需要配置：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git config --global user.name &amp;quot;liuxianan&amp;quot;// 你的github用户名，非昵称</span><br><span class="line">$ git config --global user.email  &amp;quot;xxx@qq.com&amp;quot;// 填写你的github注册邮箱</span><br></pre></td></tr></table></figure>

<p>具体这个配置是干嘛的我没仔细深究。</p>
<h1 id="使用hexo写博客"><a href="#使用hexo写博客" class="headerlink" title="使用hexo写博客"></a>使用hexo写博客</h1><h2 id="hexo简介"><a href="#hexo简介" class="headerlink" title="hexo简介"></a>hexo简介</h2><p>Hexo是一个简单、快速、强大的基于 Github Pages 的博客发布工具，支持Markdown格式，有众多优秀插件和主题。</p>
<p>官网： <a href="http://hexo.io">http://hexo.io</a></p>
<p>github: <a href="https://github.com/hexojs/hexo">https://github.com/hexojs/hexo</a></p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>由于github pages存放的都是静态文件，博客存放的不只是文章内容，还有文章列表、分类、标签、翻页等动态内容，假如每次写完一篇文章都要手动更新博文目录和相关链接信息，相信谁都会疯掉，所以hexo所做的就是将这些md文件都放在本地，每次写完文章后调用写好的命令来批量完成相关页面的生成，然后再将有改动的页面提交到github。</p>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>安装之前先来说几个注意事项：</p>
<ol>
<li>很多命令既可以用Windows的cmd来完成，也可以使用git bash来完成，但是部分命令会有一些问题，为避免不必要的问题，建议全部使用git bash来执行；</li>
<li>hexo不同版本差别比较大，网上很多文章的配置信息都是基于2.x的，所以注意不要被误导；</li>
<li>hexo有2种<code>_config.yml</code>文件，一个是根目录下的全局的<code>_config.yml</code>，一个是各个<code>theme</code>下的；</li>
</ol>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ npm install -g hexo</span><br></pre></td></tr></table></figure>

<h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><p>在电脑的某个地方新建一个名为hexo的文件夹（名字可以随便取），比如我的是<code>F:\Workspaces\hexo</code>，由于这个文件夹将来就作为你存放代码的地方，所以最好不要随便放。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ cd /f/Workspaces/hexo/</span><br><span class="line">$ hexo init</span><br></pre></td></tr></table></figure>

<p>hexo会自动下载一些文件到这个目录，包括node_modules，目录结构如下图：</p>
<p><img src="http://image.liuxianan.com/201608/20160818_115922_773_1148.png" alt="目录结构"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ hexo g # 生成</span><br><span class="line">$ hexo s # 启动服务</span><br></pre></td></tr></table></figure>

<p>执行以上命令之后，hexo就会在public文件夹生成相关html文件，这些文件将来都是要提交到github去的：</p>
<p><img src="http://image.liuxianan.com/201608/20160818_120700_028_2426.png" alt="提交到github"></p>
<p><code>hexo s</code>是开启本地预览服务，打开浏览器访问 <a href="http://localhost:4000">http://localhost:4000</a> 即可看到内容，很多人会碰到浏览器一直在转圈但是就是加载不出来的问题，一般情况下是因为端口占用的缘故，因为4000这个端口太常见了，解决端口冲突问题请参考这篇文章：<a href="http://blog.liuxianan.com/windows-port-bind.html">http://blog.liuxianan.com/windows-port-bind.html</a></p>
<p>第一次初始化的时候hexo已经帮我们写了一篇名为 Hello World 的文章，默认的主题比较丑，打开时就是这个样子：</p>
<p><img src="http://image.liuxianan.com/201608/20160818_132443_202_6848.png" alt="搭建成功"></p>
<h2 id="修改主题"><a href="#修改主题" class="headerlink" title="修改主题"></a>修改主题</h2><p>既然默认主题很丑，那我们别的不做，首先来替换一个好看点的主题。这是 <a href="https://hexo.io/themes/">官方主题</a>。</p>
<p>个人比较喜欢的2个主题：<a href="https://github.com/pinggod/hexo-theme-jekyll">hexo-theme-jekyll</a> 和 <a href="https://github.com/litten/hexo-theme-yilia">hexo-theme-yilia</a>。</p>
<p>首先下载这个主题：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ cd /f/Workspaces/hexo/</span><br><span class="line">$ git clone https://github.com/litten/hexo-theme-yilia.git themes/yilia</span><br></pre></td></tr></table></figure>

<p>下载后的主题都在这里：</p>
<p><img src="http://image.liuxianan.com/201608/20160818_134500_245_0912.png" alt="主题"></p>
<p>修改<code>_config.yml</code>中的<code>theme: landscape</code>改为<code>theme: yilia</code>，然后重新执行<code>hexo g</code>来重新生成。</p>
<p>如果出现一些莫名其妙的问题，可以先执行<code>hexo clean</code>来清理一下public的内容，然后再来重新生成和发布。</p>
<h2 id="上传之前"><a href="#上传之前" class="headerlink" title="上传之前"></a>上传之前</h2><p>在上传代码到github之前，一定要记得先把你以前所有代码下载下来（虽然github有版本管理，但备份一下总是好的），因为从hexo提交代码时会把你以前的所有代码都删掉。</p>
<h2 id="上传到github"><a href="#上传到github" class="headerlink" title="上传到github"></a>上传到github</h2><p>如果你一切都配置好了，发布上传很容易，一句<code>hexo d</code>就搞定，当然关键还是你要把所有东西配置好。</p>
<p>首先，<code>ssh key</code>肯定要配置好。</p>
<p>其次，配置<code>_config.yml</code>中有关deploy的部分：</p>
<p>正确写法：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repository: git@github.com:liuxianan/liuxianan.github.io.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure>

<p>错误写法：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: github</span><br><span class="line">  repository: https://github.com/liuxianan/liuxianan.github.io.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure>

<p>后面一种写法是hexo2.x的写法，现在已经不行了，无论是哪种写法，此时直接执行<code>hexo d</code>的话一般会报如下错误：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;Deployer not found: github 或者 Deployer not found: git</span><br></pre></td></tr></table></figure>

<p>原因是还需要安装一个插件：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<p>其它命令不确定，部署这个命令一定要用git bash，否则会提示<code>Permission denied (publickey).</code></p>
<p>打开你的git bash，输入<code>hexo d</code>就会将本次有改动的代码全部提交，没有改动的不会：</p>
<p><img src="http://image.liuxianan.com/201608/20160818_140441_769_5024.png" alt="提交"></p>
<h2 id="保留CNAME、README-md等文件"><a href="#保留CNAME、README-md等文件" class="headerlink" title="保留CNAME、README.md等文件"></a>保留CNAME、README.md等文件</h2><p>提交之后网页上一看，发现以前其它代码都没了，此时不要慌，一些非md文件可以把他们放到source文件夹下，这里的所有文件都会原样复制（除了md文件）到public目录的：</p>
<p><img src="http://image.liuxianan.com/201608/20160818_141037_580_8035.png" alt="public目录"></p>
<p>由于hexo默认会把所有md文件都转换成html，包括README.md，所有需要每次生成之后、上传之前，手动将README.md复制到public目录，并删除README.html。</p>
<h2 id="常用hexo命令"><a href="#常用hexo命令" class="headerlink" title="常用hexo命令"></a>常用hexo命令</h2><p>常见命令</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hexo new &amp;quot;postName&amp;quot; #新建文章</span><br><span class="line">hexo new page &amp;quot;pageName&amp;quot; #新建页面</span><br><span class="line">hexo generate #生成静态页面至public目录</span><br><span class="line">hexo server #开启预览访问端口（默认端口4000，&amp;#39;ctrl + c&amp;#39;关闭server）</span><br><span class="line">hexo deploy #部署到GitHub</span><br><span class="line">hexo help  # 查看帮助</span><br><span class="line">hexo version  #查看Hexo的版本</span><br></pre></td></tr></table></figure>

<p>缩写：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hexo n == hexo new</span><br><span class="line">hexo g == hexo generate</span><br><span class="line">hexo s == hexo server</span><br><span class="line">hexo d == hexo deploy</span><br></pre></td></tr></table></figure>

<p>组合命令：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hexo s -g #生成并本地预览</span><br><span class="line">hexo d -g #生成并上传</span><br></pre></td></tr></table></figure>

<h2 id="config-yml"><a href="#config-yml" class="headerlink" title="_config.yml"></a>_config.yml</h2><p>这里面都是一些全局配置，每个参数的意思都比较简单明了，所以就不作详细介绍了。</p>
<p>需要特别注意的地方是，冒号后面必须有一个空格，否则可能会出问题。</p>
<h2 id="写博客"><a href="#写博客" class="headerlink" title="写博客"></a>写博客</h2><p>定位到我们的hexo根目录，执行命令：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hexo new &amp;#39;my-first-blog&amp;#39;</span><br></pre></td></tr></table></figure>

<p>hexo会帮我们在<code>_posts</code>下生成相关md文件：</p>
<p><img src="http://image.liuxianan.com/201608/20160823_183047_352_1475.png" alt="生成相关md文件"></p>
<p>我们只需要打开这个文件就可以开始写博客了，默认生成如下内容：</p>
<p><img src="http://image.liuxianan.com/201608/20160823_183325_470_9306.png" alt="可以开始写博客了"></p>
<p>当然你也可以直接自己新建md文件，用这个命令的好处是帮我们自动生成了时间。</p>
<p>一般完整格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: postName #文章页面上的显示名称，一般是中文</span><br><span class="line">date: 2013-12-02 15:30:16 #文章生成时间，一般不改，当然也可以任意修改</span><br><span class="line">categories: 默认分类 #分类</span><br><span class="line">tags: [tag1,tag2,tag3] #文章标签，可空，多标签请用格式，注意:后面有个空格</span><br><span class="line">description: 附加一段文章摘要，字数最好在140字以内，会出现在meta的description里面</span><br><span class="line">---</span><br></pre></td></tr></table></figure>

<p>以下是正文</p>
<p>那么<code>hexo new page &#39;postName&#39;</code>命令和<code>hexo new &#39;postName&#39;</code>有什么区别呢？</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hexo new page &#x27;my-second-blog&#x27;</span><br></pre></td></tr></table></figure>

<p>生成如下：</p>
<p><img src="http://image.liuxianan.com/201608/20160823_184852_854_6502.png" alt="效果"></p>
<p>最终部署时生成：<code>hexo\public\my-second-blog\index.html</code>，但是它不会作为文章出现在博文目录。</p>
<h3 id="写博客工具"><a href="#写博客工具" class="headerlink" title="写博客工具"></a>写博客工具</h3><p>那么用什么工具写博客呢？这个我还没去找，以前自己使用editor.md简单弄了个，大家有好用的hexo写博客工具可以推荐个。</p>
<h3 id="如何让博文列表不显示全部内容"><a href="#如何让博文列表不显示全部内容" class="headerlink" title="如何让博文列表不显示全部内容"></a>如何让博文列表不显示全部内容</h3><p>默认情况下，生成的博文目录会显示全部的文章内容，如何设置文章摘要的长度呢？</p>
<p>答案是在合适的位置加上<code>&amp;lt;!--more--&amp;gt;</code>即可，例如：</p>
<h1 id="前言-1"><a href="#前言-1" class="headerlink" title="前言"></a>前言</h1><p>使用github pages服务搭建博客的好处有：</p>
<ol>
<li>全是静态文件，访问速度快；</li>
<li>免费方便，不用花一分钱就可以搭建一个自由的个人博客，不需要服务器不需要后台；</li>
<li>可以随意绑定自己的域名，不仔细看的话根本看不出来你的网站是基于github的；</li>
<li>数据绝对安全，基于github的版本管理，想恢复到哪个历史版本都行；</li>
<li>博客内容可以轻松打包、转移、发布到其它平台；</li>
<li>等等；</li>
</ol>
<p>最终效果：</p>
<p><img src="http://image.liuxianan.com/201608/20160823_184633_653_1893.png" alt="最终效果"></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="http://www.cnblogs.com/zhcncn/p/4097881.html">http://www.cnblogs.com/zhcncn/p/4097881.html</a></p>
<p><a href="http://www.jianshu.com/p/05289a4bc8b2">http://www.jianshu.com/p/05289a4bc8b2</a></p>
]]></content>
      <categories>
        <category>知识点</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>GitTalk</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2020/12/22/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html">Deployment</a></p>
<h1 id="博客转移成功"><a href="#博客转移成功" class="headerlink" title="博客转移成功"></a>博客转移成功</h1><p>今天把博客从emlog转移到了hexo，这个hexo自带的博文就不删除了，留着作为一个时间线吧。</p>
]]></content>
      <categories>
        <category>第一次</category>
      </categories>
      <tags>
        <tag>你好世界</tag>
        <tag>第一次</tag>
        <tag>随笔</tag>
      </tags>
  </entry>
  <entry>
    <title>Git相关工具(MarkdownPad等等)避免踩坑的一些补充笔记</title>
    <url>/2020/12/14/About-Git-Err-2/</url>
    <content><![CDATA[<h1 id="啰里啰嗦"><a href="#啰里啰嗦" class="headerlink" title="啰里啰嗦"></a>啰里啰嗦</h1><p>好像好久没有更新博客了，今年疫情很多人都过的不是很好，又到年底了，提前祝大家新年快乐吧😂，希望各位读者能够在新的一年蒸蒸日上，早日摆脱不开心，心想事成。😁哈哈~</p>
<h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><h2 id="1丶hexo命令操作时出现的问题"><a href="#1丶hexo命令操作时出现的问题" class="headerlink" title="1丶hexo命令操作时出现的问题"></a>1丶hexo命令操作时出现的问题</h2><h3 id="hexo-v出现的问题"><a href="#hexo-v出现的问题" class="headerlink" title="hexo -v出现的问题"></a>hexo -v出现的问题</h3><span id="more"></span>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ hexo -v</span><br><span class="line">(node:9876) Warning: Accessing non-existent property &#x27;lineno&#x27; of module exports inside circular dependency</span><br><span class="line">(Use `node --trace-warnings ...` to show where the warning was created)</span><br><span class="line">(node:9876) Warning: Accessing non-existent property &#x27;column&#x27; of module exports inside circular dependency</span><br><span class="line">(node:9876) Warning: Accessing non-existent property &#x27;filename&#x27; of module exports inside circular dependency</span><br><span class="line">(node:9876) Warning: Accessing non-existent property &#x27;lineno&#x27; of module exports inside circular dependency</span><br><span class="line">(node:9876) Warning: Accessing non-existent property &#x27;column&#x27; of module exports inside circular dependency</span><br><span class="line">(node:9876) Warning: Accessing non-existent property &#x27;filename&#x27; of module exports inside circular dependency</span><br><span class="line">hexo: 4.2.0</span><br><span class="line">hexo-cli: 3.1.0</span><br><span class="line">os: Windows_NT 10.0.18363 win32 x64</span><br><span class="line">node: 14.0.0</span><br><span class="line">v8: 8.1.307.30-node.30</span><br><span class="line">uv: 1.37.0</span><br><span class="line">zlib: 1.2.11</span><br><span class="line">brotli: 1.0.7</span><br><span class="line">ares: 1.16.0</span><br><span class="line">modules: 83</span><br><span class="line">nghttp2: 1.40.0</span><br><span class="line">napi: 6</span><br><span class="line">llhttp: 2.0.4</span><br><span class="line">openssl: 1.1.1f</span><br><span class="line">cldr: 36.1</span><br><span class="line">icu: 66.1</span><br><span class="line">tz: 2019c</span><br><span class="line">unicode: 13.0</span><br></pre></td></tr></table></figure>

<h3 id="hexo-d-和-hexo-g-出现的问题"><a href="#hexo-d-和-hexo-g-出现的问题" class="headerlink" title="hexo d 和 hexo g 出现的问题"></a>hexo d 和 hexo g 出现的问题</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ hexo d -g</span><br><span class="line">(node:3908) Warning: Accessing non-existent property &#x27;lineno&#x27; of module exports inside circular dependency</span><br><span class="line">(Use `node --trace-warnings ...` to show where the warning was created)</span><br><span class="line">(node:3908) Warning: Accessing non-existent property &#x27;column&#x27; of module exports inside circular dependency</span><br><span class="line">(node:3908) Warning: Accessing non-existent property &#x27;filename&#x27; of module exports inside circular dependency</span><br><span class="line">(node:3908) Warning: Accessing non-existent property &#x27;lineno&#x27; of module exports inside circular dependency</span><br><span class="line">(node:3908) Warning: Accessing non-existent property &#x27;column&#x27; of module exports inside circular dependency</span><br><span class="line">(node:3908) Warning: Accessing non-existent property &#x27;filename&#x27; of module exports inside circular dependency</span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Files loaded in 94 ms</span><br><span class="line">INFO  0 files generated in 22 ms</span><br><span class="line">INFO  Deploying: git</span><br><span class="line">INFO  Clearing .deploy_git folder...</span><br><span class="line">INFO  Copying files from public folder...</span><br><span class="line">FATAL Something&#x27;s wrong. Maybe you can find the solution here: https://hexo.io/docs/troubleshooting.html</span><br><span class="line">TypeError [ERR_INVALID_ARG_TYPE]: The &quot;mode&quot; argument must be integer. Received an instance of Object</span><br><span class="line">    at copyFile (fs.js:1890:10)</span><br><span class="line">    at tryCatcher (D:\Blog\node_modules\bluebird\js\release\util.js:16:23)</span><br><span class="line">    at ret (eval at makeNodePromisifiedEval (D:\Node\node_global\node_modules\hexo-cli\node_modules\bluebird\js\release\promisify.js:184:12), &lt;anonymous&gt;:13:39)</span><br><span class="line">    at D:\Blog\node_modules\hexo-fs\lib\fs.js:144:39</span><br><span class="line">    at tryCatcher (D:\Blog\node_modules\bluebird\js\release\util.js:16:23)</span><br><span class="line">    at Promise._settlePromiseFromHandler (D:\Blog\node_modules\bluebird\js\release\promise.js:547:31)</span><br><span class="line">    at Promise._settlePromise (D:\Blog\node_modules\bluebird\js\release\promise.js:604:18)</span><br><span class="line">    at Promise._settlePromise0 (D:\Blog\node_modules\bluebird\js\release\promise.js:649:10)</span><br><span class="line">    at Promise._settlePromises (D:\Blog\node_modules\bluebird\js\release\promise.js:729:18)</span><br><span class="line">    at Promise._fulfill (D:\Blog\node_modules\bluebird\js\release\promise.js:673:18)</span><br><span class="line">    at Promise._resolveCallback (D:\Blog\node_modules\bluebird\js\release\promise.js:466:57)</span><br><span class="line">    at Promise._settlePromiseFromHandler (D:\Blog\node_modules\bluebird\js\release\promise.js:559:17)</span><br><span class="line">    at Promise._settlePromise (D:\Blog\node_modules\bluebird\js\release\promise.js:604:18)</span><br><span class="line">    at Promise._settlePromise0 (D:\Blog\node_modules\bluebird\js\release\promise.js:649:10)</span><br><span class="line">    at Promise._settlePromises (D:\Blog\node_modules\bluebird\js\release\promise.js:729:18)</span><br><span class="line">    at Promise._fulfill (D:\Blog\node_modules\bluebird\js\release\promise.js:673:18)</span><br><span class="line">    at Promise._resolveCallback (D:\Blog\node_modules\bluebird\js\release\promise.js:466:57)</span><br><span class="line">    at Promise._settlePromiseFromHandler (D:\Blog\node_modules\bluebird\js\release\promise.js:559:17)</span><br><span class="line">    at Promise._settlePromise (D:\Blog\node_modules\bluebird\js\release\promise.js:604:18)</span><br><span class="line">    at Promise._settlePromise0 (D:\Blog\node_modules\bluebird\js\release\promise.js:649:10)</span><br><span class="line">    at Promise._settlePromises (D:\Blog\node_modules\bluebird\js\release\promise.js:729:18)</span><br><span class="line">    at Promise._fulfill (D:\Blog\node_modules\bluebird\js\release\promise.js:673:18)</span><br></pre></td></tr></table></figure>


<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>出现以上的这些问题，博主大胆猜测是因为node版本太高导致的，切换成低版本的node来安装和编译Hexo就可以了。</p>
<p>为什么是猜测呢，因为博主原先是安装了最新版node14.15.1.0，然后卸载重新安装了一个之前存在U盘里的node12.5.0.0版本，这个问题就解决了。😂知道具体原因的朋友也可以在现房评论区告诉博主，么么哒~</p>
<h2 id="2丶MarkdownPad发生HTML渲染组件出错的"><a href="#2丶MarkdownPad发生HTML渲染组件出错的" class="headerlink" title="2丶MarkdownPad发生HTML渲染组件出错的"></a>2丶MarkdownPad发生HTML渲染组件出错的</h2><p>此前是WIN7得到电脑，写这篇博文的时候博主换成了WIN10系统的电脑，然后MarkdowPad就发生了错误，提示如图:</p>
<p><img src="/img/GitalkErr2/MarkdowPad.png" alt="MarkdowPad错误"></p>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>出现问题当然第一时间是请教万能的网友了，于是博主就百度了一下相关的关键词， 果然发现有网友也出现过这个问题，于是博主不要脸的作为本博文的一节借鉴（抄？）了过来，也算是给自己做了一个小小的笔记吧。🤣</p>
<p>反正就是win8跟win10都会发生，上面也刚刚说了，博主此前是用的WIN7刚换的WIN10系统嘛。</p>
<p>具体办法：</p>
<p>下载这个东西： Awesomium 1.6.6 SDK</p>
<p>下载完一路点安装就行。</p>
<p>遇到有2个点不了next的时候，是有一个需要同意用户协议，勾选上同意就可以下一步了，还有一个是要选择安装类型，安装类型的在左边点击最顶部的typical标准套餐就可以了。</p>
<p>最后，重启MarkdownPad就解决问题了。 </p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>还是那句老话了，遇到问题时善用搜索工具，先自己实践的尝试去解决，对于重要的文件一定要多备份数据，最好在备份数据上动手，以免损坏源文件什么的。</p>
<p>咱有一个问题就解决一个问题，不能让问题堆积如山，2333…</p>
<p>捋清思路之后，有针对的各个击破，问题就简单了</p>
<p>感谢阅读，么么扎~~</p>
<p>新年快乐！😁</p>
]]></content>
      <categories>
        <category>知识点</category>
        <category>吐槽</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>MarkdownPad</tag>
        <tag>笔记</tag>
        <tag>知识点</tag>
      </tags>
  </entry>
  <entry>
    <title>三丰云免费主机和服务器的使用体验和感受</title>
    <url>/2020/05/10/test_sfy/</url>
    <content><![CDATA[<h1 id="开篇碎碎念"><a href="#开篇碎碎念" class="headerlink" title="开篇碎碎念"></a>开篇碎碎念</h1><p>今天母亲节啊，记得给自己的母亲大人打个电话什么的哦~~</p>
<p>博主今天突然想找一个免费主机试玩试玩，在经过一番的搜索引擎翻来覆去的看了之后，看到了三丰云，网路上关于它的文章也不少（推广续期，后面会讲到），貌似还不错，于是乎，就去他们官网注册了个账户想体验一番。</p>
<h1 id="关于三丰云"><a href="#关于三丰云" class="headerlink" title="关于三丰云"></a>关于三丰云</h1><p>他们自己说明的是北京太极三丰云计算有限公司旗下网络服务品牌，十八年IDC老兵团队蛰伏三年后投资千万于2018年10月1日创建。公司致力于为大众提供最优质的互联网基础服务和物联网服务，包括：域名注册、虚拟主机、云服务器、主机托管租用、CDN网站加速、物联网应用等服务。以帮助客户轻松、 高速、高效的应用互联网/物联网，提高企业竞争能力。</p>
<span id="more"></span>

<p>然后这边再给上免费服务器的截图：</p>
<p><img src="/img/sfy/sf01.png" alt="免费服务器"></p>
<h1 id="申请三丰云免费服务器的条件"><a href="#申请三丰云免费服务器的条件" class="headerlink" title="申请三丰云免费服务器的条件"></a>申请三丰云免费服务器的条件</h1><p>1、真实手机号码验证（测试阿里小号无法验证）</p>
<p>2、真实身份证信息验证（可能只能用自己的身份证了…）</p>
<p>3、实名认证每次1元，测试期每次0.3元人民币，不管有没有验证成功扣0.3元（并且平台充值最低为1元，坑！这里为了演示，博主血亏了1元。）</p>
<p><img src="/img/sfy/sf06.png" alt="实名认证充值1元"></p>
<p>4、免费用户使用windows系统需要缴2元安装费，默认的是CentOS，安装CentOS就不需要安装费。（服！）</p>
<p><img src="/img/sfy/sf02.png" alt="操作系统安装费"></p>
<p>免费服务器支持以下系统版本：</p>
<p>CentOS：6.5 7.0——7.6（纯净版），7.0宝塔面板（专用版）</p>
<p>Ubuntu：14.0 16.04纯净版</p>
<p>windows：Servre 2003，2008R2，2012R2</p>
<p>windows：7，10</p>
<p><img src="/img/sfy/sf03.png" alt="服务器宝塔登录面板"></p>
<h1 id="关于有效期和免费延期"><a href="#关于有效期和免费延期" class="headerlink" title="关于有效期和免费延期"></a>关于有效期和免费延期</h1><h2 id="有效期"><a href="#有效期" class="headerlink" title="有效期"></a>有效期</h2><p>首次开通：</p>
<p>为了节约系统资源，免费云服务器初始开通时24小时的使用时间，开通6小时后您可以进行免费延期操作。每次免费延期将可以免费延长一定的时间，通过免费延期您可以永久免费使用。</p>
<p>延期时间：每次最长延期5天。（免费主机是30天）</p>
<p>重要提示：</p>
<p>为了节约系统资源，把免费云服务器给最需要的人使用，避免用户一直重复开通免费云服务器。现在系统已经设定为每个用户免费开通1次，超过次数再次开通将收取一定的手续费。</p>
<p><img src="/img/sfy/sf04.jpg" alt="免费延期说明"></p>
<p><img src="/img/sfy/sf07.png" alt="免费服务器"></p>
<p><img src="/img/sfy/sf08.png" alt="免费虚拟主机"></p>
<h2 id="免费延期"><a href="#免费延期" class="headerlink" title="免费延期"></a>免费延期</h2><p>就是要你去各种社交网站或者论坛上面发帖，非常非常古老的推广方式了，不愧是十几年的老IDC了。并且发帖格式他还有一些限制，具体看下面截图吧：</p>
<p><img src="/img/sfy/sf05.jpg" alt="发帖网站推荐"></p>
<p><img src="/img/sfy/sf09.png" alt="发帖限制格式"></p>
<h1 id="吐槽总结"><a href="#吐槽总结" class="headerlink" title="吐槽总结"></a>吐槽总结</h1><p>免费玩玩还行，搭建好网站的速度方面其实还是挺不错的，不怎么建议一直使用，除非你确实挺喜欢发帖子或者时间充沛，能按时的去申请延期。</p>
<p>最后博主也就是玩耍了一下午这个三丰云，用是不会用的。</p>
<p>好了，今天的更博就这样吧，欢迎评论区留言。</p>
<p>PS：说是免费，博主好像为了演示实名认证还充值了1元啊，血亏！！</p>
]]></content>
      <categories>
        <category>随笔</category>
      </categories>
      <tags>
        <tag>随笔</tag>
        <tag>免费主机</tag>
        <tag>三丰云</tag>
        <tag>吐槽</tag>
      </tags>
  </entry>
  <entry>
    <title>当你更换电脑设备，怎么重新部署自己的Hexo博客</title>
    <url>/2020/04/07/hexo-rep/</url>
    <content><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>经常会在不同的电脑设备上面进行更新博客，所以博主就需要经常的重新配置博客环境。</p>
<p>今天就更新一篇博文，整理一下这个东西。</p>
<p>给大家看，也是给我自己看，经常会忘记一些东西，这就当时一个笔记好了。</p>
<h1 id="备份数据"><a href="#备份数据" class="headerlink" title="备份数据"></a>备份数据</h1><p>哪些是我们必须拷贝文件：</p>
<span id="more"></span>

<p>├──_config.yml  #站点的配置<br>├── theme   # 主题<br>├── scaffolds  # 文章模板<br>├── package.json  # 说明使用哪些包<br>├── .gitignore  # 限定在提交的时候哪些文件可以忽略<br>└── source  #自己写的博客文件</p>
<p>其他文件自己酌情备份就好。</p>
<p>博主是直接在U盘上面进行操作的，所以本分这个东西相对来说少了一步，不过为了防止U盘损坏/丢失之类的，还是需要再多备份一个在别的设备上面去的。</p>
<h1 id="环境部署"><a href="#环境部署" class="headerlink" title="环境部署"></a>环境部署</h1><h2 id="安装-Git"><a href="#安装-Git" class="headerlink" title="安装 Git"></a>安装 Git</h2><p>1丶最好是从官网Git下载git，在新电脑上安装。</p>
<p>因为https速度慢，而且每次都要输入口令，常用的是使用ssh，使用下面方法创建：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">$ git config --global user.name &quot;username&quot;</span><br><span class="line"></span><br><span class="line">$ git config --global user.email &quot;username@example.com&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2丶在用户主目录下运行： </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">ssh-keygen -t rsa -C “youremail@example.com”</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>把其中的邮件地址换成自己的邮件地址，然后一路回车</p>
<p>3丶最后完成后，会在用户主目录下生成.ssh目录，里面有id_rsa和id_rsa.pub两个文件，这两个就是SSH key密钥对，id_rsa是私钥，千万不能泄露出去，id_rsa.pub是公钥，可以放心地告诉任何人。</p>
<p>4丶登陆GitHub，打开「Settings」-&gt;「SSH and GPG keys」，然后点击「new SSH key」，填上任意Title，在Key文本框里粘贴公钥id_rsa.pub文件的内容（千万不要粘贴成私钥了！），最后点击「Add SSH Key」，你就应该看到已经添加的Key。</p>
<p>【博主是把旧电脑的.SSH文件夹直接拷贝到了U盘，所以换电脑之后，是可以直接把文件夹复制过去就行了。】</p>
<h2 id="安装Node-JS"><a href="#安装Node-JS" class="headerlink" title="安装Node.JS"></a>安装Node.JS</h2><h2 id="安装-Hexo"><a href="#安装-Hexo" class="headerlink" title="安装 Hexo"></a>安装 Hexo</h2><p>打开git bash客户端，输入 npm install hexo-cli -g，开始安装hexo<br>由于之前我是用 npm install hexo -g 安装的，此处我使用这个命令。因为我用 npm install hexo-cli -g命令安装后出现无法提交的情况，可能版本问题。</p>
<h1 id="安装模块"><a href="#安装模块" class="headerlink" title="安装模块"></a>安装模块</h1><p>在git bash中切换目录到新拷贝的文件夹里，使用 npm install 命令，进行模块安装。</p>
<p>不要用hexo init初始化，部分文件已经拷贝生成，如果不慎使用，则站点配置文件_config.yml会被初始化为默认值</p>
<h1 id="同步至Github"><a href="#同步至Github" class="headerlink" title="同步至Github"></a>同步至Github</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">hexo g</span><br><span class="line"></span><br><span class="line">hexo d</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h1><h3 id="bash-hexo-command-not-found-问题"><a href="#bash-hexo-command-not-found-问题" class="headerlink" title="bash: hexo command not found 问题"></a>bash: hexo command not found 问题</h3><p>检查nodejs是否安装</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">node -v</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>检查npm是否安装</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">npm -v</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>检查之后，能够正常显示版本号，说明问题不是出在这里。</p>
<p>检查hexo相应模块是否安装，进入你的文件夹，查看node_modules。</p>
<p>检查环境变量（特别是win7的环境下），在 “计算机”右击属性，进入 高级环境配置 ，选择环境变量，在 Path 属性里添加你的node_modules文件夹下的 .bin 文件夹的路径。</p>
<h1 id="其它组件"><a href="#其它组件" class="headerlink" title="其它组件"></a>其它组件</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">$ npm install npm install hexo-deployer-git --save #同步内容至github，若前面同步不成功就安装这个</span><br><span class="line"></span><br><span class="line">$ npm install hexo-generator-feed --save #RSS订阅</span><br><span class="line"></span><br><span class="line">$ npm install hexo-generator-sitemap --save #站点地图</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>博主是直接在U盘上面操作的，所以可以省略一些步骤，只需要安装必要的软件程序，然后把秘钥文件复制到电脑的用户根目录就可以了。</p>
<p>相对来说简单不少。</p>
<p>OK，今天就这样，感谢阅读。</p>
]]></content>
      <categories>
        <category>知识点</category>
        <category>Hexo</category>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>HEXO</tag>
        <tag>博客搬家</tag>
      </tags>
  </entry>
  <entry>
    <title>把自己做的一些小工具app归类到了网站上</title>
    <url>/2020/04/03/mylist-app/</url>
    <content><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>蛮久没有更新博客了，实在是因为hexo更新博文不是很方便，而且，因为一些特殊原因呢，博主所在用的电脑经常被重装，导致系统之后，环境也经常要重新配置，这很麻烦。索性就不怎么更新了。哈哈哈2333….</p>
<p>然后，最近在群里面呢，经常看到一些有意思的东西，手动去处理就会显得略微的麻烦，所以呢，博主就是利用自己仅有的那么一丢丢的安卓开发的知识，在手机上面进行了一些小小的工具开发，实现一些自己想要的功能，坦白说，写这些工具的目的完全是为了方便自己，但是既然有朋友想要，那就分享出去呗。</p>
<p>挺有意思的是，群里面有一些从12年就开始跟着我的朋友，挺好的，我很欣慰。毕竟，人来人往，没有不散的宴席，能一路走来这么久，也是挺开心的吧。</p>
<h1 id="APP相关"><a href="#APP相关" class="headerlink" title="APP相关"></a>APP相关</h1><p>贴图就不贴了，为手机端省点流量，就简单的讲一下为什么要写这些App好了。</p>
<span id="more"></span>

<p>诸如，看到什么成语接龙红包啦，想不到什么成语，就像做一个按位置搜索成语的工具，于是乎就诞生了那个“按需成语”的app</p>
<p>再例如，逛博客的时候，要记录太多的博客地址，或者打开博客有的看起来特效太多了，花里胡哨的，我是比较喜欢那种稍微简洁的，所以呢，就做了一个rss订阅源的软件，这个的话上一篇博文里已经介绍过了，这里就不在多说。</p>
<p>然后还有，某短视频平台的视频下载，官方应用下载的视频都是带水印的，很不舒服，尽管注重版权没有什么错，但是吧…..你懂的。于是乎，视频解析程序就有了那样一个视频解析app。</p>
<p>其他的就不啰嗦了，这次把应用弄到一个单页列表什么展示，既能快速的查找到，又能快速的下载，方便多了。</p>
<h1 id="地址"><a href="#地址" class="headerlink" title="地址"></a>地址</h1><p>吖远zzy 原创安卓App下载列表：<a href="http://app.hzv5.cn" title="http://app.hzv5.cn">http://app.hzv5.cn</a></p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>如果你有什么想要对我提的建议，欢迎在评论区回复，或者在首页的关于界面，找到我的其他相关联系方式联系我。<br>感谢阅读。</p>
]]></content>
      <categories>
        <category>水文</category>
        <category>吐槽</category>
        <category>心情</category>
      </categories>
      <tags>
        <tag>安卓软件</tag>
        <tag>原创软件</tag>
        <tag>android App</tag>
      </tags>
  </entry>
  <entry>
    <title>一款博主自己写的博客订阅安卓APP</title>
    <url>/2019/11/30/add-rssblog/</url>
    <content><![CDATA[<h1 id="缘起"><a href="#缘起" class="headerlink" title="缘起"></a>缘起</h1><p>我发现我好想很喜欢缘起这个词，2333…</p>
<p>上个星期，在十年之约博主群看到有typecho的客户端软件，然后就想HEXO怎么没有？</p>
<p>博主就开始着手写这么个软件了，说出来你可能不太相信，这个软件是纯手机端撸的，完全没有用到电脑。</p>
<p>下面附几张软件界面截图：</p>
<span id="more"></span>

<p><img src="/img/RssBlog/rss-blog00.jpg" alt="软件关于"></p>
<p><img src="/img/RssBlog/rss-blog01.jpg" alt="订阅博客列表"></p>
<p><img src="/img/RssBlog/rss-blog02.jpg" alt="博客文章列表"></p>
<h1 id="碎言"><a href="#碎言" class="headerlink" title="碎言"></a>碎言</h1><p>不知道为什么写着写着就写成了这个样子，开始是单纯的客户端浏览博客就行了，写着写着就出来了一个订阅。23333…</p>
<p>首页一屏：自定义主浏览的博客</p>
<p>首页二屏：自定义订阅的RSS源（理论支持任意rss源，不仅仅是限于博客类的），长按选项可以编辑或删除项目</p>
<p>首页三屏：软件的关于</p>
<p>左滑菜单：支持三设置头像，博客名称自动显示首页一屏的 Title，收藏夹功能（包含你收藏的文章列表，长按收藏夹列表支持编辑和移除收藏）</p>
<p>首页二屏点击RSS源，打开文章列表，点击条目，打开显示想要阅读的文章，长按支持添加到收藏夹或去除收藏。</p>
<p>软件没什么技术含量，查找了一些必要的开源资料和教程。</p>
<p>就是基本上都只是简单的 webniew 以及 listview 的结合使用，从而诞生了这么一个软件。</p>
<p>软件还是个测试版，可能存在诸多的未知bug，若你下载使用或者体验刚好遇到了，希望你能通过软件联系方式或者博客留言反馈给我。</p>
<p>感谢！！</p>
<h1 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h1><p>暂时没有好的其他地址存，提供百度云下载地址</p>
<p>链接:<a href="https://pan.baidu.com/s/1GdjZGnOMyNqBFAIQuRv2vA">https://pan.baidu.com/s/1GdjZGnOMyNqBFAIQuRv2vA</a></p>
<p>提取码:41e3</p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>好像有一段时间没有更新博客文章了，就借此app更新一波水文，让它看起来好像还活着！</p>
<p>2333…</p>
<p>感谢阅读，么么哒~</p>
]]></content>
      <categories>
        <category>吐槽大会</category>
        <category>知识笔记</category>
      </categories>
      <tags>
        <tag>博客订阅</tag>
        <tag>安卓软件</tag>
        <tag>原创软件</tag>
      </tags>
  </entry>
  <entry>
    <title>吹水一波，生活需要一丢丢的调节剂</title>
    <url>/2019/09/17/cnb-huawei/</url>
    <content><![CDATA[<h1 id="华为Mate30真机提前泄露"><a href="#华为Mate30真机提前泄露" class="headerlink" title="华为Mate30真机提前泄露"></a>华为Mate30真机提前泄露</h1><p>最近手机行业讨论比较火热，容易引起话题的无非就是华为了。</p>
<p>此前开发者大会，公布了鸿蒙系统以及开源了方舟编译器，着实让人佩服华为的眼界。</p>
<p>但是今天要吐槽的是，华为将在本月19号在慕尼黑发布的新旗舰机Mate30，吐槽的点不是手机本身，而是在于他的代理商职业素养和职业道德。</p>
<span id="more"></span>

<p>本身的话，对于一个旗舰手机的发布大家都是充满了期待的，虽然网络上各种猜测和爆料，也不太影响对该机的期待。</p>
<p>今天浏览网页突然一片名为“华为Mate30真机上手”的视频连接吸引了我，顶进去打开一看还真的是该机的真机。</p>
<p>附图两张：</p>
<p><img src="/img/HWMate30/M-01.jpg" alt="华为Mate30正面"><br><img src="/img/HWMate30/M-02.jpg" alt="华为Mate30背面"></p>
<p>要知道这是19号才开发布会的机型，视屏拍摄者居然视保密协议于不顾？</p>
<p>虽然只是大概展示了一下手机的外观和开机桌面，但是我感觉拍视频的这位兄弟已经凉了。2333…</p>
<h1 id="注销一些社交账号"><a href="#注销一些社交账号" class="headerlink" title="注销一些社交账号"></a>注销一些社交账号</h1><p>这两天新注册了一个手机号码，现代网络时代换个号码真的是及其的麻烦，各种的验证换绑，验证码短信来来回回收了不下四五十条。</p>
<p>把一些主流的社交软件（QQ/微信/微博等等…）更换了绑定，也注销了一些社交网站的账号：</p>
<p>简单说几个，例如：知乎（私聊“知一声”可获得注销知乎账号专属链接），酷安，soulApp（这些app设置里面就可以自助申请注销）等…</p>
<p><img src="/img/HWMate30/zhihu-01.jpg" alt="注销知乎1"><br><img src="/img/HWMate30/zhihu-02.jpg" alt="注销知乎2"></p>
<p>然后</p>
<p>这几天还得抽空去银行（中国银行/工商银行/农业银行…），把银行卡的预留号码也更改一下，想想就很累，所以没啥事不要随便的换号码，另外就是一定要注意保护自己的个人隐私。2333…</p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>吐吐槽，更新一波水文，调剂一下博客的氛围，让它看起来更生活化！</p>
<p>感谢阅读，么么哒~</p>
]]></content>
      <categories>
        <category>吐槽大会</category>
      </categories>
      <tags>
        <tag>保密协议</tag>
        <tag>职业素养</tag>
      </tags>
  </entry>
  <entry>
    <title>关于Git以及相关工具(Gitalk等等)在使用过程中的一些错误及解决办法</title>
    <url>/2019/08/17/About-Git-Err/</url>
    <content><![CDATA[<h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><h2 id="1丶Gitalk评论工具一直Logging"><a href="#1丶Gitalk评论工具一直Logging" class="headerlink" title="1丶Gitalk评论工具一直Logging"></a>1丶Gitalk评论工具一直Logging</h2><p>今天突然地发现，yilia主题配置的Gitalk评论给你，点击登陆后一直处于Logging状态。</p>
<p>可能gitment作者那个服务器过期了，登陆时一直报Object ProgressEvent。</p>
<p>很大部分原因是因为js相关的东西没有加载出来导致的。</p>
<p>如图：</p>
<span id="more"></span>

<p><img src="/img/GitalkErr/logging.png" alt="一直处于登陆中"></p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>果然不出所料的就解决了，已yilia主题为例：</p>
<p>打开博客目录 <code>themes\yilia\layout\_partial\post\gitment.ejs</code> 将：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;//imsun.github.io/gitment/style/default.css&quot;&gt;</span><br><span class="line">&lt;script src=&quot;//imsun.github.io/gitment/dist/gitment.browser.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>修改为：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;https://jjeejj.github.io/css/gitment.css&quot;&gt;</span><br><span class="line">&lt;script src=&quot;https://jjeejj.github.io/js/gitment.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>或者是改为：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;https://jjeejj.github.io/css/gitment.css&quot;&gt;</span><br><span class="line">&lt;script src=&quot;https://www.wenjunjiang.win/js/gitment.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>这样修改源文件之后，登陆时就不会再报错了，这也是别人的服务器，如果你怕再次失效之类的，你也可以自己搭建一个源文件服务器来支持你的需求2333。</p>
<h2 id="2丶Gitalk无法进行初始化创建Issue评论区"><a href="#2丶Gitalk无法进行初始化创建Issue评论区" class="headerlink" title="2丶Gitalk无法进行初始化创建Issue评论区"></a>2丶Gitalk无法进行初始化创建Issue评论区</h2><p>错误提示为：Error: Validation Failed（如图）</p>
<p><img src="/img/GitalkErr/zs.png" alt="无法初始化"></p>
<p>这种情况是因为Issue有字数限制的咯</p>
<h2 id="解决-1"><a href="#解决-1" class="headerlink" title="解决"></a>解决</h2><p>1.控制自己的文章名称数字长度，加上文章前面的地址和日期，总共不能超过50个字符。</p>
<p>2.修改主题的Gitalk评论ID获取项目，把获取地址改为获取标题，电视写文章的时候同样要控制标题的长度不要超过50个字符。</p>
<p><img src="/img/GitalkErr/zs02.png" alt="修改文件"></p>
<p>博主用的是yilia主题为例：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">id: &quot;&lt;%=url%&gt;&quot;</span><br></pre></td></tr></table></figure>

<p>修改为</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">id: &quot;&lt;%=page.title%&gt;&quot;</span><br></pre></td></tr></table></figure>

<p>这样就可以把这个问题解决，可以愉快地创建评论咯。</p>
<h2 id="3丶换电脑后，执行-hexo-d-命令提示没有-Git-文件夹"><a href="#3丶换电脑后，执行-hexo-d-命令提示没有-Git-文件夹" class="headerlink" title="3丶换电脑后，执行 hexo d 命令提示没有 .Git 文件夹"></a>3丶换电脑后，执行 hexo d 命令提示没有 .Git 文件夹</h2><p>前两天也是在更换设备去更新博客，博主是直接把博客根目录下整个文件夹拷贝，放到U盘里面储存。</p>
<p>在新电脑上操作直接拷贝 .ssh 秘钥到相应的文件夹里就可以开始对博客进行操作了。</p>
<p>但是突然出现这样一个问题：博客能够正常编译(即 hexo g)，也能正常本地预览(即 hexo s)，就是提交到远程Git仓库的时候总报没有 <code>.Git</code> 文件夹:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">fatal: not a git repository (or any of the parent directories): .git</span><br></pre></td></tr></table></figure>

<h2 id="解决-2"><a href="#解决-2" class="headerlink" title="解决"></a>解决</h2><p>搜索引擎给出的答案，大部分用户都是能够直接使用 <code>git init</code> 进行初始化恢复，但是我这边使用该指令并没有达到想要效果，甚至还产生了其他的问题或错误。</p>
<p>然后解决办法就是：</p>
<p>删除博客根目录的 <code>.deploy_git</code> 文件夹</p>
<p>然后使用命令 <code>hexo deploy</code> 重新创建该文件夹</p>
<p>就会自动生成 <code>.git</code> 文件夹在里面，支持博主的问题也就解决了，顺利发布了今天这篇文章。 </p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>总结啥，纯粹是为了让叶看起来更加完整而已。</p>
<p>遇到一个问题就解决问题，不能让问题堆积如山，2333…</p>
<p>捋清思路之后，有针对的各个击破，问题就简单了</p>
<p>么么扎~~</p>
]]></content>
      <categories>
        <category>知识点</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>笔记</tag>
        <tag>知识点</tag>
        <tag>Gitalk</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo实现文章加密和文章置顶的方法与演示</title>
    <url>/2019/07/15/encode-top-test/</url>
    <content><![CDATA[<div id="hbe-security">
  <div class="hbe-input-container">
  <input type="password" class="hbe-form-control" id="pass" placeholder="密码是[你好]两个字的拼音字母" />
    <label for="pass">密码是[你好]两个字的拼音字母</label>
    <div class="bottom-line"></div>
  </div>
</div>
<div id="decryptionError" style="display: none;">Incorrect Password!</div>
<div id="noContentError" style="display: none;">No content to display!</div>
<div id="encrypt-blog" style="display:none">
U2FsdGVkX19I9KJ8urfccuVButtFxjfpsNyqlwBgXqgAaIF/WR/tf4GfQytTA8FwuOKz7PAi7xDQ6MIb43FCASzoYCiVMC1mfzac8/UhSGyoX2RYKz4wRfylu9+py8TcwOTIdKvzDlExqBo+k5STOPwa+24NSD2w2DtxXTujUKUvcYwn6fc6g+28vExt+qMEOZPu9+xovyIYS+JXdxPmVD5knp9zGBIHA74SO/QG1M3kr5HB7OCDjBPrVEweu4ZEYznuLiUamuwCqURYsjyVOrD9NYvqQnF+ufBtEUbi/z+PH/Vvx2Vc44uRcv9oLogoIiDzL73r1QnWAidNG6jnujDZbdF1NX/58rAa4/YhHpaatP9LbIx7ZeXG9CUyRqsrtCaiHpOC3BvWUMzjz5fZ8xvj3bIr0dwelVwIrlGJuq3z89OCCHf4YToWZykcw8qXDdBapVVYORGN9Nto22NE9OTK4g13fNg5W2ITEIINFH61GZq17ugXZLtcnL8GzSsNK/aajqMtbKpiuTf2kppf5mgvYgCmhOLxRPPicqnMx9uH7PhFe0LOA3l0km6p3x3whnG7MUV2qvhD2Qfl9n8BLo4ZEGmKDU0ruiVZwhT7GWDZoIzEPrAHrwEXc4KbtdYP4yGzgeyp4LLrEDmnX/5a234QgKmEBiQw7miOzYptTacsHPoqtfRXwWvXgkne3F+OrNmVWe0yH81OSWlYARDjrlreM3dPDtrh+sI/2LuuSHIxFy5+pNMw1UbNozMvu/nq1AuMhvA3GcRJRDTE3EaRGXw7RROC8+/mAx4Smqy0Jpy9EWFWF7TfjtCffdq2RMxPOZ4Tle0in9dA7u8RmDejxNQGrc+cFKtwMXQSEZ6W/3Q2rrSbCtRTBUtrRCquXkauOzQ9LwPmDGCXupcCAvCWwwBLo8UAlcoyUL5OUv7/g93Yr25ncU6X6WvV6kSTA73ZbmaKboSy7w/unxSUR99du+PPN1JWkeQpglRoWRBcgfYoZo/G1dpXmdunRV2dVbKH1l3nALLkO43D18aw9o+kKEvmKfEBhp63sMq6ahxNnXAvX3Ls5rP+RMvA9Apj0TyVwq6buyTgI+RMETYpO11dDTC22dAvYYaB/4uzQ6j6/VF5SAe4Z6o5CdR1wAgePmGk48lNnRk9ifDGp+WTB98RhVnRVNCJ0Fb0Zfzz0MkUjsbfEsgQxniDFUOvgjhGPOl5BjRghgUVwvo9uzzES9dYmhfBaheyK9YhcqdQITbgfubfYnWdn7uIdke2I9CD5dnl+s5s2FYB88+VobOKUCCd+P+zTKr6mdzebEJHvFQUD851es1kOcw2wxNU2Qwg5ZwfwwT95ABh5SifllfsqZBKjiS2f/D/0YVLWPPBzVxd+HD/pk6yLx1/Wy3Z016MGZ6+W6mSJ1DJT9ftkuOar9oXUvvpyeIymrbvdUfhV/eJze1W19/XxefqWGdsrZEp0/vlL8DYOrJIY1rwqjM1yRRcLgV6wh8lbK84jZZXp205uFhtG9tssaDS7I/pv8gfa2AUgdsKi1kG95nj12Dqy3ypw0czRDh6jfwFSPTsqPgi8h59waTkhbqDPaMWfnmxN0zpGnjW+yLEUy8rl8zM9PBpfUxz31vBDNkx33c3QAZckLNooAk6+Z9PkFMzfBOQiXrC3x3v8UyCQHfAKB1uITwd3LjYbJfn/LN8EDyM0bIFwASUj7jxIHjZW+7yBD2N1g7pGUUwcB9Ww5TvzmrKNRWF9SLZO1738upGuwFdX73nHU3ALBhk9AKRjPnXYmNnMRYEyaONsYWcfSlyccZe0SAocYat+hgtI4RG0BuSvEiRgT3lKIx2TQHZZQW8WJ670kQVohadJBIyh9WWwJrx7APHaBTZTxpvnt2Ykeui3TSsFrlfLbO4Ut+kHO4/mTw7b976ZzgGtxZLMjQGjcgsPkuDnGE8KfHLmiw1wgUf/M1pch9ORj8PfRvBTRBGVY0m2TQOL5Yunj97/3kKK6zXvM4/FYXivoO6B/iUbrtzxQwqj0QzQ8pLuSgQHEoNkLTsBveiuwZsUsC+90ALkHkF3JJr3P9/+jvdlZeJDzYHofdQCpvucU9Q2OYAyK43B3yPHSGX1jUmGBzQXd90xsEaSdLZLrk+9XQIkhPAph26QWdjBKDik+ZJjz0S2xxYl2K+OgDeeXzr3ZNCxMUbiFTwpwwdUGAOZBXdcrj0c+P7X2SMdXGGQmBMTzLqFDRDpGu2IohtnEOye9aO6BQRW2cTOAQQ9ZT4oGNIJo5mlkeeqv8Rpv4fMzKPfShvpyz4ocvDZB2rQG84CunnWL/ImhBfiSAjFTQpFyGKCQNfDt5MV9YB0C2ocDYTrsNryH0r38OayJ7lVd8G9q6bU1K0Sb7v4AvL0QgF2Kn99/wP8KxRoOIztP3dmushnHF0fRxEQLSAKnlvdPpeqrC/eebrG1We+utoY8smk/b8ad7dgpcNkwHEW/o9c7fb2bfaucayBhShY6/HLGKeTOoDyfOG+p69j++sldnknJOSXUDKG/J8Xu3spbRR8xT0yef+A0xSK3BaQUAsv0QS7m4zLizo9ra+wThTndUAv+/FwoUYTKt0RlTRgy3APH6HfwzShxkzYjk2LF7DKlxHpFwNAuZeF9mfmL75pDEeYG1imBb5lHV+zarA6nOqs1/Oiim3hvEJQNygqBoBku8vfXl1/WCObhPAm8usKxzqPTojPHTJiEvYXxqx+IocVAb4BW6YH0AOy+gvlnh0YS6zZOOJuQx+ZunN341LiqJFvodo6sCGM1nyz3eHQmSucCG3vlTqE7jZ5HYZnzjAASIExy1B8Pa8b6TlZ+pJNkLl8Id43qzsWwjHLWMSdUGMdmqWPxZH1+f1xt93FZHbYXzJXAfQ0qhmH7XiZ2XkyrA6c0ENxofW9rVmBA6955MZAmnjAv8n4ckemq3GiEN97YwMY5jPbhfVt8YDZVw1euxDZia1c9xBaFXq+xmxRnXoZsW1cK92K/8BHfkTHxlgimi4x9JSK1jtJMJmEaynKqszU9NBu6/cUvwwiCOfK4aBEFgSixGznDRb3krF4Fh9QbWNp0k6/B9Lv1sB7s/3huSXOnUUdeZfk1Z35EzrCEnssdbGjMpbH8ff36BwN0RY6kn8rE89X/cW1XbqCMH0V5vCkRq+YKQ4XagkfXz1pM8RjgKVJqRqLdsJTYdy+p8WZP8h4A3RHKlSSP3IkUzTbm5JXpTBXhhzEJkV8t2LZJNcJTgF8BmevSzSOmitgZqwJHUQsUbvfvR2bEdm2WhLLaD6uQ+oObTpn9QdNXBlP3RBUSCZePBO2zsb4d9gIFa7s63JHylfVmPMmySX5ru0ThEDelpn4Fghyf/qGAXKl66FIG0aoUuD7vlgdR8LzVWKiJD/BoT8DK7kyzQx34d0GcbkUFLlRJ31SSpPQTjzQGjza3rGrtvC3uCUB4tT6kY6PUn4w50h4p8PL+xRiC5A6KMFukiEbl+jU8PkM9XPlONJCTdUn+xlcWClV5L0sV2gZCEPyuO2630aDDbSoYOkHFKXQOoaLg78tts093+Jtdm+cKEIgiZtFQcSlEzZCi9J9KmZw30lx9rThBtP3NHfCnZCnpv3iPypJwOgnDeASRVh8GqGLd6wi1AjPs9CyBGsUzwTe6NiRhMNujY5SMaUFEk8qZtnXq6ozTDnZH03oQMzi7LBq7Htl58iFJXER5iclal5BomnvrinDXFPfphbc1Wq8e9A+X9JKnuhWZyphGZvCHEJwo9QEzdyJigruawidQAuq/gfG/tzRUe8pNmzsxFYiLBnqhfoBKu7tddmgqgSpuoD4F5kaM0+F+MxMpheVKP120P9V9lY7cNSF9lKmannCpgcI73Q0I+Zs/ih+TxsELbHhVrQNNbrCBrub4FFuDEK3L/qKe5m98zpic5cUVr4R7ZcCpUF/lk6yIuTTHl6Y4urRh8KG0iFd5nPfCqi2HiehY2OLOkkYdPyIxoKpVyeTPw1cOy7hHEvPyAawmMnpX/LSwQuI4Ri8A9DOlYngepc8JMj2uYognJl35duGzXkVEnYURxvBy7FFVl2C8Bt4crBBHPn29lrMR6vMwYBVrwi9DzDzkbDd9xts812swbO9udrYbyKMuGbjies+6dP0xmWUutWGDBPLdBIPs80ZtUjBoh2g/yV2U5vyj6JokhoUlG4YNZb5UiWor52Y/4uoK+GthEkkmB+4NbYRntqWKt2nIA4EInXrEEtc9NW+d9aOu5UfBJxMoEd7l0pW6K2OGQuQrUn2MDT+E2OAqBzS5gHCI4cK6oIWbm7aNRacuQqjgv1rRFSMMeQ25j1dvkoiZ731EB/RVoc3wf2qRdLI7UkdLZu2HaY+MQJMqHnUSXaWmAjCBA7A9xHJLADh2ENvZf7CT+5bZpirgUra5kxccPDpb+TqL87gw4+SgeC50P4ZEK1frTy/ZOQEiaIw2Im4MEWsWZ4DPfO4eLc8zSXYR8lYZxr3J8z9ntmi/85UN8sBkM//Ry2WU110TVUGp7IiUPfJiENq0tCQKZClPSndzFXLOk4nXhyHDafcnKaiOQp7pgoUqroGtPxCaN/ByHNgEcrRLs2/oXWpKtQ64EYQgKSoBovQ6IDwmgxHzi8HEUqzPPRIk3giIhDgcw+Nl7dIRZ+VIQ5ywLrSB/+eiXqbko3k11DfETnd1A2iYEmg71+gR/PttnNQbK2TQ+mK7BjJ/K+KV53DQgilvUQOakh20IiPNu0kZNxAW8r1UFdJQwiYntCvswg4+6Kd9Ic2R1zgvYacSXQY8/5nxgelp5cersFSC+JoMHjGr87fnG9Dbm9ix+etFW3FSL0cKBLLmWpuyKftYib5udr8zx7AltpVYTsEzeVFmuOlKEftmLXWDbpdLjMtS15Hp9BbNNl2i+7RnAqKQHUPHgqJpNNp1BoCSzl4/RVXVG/kYjLBprJm3T1w5730UDmg5CQArm2/ppma1y3lu5bNio3pNHOg1vxdn5xYgoZIhBMUdgx6V7FteNOXc2h5FfGXWDSq5oRNXnO1eUjEGh3Kz+0/Xi05AqozPaIUir5193WuDxbkYRMNnk/y1RlhMbryNHwtvaUh8vCDrDJrqm3OxaJj2yNFwtK62RVmD7sE9nVbYISs/JY2n3C2lLxS49/G6+e4Ilme2LeHn7aOVh5VCjwXnbDxgK7xZWk97iISr+RnWRPHZK2uZj3xEC/xL1Z5mL6ePSL2ASCybDtUF7m+VZTHHRbQ8dDE13OEyCkHe/vSmjTviKUI2okgGGMNAfdj4GdsyoDrgJ64+N+P4qZ4aRKb5AQBwl0nUwMk9NPsuUemwFFwEDwFeCGXuuvfmLY52lXAsRKvfvbXq/TB6IsrJqGvUR3Er25fJIswjUCfswjm6xip1ZCMQKi4GAS2atlDNKgm60giDzlq6NTWmw6iPZpmBW6Zy7753cRab9MkD9z2qC5RFgR/RwvhVRJMGLn7YHa4v72XAzVg8ScyanbWY4gIovbNMnDp39/ce4vJfwhSpB2j+DJFOxBKUMtlRRDicnLOJdoAJEDs96gH6pICnJqwlX09I0z1ozepjLb45VccsWbAh9cWvXrnCve9coGLa+M3plknEB7FBY90RkpNBRzcGFDy6H2s4RwbUw/GybFB+2lF0m3f2r9g1llxtQJcGO7nLKqwu4HLZ3EltPh7TvABQXUqW+KGmrzlGjZPdjBNaYnk5FCn/PcnCmm8MVN3CzFL3pioq4cdsj6RuZzH/i1Wa+uvRuaWGrjLmfY0ni7v/5/Mgi+p1JTRRiAOeclGv2anvdmJszgHX9kL1PE/vmp7x6u5bD1D28qd6xHjN/7kUbADJu/RTpy7g11SJqm1ETp6sj3G4L4qYgz3ppxaNFyDGFY5amudbTDrOqb9MP0u/mVpJw6p/bDAzRNLjiZKR5wUE0rNlTqvgo3Uw5riIrPv/DJEA6OxWpRc04SOaWNK8Tx5FVk9+9FK6+yTStvfQM72pmhWEDfDix6kDmwoadfFuAGYkd/10CNT9NxbmB8uLtdVx8jOhdfH6moRpZPIhy0Qdc9ze0FoKnVigtQw9d2eSKpHNq7a/58KauG4ovdAKKSQuluNCPQ/EW1FoVFeQsegGhmNpnbDsz/FqMYogR1+nmaKbr8d55COuhC4jJXRPkKC1Fnu29Ntrc5wqLkYiue6DVwVvxaHCqn0v4oB1l1Jd0jxjrp+LBZ+sKgXKf5V9kV5sSACFPJcAe3X943mVJAhWBL86ZgPgj9KDjjJghVFiG72grs9AkYOHpOBwTRHqgBQUPLsHWL4Fw7SCTk4jfmQXCWJCiVi/Fwp0ka/uemZDE/8+iUL1Srv7lwv+H8ZA3+AB1KTQdVMVDU2tBeWBkdFvYpKFpZWbmzExSGW8xn9pvSUKPg+ZnmNJwHnuefhys7GIb+P+2npbsng+WCiD/EN6u+/gIHUsEcD527BaEQ3IFe78OqsC3I4BujtJFqdMi8h5Lb+oZYv1hz2St9M0wgA4wojRzvKrTnUSfSonbiyiv8E3gNArHVg9Ppq5HPyihCVjhJ51Pibxxg6RNbfiC7Rq3Ipq26UZGb6M17MDFVhxBnv0hRqPA2z5WIEgoro1+xp57uESejgSRD/8yj32kgWJ9QQcqMSnG/VTtkrWMSCfPb+f7bytqLP2nYtBaF7EsVB9hLPBKbhcoc5TfMnPY13cNaHoO6pDhRkkxYkOmBtQAjNDGbc26TkBsboFZAdknJzxYc7j+sBM4sgUTiHxhRCSkVvB8QafOCAkDBP38KsdHSunlFZeg8U4oYoXFkeTDFcJbelJ5aI4eizuNNDAognUVc00zGzq9wjNJJ68WCUWOlolqWf/aRz09Vt91jmxUKc904qriZPW1BgiZR65GGZzXwIXvzy/1hw+AaBl6xETq1CNvVjJJ62evrRC10R9jCcaiDESEM8w16oDWc2Wbe1QvRd35NuR0k8lmGSKfMVmRQgacr38OVRyjzyp7Ua6PNlEVrkG47l1RB6TiyofjOaNFfCLxw6NHtIq88p0olAcLzQIzmBJ/tOl759UK6y6c+RdYNoITRWilRGNc6vVcJY7apxNIMMedNjEGjpeL27SjRJAksGuyLgQRNB/0HP5niE05N/3nQExUw9CAE8Wu1CmXzr0SIBhDGuMts3ew9gvSB2MgaPoqFvzgcnDiVA1cc2I3LM+Zp/n1FlxStqTKpcc9DslUJ7rV+ZwvcNzeh0uldMUOdF1D3aj33UquRq83PA8xQO2o6cU0fbbaM40EgPTOA+aJhGjDuMMV2hliAoSJU9zLgHddSxc1YPltCKaA91zG43GQZ6pwQo50dYeZiihzpv86cB1peny9ztIAtqw+vmx4hSvEtFze8YgS2ao4jX/qJh+I44oClADyd3odKRAQlXeuE7fGOdB5u8XrMLJZftQCy1gpzRpkwubcp3zuwx8TdTBFZO3poK5j2RLNYAjZG5VJTsaOUFe1HkYLhBVuoAK3v4jmVYl3OW2L1nForcmXNDCppPlJ3pcxQQY7MwfX+GVBUOtfsH1HkawAV0nFfaFWhlzbYrtKwizw6q8pjnaZNQoU71E/thtw3zUIlmKjv1bjU+7fJoqjUNSuzvN49lakTfFWQas8LwpDYPaxLRcxtQGwfYCB92Sqy13pL0ZO+Haf+nEF3SNbcnag6J3kQhD9gxOU6YqtGRM85elw6HwR0q68NfdUybSoNWm4tpRzgage3YhTQ1EqziPLsyIpkOCWRQpWXNNRLX0XNwDxJ27kHbgYS866aozX4lOSycyKS61iDEknoVZDNnySLSgllvnHmu9GLWlUb8O6TXx570KTR5Zdfauj2mFBoLtHKDCI/E7UDe4T7NcnZ+1sE5NTqXNfSAb1b+ZnmQYSAs4B4s0NIG8m60O0zgOBgfR5ureSxk9WL+FgJigX7gUJqShuX4qarD1bcENMEBtvyQmkWVjU2cA4V4mIT0lQBio2ChcU8Su3f1VzKpxZA2/MrxnDOwWmFHqb7PweMrZXO68RznXZybbnt8G/vFjG0/okZkClH+GEsUiRCWZ+1UXDBlt0ja7rCwNL+Mb8kBkHdQMymEpn8+Bnd5nYKtn0RfzsDFSf0XroVHoSQ6GPwAMW3yJsWb3n7NFaRhSn2SF1rPJHinD+PPSTr3ukIorcJBIl078Iqc2dnzgVQ5RF/QeWM1mVeyHW754YzsuQ5j8OFvzPHwb4jJNCra8EqJ9DpGXFZm5ep3rfw3lcQ8uu4bLxMNA/gIipi+PuoOljphHqgbRF1rUQ+Obz/V3nLxJuGsl1mOUO0i2ql7IvdOEqjvdLDS+snLuIiXy5kYo+nXsBUJSq3w7EC37r2HZWmhMVJMmxRneZ472QhF6GY/L7W15U499ShUpLeuRnd/ZNUVEdqRsuCY8knAkgW7++Cao32xKSEVoPnuY+gXvKNH7LEl/yTSZZ5HtrS8JfgiekLwY5AhqbpXVm6JlkOnP8O3yaqxTErzTN6JuFV4ce76A3QkEiw3gBidSW/NJoaC7gv8u4IPXz34klAxy9yiRNCmu9Lgx9bu6YY5fWSKlZJQfcJLkyiwMr7z24fJbQklicVyu+9N5lBpc36FSvzTzp9NlAR8hKyXaGfOxYCkR1OB10GYMjrHefmJqoChwAVw5K9Ny5AUdnukdPUfYC4Vf+ZOOXQVRrLVSL0aVx8lkJyN7/vvzlGINRDaNu7HU1gqO5eLMpIR4jSbt0Bo5e6pMmnPQFYovhmaiQOvLFpmjCSQ2VvAuJdZj05u+q7RoQPyTWO0AUGSrkZrOaWDvXrLfsyHAUVgmtfMs8eWIzJl0HeT2ZuGZPu8NpH6FGs17vYz/n6LBemfzF0X1Fsj2Lgu6Vc7iv4oinFpYHS1IdPQrr2mQ56MHQbGLObv4kWqIDw5uPzSlSfmEZ5ToPjo5n8csDWm13KYFcX5ksK+jcdwI2BFTpoRfHtpM0GuFaqCywpG1Bm2M0EKC17q+AxezI5rWUMFVpdFLi4oHBXU0QRTHEyoxlriAGlB80DJuXCweVb9xxqcrteWswBDmiVVhs234rN2hSpaD8XjRLuaWHdfDto6WMq9UL+IuwJqh6sfZuTsLSXe2OwD+1YgytXueje+D/87EAFu6UoBHOVBfI+jTExtiFDTktjLhIa3aByZcj85oHIbPIRiJgdn/9D3J43Al1+kHS/PmGq7DvSBvJlzDIU9bEJ/I5Xgmgea++oB8QBkbmiHTmhyD6heYuHexIPTu8o4YZprKydQKCKFn1gTsvCYnLNiE5maxa0Cx9lt9cRY/yZpTPNhP2LA4VGItBadPnZT9SzK08KXRQCNzq1T7hNZdqG0BkYiAOCsAXwDKP+z67KVgPS2qfpsAPGZIn3maAjUcGaQEnXhaLRO8+VrjSF5IcyvJTDYxYIccyLYO7jFIfSNvsOe6fyYeRxNFrCRePo8tjjSIPWc4mqyDnmOeatdbN0gBv5j3WEj0sHF/C5vDOmyAX6icqBwu/Ju9MmhxkjizU551Ts9lYcFsRat6pgUdd+kryE5I94M5oMQNqs65mlFB9jokBvxCHS/MbWmqQAM38HeJ/L0v34hrXpryDmG7+WXIxQlB+Sls5e0LvSSpPrnY7Qdv1okfNxcxudlsAL82tZnghbM9zqABWO6KaT2CKzo4aXIbJpx4TfD3X9GdV3telJolpQdLijvzEspS9pz0hwS/n1cJJsqj9swuJ5PUB29qXEuXHH3VkbmG3DU/+QLsKdm8sW8bBU37cwkgzMaGj6D0TuDdADf/dpsoCgGuDilZtXR79IcH+6hzQwwQ+hcg9j3KXMLIiUor2XU1lCuJ3CcOxNlMKEYrsXec5o+bYdhT8xo3YpwG0/4McCPdbDxi8K/YuoVcgW9h6uXKDo7jNVNHAXTS4QQUliobfmLniOwmWBiPiiFOYxNi8CWZ2DfFnsTc0HYaxE/+ixlDc71LascsAjfPH2g5Hc4t8xnerKu93C4v+SCpTQLxh0mK99Goxo0CieD5PqQDM6p7+HLGs6AMAG6wxrQiNx+gmk9v7R2VypnM7uRrvOvABgBdM4WWh89qdFb4n86t7qFXEW/UI4xvE+dvyA0RzuRjto4IKqnIQxPFRJhRK3Ird520llWL0P34ho3p2mSQ1CYTnsBXR0oAWP9v1f4tYTMQ6Er5EHQ3UazdEfx/6UmPWlyPfocIQvN6LeMrJ2FCzRjLPmP9lEeZPIpzh0AdpOfAfku0o715trNLSt28BLm9nZbpTxDZzujzZKuufCePW9sh7TM74VeQX4Qq8vgMLk3Tzrmoj4MwagLnVclpfCDkVUc7aIOhWLIVE7rp/2W8y/BC/d2IdwwKqSoyln6qFmirdEgikagYPCi6BOJ21x1kAL24j84dE20Q8pQR6ZB9s7HNWxHkx1WP7pV+C3UdFR6RTjW3f77gQAipMRS2EJG8CyaTiHBfhEZ0EtKUVRRf7Dg/TvuoXA6MVcDopnRNZ6DSE0UB+xdGe5A1z9fUO3tGPZ/3GKaTWAzhH4h4Qehb3P/FMmWPRsbjv66D19mAy4GxTwxe4eJqiLeUtCSDPIDFqhxBTcUpjKPSiJGWA6wR71sgkVXyeczeTiQtVd6oDN1E2rFsDBzTzw+FNDosnFcbpmKvy87hLWDlgjqIrhSLSj1yzkAPkOYC8R0QKmFMv9mcIje2BAfBDx3OJuerirGtz/a674O6wVotSUHomHLp4VjQPDrJw4z8r5amqUUz6OZiivQpg43+jAwqNg8WiaF+L+vYUA9JMTFNBCL35gG5crPn0Zw37PJWHbdNJmXTJs7eGNsKfipqPq/5XdyP2QjjkDloYr9zH6iOJFMWg4AedHWzrXsnClGK2kZNxXXs+/z8YZ+n7jYZBDIZ/mNH3ZPj3Poc2JH+PDfiXa4/KUKaoMaMX9KFN469TI0oE2trdcu4JsE25Xf1tXcd+PFCGP9+d55OaL9XVwmYhWBwxozCR5knaCeBB6LWDGctcK99eLRJcv4sv/FxL0bsWIfP+N3VYG7d/LX+FQceh42m9WPH3fTPqgHwhhOC7sZ3Lo1Bioh22B7I4I8ckTc95OERAhST2EOUJXtzNLUD6sVMZMnNCjI4CYrIhL+yjk8XMAcRX64JyyoTHNmomOrs35DpjhVA4Ugr74EQW5znbAKQTbCRLKGytrlqRFXETjscRruCiTmJksz+DA9dAKCM8vP6371gf6V0pX0IguaeKL1kNwoU7t7tqpuSdWHecgDPRe8D3nCamIIZS9KVmMUeT1jeicTHv7fqvPMKpJf7jf/3FXHAX+mHM1/qr8q9WcfumzP47o2PnPfnkjxyJ/8cnwyz89biwIvWy/obcxYNlL0USmAHSUNTVEVD4SJt24iF0m7xMwTDm03k5v9B+BIGo55UyqDzZy0sc4b4bN1sVBTHkWYs3zYqCRUk7xRp0EQQzmp9NaXZTARlnEjdzHzXts9rCmwmjtKl6stBeoNIfOGpc3nVDifPKKgXE6OYpsI8EL3IDHJzGHKRDwEWB14Bh+aDPTt0OGxMhZ4SY/ki3vWdj+s8HVpc2bn9hETHLhdWFenyEQ8W32Q3afZRF+1jneJxn6tCmd8SP5XqMGeAl/0jvTXE+38SfykPM0QT9lR7D709eLEaToQhudBvtzyFi4KWUTNrYINllsmyBzoCykX/51qDucNaTIKkKXEwsY+OuEOIP2l5cT35tgr7THdEDO31JqI3UPf01FbIMIueOeb1bfe/W6tLOMafFur5XTuSCEGwfQlSpZj79oXtp8ZYHflRjkKxoZZk55auvERsupeSroRmG17dmwL+tSyonhK7h/KakBAaCJB5Vu3KuT1xzzW2qnzZ7VTBYa1a8TzS6ruhS/b/FTQBJbS9QvAzO+If0Tc+vUkQxLj0KP1S5QaNHzdprip/UFB25S/LmPXlIxFUA8cYfYbBeWm7ZSeew6kvrE23wTbCPmdS+s8iwNtl1tkVzY6jaxNZIOHosD2+Gs2fPNBfBuOI5UWeM6iwipcIQYttTppWi76gxH+fyS+btGHQ25+l8l/g3RtE8kGioUeJWlLQ94bm+B5abaXGoy+x+MVYxwPAUkJlApAtXTwPAlQIoJeO4M2G+WJoSpXobX5aYsRtMpYUyZS75Hf977E2pJnTddPgWNwTAfYFsmmWgj4IO/ne47WSJIg+TQU2avp9zc5/B2ccg+QRrMLRReV67dSMy81wvhVOZXvw/P7r2d+LAZX4IvNBsEJOzpFHuC0PWqy1WLmnMccrSRhcNhnfnh66VgM1qLgwhHC9gvUqrb1WnQ/e+yVv613H9FQ0pmIxb8pGmJcQv+jCPYK3rzG+LSTiqm4ixNAhy/TA10R9Y7NcqCqA6NmJV5R5xA7ElKyUO+jUTkfwtCseX45ry2tI8yKIa+zN2nAptzMwQh2C1H00e9RX2RPefDzvLDIQpHdXU/b68NEbTDkLgD4j58D/9WBYLvc+QZbNMpI700E4LLbg5klIv5opHglWRX6VjwKH4GMACHuZMI3E+UV/tQrHqLlaDcpYdL3+e72wEkgQjBRygfS0uW+OODJRB2yaK0nF7qAtmhhxGf4CW+T0uDL2NDjNRxOsEkO5egYoavMqn+5aTmtA286JogaWyTGnHeaKidOeiWS5Crz/75d78K1w2XFnn5IZfqJOXDCQDlBNlCEIH6yKUD1lrQBhVQ4PbTmb0fI8gnr0T4s3SfgN0nBCZoiHn9Dm0Ds3+5jsxcSumm9ynY1iyy/PDW18Cz40Iv27amYo2hKpz1VCEQ1Sbx//GRERy0AvJPyXJi4G3Z3gR7UtkatwVtpHAmk6PpanyFWWh9I0Av2S4hRqJuUcYxbNLDUgamplK81Qc25l/K8HLD9OIyB8R104hYe/DH1ddcCAdGIfSBznZ8KcMlxGH3gEoOp5C5zK05TD61LZWknGHoIFIkZtQSf8mRvNzmPA/FU7uQXol96fI98mvHAisI0GJdYLvn4QtDwXzIp2P5B6VGnx5AfFWMQTIhfcCbjAYjyXo68jFNeFoUvT6h1w7Y+n6W6ja0z3SgwkXGVzQC61T57vCejzxWg21LElA5lDvQCDC67UFUfZLs0Biibw96fReSuv72YJi7jbld07irqkyQ7akzUeuBl8kilsK5bkgshEZc5vKLqg3Ho88cseUyHjNSg+f6vwqQ+q2T6cPTK+/oCWxwi7zcu5GASTVctapZuMmLLnhKwB26kF/aKGUXaIEtjIpkH6LGrRceqrrnUW+UhROxsyrNqWHz2yjCyXYGS50RkLyBw9gz7PirC+jcMh+LlkZzU2+DCBJ2Lytk55MRyfzrea3/e7dSs/4GemjSQHnHCGZk3zWAozV/5Di8rvCr0kd8ZwN7gmOlqPWVZ388GrjK756Bq8oA1T2PFO7SlTWMkeE4ApocVM+aA9GnyMlp93aAlFv4gBm40O7ee+Lk652nu5bS+trAozeHZqEc+eoFOB88Dd5/d3oRDJyeGVW11Pjac13OWwYa/U/o0zZh2kyqqwS4d57QyyNIgNM7cwSrosFdJ4M+Pkw964IQDLW0C4RNjT8JpPhr51sGrxLRAkaPzn6HuKUhtYj9/EuAp/WCy1toCiwQibiqE5X9no3/HVXZ0JVVH0iMYv4Gs/Rk6Nz0BzYOo3b3+mLPJA+A6aj6HNLmwQmAGx1DwKfviqOZJyj7J1BjOZlw1C6rHx5QWdr1aqUmPH/+eHI42O1WCPJxlWCTN1+4US2Nkf6DLyyJiPYjWJFzP5EdWWCeTql4Yc/98BohtBqBVYXC9eqWMotUUmUkoNdsFTu4B31yQywuBKWIdqJo+YQOW5EWXnT6bzAhG+mhwPfDLAm7UPmK7xt3k0EshV35TnBmlDnanY7HhH6fjDpqFVkTzGfRKoWQ2s+BgLDUqQN04ggIjsNUTcdS/hYN0pECi4nycGoZ0yEiefD5o65MVGUDIYaXwEF17Pcq/TUkjRHOe3FSnAj21mgQKKlKOzwUh4O5xmuhUM4Y4krrarzZ5wTV7IwWetswa4RqzZ81LQ/fYf+nAj5B1tYLiKJF2NQXnfWUs8+P0WGXeXv5jHyoawXbM21DaV7YKyWYaV8kc0l5ASD44ej9K6r6gxOC864N3AFHsQbqUa1W5jejhM4x6sd9GovEWQ+CQKceDNg2mZU3KmXmEpVywtn+dZOzpZCxIiBFeCOkWHblL/gCpRePs3oo1hMKyTc4SBuxAcpIK7YOn8jLq/hGGEUk9FDdJkgFZ1OjcRpLhleBs+AqU6BZd/hY44Bo5U37c0qdxoF6OJw/IG9G4d3FDt/4tNJHyZcEIqJCh4/Z890QIFQKpDkfxBlMpHTrna328bgvRH6sycclHn5kxorxgpTt92sCPn9w08s+7yrBFX2YHhk6XKLMaGq7Bv8Ccnd+aMY6lC5q6uXeinHa/086rRB7JgOGS4PJefDWGSCb+YV2Z6ye0si0C1jG177eI9PRbOqD4NewMSplH3qGqgpy2Iwo4VLR8n1fNZTkI+mMwvGYZmDzJAbaNPbiL/vooUM/l71xlXOSLNeqcDMO8ui46d9hd2U9dIDqxhnNjv4FOImpP3cM2wKA8uVWpbgFWnmUql2VoV/1gXSFYi3Gnein7kqSvEUvmE1VPiLIOwD59eqxJm6v0f4QctO0YuuoMkkatLwlQua2r5TqFg9nhVq52tW4vMdBCTgDLrdHxWbSe9vyZTgUkcF8GgJQhGy2NZgbKENdRXQuiGlXhLx430Vy062mAvpZ4oQHkIl7UcrwEK7NAFZ0Fzg/LxG7Y266vatS6LXZke2hdJqz7rdf4DuZmrcs2f4PuOJz1kYnZDuu2k1Phgkf0dnXkgjJKWMSXNw8Al8z8TXs8I3dkYXoQtFE9BnGHVX86pEWDL6FowbdXZcCcLj7erYokLrGvZcvaUVrR5T34rwCjIoHls2mv2qrz8EK38KlI0wmjVg5pX76l7EhOYy4pDfpoXkVv8maDtaEeXStRpgKuAgxxCBCaEFtDwYdlFnHjewecrto5x/ZTv9HbHLMBTSmpw6WaglSFa/mKvHXnokqUedGuk5q0KY/qUNw9xWX8cugjT9X4s4oiudQVUnvVbK8A4ZcjPAD/GWpSgP6hLzwuxQ+xtprV5viXNmP+bbx829wYgT9XTuuN9d/8R8EIo2+DJXFIEn43yRutmFbWz1yGQOqMG1e6PifMRvjS1YhS2IC8RQaUxfEOBhmvXYb8RKHJNDo6I2p7RFB9o3sDK7Drt5Nhcv0KaHghQ7C+KcKBwIMjLCy2UWtYS0sscgLz4DPDJrClPC1ltVvSzKImFquC/Aw+DzobZGrQxS3Db3YlNqhwl1NI0j4khqKl++Jfds9snRc8qOlqjwG6jjbBY2HYHM2MJnJ1pO2F4JSEuHjobaLdTIWf3H5urO96smKiT1UI92yvDKquL5CSqbmTFvT1CXT9R3OZFK0zuz1l6Ba5T9FOcpJM5FNJy3qeH2IQPh9Oqorzx+Pd6NCbh6FRSFzBj0gWrsIGCzVk6x0IEUIoPqu+60554dc7B50FJoRkLJDY6zYrym9ZHTpT9kkRm1zYFCUlPNtN5fJKzFOdznJjOfMSGE0JG02AI0niCI4VbSSSFXwhL6YlNq8t1EmW7AtYu82q7DKvX2BkM4mum5E/DKzLf5eRQwQBopl8cb5JEatfUc9neb7nmWHBZ9vq2+QHxZuT21myMrZYv/e+YTCXDKNOYAtJvOBNAYCo//sXNqWc2H61seBQ02PwI4Uyg8equ7aPlwljXnh9BWlHVLVAB3bq+Jm6drBL2hIYlLon4PInl0NYWCQHG+2keALcSOnE1ivmePhqWXn9II+Rj9NxVDk01ZIvehDRj82oUR3dXs2hJNUD8P+krBe1LP2lOe4sp0lIIsLoZ9LdtD1LrDel8l3rrVzx3pcuY0mPPZWGSABsRTU4btgZ+nSP5TWRUb6m1PNHkkUX2VcHyLhaZnBj1g3S7KkYsR+jLgwHcEYxj1vpCGP+uMHBWTMJedHkT5wvhgxuEqI1+ISl2SMxK4OhzvNTDH4V+WEBYJCxAgwyh5Uf1AuAWuMT6IeSjgftLYCxy3NMsFCNn6XB+F5Xglf8Ten4n6QOZDm8WmzIoYkyiCqZM4seaExsOjc1jxUy3Xw/eAaGHHF7eDDB4ejENaQRBisBC4c3t/d8zzLdYRnuMvmC+nvj4LJGsvMVobnm2Zu5j4Ke+eyG6imqz22fryj7kcKPk26l8jFYx6eJe9JHE9RuXUesscWpQK/mtGpBcoblw7mixeRVe3JWjbWjrVMXyLK0KhJW2qiuNsnpYeaGLaCcM64pWOjTAnyHjLafrAHb/z5W09KAooexCib4+TOV0gbgjbbP28YBt8jgtAMOBur2sBjh/GK7XljfKbRLzCb89Rc3xW89NPUPX+QncW+TUDS7teL5mXfumYEJUpjw69Cj7uDklY9WZk7E/dsNxIlQitoSaFxAf1+C47o/qrPMsKpUZFnKlAEuNfTZbTgq7aSiks3IfvnackzGpBoV0/tDMMwI28/2arzFmLyA9C0YUZcONam1oVYIyNeNy1GkSpYgDF4PAEc2oHgz/Xmo7scWkCRg4DKKSox3/iddtVbLVMgVCDb0nNc93gO31IjJYZ8pJGnnZRwKSqPPQMxlmJSlmOIQLZqs6TS1FsLENuiu+oPDyCipDGGSFfeOZzC0BHhkbn5+5i1EY20C0KFHtIluRsCTFLMEk0Fygx8PKkvpL4mCXy9CBkuRG6FHfrsnKwtx3hNendYfJiFik+LaG0M7BF8NAGtYHYtMJnVq+mkm6WNkhJPl/lK+q/JrQB5mrRGSZEwYWVKS9bxiMvhfRqTFvWqCq/9JTSNp2qkA2flY2jPZy35q9KyXNXGn5qv6T161P55ElqveszBg3+r7Um4nEk+isvg7Q4f7TKN8j+AeQEK0M7RgyqEqyE8KTvJuBFTTvufeEs+pRhKpN3a1yIvyieMQ9hq+clHEWy071ItxNfqKW3nqVFqf+MCy/ZkbShKFUQbSW13ekgaPRAIUgm8u7qNAzKHbeQYKMkleXdEffhDP90nT3PCge+X61/pShPlqNFf19plWsl9UIfuqDAN1VPOG8diCyS2dM2ffbbFXwNqiKG7ZsJdUTwC0T3brfjAuCjn9GXPOP9k/oA31neReQwLtcyRmcIoyzJnH6sCK8evl8bupQl7CSiuwgbEIEgVDMPRupQorjM9CHbW1Y9ysChTr+k9U/V6uY1eHw+LeLRk1ZejJMT1trQSzpEeiJFUj7BwEcDB9fU3aiydxCEelvVtHMmqBxaRQJnOYuHNU8thqcPrv+z0dD/bem+tbtSmNue+KUFmKC+mhHCQsH08a41QUXVcKXPdEtrQwCtEQfyifu2OeU6iEbqFyh+xjK8lfzxqLRSwl1p2y624BuqgacftQwMkzJ/MQFuBpGpnvNR9bo4g2/VU/hEwf9/xbK4Bn7vavbXrhWBus96G+nn0W6/GGPT6E3GlUoTRgF65zCb+kxDxfWjftJF966GNZWuDf6+AB6IJr4GEPkbs+ZoS3Xbq/FOIBSUZBT+jIOq86sWQRgz5wpawbnNaRriy8PKLWjbOxk4BlqYRBa4oxJQFRJZehdEjBqeUaGGp3868O3Cp9kX0gizHeM7EUg0Sh0jQXV1KkF5gq3wVJ4h8O+D+K7D1nAXk6M3GfBmnC5eXBes5eK10mdq+n+5hS4ki9AOKSklcz2MDr7esuOO9a6B0eAwenH4AJq9H1ySSpXEqUohG4i5m91RA6Fjjpurgaiv/1gj+sIZ+R2DlG4tYk+m/Xk186zHGltSh627Lgl3z2XVPnTnuhIl0Npdy8Ab2qRLERxQWOv5Osuha6Vf0OyDVBZra1tR0yETE01vAzcBtj1Yei4AJ0Nb70e4zeL/nB1dzIoSei+EaQXrUYk9tyaBtloVYw0H7NFu63QLgSdfmk2kJrOEmTv78ZNXRbWOcEfOhufmvBrV+u4EBd1IbHdBiOExQLZVlvD6j1SKAADgjn9Vce9CRLgwx3DjcwHg5H2x6ohXd09t4SYIYKJi0ayR3YsXConLJOq38EVFZbnbAhrid3+MP9UvoxPU56QFSjgIuZIdhNbb80/Not7r0NKDh0qg9Woxtzqrpu+bktnxPjcY/r4WkvO6f6mm+Pv3q+lSH5QQYWgM63CUky+4mituk3XqvrqP2h/HEok+gWGkjTe/6tin/1sneFXDaBi84tv2AJuH9Ur7Y6G0gOXv00WJjtq+GqMkK8eq4hSEoR1VrwEGrrt+F/33vjnEMKqve7t5v5+4d7WAA7S9qJgT9P7qR6Py6gvtvIaOMmO2TV4Ebb+w2MVhaubfDMZnD24p3WBPw4NyuAyuZsDGx8VqQksXveAmUN14Sn+zaGylQNXhyDDjJOklIKacERcLnwmrCZEZreDXJO4jDvpMPjHm58w1KRQtKSU2xsltJBbHyX0OxrBRlKk6iKYhO4Lk7BWw4CVk5MuGW0/rb6J41OQpryAgQ1n0NKvIvRMZxROlMY1ecAVwUmgkySYf6Np0jUyFsOFqAaknTXjRG5vbYD7sGlcrrha+wIB4RJHJf5pf5ZKVz9IgOLr8Ol1J63Wwd02gOD79/IK+/DQFAr253aZ4YBkmCRwSQPQeLm8L5LLAaU8Hb9g/RZfp7d1ZhagDttR6S9Q8KIGPGLSmIMJaaNMLtW/YCk+1pCeZaWxKPi7O/L7lhRJ14iKDRpVp7t16I3ewcsTofH2xHqbH3ZXijcHS0xTbM48A0MYR+z00AWVRBcFlX1itY3qa/2op2n26maal3sngpAXET4rD6h7OG3EUXwom/mda61fxOvwUrnLIXf3Ngmq7VPmhuAEHFZfYzD9kmC9N8rcBBySolSWEm1qa9NuiQXnKsqGzv6jeoIR0QF3mA+K2aNBPCFNXPTR4ET0ULir1H1bW3EmWFJjBprHlKus1ZMDpiQujCsjBVeJ1gC4aWx9dFti+ZmGDUDfM+jUhBtF17k2TwhIN6jZCF+CwRGvkanbeu3Rv1//8OQAwuOi9ye0P3y/dQNCdCW/22M6SPeI9ByaAON2l8tMHUPez5zeDUq2WHJGrlQ/b/thChQm7Je03IqvRKsAaeFzOC63WTQ/vRYPntg6t5TvBmIUEXmYxo195+OJ0Tzyb7SWW1At3gpQorMp/nIfUjqcclC35IlOjtwe6u3ccVgCi0+NLeEOMxxqBxAZsalhErurAauIVc8j/qc5YKMTh7gG0S1T/pP/KdoHAdfE+3Ja9fF3U+oY7V0HACORe4EyZCHqcUwA64PIAaOcDpQmdIVWSAl+02U34bbLn3ZetdqR3JGkEYNxWmfDyu522qf+hMm94uDz0fMcxsoHANQjL0EnYYkf0LZGlhPVzFGeZHAShlz33zgr4qYc5dvULFwcUwN7YjrcDtmgQEGPilVq36FrPH62N4AgAb0AHR0Jo35VsCzm48b8RRNHxVfimt1Al6De98F3JcqHizm2OGAgbW0BYwbMzGgDgJHlEgbFa06qF9+nddrXO2H5HwoNGDWIVlwbZIWwAKsCAYnrGDYqfSmGdqeHMxLkSW9KTYke+5D0uF01ZQrJzqvj9BkehNAfaFmz5CM/nUidWRQ9waZe+yMzl8Yx3TBnPiE6MQr+2sPrX/B0jY/VAkdk0v488fCIG0hCq2L+CXxfxgKwt6BxNdP/Ck78AONtddPAU2nbCoXHZdfJAvapD5MFwmIS6+5dsFY2yoh50T9vOq3kWUycC2GCJYDV1YRhY6IDPnvFpZpLjDtXCRwN/wFi2jNePl2AwpvSNi+uGi1e3HKwaM2ohy/DtStM5fcsYk0CYMCozVJMoZwo1ClUclZTx9jYu3XCknzle8+GUMimKJKjdlE2SjZlU/umTnF+yHBzK7Qd1noF0pvozwGK/bsw7JOqBBpoASx3kRrqod/0/kUXhDD4NNSNl567WK5z4ZRECOfBgVoUjnXcAyTUQlWvbRT2M5r+qDHQ/MEyfE7Z6iFEpIoe8jPHO2ZPg5P5DTWwTbzfwVWoyMYsN3A5fq0ecc++mvUISfR5XnPvRwYdZGzb36ng0c5cWFYdDSc2ejkY0PfpyPc3PCfWDCeS4OOvsQfFBAS8lKkJZMFn8MdNigMLJTr1Kx5btHURzobgvVagQMbmgZLBDv3cirnBLoila+s4J57CA4MlQs/5OBgRpv9aj1Rb8zWPh7EZqSXYUepp12q+ocAHFjZUYWWA/xtTL+MQfyblz4a2FnI9Cx1XTn6NCJ0p4y49s3T0CldpV353GBJTqS8NaYTTAmtTYvX57H0BR2XN0Ula38WCTkx3ni3bmfQL64Wllaz13aJX6n/6UM3gsG73SrJDecLfa60eoKn0cjl961OPQihOBDGWGgU3GL405eDeuPLeFYhQFGdt0e1NbMxOtlG0yPalIJL9gwvQh/6NV+SLwHkbPtNAWFnS8XK9/znYttM61VF5HxQrAqTNTmyqM4He6WWYERfj999ZBCnau/Z43ATMjPbFA29Rbo6Z/8njtxkJ4FjFMIvB1DxQ+Hm+WmNIyev3/u2jZDUQNLRX/O/n6mVikGb0Xpq6WlMJ6Ls80DTJ8p9ZMen4yJph2zRx+rAb/jmVb4XsqRDyXufV/DORrrM+RFhpAix9nO6tjTkkZouMvUikrC3pj9P5myE7P1BQbN1bz4F1KPFUBzD8lyZvGBFoGBQknX/gs2XD0jFtx1zeN0A91rnLFsLQ7+jfLVWqynZ1+S/1bdErUDCyte9IohHUzAMbeV8zmMkh5hbO7sdVD/fhZXmMShsy4VjqKK/VKwcI8F0ENcY4pDWP5CEysCK/u6NILF7TDqq+XzAGSbjXnPzn8VzVk5ebPfkXXqiXIqH/sj+3OYLVczDK9UxxE9tvChSV741TTrGH5jJpiLdMLPa/RuiV0nT9dGlxTez8OsH/+qGu4VneuCBPXWxyd1NDSvdIzznYJIplUqAiM4bw/7u3UHc+kOytrkn09yDRynR0uRfxbZ3frMYqQhMD93qCDkjZIr1fzIwO96qkyjfGdvHbyO4ssYcjcWLqL6+mdM4OVVKk+UVwAiso7fq132gi+UDWdn1l/LKtFZrI93YOTiMB39WDXH3BoYExHWIAo7OUQnq8cp+T3bF2iWIqB7lw8HBCBOn3WpjCRFWgxTyANOZSYyChr2WG6MmiroQKqU0HyoTxD/uYBn6qBj7jdd/53xuyOXUIDVAR8HsyTKm6QYON2WcWzQcpoqMqHKAP+rsLaed0dDBKPvL551gJiOeENjK/dxonOLSGGMIRgKG3cYco2AE7Xne1AkXxeGy6VJ0gjCVTsP44P1f60qzGTmxtJFfNfQZCutXd0Tsw3UiBscHMZFsqY6IQF6SKQYILDRwZwRb81bA3GBJvPGqy0SK8zwmx00tJHcJEIRL+jTLrmsKFODgp0vjQbB0/Wr6faebFymEGpTNxGAjMt6faAq19Wr7sQbeJVJ7X0e9+I4aQvZjnZ24KVkKeMfUnRYIAwTGnvHMgqztmwWCnn70uuDRnt8RhEh0/8pOvKKAJ8z+XcRVcQmBtXfBHGei6xicl5hUF03Vm63IIggHlDB9KafqBXMYUGt/qq6+Zc3Vzg7E4OkqxhHsMkInhpJ+VvLx/TzFm34dP4U1GRy+zx87D8TNXbXY2qVeFaqDsl2vuw/zMVTQvkgiN9hxULtoVGNmgl4eBgk4vxOqgVDSaAQW5nppmXXObb/+7WTlXvsB9gy823o7CZ9czMjewvrM8au4+rT21a2KsTPlx+4nHjlXtgDAQPGvqQUThSp2a6OnXZK340EiorEaRDRzmlQ1WdzZPF0y2G0y3aYemYEVEHpFcKsorDQG3Nm0DlP9WBWe3cyQ3aGdTFVSoy9SOo2KHclm6KHGJZP7bSIycOsf8zZ5Kacc9Fhvnd061LeNHKz8SnzBy5hWNjW1zkV7T1mLcj5lUjiV7tMV2AC13tdNzySGZRC9hKF+a19xRCvdTlltu+gSoY2H1YxTxZDv8kiVA0Bt321ogZFOH7rJ6boAnr+t5G6R0uzfzN9wv9f8WY1podd4STi7lU0UrrFg2iVjLcsDX3btg7qg/J3ud/XnfIONhPx7ChgX/+gD1JZQq2umoecT4v9iIzhd159LhwPBfl+ty0+dPJw0ZP4aHKOHPeryoXgXhU/ebA3kQpBM8VV9gVVdJuTf0ohVb/GlX6ybMDHFzmlYCTVrxyvNADA7LGLS5eP//ZtOTR3DVa/1izc05sjktprbuqnis7GImeHqVsR4IXr3L3azdb5FwVoX9GKDGZrMoitMZF8OFMPS6/2j5+71cGeV1ThuYO8eFHE6QUW2JEhLfvdiwuRjZamBZ1q0hhtS82JbVL9AAk2JT+WihoK3pthq2gUA+c0Lx8kWCzQjT7bJyKvqPelAVzpItJmX/fUvR+oLhd6DQSgNe6ONzfdhcAdIhc9P7Tlt2QNRi5bQlA84fliE468GHLlmoxvZCZwlNb61ACl9z2uMpCveU5iE307M2I1RUGj10w2+9mBORX3A+cyPAr4jL0kivhsYKhg2eR4U5VisSI31xkM+1QXH+e9HdCB+NSSm1hqiT3i8MVeH41PZXST898d/Uh8XIlP8rmHL09tIQwtE/nFezBJvGC52eqxPZdPBuynyHoth9zsdb6pLRkOE1GbJQS3jq6U8ybNUdRQ8SEhpTgdAWOhJgkPGBTuQSRU1MY15XScP5SD+ueBkRQo3yQ5vjN2d/FQo5CIDT1rFHX76quaoTptxucV+mO3x7gQ4uTNVJRkR6Gr9z9YSymCRsW+8UmXabxyOAiKOUFLTDD5FTeK0R1fog0z/Ud/HMe4bNLUpfvMKku9fx8aPPACT+HVxRcuQk87WNNAJH4sGURL4xHq6eMaUW2Ju7v/7N9EgM+MAmahBfxZBPu9rZCfIX2hh6DOOKkzPo2Dcod+prkXrZoxyc+H2Sf9bduR7iqKu2auddHVAxUi
</div>
<script src="/lib/crypto-js.js"></script><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>知识点</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>博客优化</tag>
      </tags>
  </entry>
  <entry>
    <title>百度文字合成语音的api接口，以及其他失效的接口，找了新的免费语音接口！</title>
    <url>/2019/01/11/baidu-yuyin/</url>
    <content><![CDATA[<h1 id="最近"><a href="#最近" class="headerlink" title="最近"></a>最近</h1><p>有朋友博文<a href="http://localhost:4000/2018/04/24/my-apis/">自写与收集的一些免费的API接口（获取QQ昵称、头像、QQ秀等等…）</a>的评论里留言说，收集的api接口，有的已经失效了</p>
<p>也抽空看了，有几个确实是已经失效了，QQ秀的接口暂时没有找到新的</p>
<p>今天是找了下语音接口，就是文字转成语音的接口</p>
<p>其他的不多说了</p>
<p>直接开始贴接口地址，和参数说明吧</p>
<h1 id="1丶文字转语音"><a href="#1丶文字转语音" class="headerlink" title="1丶文字转语音"></a>1丶文字转语音</h1><p>① 接口地址：</p>
<span id="more"></span>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://ai.baidu.com/aidemo?type=tns2&amp;idx=1&amp;&amp;cuid=baidu_speech_demo&amp;cod=2&amp;lan=zh&amp;ctp=1&amp;pdt=1&amp;spd=5&amp;per=0&amp;vol=5&amp;pit=5&amp;tex=需要转换的文字内容</span><br></pre></td></tr></table></figure>

<h1 id="2丶文字转语音"><a href="#2丶文字转语音" class="headerlink" title="2丶文字转语音"></a>2丶文字转语音</h1><p>② 接口地址：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://tts.baidu.com/text2audio?idx=1&amp;cuid=baidu_speech_demo&amp;cod=2&amp;lan=zh&amp;ctp=1&amp;pdt=1&amp;spd=5&amp;per=1&amp;vol=9&amp;pit=5&amp;tex=需要转换的文字内容</span><br></pre></td></tr></table></figure>

<h1 id="参数说明："><a href="#参数说明：" class="headerlink" title="参数说明："></a>参数说明：</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cuid：是程序id，默认的这个是百度测试demo，需要自己单独的id可以去百度语音官网申请。</span><br><span class="line">per：男声0，女声1</span><br><span class="line">spd：速度参数，1~10，数字越大语音速度越快</span><br><span class="line">pit：变声参数，1~10，数字越小越低沉，数字越大音调越高</span><br><span class="line">tex：文本内容，也就是你要转换成语音的文字</span><br></pre></td></tr></table></figure>

<p>GET请求接口，会得到一个aidemo文件，后缀改成任意能识别的音频文件名称即可播放。</p>
<p>其他几个参数貌似没什么变化，暂时不知道是什么，可以自己改变一下数字试一下。</p>
<p>暂时先这样，</p>
<p>失效的接口到时候找到了新的再新增到这里。</p>
<p>失效了的，直接评论里留言即可</p>
<h1 id="么么扎！"><a href="#么么扎！" class="headerlink" title="么么扎！"></a>么么扎！</h1>]]></content>
      <categories>
        <category>知识点</category>
      </categories>
      <tags>
        <tag>语音识别</tag>
        <tag>语音合成</tag>
      </tags>
  </entry>
  <entry>
    <title>Android 利用腾讯开放平台的官方SDK，实现自定义QQ分享。并备份一下android-support-v7安卓支持包！</title>
    <url>/2018/10/28/android-qq-share/</url>
    <content><![CDATA[<h1 id="开头废话"><a href="#开头废话" class="headerlink" title="开头废话"></a>开头废话</h1><p>前些日子换了手机，旧手机上的数据忘了迁移备份就急急忙忙的重置格式化了，很难受！开发的一些APP源码也就给丢失了，然后只好去自己的群里面，找到曾经上传的旧版本，把他反编译出来一点点的还原。</p>
<p>逆向始终不是自己会玩的东西，所以效果很不理想，特别是我这种纯手机端进行编写操作的编程爱好者。蓝瘦香菇！</p>
<p>今天想要说一下那个自定义QQ分享的东西，官方文档以及demo最近也好像是做了一下更新。最烦的就是更新了的文档也不是那么的简洁明了，实在不是很适合给一般的coder看￣ ￣)σ。</p>
<p>好吧，还是直接去开始吧。</p>
<h1 id="开整"><a href="#开整" class="headerlink" title="开整"></a>开整</h1><span id="more"></span>

<p>1丶打开我的AIDE…</p>
<p>2丶新建工程项目</p>
<p>3丶到<a href="http://wiki.open.qq.com/wiki/mobile/SDK%E4%B8%8B%E8%BD%BD">QQ开放平台</a> 下载SDK</p>
<p>4丶解压SDK，把两个jar包导入工程项目的libs文件夹，没有这个文件夹自己新建一下</p>
<p>5丶然后，我们就可开始码代码了</p>
<p>6丶首先配置一下AndroidManifest文件，权限设置和注册Activity</p>
<p>权限代码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- APP联网所需权限 --&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot; /&gt;</span><br><span class="line">&lt;!-- 在SDCard中创建和删除文件的权限 --&gt; </span><br><span class="line">&lt;uses-permission </span><br><span class="line">	android:name=&quot;android.permission.MOUNT_UNMOUNT_FILESYSTEMS&quot; /&gt; </span><br><span class="line">&lt;!-- 往SDCard中写入数据的权限 --&gt;</span><br><span class="line">&lt;uses-permission </span><br><span class="line">	android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>当然，以上权限并不全都用的上或者不够，可以根据自己的需求进行增减。</p>
<p>然后是SDK需要的Activity注册了，一下代码放入到<application>标签中即可：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 注册SDKActivity --&gt;</span><br><span class="line">&lt;activity</span><br><span class="line">	android:name=&quot;com.tencent.tauth.AuthActivity&quot;</span><br><span class="line">		android:noHistory=&quot;true&quot;</span><br><span class="line">		android:launchMode=&quot;singleTask&quot; &gt;</span><br><span class="line">		&lt;intent-filter&gt;</span><br><span class="line">			&lt;action android:name=&quot;android.intent.action.VIEW&quot; /&gt;</span><br><span class="line">			&lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;</span><br><span class="line">			&lt;category android:name=&quot;android.intent.category.BROWSABLE&quot; /&gt;</span><br><span class="line">			&lt;data android:scheme=&quot;tencentID1106885928&quot; /&gt; &lt;!-- 获取的APPID --&gt;</span><br><span class="line">		&lt;/intent-filter&gt;</span><br><span class="line">	&lt;/activity&gt;</span><br></pre></td></tr></table></figure>

<p>新版的SDK增加了AssistActivity，所以也要在这里给他加上去</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;activity android:name=&quot;com.tencent.connect.common.AssistActivity&quot;</span><br><span class="line">	android:theme=&quot;@android:style/Theme.Translucent.NoTitleBar&quot;</span><br><span class="line">	android:configChanges=&quot;orientation|keyboardHidden|screenSize&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>配置好了之后，就开始写java代码了。</p>
<p>首先，创建实例。Tencent是SDK的功能入口，所有的接口调用都得通过Tencent进行调用。因此，调用SDK，首先需要创建一个Tencent实例，其代码如下：</p>
<pre><code>private static final String APP_ID = &quot;1106885928&quot;; // appid跟换成你自己的，可以在开放平台新建应用之后获取
private Tencent mTencent;
    //传入参数APPID
    mTencent = Tencent.createInstance(APP_ID, MainActivity.this.getApplicationContext());</code></pre><p>   接下来就是实现回调，也就是你分享东西出去是成功了还是失败了，又或者是用户取消了分享呢？具体就是：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line">* 自定义监听器实现IUiListener，需要3个方法</span><br><span class="line">*</span><br><span class="line">* onComplete完成 onError错误 onCancel取消</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">private class ShareUiListener implements IUiListener</span><br><span class="line">&#123;</span><br><span class="line">	@Override</span><br><span class="line">	public void onComplete(Object response)</span><br><span class="line">	&#123;</span><br><span class="line">		//分享成功</span><br><span class="line">		def_note(&quot;成功分享！&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	@Override</span><br><span class="line">	public void onError(UiError uiError)</span><br><span class="line">	&#123;</span><br><span class="line">		//分享失败</span><br><span class="line">		def_note(&quot;分享失败！&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	@Override</span><br><span class="line">	public void onCancel()</span><br><span class="line">	&#123;</span><br><span class="line">		//分享取消</span><br><span class="line">		def_note(&quot;您取消了分享！&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 回调</span><br><span class="line"> *</span><br><span class="line"> * @param requestCode</span><br><span class="line"> * </span><br><span class="line"> * @param resultCode</span><br><span class="line"> * @param data</span><br><span class="line"> */</span><br><span class="line">@Override</span><br><span class="line">protected void onActivityResult(int requestCode, int resultCode, Intent data)</span><br><span class="line">&#123;</span><br><span class="line">	if (null != mTencent)</span><br><span class="line">	&#123;</span><br><span class="line">		mTencent.onActivityResult(requestCode, resultCode, data);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>到这里就基本上搞好了。</p>
<p>然后就是对官方文档里面提到的api数据封装功能函数，可以分享链接，音乐，图片，应用这些东西，具体就是这样：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 分享到QQ</span><br><span class="line"> * @param v</span><br><span class="line"> */</span><br><span class="line">public void qqShare(String t, String s, String u, String p, String w)</span><br><span class="line">&#123;</span><br><span class="line">	final Bundle params = new Bundle();</span><br><span class="line">	params.putInt(QQShare.SHARE_TO_QQ_KEY_TYPE, QQShare.SHARE_TO_QQ_TYPE_DEFAULT);//分享的类型</span><br><span class="line">	params.putString(QQShare.SHARE_TO_QQ_TITLE, t);//分享标题</span><br><span class="line">	params.putString(QQShare.SHARE_TO_QQ_SUMMARY, s);//要分享的内容摘要</span><br><span class="line">	params.putString(QQShare.SHARE_TO_QQ_TARGET_URL, u);//内容地址</span><br><span class="line">	params.putString(QQShare.SHARE_TO_QQ_IMAGE_URL, p);//分享的图片URL</span><br><span class="line">	params.putString(QQShare.SHARE_TO_QQ_APP_NAME, w);//应用名称</span><br><span class="line">	mTencent.shareToQQ(MainActivity.this, params, new ShareUiListener());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 分享到QQ空间</span><br><span class="line"> * @param v</span><br><span class="line"> */</span><br><span class="line">public void qqQzoneShare(String t, String s, String u, String p, String w)\r\n	&#123;\r\n        int QzoneType = QzoneShare.SHARE_TO_QZONE_TYPE_NO_TYPE;\r\n        Bundle params = new Bundle();</span><br><span class="line">	params.putInt(QzoneShare.SHARE_TO_QZONE_KEY_TYPE, QzoneType);</span><br><span class="line">	params.putString(QzoneShare.SHARE_TO_QQ_TITLE, t);//分享标题</span><br><span class="line">	params.putString(QzoneShare.SHARE_TO_QQ_SUMMARY, s);//分享的内容摘要</span><br><span class="line">	params.putString(QzoneShare.SHARE_TO_QQ_TARGET_URL, u);//分享的链接</span><br><span class="line">	//分享的图片, 以ArrayList&lt;String&gt;的类型传入，以便支持多张图片（注：图片最多支持9张图片，多余的图片会被丢弃）</span><br><span class="line">	ArrayList&lt;String&gt; imageUrls = new ArrayList&lt;String&gt;();</span><br><span class="line">	imageUrls.add(&quot;http://www.hzv5.cn/logo.jpg&quot;);//添加一个图片地址</span><br><span class="line">	params.putStringArrayList(QzoneShare.SHARE_TO_QQ_IMAGE_URL, imageUrls);//分享的图片URL</span><br><span class="line">	mTencent.shareToQzone(MainActivity.this, params, new ShareUiListener());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 分享音乐</span><br><span class="line"> * @param v</span><br><span class="line"> */</span><br><span class="line">private void qqAudioShare(String t, String s, String u, String p, String w)</span><br><span class="line">&#123;</span><br><span class="line">	int ii = def_getNum(0, songlist.length - 1);</span><br><span class="line">	final Bundle params = new Bundle();</span><br><span class="line">	params.putInt(QQShare.SHARE_TO_QQ_KEY_TYPE, QQShare.SHARE_TO_QQ_TYPE_AUDIO);</span><br><span class="line">	params.putString(QQShare.SHARE_TO_QQ_TITLE, t);</span><br><span class="line">	params.putString(QQShare.SHARE_TO_QQ_SUMMARY,  s);</span><br><span class="line">	params.putString(QQShare.SHARE_TO_QQ_TARGET_URL,  u);</span><br><span class="line">	params.putString(QQShare.SHARE_TO_QQ_IMAGE_URL, p);</span><br><span class="line">	params.putString(QQShare.SHARE_TO_QQ_AUDIO_URL, songlist[ii]);</span><br><span class="line">	params.putString(QQShare.SHARE_TO_QQ_APP_NAME,  w);</span><br><span class="line">	//params.putInt(QQShare.SHARE_TO_QQ_EXT_INT, QQShare.SHARE_TO_QQ_FLAG_QZONE_AUTO_OPEN);</span><br><span class="line">	mTencent.shareToQQ(MainActivity.this, params, new ShareUiListener());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>到这里整个工程项目的QQ自定义分享基本上就完成了，这里算是给自己也做了一份备份。</p>
<h1 id="V4，V7支持包"><a href="#V4，V7支持包" class="headerlink" title="V4，V7支持包"></a>V4，V7支持包</h1><p>另外再备份两个东西，那就是安卓的android-support-v4，和v7支持包，特别是v7包，网上找的全是那种缺胳膊少腿的，找个完整的v7找了我两天时间！这个是安卓25版本的。</p>
<p>不是最新，但是够用就行了。</p>
<p>v4下载链接：<a href="https://pan.baidu.com/s/1aotD4JKcPgwje1a4cPsfqg">点击下载v4 提取码：65o3</a></p>
<p>v7下载链接：<a href="https://pan.baidu.com/s/1TuK2qB5lzy6JC8ymcJxBbA'">点击下载v7 提取码：n54t</a></p>
<p>OK，?完美！</p>
<p>笔芯❤！</p>
]]></content>
      <categories>
        <category>知识点</category>
      </categories>
      <tags>
        <tag>QQ分享</tag>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>关于Android自定义QQ分享提示未正确授权，错误码901115</title>
    <url>/2018/08/15/QQshare-Err/</url>
    <content><![CDATA[<h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>最近，QQ更新了一个成语接龙玩法的红包</p>
<p>于是乎，博主突然就想搞一个成语查询的工具2333，在给App添加一个分享应用到QQ的时候，发现出现一个错误提示，都是按之前的app写法写的，怎么就报错了，于是乎找到几个之前写的app发现也是一样报这个错误了：</p>
<p>错误提示如图：</p>
<span id="more"></span>

<p><img src="/img/QQshareErr/01.png" alt="QQ分享错误示例"></p>
<p>然后感觉就是，是不是因为QQ互联官网更新了QQ分享的SDK，于是乎，我打开了官网一看，还真的是，顶部出现了一条醒目的公告提示，这个提示已经有一段时间了，怪我最近没怎么做相关开发，没注意23333…</p>
<p>参考： <a href="https://wiki.connect.qq.com/%E5%8A%A0%E5%BC%BAqq%E4%BA%92%E8%81%94%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8-android%E5%8C%85%E5%90%8D%E5%92%8C-ios-bundleid-%E6%A0%A1%E9%AA%8C%E7%9A%84%E9%80%9A%E7%9F%A5%EF%BB%BF" title="加强QQ互联移动应用 Android包名和 iOS Bundleid 校验">加强QQ互联移动应用 Android包名和 iOS Bundleid 校验</a></p>
<p>一看公告，这个校验新方法已经是5月30日开始的了，我这是多久没关注相关的应用使用QQ分享了23333</p>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><p>根据公告说的，是为了保障QQ用户的安全，以免被恶意盗用，加强了应用的校验，如不进行信息完善，应用将无法登录和分享至QQ好友和QQ群，所以我们补全信息即可。我们进入QQ互联平台登记的应用：QQ互联官网：<a href="https://connect.qq.com/index.html" title="QQ互联官网 - 应用管理">QQ互联官网 - 应用管理</a> 应用管理中进行补充；</p>
<p><strong>（修改路径为：应用管理 – 移动应用 – 查看（应用）– 基础信息 – 平台信息 – 修改）</strong></p>
<p><img src="/img/QQshareErr/02.png" alt="进入应用"></p>
<p><img src="/img/QQshareErr/03.png" alt="修改应用信息"></p>
<p>进入修改应用信息后，添加用到该APPID的应用包名以及签名，每个APPID最多支持6组app共用。</p>
<p><img src="/img/QQshareErr/04.png" alt="添加应用包名与签名"></p>
<p>还有就是别忘了应用接口权限别忘了看一看有没有获取打开</p>
<p><img src="/img/QQshareErr/05.png" alt="管理应用权限"></p>
<h1 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h1><p>到这里就解决了这个错误码为901115的QQQ分享报错了。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>一个不算问题的问题，出于平时使用频率小，导致没怎么关注这个，当使用的时候就一脸懵逼</p>
<p>捋清思路之后，问题就简单了</p>
<p>么么扎~~</p>
]]></content>
      <categories>
        <category>知识点</category>
      </categories>
      <tags>
        <tag>笔记</tag>
        <tag>知识点</tag>
        <tag>Android</tag>
        <tag>QQ分享</tag>
      </tags>
  </entry>
  <entry>
    <title>吐槽一下下，关于最近的社交软件开放的账号销户功能！</title>
    <url>/2018/05/04/tucao-sjirji/</url>
    <content><![CDATA[<p>此前，是在QQ群里看到QQ账号可以注销的消息的，用了十几年QQ了，第一次听到QQ可以注销</p>
<p>【PS：此注销不是退出登录，而是直接把QQ账号销户】。</p>
<p><img src="/img/tucao/IMG_QQxh_01.png" alt="QQ账号销户"></p>
<p>但是腾讯是不是太天真了？</p>
<p>用了十几年的QQ我们会想要注销？</p>
<span id="more"></span>

<p>知不知道QQ对于我们八零九零意味着什么？(｡･ˇ_ˇ･｡)是不是脑子有泡？</p>
<p>这不，才上线没多久的QQ号码销户入口，今天再去看的时候就蜜汁消失了！突然的突然的开放销户又突然的关闭，不知道是什么原因，很迷！</p>
<p>然后今天是因为收到一个UC浏览器的推文《<a href="https://mparticle.uc.cn/article.html?uc_param_str=frdnsnpfvecpntnwprdssskt&client=ucweb&wm_cid=220813119445534720&wm_id=04fcc49832dc4f04ae8b82194e6bf87c&title_type=1&pagetype=share&app=uc-iflow&btifl=100&wm_aid=10625dbef0684f75800da634f77f3a6a&sdkdeep=2&sdksid=bfe73bdb-01cf-eafe-89a6-7cafb58185e1&sdkoriginal=bfe73bdb-01cf-eafe-89a6-7cafb58185e1" target="_blank" title="工信部一锤定音: 再见了微信微博!">工信部一锤定音: 再见了微信微博!</a>》，UC的小编我是真的很佩服的，同一件事和主人公，可以写N个故事！把文章标题也是命名的极其吸引人！(抱拳了，老铁！)。看了这水文之后，就去看了一下微信和微博，发现确实是可以注销账号了！</p>
<p>如下两图：</p>
<p><img src="/img/tucao/IMG_QQxh_02.png" alt="申请注销微信"><br><img src="/img/tucao/IMG_QQxh_03.png" alt="申请注销微博"></p>
<p>然而，注销账号似乎并没有那么简单，首先你得把账号里的钱填平，还有平时在别的APP或者网站上的快捷登录授权解除才可以！具体看下面注销微信和微博的两个截图：</p>
<p><img src="/img/tucao/IMG_QQxh_05.png" alt="注销微信时提醒"><br><img src="/img/tucao/IMG_QQxh_04.png" alt="注销微博时提醒"></p>
<p>说起来也是，自己主动注销的话，各种限制，极其不愿意让你销户，这让我想起了两个比较”有意思的”电脑杀毒软件，也不知道是什么情况下安装的，自己都不知道，卸载的时候弹出N次选择框让你确认，还故意把确认卸载按钮颜色弄成暗色，把取消下载弄成高亮色！</p>
<p>甚至一会儿确认在右边，一会儿在左边！呵呵哒…不知道正在看此篇博文的你有没有遇到过这种极其”流氓”的软件！</p>
<p>主动销户困难，但是”被”销户就死很简单的事！<br>只要你违规了该APP的一些规定！他们就可以冻结你的账号，甚至是直接销户！也就不管你有没有把坑填平或者解除账号授权什么的了，这是一种什么操作？</p>
<p>现在手机软件、社交媒体、购物平台等网络账号中很少有提供注销账号的服务。一旦用户注册账号，即使不再使用，此前其注册信息、购买记录、好友通讯录等都还将继续储存在平台系统中。</p>
<p>而且很多软件和平台为了推广，各种吸引眼球的广告吸引大家去注册试用，但是大部分情况下这些软件和平台并不是我们需要的，很多注册了发现不是自己需要的，就直接关掉或卸载不管了。<br>因此现在用户的个人资料很容易会被泄露。</p>
<p>很多的APP都会读取我们的手机通讯录，地理位置等信息，乍看之下，无非就是多几个废弃的账号而已，但随着个人资料和信息权利重要性的提升，保留在账户里面的所有个人资料都有可能被利用、贩卖，大大增加用户隐私泄露的风险。</p>
<p>所以大家要是有注册了一些平台或APP账号，又没有使用的话最好及时注销掉，这些不用的账号说不好很有可能会泄露你，甚至是家人朋友的个人隐私，注销掉不仅能减少自身风险，以后换号码也简单多了。</p>
<p>为什么手机号码用久了，广告短信息越来越多？这会儿应该不言而喻了吧！个人是很赞成工信部出来管制的，任何平台都应该开放用户主动注销账号的权限！</p>
<p>五一期间大家都在更博，我实在是没什么可以拿出来的，今天就借UC推文码了一堆口水文！2333…</p>
<p>食用完水文，记得流行评论，发变一下你的看法！</p>
]]></content>
      <categories>
        <category>收集控</category>
      </categories>
      <tags>
        <tag>免费api</tag>
        <tag>接口收集</tag>
      </tags>
  </entry>
  <entry>
    <title>关于新版彩虹代刷hashsalt值如何还原出真实值</title>
    <url>/2018/04/23/caihong-encode/</url>
    <content><![CDATA[<p>最近在qq群上，有朋友要求我更新一下免费领赞(QQ名片赞)App(极其无聊的app但是喜欢的人却很多)，</p>
<p>以为老接口都失效了，然后去研究了一下代刷站点发现，新版本的彩虹代刷程序增加了hashsalt值 + cookies值方式的验证，</p>
<p>其主要目的可能就是为了加大写软件的难度，以及防止恶意刷单！</p>
<p>直接查看代刷站源码，可以看到hashsalt值大概是这样的：</p>
<span id="more"></span>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function getHashsalt() &#123;</span><br><span class="line">   var hashsalt = ([] + &#123;&#125;)[!+[] + !![] + !![] + !![] + !![]] + (!+[] + !![] + !![] + !![] + !![] + []) + (!+[] + !![] + !![] + !![] + !![] + !![] + !![] + !![] + !![] + []) + ( + &#123;&#125; + [])[ + !![]] + (!+[] + !![] + !![] + !![] + !![] + !![] + !![] + !![] + []) + ([] + &#123;&#125;)[!+[] + !![] + !![] + !![] + !![]] + (!+[] + !![] + !![] + !![] + []) + ( + &#123;&#125; + [])[ + !![]] + (!+[] + !![] + !![] + !![] + !![] + !![] + !![] + !![] + !![] + []) + ( + !![] + []) + ([] + &#123;&#125;)[!+[] + !![]] + (!+[] + !![] + !![] + !![] + !![] + []) + (!+[] + !![] + !![] + []) + (!+[] + !![] + !![] + !![] + !![] + !![] + []) + ( + !![] + []) + ( + !![] + []) + (!+[] + !![] + !![] + !![] + !![] + !![] + !![] + !![] + []) + (!+[] + !![] + !![] + !![] + !![] + !![] + []) + (!+[] + !![] + !![] + !![] + !![] + !![] + !![] + !![] + !![] + []) + (!+[] + !![] + !![] + !![] + []) + (!+[] + !![] + !![] + !![] + !![] + !![] + !![] + !![] + !![] + []) + (!+[] + !![] + !![] + !![] + []) + ( + [] + []) + ( + !![] + []) + (!+[] + !![] + !![] + !![] + !![] + []) + ([][[]] + [])[!+[] + !![]] + (!+[] + !![] + !![] + !![] + !![] + !![] + !![] + []) + (!+[] + !![] + !![] + !![] + !![] + []) + (!+[] + !![] + !![] + !![] + !![] + !![] + []) + ( + [] + []) + ([][[]] + [])[!+[] + !![] + !![]] + (!+[] + !![] + !![] + []);</span><br><span class="line">    return hashsalt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这看着着实让人很懵。</p>
<p>然后搜了一下发现，精易论坛的大佬[@l1294066497]以及把怎么得到准确的hashsalt值，用易语言的方法发出来了。</p>
<p>就是直接调用<code>V8 JavaScript</code>引擎处理即可，关于该引擎可详见百度百科介绍：<a href="https://baike.baidu.com/item/V8/6178125" title="V8 JavaScript 引擎">https://baike.baidu.com/item/V8/6178125</a></p>
<p>还原hashsalt值，以及如何得到cookies值的易语言方法的代码如下图所示：</p>
<p><img src="/img/caihong/01.png" alt="hashsalt值"></p>
<p>最后是测试运行，调试结果如下：</p>
<p><img src="/img/caihong/02.png" alt="测试运行"></p>
]]></content>
      <categories>
        <category>知识点</category>
      </categories>
      <tags>
        <tag>彩虹代刷</tag>
        <tag>算法解密</tag>
      </tags>
  </entry>
  <entry>
    <title>最近有一件很神奇的事情发生，哈哈！</title>
    <url>/2018/03/16/waooooo/</url>
    <content><![CDATA[<h1 id="缘起"><a href="#缘起" class="headerlink" title="缘起"></a>缘起</h1><p>最近两个星期，有一件很神奇的事情。</p>
<p>不知道什么时候的事情了，在手机端利用AIDE写了一个吉普赛读心术的app，最初是尝试的心态上架了百度手机助手，但是没想到通过审核了。</p>
<p>后来没做什么更新，(大概三个月左右之后)就被下架了。</p>
<p>APP的主界面大概长这个样子：</p>
<span id="more"></span>

<p><img src="/img/duxin/dx_01.jpg" alt="APP的主界面"></p>
<p>最近有几位兄弟找到我，询问关于这个软件的原理是什么！</p>
<p>我这边都是4字真言回复了他们：</p>
<p>9的倍数！（这算是高冷嘛？）</p>
<h1 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h1><p>具体原理是这样的：</p>
<p>先来大概看一下流程，app的规则如下：</p>
<p><img src="/img/duxin/dx_02.jpg" alt="APP的主界面"></p>
<p>（有的朋友看了规则就说，算法是固定的，你直接按照那个算法倒推回去不就是答案了嘛？其实不然，因为系统并不知道最初用户选择的是什么数字，更不知道用户通过算法计算之后的数字是什么！）</p>
<p>然后这是用户寻找计算数字对应的符号的界面：</p>
<p><img src="/img/duxin/dx_03.jpg" alt="APP的主界面"></p>
<p>然后是系统给出答案的界面：<br><img src="/img/duxin/dx_04.jpg" alt="APP的主界面"></p>
<p>4字真言“9的倍数”说的是：</p>
<p>当用户心里默选了一个两位数的数字之后，通过上面提到的规则进行计算，得到的任何一个新的数字，必定是一个9的倍数，所以只需要将列表中的9的倍数对应的符号全部显示成一样的就可以了，最后再显示结果！</p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>(知道了原理，就像魔术被解密了一样，变得了无生趣了，有木有？)</p>
<p>还是很好奇他们是从哪里下载的APP.</p>
<img src="http://img.baidu.com/hi/jx2/j_0078.gif"/>
在这里再次放一下APP的链接吧，有兴趣怼我拿去玩儿

<h1 id="下载链接"><a href="#下载链接" class="headerlink" title="下载链接"></a>下载链接</h1><p>链接:<a href="https://pan.baidu.com/s/1fbz5Wbgex54NVoRW3mrmwQ">https://pan.baidu.com/s/1fbz5Wbgex54NVoRW3mrmwQ</a> 密码:7cu8</p>
<img src="http://img.baidu.com/hi/jx2/j_0057.gif">]]></content>
      <categories>
        <category>随笔</category>
      </categories>
      <tags>
        <tag>随笔</tag>
        <tag>吐槽</tag>
      </tags>
  </entry>
  <entry>
    <title>php自写api数据接口实例笔记</title>
    <url>/2018/01/30/php-api/</url>
    <content><![CDATA[<p>php写api接口起初是因为自己在玩机器人软件，需要进行数据交互，例如看笑话，查天气，查快递等等的一些数据，来丰富机器人的功能，现在本站暂时保留着两个就博客的api接口，<img src="http://img.baidu.com/hi/face/i_f08.gif"/></p>
<p>css什么的失效了，暂时没去管：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://www.hzv5.cn/api/ai.php</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://www.hzv5.cn/api/sina_url.php</span><br></pre></td></tr></table></figure>

<img src="http://img.baidu.com/hi/face/i_f05.gif"/>

<p>下面就来看看怎么自己写一个api接口吧：</p>
<p>实例代码：</p>
<span id="more"></span>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">  $output = array();  $a = @$_GET[&quot;a&quot;] ? $_GET[&quot;a&quot;] : &quot;&quot;;</span><br><span class="line">  $uid = @$_GET[&quot;uid&quot;] ? $_GET[&quot;uid&quot;] : 0;\r\n  if (empty($a)) &#123;</span><br><span class="line">    $output = array(&quot;data&quot;=&gt;NULL, &quot;info&quot;=&gt;&quot;非常抱歉，缺少参数!&quot;, &quot;code&quot;=&gt;-201);</span><br><span class="line">    exit(json_encode($output));</span><br><span class="line">  &#125;</span><br><span class="line">  //接口走的端口</span><br><span class="line">   if ($a == &quot;get_users&quot;) &#123;</span><br><span class="line">     //检查用户</span><br><span class="line">     if ($uid == 0) &#123;</span><br><span class="line">       $output = array(&quot;data&quot;=&gt;NULL, &quot;info&quot;=&gt;&quot;The uid is null!&quot;, &quot;code&quot;=&gt;-401);</span><br><span class="line">       exit(json_encode($output));</span><br><span class="line">     &#125;</span><br><span class="line">     //假设 $mysql 是数据库或者从网络读取的数据</span><br><span class="line">     $mysql = array(</span><br><span class="line">       10001 =&gt; array(</span><br><span class="line">         &quot;uid&quot;=&gt;10001,</span><br><span class="line">         &quot;vip&quot;=&gt;5,</span><br><span class="line">         &quot;nickname&quot; =&gt; &quot;Shine X&quot;,</span><br><span class="line">         &quot;email&quot;=&gt;&quot;88888888@qq.com&quot;,</span><br><span class="line">         &quot;qq&quot;=&gt;88888888,</span><br><span class="line">         &quot;ctime&quot;=&gt;1320321234,</span><br><span class="line">         &quot;lastLogin&quot;=&gt;1321121144,</span><br><span class="line">         &quot;level&quot;=&gt;19</span><br><span class="line">       ),10002 =&gt; array(</span><br><span class="line">         &quot;uid&quot;=&gt;10002,</span><br><span class="line">         &quot;vip&quot;=&gt;3,</span><br><span class="line">         &quot;nickname&quot; =&gt; &quot;elva&quot;,</span><br><span class="line">         &quot;email&quot;=&gt;&quot;99999999@qq.com&quot;,</span><br><span class="line">         &quot;qq&quot;=&gt;NULL,</span><br><span class="line">         &quot;ctime&quot;=&gt;1372323234,</span><br><span class="line">         &quot;lastLogin&quot;=&gt;1371122114,</span><br><span class="line">         &quot;level&quot;=&gt;12,</span><br><span class="line">       )</span><br><span class="line">     );</span><br><span class="line">     //检测查询的数据是否注册存在</span><br><span class="line">     $uidArr = array(10001,10002);</span><br><span class="line">     if (in_array($uid, $nickname, true)) &#123;</span><br><span class="line">       $output = array(&quot;data&quot; =&gt; NULL, &quot;info&quot;=&gt;&quot;The user does not exist!&quot;, &quot;code&quot; =&gt; -402);</span><br><span class="line">       exit(json_encode($output));</span><br><span class="line">     &#125;</span><br><span class="line">     //存在的开始查询数据库</span><br><span class="line">     $userInfo = $mysql[$uid];</span><br><span class="line">     //输出数据</span><br><span class="line">     $output = array(</span><br><span class="line">       &quot;data&quot; =&gt; array(&quot;userInfo&quot; =&gt; $userInfo),</span><br><span class="line">       &quot;info&quot; =&gt; &quot;Here is the message which, commonly used in popup window&quot;, //返回消息提示</span><br><span class="line">       &quot;code&quot; =&gt; 200, //成功与失败的代码，一般都是正数或者负数</span><br><span class="line">     );</span><br><span class="line">     exit(json_encode($output));</span><br><span class="line">     //其他端口查询还可以自己再继续添加，方法同上</span><br><span class="line">   &#125; elseif ($a == &quot;get_result&quot;) &#123;</span><br><span class="line">     //...</span><br><span class="line">     die(&quot;您正在调 get_result 接口!&quot;);</span><br><span class="line">   &#125; elseif ($a == &quot;get_upload&quot;) &#123;</span><br><span class="line">     //....</span><br><span class="line">     die(&quot;您正在调 get_upload 接口!&quot;);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>OK，以上便是自写api接口进行服务器和客户端之间交互的实例~</p>
<p><img src="http://img.baidu.com/hi/face/i_f07.gif"/>很简单吧，有什么不懂的可以留言评论~</p>
]]></content>
      <categories>
        <category>知识点</category>
      </categories>
      <tags>
        <tag>php接口</tag>
        <tag>api写法</tag>
      </tags>
  </entry>
  <entry>
    <title>php打开网页链接请求http连接的方法</title>
    <url>/2018/01/28/php-http/</url>
    <content><![CDATA[<h1 id="碎言碎语"><a href="#碎言碎语" class="headerlink" title="碎言碎语"></a>碎言碎语</h1><p>咱们如果是玩php非静态网站，进行网页链接请求获取需要的数据，是必不可少的，不然难道“单机”不成？</p>
<p>全部数据文件本地化？这好像是静态网站的模式，而且就算是静态网站也不完全是静态的，也有js加持。</p>
<p>这显然不太现实了吧~~</p>
<h1 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h1><p>利用php的curl函数进行封装，具体代码如下：</p>
<span id="more"></span>
<pre><code>function http_request($url,$timeout=30,$header=array())&#123;
    if (!function_exists(&quot;curl_init&quot;)) &#123;
        throw new Exception(&quot;server not install curl&quot;);
    &#125;
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_HEADER, true);
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_TIMEOUT, $timeout);
    if (!emptyempty($header)) &#123;
        curl_setopt($ch, CURLOPT_HTTPHEADER, $header);
    &#125; 
    $data = curl_exec($ch);
    list($header, $data) = explode(&amp;quot;\\r\\n\\r\\n&amp;quot;, $data);
    $http_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    if ($http_code == 301 || $http_code == 302) &#123; 
        $matches = array();
        preg_match(&quot;/Location:(.*?)\\n/&quot;, $header, $matches);
        $url = trim(array_pop($matches));
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_HEADER, false);
        $data = curl_exec($ch);
    &#125;
    if ($data == false) &#123;
        curl_close($ch); 
    &#125; 
    curl_close($ch);
    return $data;
&#125;</code></pre><h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>这个封装好了是可以直接套用的，也对301/302重定向的网页进行了进一步的处理！</p>
<p>ps：由于博客显示愿意，请注意url之类的符号，需要转码还原。</p>
<p>打开https链接的网页也是可以的~</p>
]]></content>
      <categories>
        <category>知识点</category>
      </categories>
      <tags>
        <tag>php相关</tag>
        <tag>函数封装</tag>
      </tags>
  </entry>
  <entry>
    <title>coding pages托管项目是有点小尴尬~</title>
    <url>/2018/01/25/coding-pages/</url>
    <content><![CDATA[<h1 id="小尴尬"><a href="#小尴尬" class="headerlink" title="小尴尬"></a>小尴尬</h1><p>静态的程序不知道，反正类似于emlog以及现在本站正在使用的typecho程序来说，</p>
<p>各种奇奇怪怪的问题，coding官方是说 ：还在公测阶段。</p>
<p>如果你是手机端操作代码进行托管，而非使用git操作的，使用coding pages就会有这样的情况：<br>（ps因为emlog官方版本的最新版不支持php7.0，所以这里测试使用的是 @疯狂老司机 前辈自制的emlog6.0特别版。</p>
<span id="more"></span>
<p>而typecho测试使用的是官方最新的1.1版本。另外，鄙人完全是在手机端进行的项目测试~）</p>
<p>手机端上传项目代码到coding pages安装完程序后，如果编辑了项目代码，就要进行项目的重新部署，对于emlog和typecho，都会导致程序需要重新安装，typecho的话还有config文件记录，安装程序会提示使用原有数据安转访问。而emlog就不一样了，旧数据直接丢失~</p>
<p>emlog安装完不能删除install文件，因为程序会自己往该文件上跳，然后在进行首页访问。如果我们删除该文件的话网站就会404，不删除就可以继续访问重装程序，这是很不安全的。而typecho尚好，安装完可以正常访问，install文件也不需要删除，程序自动屏蔽掉了！</p>
<p>coding编辑项目貌似现在不能修改文件名称，创建文件夹以及删除文件。必须使用git/命令行进行操作。</p>
<p>coding可以免费使用https/SSL服务，这一点还是好的。但是至今我没看到怎么关闭SSL服务。这就导致频繁编辑项目之后，再重复绑定域名，系统自动重复申请ssl安全证书，致使证书失效，这样访问网站就提醒证书不安全了。好在一个星期之后可以重新申请！</p>
<h1 id="希冀"><a href="#希冀" class="headerlink" title="希冀"></a>希冀</h1><p>以上便是鄙人在手机端，使用emlog和typecho在coding pages上进行项目托管体验有效期左右的小小感受！</p>
<p>coding适合好的项目托管平台，跟国外的Github类似，但是国内的话coding的访问速度要快的多，而且coding还可以免费使用htts/ssl服务。</p>
<p>有人说这是公测阶段，后续应该是要收费的了。</p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>后续还有什么新的发现，再继续追加。</p>
<p>总之，希望coding越做越好！</p>
]]></content>
      <categories>
        <category>知识点</category>
      </categories>
      <tags>
        <tag>coding</tag>
        <tag>项目托管</tag>
      </tags>
  </entry>
  <entry>
    <title></title>
    <url>/README.html</url>
    <content><![CDATA[<h1 id="ldyivan-github-io"><a href="#ldyivan-github-io" class="headerlink" title="ldyivan.github.io"></a>ldyivan.github.io</h1><p>Welcome！ My friend, This is a site built using hexo. URL is：<a href="https://www.hzv5.cn">https://www.hzv5.cn</a></p>
]]></content>
  </entry>
  <entry>
    <title>404 Not Found：该页无法显示</title>
    <url>//404.html</url>
    <content><![CDATA[<script src="//volunteer.cdn-go.cn/404/latest/404.js" rendertarget="404DIV"></script>

<!-- <script type="text/javascript" src="//qzonestyle.gtimg.cn/qzone/hybrid/app/404/search_children.js" charset="utf-8" homePageUrl="/" homePageName="回到我的主页"></script> -->]]></content>
  </entry>
  <entry>
    <title>关于</title>
    <url>/about/index.html</url>
    <content><![CDATA[<p>昵称：吖远zzy</p>
<p>邮箱：i#hzv5.cn</p>
<p>很惭愧，<br>就真的只是<br>一个不知名的编程爱好者！</p>
<p>就只是爱好<br>仅此而已…</p>
<p>谢谢大家！</p>
]]></content>
  </entry>
  <entry>
    <title>隐私政策</title>
    <url>/agreement/Privacy_policy.html</url>
    <content><![CDATA[<h1 id="隐私政策"><a href="#隐私政策" class="headerlink" title="隐私政策"></a>隐私政策</h1><p>您在使用我们的服务时，我们可能会收集和使用您的相关信息。</p>
<p>我们希望通过本《隐私政策》向您说明，在使用我们的服务时，我们如何收集、使用、储存和分享这些信息，以及我们为您提供的访问、更新、控制和保护这些信息的方式。</p>
<p>本《隐私政策》与您所使用的服务息息相关，希望您仔细阅读，在需要时，按照本《隐私政策》的指引，作出您认为适当的选择。</p>
<p>本《隐私政策》中涉及的相关技术词汇，我们尽量以简明扼要的表述，并提供进一步说明的链接，以便您的理解。</p>
<p>您使用或继续使用我们的服务，即意味着同意我们按照本《隐私政策》收集、使用、储存和分享您的相关信息。</p>
<p>如对本《隐私政策》或相关事宜有任何问题，请通过<br><a href="mailto:i@hzv5.cn">i@hzv5.cn</a> 与我们联系。</p>
<h2 id="我们可能收集的信息"><a href="#我们可能收集的信息" class="headerlink" title="我们可能收集的信息"></a>我们可能收集的信息</h2><p>我们提供服务时，可能会收集、储存和使用下列与您有关的信息。</p>
<p>如果您不提供相关信息，可能无法享受我们提供的某些服务，或者无法达到相关服务拟达到的效果。</p>
<h2 id="您提供的信息"><a href="#您提供的信息" class="headerlink" title="您提供的信息"></a>您提供的信息</h2><p>您在使用我们的服务时，向我们提供的相关个人信息，例如电话号码、电子邮件或银行卡号等；</p>
<p>您通过我们的服务向其他方提供的共享信息，以及您使用我们的服务时所储存的信息。</p>
<h2 id="其他方分享的您的信息"><a href="#其他方分享的您的信息" class="headerlink" title="其他方分享的您的信息"></a>其他方分享的您的信息</h2><p>其他方使用我们的服务时所提供有关您的共享信息。</p>
<h2 id="我们获取的您的信息"><a href="#我们获取的您的信息" class="headerlink" title="我们获取的您的信息"></a>我们获取的您的信息</h2><p>您使用服务时我们可能收集如下信息：</p>
<p><strong>日志信息</strong>，指您使用我们的服务时，系统可能通过cookies、web beacon或其他方式自动采集的技术信息，</p>
<p>包括：<br><strong>设备或软件信息</strong>，例如您的移动设备、网页浏览器或用于接入我们服务的其他程序所提供的配置信息、您的IP地址和移动设备所用的版本和设备识别码；</p>
<p>在使用我们服务时搜索或浏览的信息，例如您使用的网页搜索词语、访问的社交媒体页面url地址，以及您在使用我们服务时浏览或要求提供的其他信息和内容详情；</p>
<p>有关您曾使用的移动应用（APP）和其他软件的信息，以及您曾经使用该等移动应用和软件的信息；</p>
<p><strong>位置信息</strong>，指您开启设备定位功能并使用我们基于位置提供的相关服务时，收集的有关您位置的信息，</p>
<p>包括：<br>您通过具有定位功能的移动设备使用我们的服务时，通过GPS或WiFi等方式收集的您的地理位置信息；</p>
<p>您或其他用户提供的包含您所处地理位置的实时信息，例如您提供的账户信息中包含的您所在地区信息，您或其他人上传的显示您当前或曾经所处地理位置的共享信息；</p>
<p>您可以通过关闭定位功能，停止对您的地理位置信息的收集。</p>
<h2 id="我们可能如何使用信息"><a href="#我们可能如何使用信息" class="headerlink" title="我们可能如何使用信息"></a>我们可能如何使用信息</h2><p>我们可能将在向您提供服务的过程之中所收集的信息用作下列用途：</p>
<p>向您提供服务；</p>
<p>在我们提供服务时，用于身份验证、客户服务、安全防范、诈骗监测、存档和备份用途，确保我们向您提供的产品和服务的安全性；</p>
<p>帮助我们设计新服务，改善我们现有服务；</p>
<p>使我们更加了解您如何接入和使用我们的服务，从而针对性地回应您的个性化需求，例如语言设定、位置设定、个性化的帮助服务和指示，或对您和其他用户作出其他方面的回应；</p>
<p>向您提供与您更加相关的广告以替代普遍投放的广告；</p>
<p>评估我们服务中的广告和其他促销及推广活动的效果，并加以改善；</p>
<p>软件认证或管理软件升级；</p>
<p>让您参与有关我们产品和服务的调查。</p>
<p>为了让您有更好的体验、改善我们的服务或您同意的其他用途，在符合相关法律法规的前提下，我们可能将通过某一项服务所收集的信息，以汇集信息或者个性化的方式，用于我们的其他服务。例如，在您使用我们的一项服务时所收集的信息，可能在另一服务中用于向您提供特定内容，或向您展示与您相关的、非普遍推送的信息。如果我们在相关服务中提供了相应选项，您也可以授权我们将该服务所提供和储存的信息用于我们的其他服务。</p>
<p>我们将尽一切可能采取适当的技术手段，保证您可以访问、更新和更正自己的注册信息或使用我们的服务时提供的其他个人信息。在访问、更新、更正和删除前述信息时，我们可能会要求您进行身份验证，以保障账户安全。</p>
<h3 id="我们可能分享的信息"><a href="#我们可能分享的信息" class="headerlink" title="我们可能分享的信息"></a>我们可能分享的信息</h3><p>除以下情形外，未经您同意，我们不会与任何第三方分享您的个人信息：</p>
<p>我们可能将您的个人信息与第三方服务供应商、承包商及代理（例如代表我们发出电子邮件或推送通知的通讯服务提供商、为我们提供位置数据的地图服务供应商）分享（他们可能并非位于您所在的法域），用作下列用途：</p>
<p>向您提供我们的服务；</p>
<p>实现“我们可能如何使用信息”部分所述目的；</p>
<p>履行我们在本《隐私政策》中的义务和行使我们的权利；</p>
<p>理解、维护和改善我们的服务。</p>
<p>如我们与任何上述第三方分享您的个人信息，我们将努力确保该等第三方在使用您的个人信息时遵守本《隐私政策》及我们要求其遵守的其他适当的保密和安全措施。</p>
<p>随着我们业务的持续发展，我们有可能进行合并、收购、资产转让或类似的交易，您的个人信息有可能作为此类交易的一部分而被转移。我们将在转移前通知您。</p>
<p>我们还可能为以下需要而保留、保存或披露您的个人信息：</p>
<p>遵守适用的法律法规；</p>
<p>遵守法院命令或其他法律程序的规定；</p>
<p>遵守相关政府机关的要求；</p>
<p>为遵守适用的法律法规、维护社会公共利益，或保护我们的客户、我们、其他用户的人身和财产安全或合法权益所合理必需的用途.</p>
<h2 id="信息安全"><a href="#信息安全" class="headerlink" title="信息安全"></a>信息安全</h2><p>我们仅在本《隐私政策》所述目的所必需的期间和法律法规要求的时限内保留您的个人信息。 </p>
<p>我们使用各种安全技术和程序，以防信息的丢失、不当使用、未经授权阅览或披露。</p>
<p>例如，在某些服务中，我们将利用加密技术（例如SSL）来保护您提供的个人信息。</p>
<p>但请您理解，由于技术的限制以及可能存在的各种恶意手段，在互联网行业，即便竭尽所能加强安全措施，也不可能始终保证信息百分之百的安全。</p>
<p>您需要了解，您接入我们的服务所用的系统和通讯网络，有可能因我们可控范围外的因素而出现问题。</p>
<h3 id="您分享的信息"><a href="#您分享的信息" class="headerlink" title="您分享的信息"></a>您分享的信息</h3><p>我们的多项服务，可让您不仅与自己的社交网络，也与使用该服务的所有用户公开分享您的相关信息，例如，您在我们的服务中所上传或发布的信息（包括您公开的个人信息、您建立的名单）、您对其他人上传或发布的信息作出的回应，以及包括与这些信息有关的位置数据和日志信息。</p>
<p>使用我们服务的其他用户也有可能分享与您有关的信息（包括位置数据和日志信息）。</p>
<p>特别是，我们的社交媒体服务，是专为使您与世界各地的用户共享信息而设计，您可以使共享信息实时、广泛地传递。</p>
<p>只要您不删除共享信息，有关信息会一直留存在公共领域；</p>
<p>即使您删除共享信息，有关信息仍可能由其他用户或不受我们控制的非关联第三方独立地缓存、复制或储存，或由其他用户或该等第三方在公共领域保存。</p>
<p>因此，请您谨慎考虑通过我们的服务上传、发布和交流的信息内容。</p>
<p>在一些情况下，您可通过我们某些服务的隐私设定来控制有权浏览您共享信息的用户范围。</p>
<p>如要求从我们的服务中删除您的相关信息，请通过该等特别服务条款提供的方式操作。</p>
<h2 id="您分享的敏感个人信息"><a href="#您分享的敏感个人信息" class="headerlink" title="您分享的敏感个人信息"></a>您分享的敏感个人信息</h2><p>某些个人信息因其特殊性可能被认为是敏感个人信息，例如您的种族、宗教、个人健康和医疗信息等。相比其他个人信息，敏感个人信息受到更加严格的保护。</p>
<p>请注意，您在使用我们的服务时所提供、上传或发布的内容和信息（例如有关您社交活动的照片等信息），可能会泄露您的敏感个人信息。您需要谨慎地考虑，是否在使用我们的服务时披露相关敏感个人信息。</p>
<p>您同意按本《隐私政策》所述的目的和方式来处理您的敏感个人信息。</p>
<h2 id="我们可能如何收集信息"><a href="#我们可能如何收集信息" class="headerlink" title="我们可能如何收集信息"></a>我们可能如何收集信息</h2><p>我们或我们的第三方合作伙伴，可能通过cookies和web beacon收集和使用您的信息，并将该等信息储存为日志信息。</p>
<p>我们使用自己的cookies和web beacon，目的是为您提供更个性化的用户体验和服务，并用于以下用途：</p>
<p>记住您的身份。</p>
<p>例如：cookies和web beacon有助于我们辨认您作为我们的注册用户的身份，或保存您向我们提供的有关您的喜好或其他信息；</p>
<p>分析您使用我们服务的情况。</p>
<p>例如，我们可利用cookies和web beacon来了解您使用我们的服务进行什么活动，或哪些网页或服务最受您的欢迎；</p>
<h2 id="广告优化"><a href="#广告优化" class="headerlink" title="广告优化"></a>广告优化</h2><p>Cookies和web beacon有助于我们根据您的信息，向您提供与您相关的广告而非进行普遍的广告投放。</p>
<p>我们为上述目的使用cookies和web beacon的同时，可能将通过cookies和web beacon收集的非个人身份信息，经统计加工后提供给广告商或其他合作伙伴，用于分析用户如何使用我们的服务，并用于广告服务。</p>
<p>我们的产品和服务上可能会有广告商或其他合作方放置的cookies和web beacon。这些cookies和web beacon可能会收集与您相关的非个人身份信息，以用于分析用户如何使用该等服务、向您发送您可能感兴趣的广告，或用于评估广告服务的效果。</p>
<p>这些第三方cookies和web beacon收集和使用该等信息，不受本《隐私政策》约束，而是受相关使用者的隐私政策约束，我们不对第三方的cookies或web beacon承担责任。</p>
<p>您可以通过浏览器设置拒绝或管理cookies或web beacon。</p>
<p>但请注意，如果停用cookies或web beacon，您有可能无法享受最佳的服务体验，某些服务也可能无法正常使用。</p>
<p>同时，您还会收到同样数量的广告，但这些广告与您的相关性会降低。</p>
<h2 id="广告服务"><a href="#广告服务" class="headerlink" title="广告服务"></a>广告服务</h2><p>我们可能使用您的相关信息，向您提供与您更加相关的广告。</p>
<p>我们也可能使用您的信息，通过我们的服务、电子邮件或其他方式向您发送营销信息，提供或推广我们或第三方的如下商品和服务：</p>
<p>我们的服务，我们的关联公司和合作伙伴的商品或服务，包括即时通讯服务、网上媒体服务、互动娱乐服务、社交网络服务、付款服务、互联网搜索服务、位置和地图服务、应用软件和服务、数据管理软件和服务、网上广告服务、互联网金融，以及其他社交媒体、娱乐、电子商务、资讯和通讯软件或服务（统称“互联网服务”）；</p>
<p>第三方互联网服务供应商，以及与下列有关的第三方商品或服务：食物和餐饮、体育、音乐、电影、电视、现场表演及其他艺术和娱乐、书册、杂志和其他刊物、服装和配饰、珠宝、化妆品、个人健康和卫生、电子、收藏品、家用器皿、电器、家居装饰和摆设、宠物、汽车、酒店、交通和旅游、银行、保险及其他金融服务、会员积分和奖励计划，以及我们认为可能与您相关的其他商品或服务。</p>
<p>如您不希望我们将您的个人信息用作前述广告用途，您可以通过我们在广告中提供的相关提示，或在特定服务中提供的指引，要求我们停止为上述用途使用您的个人信息。</p>
<h2 id="我们可能向您发送的邮件和信息"><a href="#我们可能向您发送的邮件和信息" class="headerlink" title="我们可能向您发送的邮件和信息"></a>我们可能向您发送的邮件和信息</h2><h3 id="邮件和信息推送"><a href="#邮件和信息推送" class="headerlink" title="邮件和信息推送"></a>邮件和信息推送</h3><p>您在使用我们的服务时，我们可能使用您的信息向您的设备发送电子邮件、新闻或推送通知。</p>
<p>如您不希望收到这些信息，可以按照我们的相关提示，在设备上选择取消订阅。</p>
<h3 id="与服务有关的公告"><a href="#与服务有关的公告" class="headerlink" title="与服务有关的公告"></a>与服务有关的公告</h3><p>我们可能在必要时（例如因系统维护而暂停某一项服务时）向您发出与服务有关的公告。</p>
<p>您可能无法取消这些与服务有关、性质不属于推广的公告。</p>
<h2 id="隐私政策的适用例外"><a href="#隐私政策的适用例外" class="headerlink" title="隐私政策的适用例外"></a>隐私政策的适用例外</h2><p>我们的服务可能包括或链接至第三方提供的社交媒体或其他服务（包括网站）。</p>
<p>例如：</p>
<p>您利用 “分享”键将某些内容分享到我们的服务，或您利用第三方连线服务登录我们的服务。这些功能可能会收集您的相关信息（包括您的日志信息），并可能在您的电脑装置cookies，从而正常运行上述功能；</p>
<p>我们通过广告或我们服务的其他方式向您提供链接，使您可以接入第三方的服务或网站。</p>
<p>该等第三方社交媒体或其他服务可能由相关的第三方或我们运营。您使用该等第三方的社交媒体服务或其他服务（包括您向该等第三方提供的任何个人信息），须受该第三方的服务条款及隐私政策（而非《通用服务条款》或本《隐私政策》）约束，您需要仔细阅读其条款。</p>
<p>本《隐私政策》仅适用于我们所收集的信息，并不适用于任何第三方提供的服务或第三方的信息使用规则，我们对任何第三方使用由您提供的信息不承担任何责任。</p>
<h2 id="未成年人使用我们的服务"><a href="#未成年人使用我们的服务" class="headerlink" title="未成年人使用我们的服务"></a>未成年人使用我们的服务</h2><p>我们鼓励父母或监护人指导未满十八岁的未成年人使用我们的服务。</p>
<p>我们建议未成年人鼓励他们的父母或监护人阅读本《隐私政策》，并建议未成年人在提交的个人信息之前寻求父母或监护人的同意和指导。</p>
<h2 id="隐私政策的适用范围"><a href="#隐私政策的适用范围" class="headerlink" title="隐私政策的适用范围"></a>隐私政策的适用范围</h2><p>除某些特定服务外，我们所有的服务均适用本《隐私政策》。</p>
<p>这些特定服务将适用特定的隐私政策。</p>
<p>针对某些特定服务的特定隐私政策，将更具体地说明我们在该等服务中如何使用您的信息。</p>
<p>该特定服务的隐私政策构成本《隐私政策》的一部分。</p>
<p>如相关特定服务的隐私政策与本《隐私政策》有不一致之处，适用该特定服务的隐私政策。<br>请您注意，本《隐私政策》不适用于以下情况：</p>
<p>通过我们的服务而接入的第三方服务（包括任何第三方网站）收集的信息；</p>
<p>通过在我们服务中进行广告服务的其他公司或机构所收集的信息。</p>
<h2 id="变更"><a href="#变更" class="headerlink" title="变更"></a>变更</h2><p>我们可能适时修订本《隐私政策》的条款，该等修订构成本《隐私政策》的一部分。</p>
<p>如该等修订造成您在本《隐私政策》下权利的实质减少，我们将在修订生效前通过在主页上显著位置提示或向您发送电子邮件或以其他方式通知您。</p>
<p>在该种情况下，若您继续使用我们的服务，即表示同意受经修订的本《隐私政策》的约束。</p>
]]></content>
  </entry>
  <entry>
    <title>用户协议</title>
    <url>/agreement/User_agreement.html</url>
    <content><![CDATA[<h1 id="用户协议"><a href="#用户协议" class="headerlink" title="用户协议"></a>用户协议</h1><p>请您使用本产品之前，请务必仔细阅读并理解《用户许可使用协议》（以下简称“本协议”）中规定的多有权利和限制。</p>
<p>我们一向尊重并会严格保护用户在使用本产品时的合法权益（包括用户隐私、用户数据等）不受到任何侵犯。</p>
<p>本协议（包括本文最后部分的隐私政策）是用户（包括通过各种合法途径获取到本产品的自然人、法人或其他组织机构，以下简称“用户”或“您”）与我们之间针对本产品相关事项最终的、完整的且排他的协议，并取代、合并之前的当事人之间关于上述事项的讨论和协议。</p>
<p>本协议将对用户使用本产品的行为产生法律约束力，您已承诺和保证有权利和能力订立本协议。用户开始使用本产品将视为已经接受本协议，请认真阅读并理解本协议中各种条款，包括免除和限制我们的免责条款和对用户的权利限制（未成年人审阅时应由法定监护人陪同），如果您不能接受本协议中的全部条款，请勿开始使用本产品。</p>
<h2 id="使用账户"><a href="#使用账户" class="headerlink" title="使用账户"></a>使用账户</h2><p>您必须承诺和保证：</p>
<ol>
<li><p>您使用本产品的行为必须合法。本产品将会依据本协议“修改和终止”的规定保留或终止您的账户。</p>
</li>
<li><p>您必须承诺对您的登录信息保密、不被其他人获取与使用，并且对您在本账户下的所有行为负责。</p>
</li>
<li><p>您必须将任何有可能触犯法律的、未授权使用或怀疑为未授权使用的行为在第一时间通知本产品。本产品不对您因未能遵守上述要求而造成的损失承担法律责任。</p>
</li>
</ol>
<h2 id="终端用户协议许可"><a href="#终端用户协议许可" class="headerlink" title="终端用户协议许可"></a>终端用户协议许可</h2><p>依据本协议规定，本产品将授予您以下不可转让的、非排他的许可：</p>
<p>1.使用本产品的权利；</p>
<p>2.在您所有的网络通信设备、计算机设备和移动通信设备上下载、安装、使用本产品的权利。</p>
<h2 id="限制性条款"><a href="#限制性条款" class="headerlink" title="限制性条款"></a>限制性条款</h2><p>本协议对您的授权将受到以下限制：</p>
<ol>
<li><p>您不得对本产品进行任何形式的许可、出售、租赁、转让、发行或其他商业用途；</p>
</li>
<li><p>除非法律禁止此类限制，否则您不得对本产品的任何部分或衍生产品进行修改、翻译、改编、合并、利用、分解、改造或反向编译、反向工程等；</p>
</li>
<li><p>您不得以创建相同或竞争服务为目的使用本产品；</p>
</li>
<li><p>除非法律明文规定，否则您不得对本产品的任何部分以任何形式或方法进行生产、复制、发行、出售、下载或显示等；</p>
</li>
<li><p>您不得删除或破坏包含在本产品中的任何版权声明或其他所有权标记。</p>
</li>
</ol>
<h2 id="费用"><a href="#费用" class="headerlink" title="费用"></a>费用</h2><p>您必须自行负担购买本产品的费用，个人上网或第三方（包括但不限于电信或移动通讯提供商）收取的通讯费、信息费等相关费用。</p>
<p>如涉及电信增值服务，我们建议您与增值服务提供商确认相关费用问题。</p>
<h2 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h2><p>任何本产品的更新版本或未来版本、更新或者其他变更将受到本协议约束。</p>
<h2 id="遵守法律"><a href="#遵守法律" class="headerlink" title="遵守法律"></a>遵守法律</h2><p>您同意遵守《中华人民共和国合同法》、《中华人民共和国著作权法》及其实施条例、《全国人民代表大会常务委员会关于维护互联网安全的决定》（“人大安全决定”）、《中华人民共和国保守国家秘密法》、《中华人民共和国电信条例》（“电信条例“）、《中华人民共和国计算机信息系统安全保护条例》、《中华人民共和国计算机信息网络国际联网管理暂行规定》及其实施办法、《计算机信息系统国际联网保密管理规定》、《互联网信息服务管理办法》、《计算机信息网络国际联网安全保护管理办法》、《互联网电子公告服务管理规定》（“电子公告规定”）等相关中国法律法规的任何及所有的规定，并对以任何方式使用您的密码和您的账号使用本服务的任何行为及其结果承担全部责任。如违反《人大安全决定》有可能构成犯罪，被追究刑事责任。</p>
<p>《电子公告规定》则有明文规定，上网用户使用电子公告服务系统对所发布的信息负责。</p>
<p>《电信条例》也强调，使用电信网络传输信息的内容及其后果由电信用户负责。</p>
<p>在任何情况下，如果本网站有理由认为您的任何行为，包括但不限于您的任何言论和其它行为违反或可能违反上述法律和法规的任何规定，本网站可在任何时候不经任何事先通知终止向您提供服务。</p>
<h2 id="用户内容"><a href="#用户内容" class="headerlink" title="用户内容"></a>用户内容</h2><p>1.用户内容是指该用户下载、发布或以其他方式使用本产品时产生的所有内容（例如：您的信息、图片、音乐或其他内容）。</p>
<p>2.您是您的用户内容唯一的责任人，您将承担因您的用户内容披露而导致的您或任何第三方被识别的风险。</p>
<p>3.您已同意您的用户内容受到权利限制（详见“权利限制”）</p>
<h2 id="权利限制"><a href="#权利限制" class="headerlink" title="权利限制"></a>权利限制</h2><p>您已同意通过分享或其他方式使用本产品中的相关服务，在使用过程中，您将承担因下述行为所造成的风险而产生的全部法律责任：</p>
<p>1.破坏宪法所确定的基本原则的；</p>
<p>2.危害国家安全、泄露国家秘密、颠覆国家政权、破坏国家统一的；</p>
<p>3.损害国家荣誉和利益的；</p>
<p>4.煽动民族仇恨、民族歧视，破坏民族团结的；</p>
<p>5.破坏国家宗教政策，宣扬邪教和封建迷信的；</p>
<p>6.散布淫秽、色情、赌博、暴力、凶杀、恐怖或者教唆犯罪的；</p>
<p>7.侮辱或者诽谤他人，侵害他人合法权益的；</p>
<p>8.含有法律、行政法规禁止的其他内容的。</p>
<p>您已经同意不在本产品从事下列行为：</p>
<p>1.发布或分享电脑病毒、蠕虫、恶意代码、故意破坏或改变计算机系统或数据的软件；</p>
<p>2.未授权的情况下，收集其他用户的信息或数据，例如电子邮箱地址等；</p>
<p>3.用自动化的方式恶意使用本产品，给服务器造成过度的负担或以其他方式干扰或损害网站服务器和网络链接；</p>
<p>4.在未授权的情况下，尝试访问本产品的服务器数据或通信数据；</p>
<p>5.干扰、破坏本产品其他用户的使用。</p>
<h2 id="修改和终止"><a href="#修改和终止" class="headerlink" title="修改和终止"></a>修改和终止</h2><h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><p>本协议容许变更。如果本协议有任何实质性变更，我们将通过电子邮件或产品内部通知的方式来通知您。变更通知之后，继续使用本产品则为您已知晓此类变更并同意条款约束；</p>
<p>我们保留在任何时候无需通知而修改、保留或关闭本产品任何服务之权利；</p>
<p>您已同意我们无需因修改、保留或关闭本产品任何服务之权利；</p>
<p>您已同意我们无需因修改、保留或关闭本产品任何服务的行为对您或第三方承担责任。</p>
<h3 id="终止"><a href="#终止" class="headerlink" title="终止"></a>终止</h3><p>本协议自您接受之日起生效，在您使用本产品的过程中持续有效，直至依据本协议终止；</p>
<p>尽管有上述规定，如果您使用本产品的时间早于您接受本协议的时间，您在此知晓并同意本协议于您接受本协议的时间，您在此知晓并同意本协议于您第一次使用本产品时生效，除非依据本协议提前终止；</p>
<p>我们可能会依据法律的规定，保留您使用本产品或者本账户的权利；无论是否通知，我们将在任何时间以任何原因终止本协议，包括出于善意的相信您违反了我们可接受使用政策或本协议的其他规定；</p>
<p>不受前款规定所限，如果用户侵犯第三人的版权且我们接到版权所有人或版权所有人的合法代理人的通知后，我们保留终止本协议的权利；</p>
<p>一旦本协议终止，您使用本产品的权利即告终止。您应当知晓您的产品终止意味着您的用户内容将从我们的活动数据库中删除。我们不因终止本协议对您承担任何责任，包括终止您的用户账户和删除您的用户内容。</p>
<h2 id="第三方"><a href="#第三方" class="headerlink" title="第三方"></a>第三方</h2><p>您已知晓或同意我们的部分服务是基于第三方的技术支持获得；</p>
<p>您已知晓本协议是您在与我们之前签订，而非您与上述第三方之间签订。</p>
<p>我们是基于本产品所产生的内容、维护、支持服务、保证和由此产生的诉讼等事项的唯一责任人。</p>
<p>您已同意遵守且授权给本产品限制您有条件地使用本产品的服务。</p>
<h2 id="第三方信息和服务"><a href="#第三方信息和服务" class="headerlink" title="第三方信息和服务"></a>第三方信息和服务</h2><p>1.本产品包含了第三方的部分信息和服务。我们不控制且不对第三方的信息和服务负责；</p>
<p>2.我们仅为您使用方便的目的或为承诺和保证第三方的需要而提供此类信息和服务；</p>
<p>3.用户需对使用第三方信息和服务产生的风险承担法律责任；</p>
<p>4.当用户访问第三方信息和服务时，适用第三方的条款和政策。</p>
<h2 id="赔偿"><a href="#赔偿" class="headerlink" title="赔偿"></a>赔偿</h2><p>您已同意无害地使用本产品，避免因下述行为或相关行为遭受来第三方的任何投诉、诉讼、损失、损害、责任、成本和费用（包括律师费）：</p>
<p>1.用户使用本产品的行为；</p>
<p>2.用户的用户内容；</p>
<p>3.用户违反本协议的行为。</p>
<p>我们保留专属抗辩权和请求赔偿的权利</p>
<p>您已同意，除非获得我们书面同意，您不得在您与我们共同对第三方提起的诉讼中单方和解。</p>
<p>我们将尽合理努力将此类诉讼、诉讼行为或进程通知您。</p>
<p>在任何情况下，本产品都不对您或任何第三方因本协议产生的任何间接性、后果性、惩罚性的、偶然的、特殊或惩罚性的损害赔偿承担责任。</p>
<p>访问、使用本产品所产生的损坏计算机系统或移动通讯设备数据的风险将由您个人承担。</p>
<h2 id="适用法律"><a href="#适用法律" class="headerlink" title="适用法律"></a>适用法律</h2><p>本协议适用中华人民共和国法律；</p>
<p>如果双方发生纠纷，应本着友好的圆柱协商解决；如协商不成，应向所在地的法院提起诉讼。</p>
<h2 id="独立性"><a href="#独立性" class="headerlink" title="独立性"></a>独立性</h2><p>本协议中的某些条款因故无法适用，则本协议的其他条款继续适用且无法适用的条款将会被修改，以便其能够依法适用。</p>
<h2 id="完整性"><a href="#完整性" class="headerlink" title="完整性"></a>完整性</h2><p>本协议（包括隐私政策）是您和本产品之间关于本产品相关事项的最终的、完整的、排他的协议，且取代和合并之前当事人关于此类事项（包括之前的最终用户许可、服务条款和隐私政策）的讨论和协议；</p>
<p>每部分的题目只为阅读之便而无任何法律或合同义务；</p>
<p>除非我们书面同意，您不得转让本协议所规定的权利义务。任何违反上述规定企图转让的行为均无效。</p>
]]></content>
  </entry>
  <entry>
    <title>分类</title>
    <url>/categories/index.html</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>书单</title>
    <url>/books/index.html</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>友情链接</title>
    <url>/friends/index.html</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>友情链接</title>
    <url>/links/index.html</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>留言板</title>
    <url>/guestbook/index.html</url>
    <content><![CDATA[<p><img src="/img/work.jpg" alt="博主一直都在"></p>
<h2 id="有什么想说的吗？欢迎留言"><a href="#有什么想说的吗？欢迎留言" class="headerlink" title="有什么想说的吗？欢迎留言~"></a>有什么想说的吗？欢迎留言~</h2><h2 id="❥-么么哒！"><a href="#❥-么么哒！" class="headerlink" title="❥(^_-) 么么哒！~"></a>❥(^_-) 么么哒！~</h2>]]></content>
  </entry>
  <entry>
    <title></title>
    <url>/photos/config.js</url>
    <content><![CDATA[window.CONFIG = {
    // GitHub raw content URLs
    CDN_URL: 'https://raw.githubusercontent.com/ldyivan/BlogPicture/refs/heads/master/photos/',
    THUMBNAIL_URL: 'https://raw.githubusercontent.com/ldyivan/BlogPicture/refs/heads/master/min_photos/',
    // 缩略图尺寸
    THUMBNAIL_SIZE: {
        width: 300,
        height: 300
    },
    // 图片加载失败时的默认图片
    DEFAULT_IMAGE: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNlZWUiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgYWxpZ25tZW50LWJhc2VsaW5lPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UsIHNhbnMtc2VyaWYiIGZpbGw9IiNhYWEiPkxvYWRpbmcuLi48L3RleHQ+PC9zdmc+'
}; ]]></content>
  </entry>
  <entry>
    <title></title>
    <url>/photos/data.json</url>
    <content><![CDATA[{"list":[{"date":"2019-10","arr":{"year":2019,"month":10,"link":["2019-10-07_天天叫外卖的快餐生活，好久都没有吃米饭了，现在几乎忘记了米饭的味道.jpg"],"text":["天天叫外卖的快餐生活，好久都没有吃米饭了，现在几乎忘记了米饭的味道"],"type":["image"]}},{"date":"2019-08","arr":{"year":2019,"month":8,"link":["2019-08-15_今天就是吃吃吃，放开了吃.jpg","2019-08-15_今天就是吃吃吃，放开了吃2.png"],"text":["今天就是吃吃吃，放开了吃","今天就是吃吃吃，放开了吃2"],"type":["image","image"]}},{"date":"2018-11","arr":{"year":2018,"month":11,"link":["2018-11-30_今天是10月23祝自己生日快乐，永远18。在图书馆平平淡淡地度过了一天，这样的生活可能是人生的常态.jpg"],"text":["今天是10月23祝自己生日快乐，永远18。在图书馆平平淡淡地度过了一天，这样的生活可能是人生的常态"],"type":["image"]}},{"date":"2018-10","arr":{"year":2018,"month":10,"link":["2018-10-8_通子练的肱二头肌.jpg"],"text":["通子练的肱二头肌"],"type":["image"]}},{"date":"2018-09","arr":{"year":2018,"month":9,"link":["2018-09-19_夜幕下的图书馆.jpg","2018-09-24_祝俊哥生日快乐！.jpg"],"text":["夜幕下的图书馆","祝俊哥生日快乐！"],"type":["image","image"]}},{"date":"2018-02","arr":{"year":2018,"month":2,"link":["2018-02-20_忘了这是哪里了.jpg"],"text":["忘了这是哪里了"],"type":["image"]}}]}]]></content>
  </entry>
  <entry>
    <title>相册</title>
    <url>/photos/index.html</url>
    <content><![CDATA[<link rel="stylesheet" href="./ins.css">
<div class="photos-btn-wrap">
	<a class="photos-btn active" href="javascript:void(0)">Photos</a>
	<a class="photos-btn" href="#">待续</a>
</div>
<div class="instagram itemscope">
	<div class="photo-wrapper"></div>
</div>

<!-- 引入必要的脚本 -->
<script>
    // 确保 LazyLoad 可用
    window.lazyLoadOptions = {
        elements_selector: ".lazy",
        threshold: 50
    };
</script>
<script src="./lazyload.min.js"></script>
<script src="./config.js"></script>
<script src="./ins.js"></script>]]></content>
  </entry>
  <entry>
    <title></title>
    <url>/photos/ins.css</url>
    <content><![CDATA[#post-instagram{
	padding: 30px;
}
#post-instagram .article-entry{
	padding-right: 0;
}
.instagram{
	position: relative;
	min-height: 500px;
}
.instagram img {
	width: 100%;
}
.instagram .year {
	font-size: 16px;
}
.instagram .open-ins{
	padding: 10px 0;
	color: #cdcdcd;
}
.instagram .open-ins:hover{
	color: #657b83;
}
.instagram .year{
	display: inline;
}
.instagram .thumb {
	width: 25%;
	height: 0; 
	padding-bottom: 25%;
	position: relative;
	display: inline-block;
	text-align: center;
	background: #ededed;
	outline: 1px solid #ddd;
}
.instagram .thumb a {
	position: relative;
}
.instagram .album h1 em{
	font-style: normal;
	font-size: 14px;
	margin-left: 10px;
}
.instagram .album ul{
	display: flex;
	flex-wrap: wrap;
	clear: both;
	width: 100%;
	text-align: left;
}
.instagram .album li{
	list-style: none;
	display: inline-block;
	box-sizing: border-box;
	padding: 0 5px;
	margin-bottom: -10px;
	height: 0;
	width: 25%;
	position: relative;
	padding-bottom: 25%;
}
.instagram .album li:before{
	display: none;
}
.instagram .album div.img-box{
	position: absolute;
	width: 90%;
	height: 90%;
	-webkit-box-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);
	-moz-box-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);
	box-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);
}
.instagram .album div.img-box img{
	width: 100%;
	height: 100%;
    position: absolute;
    z-index: 2;
}
.instagram .album div.img-box .img-bg{
	position: absolute;
	top: 0;
	left: 0;
	bottom: 0px;
	width: 100%;
	margin: -5px;
	padding: 5px;
	-webkit-box-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);
	-moz-box-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);
	box-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);
	-webkit-transition: all 0.15s ease-out 0.1s;
	-moz-transition: all 0.15s ease-out 0.1s;
	-o-transition: all 0.15s ease-out 0.1s;
	transition: all 0.15s ease-out 0.1s;
	opacity: 0.2;
	cursor: pointer;
	display: block;
	z-index: 3;
}
.instagram .album div.img-box .icon {
    font-size: 14px;
    position: absolute;
    left: 50%;
    top: 50%;
    margin-left: -7px;
    margin-top: -7px;
    color: #999;
    z-index: 1;
}
.instagram .album div.img-box .img-bg:hover{
	opacity: 0;
}
.photos-btn-wrap {
    display: flex;
    align-items: center;
    padding: 0;
    margin: 0 0 40px 0;
    border-bottom: 1px solid var(--border-color);
}
.photos-btn {
    position: relative;
    color: var(--text-color);
    text-decoration: none;
    font-size: 1em;
    padding: 16px 0;
    margin-right: 32px;
    transition: all 0.3s ease;
    opacity: 0.7;
    background: transparent;
    border: none;
    cursor: pointer;
}
.photos-btn:last-child {
    margin-right: 0;
}
.photos-btn:hover {
    opacity: 1;
}
.photos-btn.active {
    color: var(--primary-color);
    opacity: 1;
}
.photos-btn.active::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    width: 100%;
    height: 2px;
    background: var(--primary-color);
}

@media screen and (max-width:600px) {
	.instagram .thumb {
		width: 50%;
		padding-bottom: 50%;
	}
	.instagram .album li {
		width: 100%;
		position: relative;
		padding-bottom: 100%;
		text-align: center;
	}
	.instagram .album div.img-box{
		margin: 0;
		width: 90%;
		height: 90%;
	}
}

.loading-wrap {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
}

.loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 2px solid #f3f3f3;
    border-top: 2px solid #3498db;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.photo-wrapper {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.photo-section {
    margin-bottom: 48px;
}

.photo-date {
    position: relative;
    font-size: 1.2em;
    font-weight: 500;
    margin: 0 0 24px 0;
    padding: 0 0 0 20px;
    color: var(--text-color);
    display: flex;
    align-items: center;
}

.photo-date::before {
    content: '#';
    position: absolute;
    left: 0;
    color: var(--primary-color);
    font-weight: bold;
}

.photo-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 24px;
    padding: 0;
}

.photo-item {
    position: relative;
    overflow: hidden;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
    background: var(--card-background);
    aspect-ratio: 1;
    cursor: pointer;
}

.photo-placeholder {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: var(--card-background);
    z-index: 1;
    margin: 0;
    padding: 0;
}

.loading-icon {
    width: 30px;
    height: 30px;
    border: 3px solid var(--border-color);
    border-top: 3px solid var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 10px;
}

.loading-text {
    color: var(--text-color);
    font-size: 14px;
}

.error-message {
    color: var(--error-color);
    font-size: 14px;
    text-align: center;
    padding: 10px;
}

.photo-item img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: opacity 0.3s ease, transform 0.3s ease;
    z-index: 2;
    margin: 0;
    padding: 0;
    display: block;
}

.photo-item img.lazy {
    opacity: 0;
}

.photo-item img.lazy.loaded {
    opacity: 1;
}

.photo-info {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 15px;
    background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
    color: #fff;
    transform: translateY(100%);
    transition: transform 0.3s ease;
    z-index: 3;
}

.photo-item:hover .photo-info {
    transform: translateY(0);
}

.photo-info p {
    margin: 0;
    font-size: 14px;
    line-height: 1.4;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* 暗黑模式 */
:root {
    --text-color: #2c3e50;
    --border-color: rgba(0, 0, 0, 0.1);
    --card-background: #ffffff;
    --primary-color: #3b82f6;
    --error-color: #ef4444;
    --background-color: #ffffff;
}

[data-theme="dark"] {
    --text-color: #e5e7eb;
    --border-color: rgba(255, 255, 255, 0.1);
    --card-background: #1f2937;
    --primary-color: #60a5fa;
    --error-color: #f87171;
    --background-color: #111827;
}

/* 移动端适配 */
@media screen and (max-width: 768px) {
    .photos-btn-wrap {
        margin: 0 0 32px 0;
    }

    .photos-btn {
        font-size: 0.9em;
        padding: 12px 0;
        margin-right: 24px;
    }

    .photo-section {
        margin-bottom: 32px;
    }

    .photo-date {
        font-size: 1.1em;
        margin: 0 0 16px 0;
    }

    .photo-grid {
        gap: 16px;
    }
}

/* 错误状态 */
.error {
    text-align: center;
    padding: 20px;
    color: var(--text-color);
    background: var(--card-background);
    border-radius: 8px;
    margin: 20px 0;
}

.preview-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    cursor: zoom-out;
}

.preview-overlay.active {
    display: flex;
}

.preview-container {
    position: relative;
    max-width: 90%;
    max-height: 90%;
}

.preview-image {
    max-width: 100%;
    max-height: 90vh;
    object-fit: contain;
    border-radius: 4px;
}

.preview-loading {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #fff;
}

.preview-text {
    position: absolute;
    bottom: -30px;
    left: 0;
    width: 100%;
    text-align: center;
    color: #fff;
    font-size: 14px;
    padding: 10px;
}

.preview-close {
    position: absolute;
    top: 20px;
    right: 20px;
    color: #fff;
    font-size: 30px;
    cursor: pointer;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 50%;
    transition: background-color 0.3s;
}

.preview-close:hover {
    background: rgba(0, 0, 0, 0.8);
}]]></content>
  </entry>
  <entry>
    <title></title>
    <url>/photos/ins.js</url>
    <content><![CDATA[(function() {
    // 相册类
    function PhotoGallery() {
        this.container = document.querySelector('.photo-wrapper');
        this.init();
        this.initPreview();
    }

    PhotoGallery.prototype = {
        init: function() {
            var self = this;
            this.fetchPhotoData()
                .then(function(data) {
                    self.render(data);
                    self.initLazyLoad();
                })
                .catch(function(error) {
                    console.error('Failed to initialize photo gallery:', error);
                    self.showError();
                });
        },

        initPreview: function() {
            var self = this;
            // 创建预览框HTML
            var previewHtml = [
                '<div class="preview-overlay">',
                '    <div class="preview-close">&times;</div>',
                '    <div class="preview-container">',
                '        <div class="preview-loading">',
                '            <div class="loading-icon"></div>',
                '            <div class="loading-text">加载中...</div>',
                '        </div>',
                '        <img class="preview-image" src="" alt="" />',
                '        <div class="preview-text"></div>',
                '    </div>',
                '</div>'
            ].join('');

            // 添加预览框到body
            document.body.insertAdjacentHTML('beforeend', previewHtml);

            // 获取预览框元素
            this.previewOverlay = document.querySelector('.preview-overlay');
            this.previewImage = this.previewOverlay.querySelector('.preview-image');
            this.previewText = this.previewOverlay.querySelector('.preview-text');
            this.previewLoading = this.previewOverlay.querySelector('.preview-loading');

            // 绑定关闭事件
            this.previewOverlay.addEventListener('click', function(e) {
                if (e.target === this || e.target.classList.contains('preview-close')) {
                    self.closePreview();
                }
            });

            // 绑定键盘事件
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    self.closePreview();
                }
            });
        },

        showPreview: function(src, text) {
            var self = this;
            this.previewLoading.style.display = 'block';
            this.previewImage.style.display = 'none';
            this.previewOverlay.classList.add('active');
            this.previewText.textContent = text;

            // 加载原图
            var img = new Image();
            img.onload = function() {
                self.previewLoading.style.display = 'none';
                self.previewImage.style.display = 'block';
                self.previewImage.src = src;
            };
            img.onerror = function() {
                self.previewLoading.innerHTML = '<div class="error-message">图片加载失败</div>';
            };
            img.src = src;
        },

        closePreview: function() {
            this.previewOverlay.classList.remove('active');
            this.previewImage.src = '';
            this.previewText.textContent = '';
        },

        fetchPhotoData: function() {
            return fetch('./data.json')
                .then(function(response) {
                    if (!response.ok) throw new Error('Failed to fetch photo data');
                    return response.json();
                });
        },

        render: function(data) {
            var groupedPhotos = this.processPhotoData(data);
            var html = Object.keys(groupedPhotos)
                .sort(function(a, b) { return b.localeCompare(a); })
                .map(function(date) {
                    return [
                        '<div class="photo-section">',
                        '    <div class="photo-date"># ' + date + '</div>',
                        '    <div class="photo-grid">',
                        groupedPhotos[date].map(this.createPhotoHTML).join(''),
                        '    </div>',
                        '</div>'
                    ].join('');
                }, this).join('');
            this.container.innerHTML = html;
        },

        processPhotoData: function(data) {
            var groupedPhotos = {};
            data.list.forEach(function(item) {
                var yearMonth = item.date.split('-');
                var year = yearMonth[0];
                var month = yearMonth[1];
                var dateKey = year + '年' + month + '月';
                
                if (!groupedPhotos[dateKey]) {
                    groupedPhotos[dateKey] = [];
                }

                item.arr.link.forEach(function(link, index) {
                    var cleanLink = link.replace(/\s+/g, '%20');
                    groupedPhotos[dateKey].push({
                        src: window.CONFIG.CDN_URL + cleanLink,
                        thumbnail: window.CONFIG.THUMBNAIL_URL + cleanLink,
                        text: item.arr.text[index],
                        date: dateKey
                    });
                });
            });
            return groupedPhotos;
        },

        createPhotoHTML: function(photo) {
            return [
                '<div class="photo-item" onclick="window.photoGallery.showPreview(\'' + photo.src + '\', \'' + photo.text + '\')">',
                '    <div class="photo-placeholder">',
                '        <div class="loading-icon"></div>',
                '        <span class="loading-text">加载中...</span>',
                '    </div>',
                '    <img',
                '        class="lazy"',
                '        data-src="' + photo.thumbnail + '"',
                '        data-original="' + photo.src + '"',
                '        src="' + window.CONFIG.DEFAULT_IMAGE + '"',
                '        alt="' + photo.text + '"',
                '    />',
                '    <div class="photo-info">',
                '        <p>' + photo.text + '</p>',
                '    </div>',
                '</div>'
            ].join('');
        },

        initLazyLoad: function() {
            try {
                var myLazyLoad = new window.LazyLoad({
                    elements_selector: ".lazy",
                    threshold: 50,
                    callback_loaded: function(el) {
                        el.classList.add('loaded');
                        el.parentElement.classList.add('loaded');
                        var placeholder = el.parentElement.querySelector('.photo-placeholder');
                        if (placeholder) {
                            placeholder.style.display = 'none';
                        }
                    },
                    callback_error: function(el) {
                        var retryCount = el.getAttribute('data-retry-count') || 0;
                        if (retryCount < 3) {
                            el.setAttribute('data-retry-count', parseInt(retryCount) + 1);
                            var originalSrc = el.dataset.src.split('?')[0];
                            el.src = originalSrc;
                        } else {
                            el.src = window.CONFIG.DEFAULT_IMAGE;
                            el.classList.add('error');
                            var placeholder = el.parentElement.querySelector('.photo-placeholder');
                            if (placeholder) {
                                placeholder.innerHTML = '<div class="error-message">加载失败</div>';
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('LazyLoad initialization failed:', error);
                var images = document.querySelectorAll('.lazy');
                images.forEach(function(img) {
                    img.src = img.getAttribute('data-src').split('?')[0];
                });
            }
        },

        showError: function() {
            this.container.innerHTML = '<div class="error">相册加载失败，请刷新重试</div>';
        }
    };

    // 当页面加载完成时初始化相册
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            window.photoGallery = new PhotoGallery();
        });
    } else {
        window.photoGallery = new PhotoGallery();
    }
})();]]></content>
  </entry>
  <entry>
    <title></title>
    <url>/photos/lazyload.min.js</url>
    <content><![CDATA[/*!
 * An jQuery | zepto plugin for lazy loading images.
 * author -> jieyou
 * see https://github.com/jieyou/lazyload
 * use some tuupola's code https://github.com/tuupola/jquery_lazyload (BSD)
 * use component's throttle https://github.com/component/throttle (MIT)
 */
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(n="undefined"!=typeof globalThis?globalThis:n||self).LazyLoad=t()}(this,(function(){"use strict";function n(){return n=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},n.apply(this,arguments)}var t="undefined"!=typeof window,e=t&&!("onscroll"in window)||"undefined"!=typeof navigator&&/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent),i=t&&"IntersectionObserver"in window,o=t&&"classList"in document.createElement("p"),a=t&&window.devicePixelRatio>1,r={elements_selector:".lazy",container:e||t?document:null,threshold:300,thresholds:null,data_src:"src",data_srcset:"srcset",data_sizes:"sizes",data_bg:"bg",data_bg_hidpi:"bg-hidpi",data_bg_multi:"bg-multi",data_bg_multi_hidpi:"bg-multi-hidpi",data_bg_set:"bg-set",data_poster:"poster",class_applied:"applied",class_loading:"loading",class_loaded:"loaded",class_error:"error",class_entered:"entered",class_exited:"exited",unobserve_completed:!0,unobserve_entered:!1,cancel_on_exit:!0,callback_enter:null,callback_exit:null,callback_applied:null,callback_loading:null,callback_loaded:null,callback_error:null,callback_finish:null,callback_cancel:null,use_native:!1,restore_on_error:!1},c=function(t){return n({},r,t)},l=function(n,t){var e,i="LazyLoad::Initialized",o=new n(t);try{e=new CustomEvent(i,{detail:{instance:o}})}catch(n){(e=document.createEvent("CustomEvent")).initCustomEvent(i,!1,!1,{instance:o})}window.dispatchEvent(e)},u="src",s="srcset",d="sizes",f="poster",_="llOriginalAttrs",g="data",v="loading",b="loaded",m="applied",p="error",h="native",E="data-",I="ll-status",y=function(n,t){return n.getAttribute(E+t)},k=function(n){return y(n,I)},w=function(n,t){return function(n,t,e){var i="data-ll-status";null!==e?n.setAttribute(i,e):n.removeAttribute(i)}(n,0,t)},A=function(n){return w(n,null)},L=function(n){return null===k(n)},O=function(n){return k(n)===h},x=[v,b,m,p],C=function(n,t,e,i){n&&(void 0===i?void 0===e?n(t):n(t,e):n(t,e,i))},N=function(n,t){o?n.classList.add(t):n.className+=(n.className?" ":"")+t},M=function(n,t){o?n.classList.remove(t):n.className=n.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,"")},z=function(n){return n.llTempImage},T=function(n,t){if(t){var e=t._observer;e&&e.unobserve(n)}},R=function(n,t){n&&(n.loadingCount+=t)},G=function(n,t){n&&(n.toLoadCount=t)},j=function(n){for(var t,e=[],i=0;t=n.children[i];i+=1)"SOURCE"===t.tagName&&e.push(t);return e},D=function(n,t){var e=n.parentNode;e&&"PICTURE"===e.tagName&&j(e).forEach(t)},H=function(n,t){j(n).forEach(t)},V=[u],F=[u,f],B=[u,s,d],J=[g],P=function(n){return!!n[_]},S=function(n){return n[_]},U=function(n){return delete n[_]},q=function(n,t){if(!P(n)){var e={};t.forEach((function(t){e[t]=n.getAttribute(t)})),n[_]=e}},K=function(n,t){if(P(n)){var e=S(n);t.forEach((function(t){!function(n,t,e){e?n.setAttribute(t,e):n.removeAttribute(t)}(n,t,e[t])}))}},Q=function(n,t,e){N(n,t.class_applied),w(n,m),e&&(t.unobserve_completed&&T(n,t),C(t.callback_applied,n,e))},W=function(n,t,e){N(n,t.class_loading),w(n,v),e&&(R(e,1),C(t.callback_loading,n,e))},X=function(n,t,e){e&&n.setAttribute(t,e)},Y=function(n,t){X(n,d,y(n,t.data_sizes)),X(n,s,y(n,t.data_srcset)),X(n,u,y(n,t.data_src))},Z={IMG:function(n,t){D(n,(function(n){q(n,B),Y(n,t)})),q(n,B),Y(n,t)},IFRAME:function(n,t){q(n,V),X(n,u,y(n,t.data_src))},VIDEO:function(n,t){H(n,(function(n){q(n,V),X(n,u,y(n,t.data_src))})),q(n,F),X(n,f,y(n,t.data_poster)),X(n,u,y(n,t.data_src)),n.load()}},$=["IMG","IFRAME","VIDEO"],nn=function(n,t){!t||function(n){return n.loadingCount>0}(t)||function(n){return n.toLoadCount>0}(t)||C(n.callback_finish,t)},tn=function(n,t,e){n.addEventListener(t,e),n.llEvLisnrs[t]=e},en=function(n,t,e){n.removeEventListener(t,e)},on=function(n){return!!n.llEvLisnrs},an=function(n){if(on(n)){var t=n.llEvLisnrs;for(var e in t){var i=t[e];en(n,e,i)}delete n.llEvLisnrs}},rn=function(n,t,e){!function(n){delete n.llTempImage}(n),R(e,-1),function(n){n&&(n.toLoadCount-=1)}(e),M(n,t.class_loading),t.unobserve_completed&&T(n,e)},cn=function(n,t,e){var i=z(n)||n;on(i)||function(n,t,e){on(n)||(n.llEvLisnrs={});var i="VIDEO"===n.tagName?"loadeddata":"load";tn(n,i,t),tn(n,"error",e)}(i,(function(o){!function(n,t,e,i){var o=O(t);rn(t,e,i),N(t,e.class_loaded),w(t,b),C(e.callback_loaded,t,i),o||nn(e,i)}(0,n,t,e),an(i)}),(function(o){!function(n,t,e,i){var o=O(t);rn(t,e,i),N(t,e.class_error),w(t,p),C(e.callback_error,t,i),e.restore_on_error&&K(t,B),o||nn(e,i)}(0,n,t,e),an(i)}))},ln=function(n,t,e){!function(n){return $.indexOf(n.tagName)>-1}(n)?function(n,t,e){!function(n){n.llTempImage=document.createElement("IMG")}(n),cn(n,t,e),function(n){P(n)||(n[_]={backgroundImage:n.style.backgroundImage})}(n),function(n,t,e){var i=y(n,t.data_bg),o=y(n,t.data_bg_hidpi),r=a&&o?o:i;r&&(n.style.backgroundImage='url("'.concat(r,'")'),z(n).setAttribute(u,r),W(n,t,e))}(n,t,e),function(n,t,e){var i=y(n,t.data_bg_multi),o=y(n,t.data_bg_multi_hidpi),r=a&&o?o:i;r&&(n.style.backgroundImage=r,Q(n,t,e))}(n,t,e),function(n,t,e){var i=y(n,t.data_bg_set);if(i){var o=i.split("|"),a=o.map((function(n){return"image-set(".concat(n,")")}));n.style.backgroundImage=a.join(),""===n.style.backgroundImage&&(a=o.map((function(n){return"-webkit-image-set(".concat(n,")")})),n.style.backgroundImage=a.join()),Q(n,t,e)}}(n,t,e)}(n,t,e):function(n,t,e){cn(n,t,e),function(n,t,e){var i=Z[n.tagName];i&&(i(n,t),W(n,t,e))}(n,t,e)}(n,t,e)},un=function(n){n.removeAttribute(u),n.removeAttribute(s),n.removeAttribute(d)},sn=function(n){D(n,(function(n){K(n,B)})),K(n,B)},dn={IMG:sn,IFRAME:function(n){K(n,V)},VIDEO:function(n){H(n,(function(n){K(n,V)})),K(n,F),n.load()}},fn=function(n,t){(function(n){var t=dn[n.tagName];t?t(n):function(n){if(P(n)){var t=S(n);n.style.backgroundImage=t.backgroundImage}}(n)})(n),function(n,t){L(n)||O(n)||(M(n,t.class_entered),M(n,t.class_exited),M(n,t.class_applied),M(n,t.class_loading),M(n,t.class_loaded),M(n,t.class_error))}(n,t),A(n),U(n)},_n=["IMG","IFRAME","VIDEO"],gn=function(n){return n.use_native&&"loading"in HTMLImageElement.prototype},vn=function(n,t,e){n.forEach((function(n){return function(n){return n.isIntersecting||n.intersectionRatio>0}(n)?function(n,t,e,i){var o=function(n){return x.indexOf(k(n))>=0}(n);w(n,"entered"),N(n,e.class_entered),M(n,e.class_exited),function(n,t,e){t.unobserve_entered&&T(n,e)}(n,e,i),C(e.callback_enter,n,t,i),o||ln(n,e,i)}(n.target,n,t,e):function(n,t,e,i){L(n)||(N(n,e.class_exited),function(n,t,e,i){e.cancel_on_exit&&function(n){return k(n)===v}(n)&&"IMG"===n.tagName&&(an(n),function(n){D(n,(function(n){un(n)})),un(n)}(n),sn(n),M(n,e.class_loading),R(i,-1),A(n),C(e.callback_cancel,n,t,i))}(n,t,e,i),C(e.callback_exit,n,t,i))}(n.target,n,t,e)}))},bn=function(n){return Array.prototype.slice.call(n)},mn=function(n){return n.container.querySelectorAll(n.elements_selector)},pn=function(n){return function(n){return k(n)===p}(n)},hn=function(n,t){return function(n){return bn(n).filter(L)}(n||mn(t))},En=function(n,e){var o=c(n);this._settings=o,this.loadingCount=0,function(n,t){i&&!gn(n)&&(t._observer=new IntersectionObserver((function(e){vn(e,n,t)}),function(n){return{root:n.container===document?null:n.container,rootMargin:n.thresholds||n.threshold+"px"}}(n)))}(o,this),function(n,e){t&&(e._onlineHandler=function(){!function(n,t){var e;(e=mn(n),bn(e).filter(pn)).forEach((function(t){M(t,n.class_error),A(t)})),t.update()}(n,e)},window.addEventListener("online",e._onlineHandler))}(o,this),this.update(e)};return En.prototype={update:function(n){var t,o,a=this._settings,r=hn(n,a);G(this,r.length),!e&&i?gn(a)?function(n,t,e){n.forEach((function(n){-1!==_n.indexOf(n.tagName)&&function(n,t,e){n.setAttribute("loading","lazy"),cn(n,t,e),function(n,t){var e=Z[n.tagName];e&&e(n,t)}(n,t),w(n,h)}(n,t,e)})),G(e,0)}(r,a,this):(o=r,function(n){n.disconnect()}(t=this._observer),function(n,t){t.forEach((function(t){n.observe(t)}))}(t,o)):this.loadAll(r)},destroy:function(){this._observer&&this._observer.disconnect(),t&&window.removeEventListener("online",this._onlineHandler),mn(this._settings).forEach((function(n){U(n)})),delete this._observer,delete this._settings,delete this._onlineHandler,delete this.loadingCount,delete this.toLoadCount},loadAll:function(n){var t=this,e=this._settings;hn(n,e).forEach((function(n){T(n,t),ln(n,e,t)}))},restoreAll:function(){var n=this._settings;mn(n).forEach((function(t){fn(t,n)}))}},En.load=function(n,t){var e=c(t);ln(n,e)},En.resetStatus=function(n){A(n)},t&&function(n,t){if(t)if(t.length)for(var e,i=0;e=t[i];i+=1)l(n,e);else l(n,t)}(En,window.lazyLoadOptions),En}));]]></content>
  </entry>
  <entry>
    <title>随机文章</title>
    <url>/random/index.html</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Repositories</title>
    <url>/repository/index.html</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>标签</title>
    <url>/tags/index.html</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title></title>
    <url>/web/730297772.html</url>
    <content><![CDATA[<!DOCTYPE html>
<html>
<head>
	<title> 吖远の鱼尾纹插件 鱼尾纹发卡机器人 </title>
    <meta name="validation-tag" content="ssad/tetris_web/page/adapt_pc" />
  
  首页地址 index{}index
  购买地址 gm{}gm

  超级按钮1名称 ab1{更多功能>>>}ab1
  超级按钮1名称 ab2{使用方法}ab2
  超级按钮1名称 ab3{检查更新}ab3
  超级按钮1名称 ab4{加QQ群交流}ab4
  
  超级按钮1地址 ad1{}ad1
  超级按钮1地址 ad2{}ad2
  超级按钮1地址 ad3{}ad3
  超级按钮1地址 ad4{}ad4

  广告按钮 gg{插件定制联系QQ：730297772}gg
  

</head>]]></content>
  </entry>
  <entry>
    <title></title>
    <url>/web/NMSL.html</url>
    <content><![CDATA[<!DOCTYPE html>
<html>
<head>
	<title> 吖远zzyの雅俗并存APP </title>
    <meta name="validation-tag" content="ssad/tetris_web/page/adapt_pc" />
  
  软件上个版本：20191209
  
  软件版本bb【20191209】bb
  
  公告发布gg【welcome!!!】gg
  
  介绍说明js【暂无介绍】js
  
  下载地址xz【http://dz.hzv5.cn/BlogRss20191205.apk】xz

</head>]]></content>
  </entry>
  <entry>
    <title></title>
    <url>/web/BlogRss.html</url>
    <content><![CDATA[<!DOCTYPE html>
<html>
<head>
	<title> 吖远zzyの博客订阅APP </title>
    <meta name="validation-tag" content="ssad/tetris_web/page/adapt_pc" />
  
  软件上个版本：20191214
  
  软件版本bb【20191214】bb
  
  公告发布gg【20191214更新:
  优化制杖速度，让它尽量不那么智障！
  感谢支持！】gg
  
  介绍说明js【Rss订阅博客，软件完全免费使用。
  理论上首页博客浏览，是支持任意博客浏览的，然后订阅栏目提供rss地址即可获取博客的文章订阅显示了。
  软件尚在持续开发更新阶段，可能存在一些问题没有修复，若您对本软件有哪些好的建议或意见，请通过软件内联系方式与我取得联系！
  感谢支持！】js
  
  下载地址xz【http://dz.hzv5.cn/BlogRss20191214.apk】xz




【推荐订阅列表】

博客名称mc【月光博客【隔】尚磊's Blog【隔】王魏 iOS【隔】玉令天下【隔】豆瓣影评【隔】意林【隔】青年文摘【隔】腾讯CDC【隔】36氪【隔】爱范儿【隔】月宅酱【隔】SEO技术【隔】酷壳【隔】羽忆江南【隔】皮毛技术君【隔】会写代码的猪【隔】你的益达】mc

博客地址dz【https://www.williamlong.info/rss.xml【隔】http://shanglei.net/feed/【隔】https://onevcat.com/feed.xml【隔】http://yulingtianxia.com/atom.xml【隔】https://www.douban.com/feed/review/movie【隔】http://blog.sina.com.cn/rss/yilinzazhi.xml【隔】http://blog.sina.com.cn/rss/qnwzlb.xml【隔】https://cdc.tencent.com/feed/【隔】https://36kr.com/feed/【隔】https://www.ifanr.com/feed/【隔】https://ikmoe.com/feed/【隔】https://www.seozac.com/feed/【隔】https://coolshell.cn/feed/【隔】https://yyjn.org/feed/【隔】https://www.whoit.top/feed/【隔】http://gaosboy.com/feed/【隔】https://1000yun.cn/feed/】dz

</head>]]></content>
  </entry>
  <entry>
    <title></title>
    <url>/web/autojs_dy_pldz.html</url>
    <content><![CDATA[<!DOCTYPE html>
<html>
<head>
	<title> 吖远zzyの软件授权 </title>
    <meta name="validation-tag" content="ssad/tetris_web/page/adapt_pc" />
  
	授权用户列表：
	
	My华为p20Pro：10AY2240caab677a8efb17202240
	My华为p20Pro：10AY22408756a54aec9478cc2240
	
	YH华为nova2S：9AY2160016aaee01a51e40b2160
	YHvivoX20A：8.1.0AY21601aee571a4b84f5122160
	
	QQ群小杰：9AY2340fc0aef783592aa722340
	
	更多...

</head>]]></content>
  </entry>
  <entry>
    <title></title>
    <url>/web/hzcj.html</url>
    <content><![CDATA[<!DOCTYPE html>
<html>
<head>
	<title> 吖远zzyの猴子插件检测 </title>
    <meta name="validation-tag" content="ssad/tetris_web/page/adapt_pc" />
  
  授权用户列表：

  【【【2831935979_2017年1月18日丨1552121603_2017年7月18日丨2717075548_2017年1月18日丨1505643353_2099年12月30日丨799291101_2099年12月30日丨859885954_2099年12月30日丨1032062665_2099年12月30日丨314959475_2017年3月17日丨3314917982_2017年4月30日丨3444517972_2017年4月24日丨3549137510_2017年6月11日丨3499557120_2017年6月19日丨2221666768_2018年2月20日丨2167184783_2018年6月7日丨2636924510_2019年9月18日丨914106223_2020年1月15日】】】

</head>]]></content>
  </entry>
  <entry>
    <title></title>
    <url>/web/index.html</url>
    <content><![CDATA[<!DOCTYPE html>
<html>
<head>
	<title> 吖远zzyの博客 </title>
    <meta name="validation-tag" content="ssad/tetris_web/page/adapt_pc" />
  
  404 NOT FOUND

</head>]]></content>
  </entry>
</search>
