import{s as e,c as l,a as t,h as s,b as a,w as i,i as n,o,d as c,e as u,n as d,f as r,t as f,g as h,r as p,F as g,j as m,k as _,l as w,m as b}from"./index-B_HgWrMB.js";const I=((e,l)=>{const t=e.__vccOpts||e;for(const[s,a]of l)t[s]=a;return t})({data:()=>({files:[],previewImages:[],hasImages:!1,processResult:null,zipContent:null,maxImages:20,isDragging:!1,showHelpModal:!1}),methods:{getFileName(e){const l=e.name||e.path.split("/").pop();return l.length>15?l.substring(0,12)+"...":l},formatFileSize(e){if(0===e)return"0 B";const l=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,l)).toFixed(2)+" "+["B","KB","MB","GB"][l]},async calculateBlobsSize(e){let l=0;for(const t of e)l+=t.size;return this.formatFileSize(l)},async chooseImages(){try{const t=this.maxImages-this.files.length;if(t<=0)return void e({title:`最多只能上传${this.maxImages}张图片`,icon:"none"});const s=await l({count:t,sourceType:["album"]});this.handleSelectedFiles(s.tempFiles)}catch(t){console.error(t)}},deleteImage(e){this.files.splice(e,1),this.previewImages.splice(e,1),this.hasImages=this.files.length>0,this.processResult=null,this.zipContent=null},handleDragOver(e){this.isDragging=!0},handleDragLeave(e){this.isDragging=!1},handleDrop(l){this.isDragging=!1;const t=Array.from(l.dataTransfer.files);this.files.length+t.length>this.maxImages?e({title:`最多只能上传${this.maxImages}张图片`,icon:"none"}):this.handleSelectedFiles(t)},handleSelectedFiles(l){const t=l.filter((e=>e.type.startsWith("image/")));if(this.files.length+t.length>this.maxImages)return void e({title:`最多只能上传${this.maxImages}张图片`,icon:"none"});this.files.push(...t);const s=t.map((e=>e.path?e.path:URL.createObjectURL(e)));this.previewImages.push(...s),this.hasImages=this.files.length>0,this.processResult=null,this.zipContent=null},createImage:e=>new Promise((l=>{const t=new Image;t.src=e.path||URL.createObjectURL(e),t.onload=()=>l(t)})),getImageBlob(e){const l=document.createElement("canvas");l.width=e.width,l.height=e.height;return l.getContext("2d").drawImage(e,0,0),new Promise((e=>{l.toBlob(e,"image/jpeg",.9)}))},resizeImage(e,l,t){const s=document.createElement("canvas");s.width=l,s.height=t;const a=s.getContext("2d"),i=Math.min(l/e.width,t/e.height),n=e.width*i,o=e.height*i,c=(l-n)/2,u=(t-o)/2;return a.fillStyle="white",a.fillRect(0,0,l,t),a.drawImage(e,c,u,n,o),new Promise((e=>{s.toBlob(e,"image/jpeg",.9)}))},async processImages(){if("undefined"!=typeof JSZip&&"undefined"!=typeof saveAs){t({title:"处理中...",mask:!0});try{const l=new JSZip,t=l.folder("photos"),a=l.folder("min_photos"),i={list:[]},n=[],o=[];for(const e of this.files){const l=await this.createImage(e),s=await this.getImageBlob(l),c=await this.resizeImage(l,360,360);n.push(s),o.push(c);const u=e.name||e.path.split("/").pop(),d=u.substring(0,u.lastIndexOf(".")),r=new Date,f=r.getFullYear(),h=r.getMonth()+1,p=`${f}-${h.toString().padStart(2,"0")}`;i.list.push({date:p,arr:{year:f,month:h,link:[u],text:[d],type:["image"]}}),t.file(u,s),a.file(u,c)}l.file("data.json",JSON.stringify(i,null,2));const c=await l.generateAsync({type:"blob"});this.processResult={imageCount:this.files.length,originalSize:await this.calculateBlobsSize(n),thumbnailSize:await this.calculateBlobsSize(o),zipSize:this.formatFileSize(c.size)},this.zipContent=c,e({title:"处理完成",icon:"success"})}catch(l){console.error(l),e({title:"处理失败",icon:"error"})}finally{s()}}else e({title:"依赖加载失败，请刷新页面重试",icon:"none"})},downloadZip(){this.zipContent&&saveAs(this.zipContent,"photos.zip")},showHelp(){this.showHelpModal=!0},hideHelp(){this.showHelpModal=!1},openWebsite(){window.open("https://www.hzv5.cn","_blank")}}},[["render",function(e,l,t,s,I,v){const z=n,C=_,k=b,y=w;return o(),a(z,{class:"container"},{default:i((()=>[c(z,{class:"header"},{default:i((()=>[c(z,{class:"header-content"},{default:i((()=>[c(z,{class:"title"},{default:i((()=>[u("图片批量处理工具")])),_:1}),c(z,{class:"help-btn",onClick:v.showHelp},{default:i((()=>[u("👋")])),_:1},8,["onClick"])])),_:1}),c(z,{class:"subtitle"},{default:i((()=>[u("支持批量生成缩略图和JSON数据")])),_:1})])),_:1}),c(z,{class:"main-content"},{default:i((()=>[c(z,{class:d(["upload-zone",{dragging:I.isDragging}]),onClick:v.chooseImages,onDragover:r(v.handleDragOver,["prevent"]),onDragleave:r(v.handleDragLeave,["prevent"]),onDrop:r(v.handleDrop,["prevent"])},{default:i((()=>[c(z,{class:"upload-icon"},{default:i((()=>[c(C,null,{default:i((()=>[u("📸")])),_:1})])),_:1}),c(C,{class:"upload-text"},{default:i((()=>[u("点击或拖拽图片到这里上传")])),_:1}),c(C,{class:"upload-tip"},{default:i((()=>[u("支持jpg、png格式，最多可上传20张图片")])),_:1})])),_:1},8,["class","onClick","onDragover","onDragleave","onDrop"]),I.files.length>0?(o(),a(z,{key:0,class:"preview-section"},{default:i((()=>[c(z,{class:"section-header"},{default:i((()=>[c(C,{class:"section-title"},{default:i((()=>[u("已选择图片")])),_:1}),c(C,{class:"image-count"},{default:i((()=>[u(f(I.files.length)+"/"+f(I.maxImages),1)])),_:1})])),_:1}),c(z,{class:"preview-container"},{default:i((()=>[(o(!0),h(g,null,p(I.previewImages,((e,l)=>(o(),a(z,{key:l,class:"preview-item-wrapper"},{default:i((()=>[c(k,{src:e,class:"preview-item",mode:"aspectFill"},null,8,["src"]),c(z,{class:"delete-btn",onClick:r((e=>v.deleteImage(l)),["stop"])},{default:i((()=>[u("❌")])),_:2},1032,["onClick"]),c(z,{class:"image-name"},{default:i((()=>[u(f(v.getFileName(I.files[l])),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):m("",!0),c(y,{class:d(["process-btn",{"can-process":I.hasImages}]),disabled:!I.hasImages,onClick:v.processImages},{default:i((()=>[c(C,null,{default:i((()=>[u("⚡️")])),_:1}),c(C,null,{default:i((()=>[u("处理图片")])),_:1})])),_:1},8,["class","disabled","onClick"]),I.processResult?(o(),a(z,{key:1,class:"result-container"},{default:i((()=>[c(z,{class:"result-header"},{default:i((()=>[c(z,{class:"result-title"},{default:i((()=>[u("处理完成")])),_:1}),c(z,{class:"result-subtitle"},{default:i((()=>[u("图片处理已完成，可以下载压缩包")])),_:1})])),_:1}),c(z,{class:"result-info"},{default:i((()=>[c(z,{class:"info-item"},{default:i((()=>[c(C,null,{default:i((()=>[u("🖼️")])),_:1}),c(z,{class:"info-content"},{default:i((()=>[c(C,{class:"label"},{default:i((()=>[u("处理图片数量")])),_:1}),c(C,{class:"value"},{default:i((()=>[u(f(I.processResult.imageCount)+"张",1)])),_:1})])),_:1})])),_:1}),c(z,{class:"info-item"},{default:i((()=>[c(C,null,{default:i((()=>[u("📁")])),_:1}),c(z,{class:"info-content"},{default:i((()=>[c(C,{class:"label"},{default:i((()=>[u("原图总大小")])),_:1}),c(C,{class:"value"},{default:i((()=>[u(f(I.processResult.originalSize),1)])),_:1})])),_:1})])),_:1}),c(z,{class:"info-item"},{default:i((()=>[c(C,null,{default:i((()=>[u("🔍")])),_:1}),c(z,{class:"info-content"},{default:i((()=>[c(C,{class:"label"},{default:i((()=>[u("缩略图总大小")])),_:1}),c(C,{class:"value"},{default:i((()=>[u(f(I.processResult.thumbnailSize),1)])),_:1})])),_:1})])),_:1}),c(z,{class:"info-item"},{default:i((()=>[c(C,null,{default:i((()=>[u("📦")])),_:1}),c(z,{class:"info-content"},{default:i((()=>[c(C,{class:"label"},{default:i((()=>[u("压缩包大小")])),_:1}),c(C,{class:"value"},{default:i((()=>[u(f(I.processResult.zipSize),1)])),_:1})])),_:1})])),_:1})])),_:1}),c(y,{class:"download-btn",onClick:v.downloadZip},{default:i((()=>[c(C,null,{default:i((()=>[u("⬇️")])),_:1}),c(C,null,{default:i((()=>[u("下载压缩包")])),_:1})])),_:1},8,["onClick"])])),_:1})):m("",!0)])),_:1}),c(z,{class:"footer"},{default:i((()=>[c(C,{class:"footer-text"},{default:i((()=>[u("图片批量处理工具 © 2023,"),c(C,{style:{color:"royalblue","font-weight":"600"},onClick:v.openWebsite},{default:i((()=>[u("吖远zzy")])),_:1},8,["onClick"])])),_:1})])),_:1}),I.showHelpModal?(o(),a(z,{key:0,class:"help-modal",onClick:v.hideHelp},{default:i((()=>[c(z,{class:"modal-content",onClick:l[0]||(l[0]=r((()=>{}),["stop"]))},{default:i((()=>[c(z,{class:"modal-header"},{default:i((()=>[c(C,{class:"modal-title"},{default:i((()=>[u("使用帮助 🎯")])),_:1}),c(C,{class:"close-btn",onClick:v.hideHelp},{default:i((()=>[u("×")])),_:1},8,["onClick"])])),_:1}),c(z,{class:"modal-body"},{default:i((()=>[c(z,{class:"help-section"},{default:i((()=>[c(z,{class:"help-title"},{default:i((()=>[u("🎨 主要功能")])),_:1}),c(z,{class:"help-text"},{default:i((()=>[c(C,null,{default:i((()=>[u("• 批量处理图片并生成缩略图")])),_:1}),c(C,null,{default:i((()=>[u("• 自动生成JSON数据文件")])),_:1}),c(C,null,{default:i((()=>[u("• 支持拖拽上传和预览")])),_:1}),c(C,null,{default:i((()=>[u("• 最多可处理20张图片")])),_:1})])),_:1})])),_:1}),c(z,{class:"help-section"},{default:i((()=>[c(z,{class:"help-title"},{default:i((()=>[u("📝 使用步骤")])),_:1}),c(z,{class:"help-text"},{default:i((()=>[c(C,null,{default:i((()=>[u("1. 点击或拖拽上传图片")])),_:1}),c(C,null,{default:i((()=>[u("2. 预览并确认图片")])),_:1}),c(C,null,{default:i((()=>[u("3. 点击处理按钮")])),_:1}),c(C,null,{default:i((()=>[u("4. 下载生成的压缩包")])),_:1})])),_:1})])),_:1}),c(z,{class:"help-section"},{default:i((()=>[c(z,{class:"help-title"},{default:i((()=>[u("📦 输出内容")])),_:1}),c(z,{class:"help-text"},{default:i((()=>[c(C,null,{default:i((()=>[u("• 原图保存在 photos 文件夹")])),_:1}),c(C,null,{default:i((()=>[u("• 缩略图保存在 min_photos 文件夹")])),_:1}),c(C,null,{default:i((()=>[u("• 自动生成 data.json 文件")])),_:1}),c(C,null,{default:i((()=>[u("• 所有文件打包成 zip 下载")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["onClick"])):m("",!0)])),_:1})}],["__scopeId","data-v-ac91bab0"]]);export{I as default};
