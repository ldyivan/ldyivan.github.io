import{s as e,c as l,a as t,h as s,b as a,w as i,i as n,o,d as c,e as u,n as d,f as r,t as f,g as h,r as p,F as g,j as m,k as _,l as w,m as b}from"./index-B_HgWrMB.js";const I=((e,l)=>{const t=e.__vccOpts||e;for(const[s,a]of l)t[s]=a;return t})({data:()=>({files:[],previewImages:[],hasImages:!1,processResult:null,zipContent:null,maxImages:20,isDragging:!1,showHelpModal:!1}),methods:{getFileName(e){const l=e.name||e.path.split("/").pop();return l.length>15?l.substring(0,12)+"...":l},formatFileSize(e){if(0===e)return"0 B";const l=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,l)).toFixed(2)+" "+["B","KB","MB","GB"][l]},async calculateBlobsSize(e){let l=0;for(const t of e)l+=t.size;return this.formatFileSize(l)},async chooseImages(){try{const t=this.maxImages-this.files.length;if(t<=0)return void e({title:`æœ€å¤šåªèƒ½ä¸Šä¼ ${this.maxImages}å¼ å›¾ç‰‡`,icon:"none"});const s=await l({count:t,sourceType:["album"]});this.handleSelectedFiles(s.tempFiles)}catch(t){console.error(t)}},deleteImage(e){this.files.splice(e,1),this.previewImages.splice(e,1),this.hasImages=this.files.length>0,this.processResult=null,this.zipContent=null},handleDragOver(e){this.isDragging=!0},handleDragLeave(e){this.isDragging=!1},handleDrop(l){this.isDragging=!1;const t=Array.from(l.dataTransfer.files);this.files.length+t.length>this.maxImages?e({title:`æœ€å¤šåªèƒ½ä¸Šä¼ ${this.maxImages}å¼ å›¾ç‰‡`,icon:"none"}):this.handleSelectedFiles(t)},handleSelectedFiles(l){const t=l.filter((e=>e.type.startsWith("image/")));if(this.files.length+t.length>this.maxImages)return void e({title:`æœ€å¤šåªèƒ½ä¸Šä¼ ${this.maxImages}å¼ å›¾ç‰‡`,icon:"none"});this.files.push(...t);const s=t.map((e=>e.path?e.path:URL.createObjectURL(e)));this.previewImages.push(...s),this.hasImages=this.files.length>0,this.processResult=null,this.zipContent=null},createImage:e=>new Promise((l=>{const t=new Image;t.src=e.path||URL.createObjectURL(e),t.onload=()=>l(t)})),getImageBlob(e){const l=document.createElement("canvas");l.width=e.width,l.height=e.height;return l.getContext("2d").drawImage(e,0,0),new Promise((e=>{l.toBlob(e,"image/jpeg",.9)}))},resizeImage(e,l,t){const s=document.createElement("canvas");s.width=l,s.height=t;const a=s.getContext("2d"),i=Math.min(l/e.width,t/e.height),n=e.width*i,o=e.height*i,c=(l-n)/2,u=(t-o)/2;return a.fillStyle="white",a.fillRect(0,0,l,t),a.drawImage(e,c,u,n,o),new Promise((e=>{s.toBlob(e,"image/jpeg",.9)}))},async processImages(){if("undefined"!=typeof JSZip&&"undefined"!=typeof saveAs){t({title:"å¤„ç†ä¸­...",mask:!0});try{const l=new JSZip,t=l.folder("photos"),a=l.folder("min_photos"),i={list:[]},n=[],o=[];for(const e of this.files){const l=await this.createImage(e),s=await this.getImageBlob(l),c=await this.resizeImage(l,360,360);n.push(s),o.push(c);const u=e.name||e.path.split("/").pop(),d=u.substring(0,u.lastIndexOf(".")),r=new Date,f=r.getFullYear(),h=r.getMonth()+1,p=`${f}-${h.toString().padStart(2,"0")}`;i.list.push({date:p,arr:{year:f,month:h,link:[u],text:[d],type:["image"]}}),t.file(u,s),a.file(u,c)}l.file("data.json",JSON.stringify(i,null,2));const c=await l.generateAsync({type:"blob"});this.processResult={imageCount:this.files.length,originalSize:await this.calculateBlobsSize(n),thumbnailSize:await this.calculateBlobsSize(o),zipSize:this.formatFileSize(c.size)},this.zipContent=c,e({title:"å¤„ç†å®Œæˆ",icon:"success"})}catch(l){console.error(l),e({title:"å¤„ç†å¤±è´¥",icon:"error"})}finally{s()}}else e({title:"ä¾èµ–åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•",icon:"none"})},downloadZip(){this.zipContent&&saveAs(this.zipContent,"photos.zip")},showHelp(){this.showHelpModal=!0},hideHelp(){this.showHelpModal=!1},openWebsite(){window.open("https://www.hzv5.cn","_blank")}}},[["render",function(e,l,t,s,I,v){const z=n,C=_,k=b,y=w;return o(),a(z,{class:"container"},{default:i((()=>[c(z,{class:"header"},{default:i((()=>[c(z,{class:"header-content"},{default:i((()=>[c(z,{class:"title"},{default:i((()=>[u("å›¾ç‰‡æ‰¹é‡å¤„ç†å·¥å…·")])),_:1}),c(z,{class:"help-btn",onClick:v.showHelp},{default:i((()=>[u("ğŸ‘‹")])),_:1},8,["onClick"])])),_:1}),c(z,{class:"subtitle"},{default:i((()=>[u("æ”¯æŒæ‰¹é‡ç”Ÿæˆç¼©ç•¥å›¾å’ŒJSONæ•°æ®")])),_:1})])),_:1}),c(z,{class:"main-content"},{default:i((()=>[c(z,{class:d(["upload-zone",{dragging:I.isDragging}]),onClick:v.chooseImages,onDragover:r(v.handleDragOver,["prevent"]),onDragleave:r(v.handleDragLeave,["prevent"]),onDrop:r(v.handleDrop,["prevent"])},{default:i((()=>[c(z,{class:"upload-icon"},{default:i((()=>[c(C,null,{default:i((()=>[u("ğŸ“¸")])),_:1})])),_:1}),c(C,{class:"upload-text"},{default:i((()=>[u("ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°è¿™é‡Œä¸Šä¼ ")])),_:1}),c(C,{class:"upload-tip"},{default:i((()=>[u("æ”¯æŒjpgã€pngæ ¼å¼ï¼Œæœ€å¤šå¯ä¸Šä¼ 20å¼ å›¾ç‰‡")])),_:1})])),_:1},8,["class","onClick","onDragover","onDragleave","onDrop"]),I.files.length>0?(o(),a(z,{key:0,class:"preview-section"},{default:i((()=>[c(z,{class:"section-header"},{default:i((()=>[c(C,{class:"section-title"},{default:i((()=>[u("å·²é€‰æ‹©å›¾ç‰‡")])),_:1}),c(C,{class:"image-count"},{default:i((()=>[u(f(I.files.length)+"/"+f(I.maxImages),1)])),_:1})])),_:1}),c(z,{class:"preview-container"},{default:i((()=>[(o(!0),h(g,null,p(I.previewImages,((e,l)=>(o(),a(z,{key:l,class:"preview-item-wrapper"},{default:i((()=>[c(k,{src:e,class:"preview-item",mode:"aspectFill"},null,8,["src"]),c(z,{class:"delete-btn",onClick:r((e=>v.deleteImage(l)),["stop"])},{default:i((()=>[u("âŒ")])),_:2},1032,["onClick"]),c(z,{class:"image-name"},{default:i((()=>[u(f(v.getFileName(I.files[l])),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):m("",!0),c(y,{class:d(["process-btn",{"can-process":I.hasImages}]),disabled:!I.hasImages,onClick:v.processImages},{default:i((()=>[c(C,null,{default:i((()=>[u("âš¡ï¸")])),_:1}),c(C,null,{default:i((()=>[u("å¤„ç†å›¾ç‰‡")])),_:1})])),_:1},8,["class","disabled","onClick"]),I.processResult?(o(),a(z,{key:1,class:"result-container"},{default:i((()=>[c(z,{class:"result-header"},{default:i((()=>[c(z,{class:"result-title"},{default:i((()=>[u("å¤„ç†å®Œæˆ")])),_:1}),c(z,{class:"result-subtitle"},{default:i((()=>[u("å›¾ç‰‡å¤„ç†å·²å®Œæˆï¼Œå¯ä»¥ä¸‹è½½å‹ç¼©åŒ…")])),_:1})])),_:1}),c(z,{class:"result-info"},{default:i((()=>[c(z,{class:"info-item"},{default:i((()=>[c(C,null,{default:i((()=>[u("ğŸ–¼ï¸")])),_:1}),c(z,{class:"info-content"},{default:i((()=>[c(C,{class:"label"},{default:i((()=>[u("å¤„ç†å›¾ç‰‡æ•°é‡")])),_:1}),c(C,{class:"value"},{default:i((()=>[u(f(I.processResult.imageCount)+"å¼ ",1)])),_:1})])),_:1})])),_:1}),c(z,{class:"info-item"},{default:i((()=>[c(C,null,{default:i((()=>[u("ğŸ“")])),_:1}),c(z,{class:"info-content"},{default:i((()=>[c(C,{class:"label"},{default:i((()=>[u("åŸå›¾æ€»å¤§å°")])),_:1}),c(C,{class:"value"},{default:i((()=>[u(f(I.processResult.originalSize),1)])),_:1})])),_:1})])),_:1}),c(z,{class:"info-item"},{default:i((()=>[c(C,null,{default:i((()=>[u("ğŸ”")])),_:1}),c(z,{class:"info-content"},{default:i((()=>[c(C,{class:"label"},{default:i((()=>[u("ç¼©ç•¥å›¾æ€»å¤§å°")])),_:1}),c(C,{class:"value"},{default:i((()=>[u(f(I.processResult.thumbnailSize),1)])),_:1})])),_:1})])),_:1}),c(z,{class:"info-item"},{default:i((()=>[c(C,null,{default:i((()=>[u("ğŸ“¦")])),_:1}),c(z,{class:"info-content"},{default:i((()=>[c(C,{class:"label"},{default:i((()=>[u("å‹ç¼©åŒ…å¤§å°")])),_:1}),c(C,{class:"value"},{default:i((()=>[u(f(I.processResult.zipSize),1)])),_:1})])),_:1})])),_:1})])),_:1}),c(y,{class:"download-btn",onClick:v.downloadZip},{default:i((()=>[c(C,null,{default:i((()=>[u("â¬‡ï¸")])),_:1}),c(C,null,{default:i((()=>[u("ä¸‹è½½å‹ç¼©åŒ…")])),_:1})])),_:1},8,["onClick"])])),_:1})):m("",!0)])),_:1}),c(z,{class:"footer"},{default:i((()=>[c(C,{class:"footer-text"},{default:i((()=>[u("å›¾ç‰‡æ‰¹é‡å¤„ç†å·¥å…· Â© 2023,"),c(C,{style:{color:"royalblue","font-weight":"600"},onClick:v.openWebsite},{default:i((()=>[u("å–è¿œzzy")])),_:1},8,["onClick"])])),_:1})])),_:1}),I.showHelpModal?(o(),a(z,{key:0,class:"help-modal",onClick:v.hideHelp},{default:i((()=>[c(z,{class:"modal-content",onClick:l[0]||(l[0]=r((()=>{}),["stop"]))},{default:i((()=>[c(z,{class:"modal-header"},{default:i((()=>[c(C,{class:"modal-title"},{default:i((()=>[u("ä½¿ç”¨å¸®åŠ© ğŸ¯")])),_:1}),c(C,{class:"close-btn",onClick:v.hideHelp},{default:i((()=>[u("Ã—")])),_:1},8,["onClick"])])),_:1}),c(z,{class:"modal-body"},{default:i((()=>[c(z,{class:"help-section"},{default:i((()=>[c(z,{class:"help-title"},{default:i((()=>[u("ğŸ¨ ä¸»è¦åŠŸèƒ½")])),_:1}),c(z,{class:"help-text"},{default:i((()=>[c(C,null,{default:i((()=>[u("â€¢ æ‰¹é‡å¤„ç†å›¾ç‰‡å¹¶ç”Ÿæˆç¼©ç•¥å›¾")])),_:1}),c(C,null,{default:i((()=>[u("â€¢ è‡ªåŠ¨ç”ŸæˆJSONæ•°æ®æ–‡ä»¶")])),_:1}),c(C,null,{default:i((()=>[u("â€¢ æ”¯æŒæ‹–æ‹½ä¸Šä¼ å’Œé¢„è§ˆ")])),_:1}),c(C,null,{default:i((()=>[u("â€¢ æœ€å¤šå¯å¤„ç†20å¼ å›¾ç‰‡")])),_:1})])),_:1})])),_:1}),c(z,{class:"help-section"},{default:i((()=>[c(z,{class:"help-title"},{default:i((()=>[u("ğŸ“ ä½¿ç”¨æ­¥éª¤")])),_:1}),c(z,{class:"help-text"},{default:i((()=>[c(C,null,{default:i((()=>[u("1. ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡")])),_:1}),c(C,null,{default:i((()=>[u("2. é¢„è§ˆå¹¶ç¡®è®¤å›¾ç‰‡")])),_:1}),c(C,null,{default:i((()=>[u("3. ç‚¹å‡»å¤„ç†æŒ‰é’®")])),_:1}),c(C,null,{default:i((()=>[u("4. ä¸‹è½½ç”Ÿæˆçš„å‹ç¼©åŒ…")])),_:1})])),_:1})])),_:1}),c(z,{class:"help-section"},{default:i((()=>[c(z,{class:"help-title"},{default:i((()=>[u("ğŸ“¦ è¾“å‡ºå†…å®¹")])),_:1}),c(z,{class:"help-text"},{default:i((()=>[c(C,null,{default:i((()=>[u("â€¢ åŸå›¾ä¿å­˜åœ¨ photos æ–‡ä»¶å¤¹")])),_:1}),c(C,null,{default:i((()=>[u("â€¢ ç¼©ç•¥å›¾ä¿å­˜åœ¨ min_photos æ–‡ä»¶å¤¹")])),_:1}),c(C,null,{default:i((()=>[u("â€¢ è‡ªåŠ¨ç”Ÿæˆ data.json æ–‡ä»¶")])),_:1}),c(C,null,{default:i((()=>[u("â€¢ æ‰€æœ‰æ–‡ä»¶æ‰“åŒ…æˆ zip ä¸‹è½½")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["onClick"])):m("",!0)])),_:1})}],["__scopeId","data-v-ac91bab0"]]);export{I as default};
